<?xml version="1.0" encoding="UTF-8"?>
<result>
   <comment start="1" end="1408"/>
   <literal type="34" start="1420" end="1464"/>
   <literal type="34" start="1500" end="1543"/>
   <literal type="34" start="1548" end="1563"/>
   <literal type="34" start="1580" end="1623"/>
   <literal type="34" start="1628" end="1650"/>
   <literal type="34" start="1681" end="1725"/>
   <literal type="34" start="1730" end="1746"/>
   <comment start="1751" end="1867"/>
   <literal type="34" start="1919" end="1929"/>
   <literal type="34" start="1934" end="1949"/>
   <comment start="1958" end="2025"/>
   <comment start="2098" end="2146"/>
   <literal type="34" start="2200" end="2204"/>
   <comment start="2208" end="2232"/>
   <comment start="2237" end="2265"/>
   <comment start="2270" end="2448"/>
   <xml-open-tag pos="3391" xxq-fnlevel="1"/>
   <xml-name-end pos="3407"/>
   <x-equals pos="3423"/>
   <xml-att-quote pos="3424"/>
   <xml-literal-start pos="3425"/>
   <xml-att-quote pos="3429"/>
   <xml-literal-end pos="3430"/>
   <x-equals pos="3436"/>
   <xml-att-quote pos="3437"/>
   <xml-literal-start pos="3438"/>
   <xml-att-quote pos="3480"/>
   <x-tag-end pos="3481" length="1"/>
   <nested-query pos="3492"/>
   <start-xquery pos="3493" xq-fnLevel="2"/>
   <xml-open-tag pos="3528" xxq-fnlevel="2"/>
   <x-tag-end pos="3533" length="1"/>
   <xml-open-tag pos="3548" xxq-fnlevel="2"/>
   <x-tag-end pos="3553" length="1"/>
   <nested-query pos="3554"/>
   <start-xquery pos="3555" xq-fnLevel="3"/>
   <unnested-xquery pos="3560"/>
   <xml-close-tag pos="3561"/>
   <x-tag-end pos="3567" length="1"/>
   <nested-query pos="3582"/>
   <start-xquery pos="3583" xq-fnLevel="3"/>
   <xml-open-tag pos="3631" xxq-fnlevel="3"/>
   <x-tag-end pos="3640" length="1"/>
   <nested-query pos="3641"/>
   <start-xquery pos="3642" xq-fnLevel="4"/>
   <unnested-xquery pos="3648"/>
   <xml-close-tag pos="3649"/>
   <x-tag-end pos="3659" length="1"/>
   <start-xquery pos="3660" xml-exit-level="2" xq-fnLevel="3"/>
   <unnested-xquery pos="3695"/>
   <resume-x-literal-txt pos="3696"/>
   <xml-close-tag pos="3706"/>
   <x-tag-end pos="3712" length="1"/>
   <start-xquery pos="3713" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="3740"/>
   <resume-x-literal-txt pos="3741"/>
   <nested-query pos="3751"/>
   <start-xquery pos="3752" xq-fnLevel="2"/>
   <unnested-xquery pos="3795"/>
   <resume-x-literal-txt pos="3796"/>
   <nested-query pos="3806"/>
   <start-xquery pos="3807" xq-fnLevel="2"/>
   <unnested-xquery pos="3840"/>
   <resume-x-literal-txt pos="3841"/>
   <nested-query pos="3851"/>
   <start-xquery pos="3852" xq-fnLevel="2"/>
   <xml-open-tag pos="3910" xxq-fnlevel="2"/>
   <x-tag-end pos="3921" length="1"/>
   <nested-query pos="3940"/>
   <start-xquery pos="3941" xq-fnLevel="3"/>
   <xml-open-tag pos="3963" xxq-fnlevel="3"/>
   <x-tag-end pos="3968" length="1"/>
   <nested-query pos="3969"/>
   <start-xquery pos="3970" xq-fnLevel="4"/>
   <unnested-xquery pos="3981"/>
   <xml-close-tag pos="3982"/>
   <x-tag-end pos="3988" length="1"/>
   <start-xquery pos="3989" xml-exit-level="2" xq-fnLevel="3"/>
   <unnested-xquery pos="3997"/>
   <resume-x-literal-txt pos="3998"/>
   <nested-query pos="4016"/>
   <start-xquery pos="4017" xq-fnLevel="3"/>
   <xml-open-tag pos="4037" xxq-fnlevel="3"/>
   <x-tag-end pos="4040" length="1"/>
   <nested-query pos="4041"/>
   <start-xquery pos="4042" xq-fnLevel="4"/>
   <unnested-xquery pos="4051"/>
   <xml-close-tag pos="4052"/>
   <x-tag-end pos="4056" length="1"/>
   <start-xquery pos="4057" xml-exit-level="2" xq-fnLevel="3"/>
   <unnested-xquery pos="4065"/>
   <resume-x-literal-txt pos="4066"/>
   <xml-close-tag pos="4080"/>
   <x-tag-end pos="4092" length="1"/>
   <start-xquery pos="4093" xml-exit-level="1" xq-fnLevel="2"/>
   <xml-open-tag pos="4141" xxq-fnlevel="2"/>
   <x-tag-end pos="4152" length="1"/>
   <xml-open-tag pos="4171" xxq-fnlevel="2"/>
   <x-tag-end pos="4189" length="1"/>
   <nested-query pos="4190"/>
   <start-xquery pos="4191" xq-fnLevel="3"/>
   <unnested-xquery pos="4200"/>
   <xml-close-tag pos="4201"/>
   <x-tag-end pos="4220" length="1"/>
   <xml-close-tag pos="4235"/>
   <x-tag-end pos="4247" length="1"/>
   <start-xquery pos="4248" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="4288"/>
   <resume-x-literal-txt pos="4289"/>
   <nested-query pos="4299"/>
   <start-xquery pos="4300" xq-fnLevel="2"/>
   <literal type="34" start="4351" end="4355"/>
   <xml-open-tag pos="4434" xxq-fnlevel="2"/>
   <x-tag-end pos="4439" length="1"/>
   <xml-open-tag pos="4440" xxq-fnlevel="2"/>
   <x-tag-end pos="4454" length="1"/>
   <nested-query pos="4455"/>
   <start-xquery pos="4456" xq-fnLevel="3"/>
   <unnested-xquery pos="4461"/>
   <xml-close-tag pos="4462"/>
   <x-tag-end pos="4477" length="1"/>
   <xml-close-tag pos="4478"/>
   <x-tag-end pos="4484" length="1"/>
   <start-xquery pos="4485" xml-exit-level="1" xq-fnLevel="2"/>
   <xml-open-tag pos="4551" xxq-fnlevel="2"/>
   <x-tag-end pos="4556" length="1"/>
   <xml-open-tag pos="4557" xxq-fnlevel="2"/>
   <x-tag-end pos="4571" length="1"/>
   <xml-close-tag pos="4576"/>
   <x-tag-end pos="4591" length="1"/>
   <xml-close-tag pos="4592"/>
   <x-tag-end pos="4598" length="1"/>
   <start-xquery pos="4599" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="4605"/>
   <resume-x-literal-txt pos="4606"/>
   <xml-close-tag pos="4612"/>
   <x-tag-end pos="4629" length="1"/>
   <start-xquery pos="4630" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="5225" xxq-fnlevel="1"/>
   <x-tag-end pos="5238" length="1"/>
   <nested-query pos="5239"/>
   <start-xquery pos="5240" xq-fnLevel="2"/>
   <unnested-xquery pos="5250"/>
   <xml-close-tag pos="5251"/>
   <x-tag-end pos="5265" length="1"/>
   <start-xquery pos="5266" xml-exit-level="0" xq-fnLevel="1"/>
   <literal type="34" start="5298" end="5302"/>
   <xml-open-tag pos="5335" xxq-fnlevel="1"/>
   <xml-name-end pos="5347"/>
   <x-equals pos="5353"/>
   <xml-att-quote pos="5354"/>
   <xml-literal-start pos="5355"/>
   <xml-att-quote pos="5397"/>
   <x-tag-end pos="5398" length="1"/>
   <xml-open-tag pos="5417" xxq-fnlevel="1"/>
   <x-tag-end pos="5424" length="1"/>
   <nested-query pos="5425"/>
   <start-xquery pos="5426" xq-fnLevel="2"/>
   <unnested-xquery pos="5433"/>
   <xml-close-tag pos="5434"/>
   <x-tag-end pos="5442" length="1"/>
   <nested-query pos="5461"/>
   <start-xquery pos="5462" xq-fnLevel="2"/>
   <unnested-xquery pos="5468"/>
   <resume-x-literal-txt pos="5469"/>
   <xml-close-tag pos="5483"/>
   <x-tag-end pos="5496" length="1"/>
   <start-xquery pos="5497" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="6125" xxq-fnlevel="1"/>
   <x-tag-end pos="6138" length="1"/>
   <nested-query pos="6139"/>
   <start-xquery pos="6140" xq-fnLevel="2"/>
   <unnested-xquery pos="6150"/>
   <xml-close-tag pos="6151"/>
   <x-tag-end pos="6165" length="1"/>
   <start-xquery pos="6166" xml-exit-level="0" xq-fnLevel="1"/>
   <literal type="34" start="6199" end="6203"/>
   <xml-open-tag pos="6236" xxq-fnlevel="1"/>
   <xml-name-end pos="6243"/>
   <x-equals pos="6249"/>
   <xml-att-quote pos="6250"/>
   <xml-literal-start pos="6251"/>
   <xml-att-quote pos="6293"/>
   <x-tag-end pos="6294" length="1"/>
   <xml-open-tag pos="6313" xxq-fnlevel="1"/>
   <x-tag-end pos="6322" length="1"/>
   <nested-query pos="6323"/>
   <start-xquery pos="6324" xq-fnLevel="2"/>
   <unnested-xquery pos="6331"/>
   <xml-close-tag pos="6332"/>
   <x-tag-end pos="6342" length="1"/>
   <nested-query pos="6361"/>
   <start-xquery pos="6362" xq-fnLevel="2"/>
   <unnested-xquery pos="6369"/>
   <resume-x-literal-txt pos="6370"/>
   <xml-close-tag pos="6384"/>
   <x-tag-end pos="6392" length="1"/>
   <start-xquery pos="6393" xml-exit-level="0" xq-fnLevel="1"/>
   <literal type="39" start="6509" end="6511"/>
   <literal type="34" start="6620" end="6622"/>
   <comment start="6651" end="6680"/>
   <comment start="6685" end="7005"/>
   <xml-open-tag pos="7137" xxq-fnlevel="1"/>
   <xml-name-end pos="7142"/>
   <x-equals pos="7149"/>
   <xml-att-quote pos="7150"/>
   <xml-literal-start pos="7151"/>
   <xml-att-quote pos="7161"/>
   <xml-literal-end pos="7162"/>
   <x-equals pos="7169"/>
   <xml-att-quote pos="7170"/>
   <xml-literal-start pos="7171"/>
   <xml-att-quote pos="7174"/>
   <x-tag-end pos="7175" length="1"/>
   <xml-open-tag pos="7191" xxq-fnlevel="1"/>
   <xml-name-end pos="7195"/>
   <x-equals pos="7201"/>
   <xml-att-quote pos="7202"/>
   <xml-literal-start pos="7203"/>
   <xml-att-quote pos="7276"/>
   <x-tag-end pos="7277" length="1"/>
   <nested-query pos="7292"/>
   <start-xquery pos="7293" xq-fnLevel="2"/>
   <literal type="34" start="7344" end="7361"/>
   <literal type="34" start="7402" end="7404"/>
   <literal type="34" start="7445" end="7450"/>
   <literal type="34" start="7492" end="7538"/>
   <unnested-xquery pos="7657"/>
   <resume-x-literal-txt pos="7658"/>
   <nested-query pos="7672"/>
   <start-xquery pos="7673" xq-fnLevel="2"/>
   <xml-open-tag pos="7712" xxq-fnlevel="2"/>
   <xml-name-end pos="7719"/>
   <x-equals pos="7724"/>
   <xml-att-quote pos="7725"/>
   <xml-literal-start pos="7726"/>
   <xml-att-quote pos="7731"/>
   <xml-literal-end pos="7732"/>
   <x-equals pos="7738"/>
   <xml-att-quote pos="7739"/>
   <xml-literal-start pos="7740"/>
   <xml-att-quote pos="7772"/>
   <x-tag-end pos="7773" length="1"/>
   <nested-query pos="7789"/>
   <start-xquery pos="7790" xq-fnLevel="3"/>
   <literal type="34" start="7890" end="7893"/>
   <literal type="34" start="8021" end="8022"/>
   <literal type="34" start="8091" end="8100"/>
   <unnested-xquery pos="8155"/>
   <resume-x-literal-txt pos="8156"/>
   <xml-close-tag pos="8164"/>
   <x-tag-end pos="8172" length="1"/>
   <start-xquery pos="8173" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="8189"/>
   <resume-x-literal-txt pos="8190"/>
   <xml-close-tag pos="8200"/>
   <x-tag-end pos="8205" length="1"/>
   <nested-query pos="8216"/>
   <start-xquery pos="8217" xq-fnLevel="2"/>
   <unnested-xquery pos="8463"/>
   <resume-x-literal-txt pos="8464"/>
   <nested-query pos="8474"/>
   <start-xquery pos="8475" xq-fnLevel="2"/>
   <unnested-xquery pos="8557"/>
   <resume-x-literal-txt pos="8558"/>
   <xml-open-tag pos="8562" xxq-fnlevel="1"/>
   <xml-name-end pos="8568"/>
   <x-equals pos="8574"/>
   <xml-att-quote pos="8575"/>
   <xml-literal-start pos="8576"/>
   <xml-att-quote pos="8582"/>
   <xml-literal-end pos="8583"/>
   <x-equals pos="8588"/>
   <xml-att-quote pos="8589"/>
   <xml-literal-start pos="8590"/>
   <xml-att-quote pos="8596"/>
   <xml-literal-end pos="8597"/>
   <x-equals pos="8603"/>
   <xml-att-quote pos="8604"/>
   <xml-literal-start pos="8605"/>
   <xml-att-quote pos="8611"/>
   <xml-literal-end pos="8612"/>
   <x-equals pos="8618"/>
   <xml-att-quote pos="8619"/>
   <xml-literal-start pos="8620"/>
   <xml-att-quote pos="8651"/>
   <xml-literal-end pos="8652"/>
   <x-tag-end pos="8653" length="2" level="2" xq-fnlevel="1"/>
   <xml-close-tag pos="8658"/>
   <x-tag-end pos="8664" length="1"/>
   <start-xquery pos="8665" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="9077" xxq-fnlevel="1"/>
   <xml-name-end pos="9100"/>
   <x-tag-end pos="9101" length="2" level="1" xq-fnlevel="1"/>
   <start-xquery pos="9103" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="9134" xxq-fnlevel="1"/>
   <xml-name-end pos="9138"/>
   <x-equals pos="9144"/>
   <xml-att-quote pos="9145"/>
   <xml-literal-start pos="9146"/>
   <xml-att-quote pos="9164"/>
   <x-tag-end pos="9165" length="1"/>
   <nested-query pos="9176"/>
   <start-xquery pos="9177" xq-fnLevel="2"/>
   <unnested-xquery pos="9183"/>
   <resume-x-literal-txt pos="9184"/>
   <xml-open-tag pos="9201" xxq-fnlevel="1"/>
   <x-tag-end pos="9204" length="2" level="2" xq-fnlevel="1"/>
   <xml-open-tag pos="9216" xxq-fnlevel="1"/>
   <xml-name-end pos="9223"/>
   <x-equals pos="9226"/>
   <xml-att-quote pos="9227"/>
   <xml-literal-start pos="9228"/>
   <nested-query pos="9235"/>
   <start-xquery pos="9236" xq-fnLevel="2"/>
   <unnested-xquery pos="9245"/>
   <xml-att-quote pos="9246"/>
   <xml-literal-end pos="9247"/>
   <x-equals pos="9256"/>
   <xml-att-quote pos="9257"/>
   <xml-literal-start pos="9258"/>
   <xml-att-quote pos="9266"/>
   <xml-literal-end pos="9267"/>
   <x-equals pos="9272"/>
   <xml-att-quote pos="9273"/>
   <xml-literal-start pos="9274"/>
   <xml-att-quote pos="9278"/>
   <xml-literal-end pos="9279"/>
   <x-equals pos="9284"/>
   <xml-att-quote pos="9285"/>
   <xml-literal-start pos="9286"/>
   <xml-att-quote pos="9287"/>
   <xml-literal-end pos="9288"/>
   <x-equals pos="9294"/>
   <xml-att-quote pos="9295"/>
   <xml-literal-start pos="9296"/>
   <xml-att-quote pos="9308"/>
   <xml-literal-end pos="9309"/>
   <x-tag-end pos="9310" length="1"/>
   <xml-open-tag pos="9325" xxq-fnlevel="1"/>
   <xml-name-end pos="9332"/>
   <x-equals pos="9338"/>
   <xml-att-quote pos="9339"/>
   <nested-query pos="9340"/>
   <start-xquery pos="9341" xq-fnLevel="2"/>
   <literal type="34" start="9371" end="9376"/>
   <unnested-xquery pos="9378"/>
   <xml-att-quote pos="9379"/>
   <x-tag-end pos="9380" length="1"/>
   <nested-query pos="9399"/>
   <start-xquery pos="9400" xq-fnLevel="2"/>
   <literal type="34" start="9480" end="9485"/>
   <literal type="34" start="9531" end="9540"/>
   <unnested-xquery pos="9567"/>
   <resume-x-literal-txt pos="9568"/>
   <nested-query pos="9590"/>
   <start-xquery pos="9591" xq-fnLevel="2"/>
   <unnested-xquery pos="9597"/>
   <resume-x-literal-txt pos="9598"/>
   <xml-close-tag pos="9612"/>
   <x-tag-end pos="9620" length="1"/>
   <nested-query pos="9635"/>
   <start-xquery pos="9636" xq-fnLevel="2"/>
   <literal type="34" start="9789" end="9791"/>
   <xml-open-tag pos="9856" xxq-fnlevel="2"/>
   <xml-name-end pos="9863"/>
   <x-equals pos="9869"/>
   <xml-att-quote pos="9870"/>
   <nested-query pos="9871"/>
   <start-xquery pos="9872" xq-fnLevel="3"/>
   <unnested-xquery pos="9878"/>
   <xml-att-quote pos="9879"/>
   <x-tag-end pos="9880" length="1"/>
   <nested-query pos="9900"/>
   <start-xquery pos="9901" xq-fnLevel="3"/>
   <literal type="34" start="9978" end="9987"/>
   <unnested-xquery pos="10015"/>
   <resume-x-literal-txt pos="10016"/>
   <nested-query pos="10035"/>
   <start-xquery pos="10036" xq-fnLevel="3"/>
   <literal type="34" start="10059" end="10062"/>
   <literal type="34" start="10088" end="10090"/>
   <unnested-xquery pos="10092"/>
   <resume-x-literal-txt pos="10093"/>
   <xml-close-tag pos="10111"/>
   <x-tag-end pos="10119" length="1"/>
   <start-xquery pos="10120" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="10120"/>
   <resume-x-literal-txt pos="10121"/>
   <xml-close-tag pos="10129"/>
   <x-tag-end pos="10137" length="1"/>
   <xml-close-tag pos="10145"/>
   <x-tag-end pos="10150" length="1"/>
   <start-xquery pos="10151" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="10258" xxq-fnlevel="1"/>
   <xml-name-end pos="10262"/>
   <x-equals pos="10268"/>
   <xml-att-quote pos="10269"/>
   <xml-literal-start pos="10270"/>
   <xml-att-quote pos="10288"/>
   <x-tag-end pos="10289" length="1"/>
   <xml-open-tag pos="10305" xxq-fnlevel="1"/>
   <x-tag-end pos="10308" length="2" level="2" xq-fnlevel="1"/>
   <xml-open-tag pos="10320" xxq-fnlevel="1"/>
   <xml-name-end pos="10324"/>
   <x-equals pos="10330"/>
   <xml-att-quote pos="10331"/>
   <xml-literal-start pos="10332"/>
   <xml-att-quote pos="10347"/>
   <x-tag-end pos="10348" length="1"/>
   <xml-open-tag pos="10363" xxq-fnlevel="1"/>
   <xml-name-end pos="10369"/>
   <x-equals pos="10375"/>
   <xml-att-quote pos="10376"/>
   <xml-literal-start pos="10377"/>
   <xml-att-quote pos="10431"/>
   <x-tag-end pos="10432" length="1"/>
   <xml-close-tag pos="10440"/>
   <x-tag-end pos="10447" length="1"/>
   <xml-open-tag pos="10462" xxq-fnlevel="1"/>
   <xml-name-end pos="10469"/>
   <x-equals pos="10474"/>
   <xml-att-quote pos="10475"/>
   <xml-literal-start pos="10476"/>
   <xml-att-quote pos="10487"/>
   <x-tag-end pos="10488" length="1"/>
   <xml-open-tag pos="10504" xxq-fnlevel="1"/>
   <xml-name-end pos="10511"/>
   <x-equals pos="10517"/>
   <xml-att-quote pos="10518"/>
   <xml-literal-start pos="10519"/>
   <xml-att-quote pos="10521"/>
   <x-tag-end pos="10522" length="1"/>
   <nested-query pos="10523"/>
   <start-xquery pos="10524" xq-fnLevel="2"/>
   <literal type="34" start="10558" end="10561"/>
   <unnested-xquery pos="10563"/>
   <resume-x-literal-txt pos="10564"/>
   <xml-close-tag pos="10571"/>
   <x-tag-end pos="10579" length="1"/>
   <xml-open-tag pos="10595" xxq-fnlevel="1"/>
   <xml-name-end pos="10602"/>
   <x-equals pos="10608"/>
   <xml-att-quote pos="10609"/>
   <xml-literal-start pos="10610"/>
   <xml-att-quote pos="10612"/>
   <x-tag-end pos="10613" length="1"/>
   <nested-query pos="10614"/>
   <start-xquery pos="10615" xq-fnLevel="2"/>
   <literal type="34" start="10649" end="10652"/>
   <unnested-xquery pos="10654"/>
   <resume-x-literal-txt pos="10655"/>
   <xml-close-tag pos="10663"/>
   <x-tag-end pos="10671" length="1"/>
   <xml-open-tag pos="10687" xxq-fnlevel="1"/>
   <xml-name-end pos="10694"/>
   <x-equals pos="10700"/>
   <xml-att-quote pos="10701"/>
   <xml-literal-start pos="10702"/>
   <xml-att-quote pos="10704"/>
   <x-tag-end pos="10705" length="1"/>
   <nested-query pos="10706"/>
   <start-xquery pos="10707" xq-fnLevel="2"/>
   <literal type="34" start="10741" end="10744"/>
   <unnested-xquery pos="10746"/>
   <resume-x-literal-txt pos="10747"/>
   <xml-close-tag pos="10752"/>
   <x-tag-end pos="10760" length="1"/>
   <xml-open-tag pos="10776" xxq-fnlevel="1"/>
   <xml-name-end pos="10783"/>
   <x-equals pos="10789"/>
   <xml-att-quote pos="10790"/>
   <xml-literal-start pos="10791"/>
   <xml-att-quote pos="10793"/>
   <x-tag-end pos="10794" length="1"/>
   <nested-query pos="10795"/>
   <start-xquery pos="10796" xq-fnLevel="2"/>
   <literal type="34" start="10830" end="10833"/>
   <unnested-xquery pos="10835"/>
   <resume-x-literal-txt pos="10836"/>
   <xml-close-tag pos="10841"/>
   <x-tag-end pos="10849" length="1"/>
   <xml-open-tag pos="10865" xxq-fnlevel="1"/>
   <xml-name-end pos="10872"/>
   <x-equals pos="10878"/>
   <xml-att-quote pos="10879"/>
   <xml-literal-start pos="10880"/>
   <xml-att-quote pos="10882"/>
   <x-tag-end pos="10883" length="1"/>
   <nested-query pos="10884"/>
   <start-xquery pos="10885" xq-fnLevel="2"/>
   <literal type="34" start="10919" end="10922"/>
   <unnested-xquery pos="10924"/>
   <resume-x-literal-txt pos="10925"/>
   <xml-close-tag pos="10928"/>
   <x-tag-end pos="10936" length="1"/>
   <xml-open-tag pos="10952" xxq-fnlevel="1"/>
   <xml-name-end pos="10959"/>
   <x-equals pos="10965"/>
   <xml-att-quote pos="10966"/>
   <xml-literal-start pos="10967"/>
   <xml-att-quote pos="10969"/>
   <x-tag-end pos="10970" length="1"/>
   <nested-query pos="10971"/>
   <start-xquery pos="10972" xq-fnLevel="2"/>
   <literal type="34" start="11006" end="11009"/>
   <unnested-xquery pos="11011"/>
   <resume-x-literal-txt pos="11012"/>
   <xml-close-tag pos="11016"/>
   <x-tag-end pos="11024" length="1"/>
   <xml-open-tag pos="11040" xxq-fnlevel="1"/>
   <xml-name-end pos="11047"/>
   <x-equals pos="11053"/>
   <xml-att-quote pos="11054"/>
   <xml-literal-start pos="11055"/>
   <xml-att-quote pos="11057"/>
   <x-tag-end pos="11058" length="1"/>
   <nested-query pos="11059"/>
   <start-xquery pos="11060" xq-fnLevel="2"/>
   <literal type="34" start="11094" end="11097"/>
   <unnested-xquery pos="11099"/>
   <resume-x-literal-txt pos="11100"/>
   <xml-close-tag pos="11104"/>
   <x-tag-end pos="11112" length="1"/>
   <xml-open-tag pos="11128" xxq-fnlevel="1"/>
   <xml-name-end pos="11135"/>
   <x-equals pos="11141"/>
   <xml-att-quote pos="11142"/>
   <xml-literal-start pos="11143"/>
   <xml-att-quote pos="11145"/>
   <x-tag-end pos="11146" length="1"/>
   <nested-query pos="11147"/>
   <start-xquery pos="11148" xq-fnLevel="2"/>
   <literal type="34" start="11182" end="11185"/>
   <unnested-xquery pos="11187"/>
   <resume-x-literal-txt pos="11188"/>
   <xml-close-tag pos="11194"/>
   <x-tag-end pos="11202" length="1"/>
   <xml-open-tag pos="11218" xxq-fnlevel="1"/>
   <xml-name-end pos="11225"/>
   <x-equals pos="11231"/>
   <xml-att-quote pos="11232"/>
   <xml-literal-start pos="11233"/>
   <xml-att-quote pos="11235"/>
   <x-tag-end pos="11236" length="1"/>
   <nested-query pos="11237"/>
   <start-xquery pos="11238" xq-fnLevel="2"/>
   <literal type="34" start="11272" end="11275"/>
   <unnested-xquery pos="11277"/>
   <resume-x-literal-txt pos="11278"/>
   <xml-close-tag pos="11287"/>
   <x-tag-end pos="11295" length="1"/>
   <xml-open-tag pos="11311" xxq-fnlevel="1"/>
   <xml-name-end pos="11318"/>
   <x-equals pos="11324"/>
   <xml-att-quote pos="11325"/>
   <xml-literal-start pos="11326"/>
   <xml-att-quote pos="11328"/>
   <x-tag-end pos="11329" length="1"/>
   <nested-query pos="11330"/>
   <start-xquery pos="11331" xq-fnLevel="2"/>
   <literal type="34" start="11365" end="11368"/>
   <unnested-xquery pos="11370"/>
   <resume-x-literal-txt pos="11371"/>
   <xml-close-tag pos="11378"/>
   <x-tag-end pos="11386" length="1"/>
   <xml-open-tag pos="11402" xxq-fnlevel="1"/>
   <xml-name-end pos="11409"/>
   <x-equals pos="11415"/>
   <xml-att-quote pos="11416"/>
   <xml-literal-start pos="11417"/>
   <xml-att-quote pos="11419"/>
   <x-tag-end pos="11420" length="1"/>
   <nested-query pos="11421"/>
   <start-xquery pos="11422" xq-fnLevel="2"/>
   <literal type="34" start="11456" end="11459"/>
   <unnested-xquery pos="11461"/>
   <resume-x-literal-txt pos="11462"/>
   <xml-close-tag pos="11470"/>
   <x-tag-end pos="11478" length="1"/>
   <xml-open-tag pos="11494" xxq-fnlevel="1"/>
   <xml-name-end pos="11501"/>
   <x-equals pos="11507"/>
   <xml-att-quote pos="11508"/>
   <xml-literal-start pos="11509"/>
   <xml-att-quote pos="11511"/>
   <x-tag-end pos="11512" length="1"/>
   <nested-query pos="11513"/>
   <start-xquery pos="11514" xq-fnLevel="2"/>
   <literal type="34" start="11548" end="11551"/>
   <unnested-xquery pos="11553"/>
   <resume-x-literal-txt pos="11554"/>
   <xml-close-tag pos="11562"/>
   <x-tag-end pos="11570" length="1"/>
   <xml-close-tag pos="11585"/>
   <x-tag-end pos="11593" length="1"/>
   <nested-query pos="11608"/>
   <start-xquery pos="11609" xq-fnLevel="2"/>
   <literal type="34" start="11609" end="11613"/>
   <unnested-xquery pos="11614"/>
   <resume-x-literal-txt pos="11615"/>
   <xml-open-tag pos="11629" xxq-fnlevel="1"/>
   <xml-name-end pos="11635"/>
   <x-equals pos="11640"/>
   <xml-att-quote pos="11641"/>
   <xml-literal-start pos="11642"/>
   <xml-att-quote pos="11646"/>
   <xml-literal-end pos="11647"/>
   <x-equals pos="11652"/>
   <xml-att-quote pos="11653"/>
   <xml-literal-start pos="11654"/>
   <xml-att-quote pos="11663"/>
   <xml-literal-end pos="11664"/>
   <x-equals pos="11670"/>
   <xml-att-quote pos="11671"/>
   <nested-query pos="11672"/>
   <start-xquery pos="11673" xq-fnLevel="2"/>
   <unnested-xquery pos="11701"/>
   <xml-att-quote pos="11702"/>
   <xml-literal-end pos="11703"/>
   <x-equals pos="11709"/>
   <xml-att-quote pos="11710"/>
   <xml-literal-start pos="11711"/>
   <xml-att-quote pos="11721"/>
   <xml-literal-end pos="11722"/>
   <x-tag-end pos="11723" length="2" level="3" xq-fnlevel="1"/>
   <nested-query pos="11739"/>
   <start-xquery pos="11740" xq-fnLevel="2"/>
   <literal type="34" start="11740" end="11744"/>
   <unnested-xquery pos="11745"/>
   <resume-x-literal-txt pos="11746"/>
   <xml-open-tag pos="11760" xxq-fnlevel="1"/>
   <xml-name-end pos="11766"/>
   <x-equals pos="11771"/>
   <xml-att-quote pos="11772"/>
   <xml-literal-start pos="11773"/>
   <xml-att-quote pos="11777"/>
   <xml-literal-end pos="11778"/>
   <x-equals pos="11783"/>
   <xml-att-quote pos="11784"/>
   <xml-literal-start pos="11785"/>
   <xml-att-quote pos="11795"/>
   <xml-literal-end pos="11796"/>
   <x-equals pos="11802"/>
   <xml-att-quote pos="11803"/>
   <nested-query pos="11804"/>
   <start-xquery pos="11805" xq-fnLevel="2"/>
   <unnested-xquery pos="11834"/>
   <xml-att-quote pos="11835"/>
   <xml-literal-end pos="11836"/>
   <x-equals pos="11842"/>
   <xml-att-quote pos="11843"/>
   <xml-literal-start pos="11844"/>
   <xml-att-quote pos="11854"/>
   <xml-literal-end pos="11855"/>
   <x-tag-end pos="11856" length="2" level="3" xq-fnlevel="1"/>
   <xml-close-tag pos="11868"/>
   <x-tag-end pos="11873" length="1"/>
   <xml-open-tag pos="11884" xxq-fnlevel="1"/>
   <x-tag-end pos="11888" length="1"/>
   <xml-open-tag pos="11903" xxq-fnlevel="1"/>
   <xml-name-end pos="11909"/>
   <x-equals pos="11915"/>
   <xml-att-quote pos="11916"/>
   <xml-literal-start pos="11917"/>
   <xml-att-quote pos="11971"/>
   <x-tag-end pos="11972" length="1"/>
   <xml-close-tag pos="11978"/>
   <x-tag-end pos="11985" length="1"/>
   <xml-open-tag pos="12000" xxq-fnlevel="1"/>
   <xml-name-end pos="12007"/>
   <x-equals pos="12012"/>
   <xml-att-quote pos="12013"/>
   <xml-literal-start pos="12014"/>
   <xml-att-quote pos="12023"/>
   <x-tag-end pos="12024" length="1"/>
   <xml-open-tag pos="12040" xxq-fnlevel="1"/>
   <xml-name-end pos="12047"/>
   <x-equals pos="12053"/>
   <xml-att-quote pos="12054"/>
   <xml-literal-start pos="12055"/>
   <xml-att-quote pos="12057"/>
   <x-tag-end pos="12058" length="1"/>
   <nested-query pos="12059"/>
   <start-xquery pos="12060" xq-fnLevel="2"/>
   <literal type="34" start="12092" end="12095"/>
   <unnested-xquery pos="12097"/>
   <resume-x-literal-txt pos="12098"/>
   <xml-close-tag pos="12105"/>
   <x-tag-end pos="12113" length="1"/>
   <xml-open-tag pos="12129" xxq-fnlevel="1"/>
   <xml-name-end pos="12136"/>
   <x-equals pos="12142"/>
   <xml-att-quote pos="12143"/>
   <xml-literal-start pos="12144"/>
   <xml-att-quote pos="12146"/>
   <x-tag-end pos="12147" length="1"/>
   <nested-query pos="12148"/>
   <start-xquery pos="12149" xq-fnLevel="2"/>
   <literal type="34" start="12181" end="12184"/>
   <unnested-xquery pos="12186"/>
   <resume-x-literal-txt pos="12187"/>
   <xml-close-tag pos="12195"/>
   <x-tag-end pos="12203" length="1"/>
   <xml-open-tag pos="12219" xxq-fnlevel="1"/>
   <xml-name-end pos="12226"/>
   <x-equals pos="12232"/>
   <xml-att-quote pos="12233"/>
   <xml-literal-start pos="12234"/>
   <xml-att-quote pos="12236"/>
   <x-tag-end pos="12237" length="1"/>
   <nested-query pos="12238"/>
   <start-xquery pos="12239" xq-fnLevel="2"/>
   <literal type="34" start="12271" end="12274"/>
   <unnested-xquery pos="12276"/>
   <resume-x-literal-txt pos="12277"/>
   <xml-close-tag pos="12282"/>
   <x-tag-end pos="12290" length="1"/>
   <xml-open-tag pos="12306" xxq-fnlevel="1"/>
   <xml-name-end pos="12313"/>
   <x-equals pos="12319"/>
   <xml-att-quote pos="12320"/>
   <xml-literal-start pos="12321"/>
   <xml-att-quote pos="12323"/>
   <x-tag-end pos="12324" length="1"/>
   <nested-query pos="12325"/>
   <start-xquery pos="12326" xq-fnLevel="2"/>
   <literal type="34" start="12358" end="12361"/>
   <unnested-xquery pos="12363"/>
   <resume-x-literal-txt pos="12364"/>
   <xml-close-tag pos="12369"/>
   <x-tag-end pos="12377" length="1"/>
   <xml-open-tag pos="12393" xxq-fnlevel="1"/>
   <xml-name-end pos="12400"/>
   <x-equals pos="12406"/>
   <xml-att-quote pos="12407"/>
   <xml-literal-start pos="12408"/>
   <xml-att-quote pos="12410"/>
   <x-tag-end pos="12411" length="1"/>
   <nested-query pos="12412"/>
   <start-xquery pos="12413" xq-fnLevel="2"/>
   <literal type="34" start="12445" end="12448"/>
   <unnested-xquery pos="12450"/>
   <resume-x-literal-txt pos="12451"/>
   <xml-close-tag pos="12454"/>
   <x-tag-end pos="12462" length="1"/>
   <xml-open-tag pos="12478" xxq-fnlevel="1"/>
   <xml-name-end pos="12485"/>
   <x-equals pos="12491"/>
   <xml-att-quote pos="12492"/>
   <xml-literal-start pos="12493"/>
   <xml-att-quote pos="12495"/>
   <x-tag-end pos="12496" length="1"/>
   <nested-query pos="12497"/>
   <start-xquery pos="12498" xq-fnLevel="2"/>
   <literal type="34" start="12530" end="12533"/>
   <unnested-xquery pos="12535"/>
   <resume-x-literal-txt pos="12536"/>
   <xml-close-tag pos="12540"/>
   <x-tag-end pos="12548" length="1"/>
   <xml-open-tag pos="12564" xxq-fnlevel="1"/>
   <xml-name-end pos="12571"/>
   <x-equals pos="12577"/>
   <xml-att-quote pos="12578"/>
   <xml-literal-start pos="12579"/>
   <xml-att-quote pos="12581"/>
   <x-tag-end pos="12582" length="1"/>
   <nested-query pos="12583"/>
   <start-xquery pos="12584" xq-fnLevel="2"/>
   <literal type="34" start="12616" end="12619"/>
   <unnested-xquery pos="12621"/>
   <resume-x-literal-txt pos="12622"/>
   <xml-close-tag pos="12626"/>
   <x-tag-end pos="12634" length="1"/>
   <xml-open-tag pos="12650" xxq-fnlevel="1"/>
   <xml-name-end pos="12657"/>
   <x-equals pos="12663"/>
   <xml-att-quote pos="12664"/>
   <xml-literal-start pos="12665"/>
   <xml-att-quote pos="12667"/>
   <x-tag-end pos="12668" length="1"/>
   <nested-query pos="12669"/>
   <start-xquery pos="12670" xq-fnLevel="2"/>
   <literal type="34" start="12702" end="12705"/>
   <unnested-xquery pos="12707"/>
   <resume-x-literal-txt pos="12708"/>
   <xml-close-tag pos="12714"/>
   <x-tag-end pos="12722" length="1"/>
   <xml-open-tag pos="12738" xxq-fnlevel="1"/>
   <xml-name-end pos="12745"/>
   <x-equals pos="12751"/>
   <xml-att-quote pos="12752"/>
   <xml-literal-start pos="12753"/>
   <xml-att-quote pos="12755"/>
   <x-tag-end pos="12756" length="1"/>
   <nested-query pos="12757"/>
   <start-xquery pos="12758" xq-fnLevel="2"/>
   <literal type="34" start="12790" end="12793"/>
   <unnested-xquery pos="12795"/>
   <resume-x-literal-txt pos="12796"/>
   <xml-close-tag pos="12805"/>
   <x-tag-end pos="12813" length="1"/>
   <xml-open-tag pos="12829" xxq-fnlevel="1"/>
   <xml-name-end pos="12836"/>
   <x-equals pos="12842"/>
   <xml-att-quote pos="12843"/>
   <xml-literal-start pos="12844"/>
   <xml-att-quote pos="12846"/>
   <x-tag-end pos="12847" length="1"/>
   <nested-query pos="12848"/>
   <start-xquery pos="12849" xq-fnLevel="2"/>
   <literal type="34" start="12881" end="12884"/>
   <unnested-xquery pos="12886"/>
   <resume-x-literal-txt pos="12887"/>
   <xml-close-tag pos="12894"/>
   <x-tag-end pos="12902" length="1"/>
   <xml-open-tag pos="12918" xxq-fnlevel="1"/>
   <xml-name-end pos="12925"/>
   <x-equals pos="12931"/>
   <xml-att-quote pos="12932"/>
   <xml-literal-start pos="12933"/>
   <xml-att-quote pos="12935"/>
   <x-tag-end pos="12936" length="1"/>
   <nested-query pos="12937"/>
   <start-xquery pos="12938" xq-fnLevel="2"/>
   <literal type="34" start="12970" end="12973"/>
   <unnested-xquery pos="12975"/>
   <resume-x-literal-txt pos="12976"/>
   <xml-close-tag pos="12984"/>
   <x-tag-end pos="12992" length="1"/>
   <xml-open-tag pos="13008" xxq-fnlevel="1"/>
   <xml-name-end pos="13015"/>
   <x-equals pos="13021"/>
   <xml-att-quote pos="13022"/>
   <xml-literal-start pos="13023"/>
   <xml-att-quote pos="13025"/>
   <x-tag-end pos="13026" length="1"/>
   <nested-query pos="13027"/>
   <start-xquery pos="13028" xq-fnLevel="2"/>
   <literal type="34" start="13060" end="13063"/>
   <unnested-xquery pos="13065"/>
   <resume-x-literal-txt pos="13066"/>
   <xml-close-tag pos="13074"/>
   <x-tag-end pos="13082" length="1"/>
   <xml-close-tag pos="13097"/>
   <x-tag-end pos="13105" length="1"/>
   <nested-query pos="13120"/>
   <start-xquery pos="13121" xq-fnLevel="2"/>
   <literal type="34" start="13121" end="13125"/>
   <unnested-xquery pos="13126"/>
   <resume-x-literal-txt pos="13127"/>
   <xml-open-tag pos="13141" xxq-fnlevel="1"/>
   <xml-name-end pos="13147"/>
   <x-equals pos="13152"/>
   <xml-att-quote pos="13153"/>
   <xml-literal-start pos="13154"/>
   <xml-att-quote pos="13158"/>
   <xml-literal-end pos="13159"/>
   <x-equals pos="13164"/>
   <xml-att-quote pos="13165"/>
   <xml-literal-start pos="13166"/>
   <xml-att-quote pos="13173"/>
   <xml-literal-end pos="13174"/>
   <x-equals pos="13180"/>
   <xml-att-quote pos="13181"/>
   <nested-query pos="13182"/>
   <start-xquery pos="13183" xq-fnLevel="2"/>
   <unnested-xquery pos="13209"/>
   <xml-att-quote pos="13210"/>
   <xml-literal-end pos="13211"/>
   <x-equals pos="13217"/>
   <xml-att-quote pos="13218"/>
   <xml-literal-start pos="13219"/>
   <xml-att-quote pos="13229"/>
   <xml-literal-end pos="13230"/>
   <x-tag-end pos="13231" length="2" level="3" xq-fnlevel="1"/>
   <nested-query pos="13247"/>
   <start-xquery pos="13248" xq-fnLevel="2"/>
   <literal type="34" start="13248" end="13252"/>
   <unnested-xquery pos="13253"/>
   <resume-x-literal-txt pos="13254"/>
   <xml-open-tag pos="13268" xxq-fnlevel="1"/>
   <xml-name-end pos="13274"/>
   <x-equals pos="13279"/>
   <xml-att-quote pos="13280"/>
   <xml-literal-start pos="13281"/>
   <xml-att-quote pos="13285"/>
   <xml-literal-end pos="13286"/>
   <x-equals pos="13291"/>
   <xml-att-quote pos="13292"/>
   <xml-literal-start pos="13293"/>
   <xml-att-quote pos="13301"/>
   <xml-literal-end pos="13302"/>
   <x-equals pos="13308"/>
   <xml-att-quote pos="13309"/>
   <nested-query pos="13310"/>
   <start-xquery pos="13311" xq-fnLevel="2"/>
   <unnested-xquery pos="13338"/>
   <xml-att-quote pos="13339"/>
   <xml-literal-end pos="13340"/>
   <x-equals pos="13346"/>
   <xml-att-quote pos="13347"/>
   <xml-literal-start pos="13348"/>
   <xml-att-quote pos="13358"/>
   <xml-literal-end pos="13359"/>
   <x-tag-end pos="13360" length="2" level="3" xq-fnlevel="1"/>
   <xml-close-tag pos="13372"/>
   <x-tag-end pos="13377" length="1"/>
   <xml-close-tag pos="13382"/>
   <x-tag-end pos="13387" length="1"/>
   <start-xquery pos="13388" xml-exit-level="0" xq-fnLevel="1"/>
   <literal type="34" start="13535" end="13544"/>
   <comment start="13561" end="13589"/>
   <comment start="13594" end="14798"/>
   <comment start="14803" end="15073"/>
   <comment start="15790" end="15944"/>
   <xml-open-tag pos="16028" xxq-fnlevel="1"/>
   <x-tag-end pos="16032" length="1"/>
   <nested-query pos="16033"/>
   <start-xquery pos="16034" xq-fnLevel="2"/>
   <unnested-xquery pos="16050"/>
   <xml-close-tag pos="16051"/>
   <x-tag-end pos="16056" length="1"/>
   <start-xquery pos="16057" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="16081" end="16539"/>
   <xml-open-tag pos="16836" xxq-fnlevel="1"/>
   <xml-name-end pos="16840"/>
   <x-equals pos="16846"/>
   <xml-att-quote pos="16847"/>
   <xml-literal-start pos="16848"/>
   <xml-att-quote pos="16862"/>
   <x-tag-end pos="16863" length="1"/>
   <xml-open-tag pos="16874" xxq-fnlevel="1"/>
   <xml-name-end pos="16878"/>
   <x-equals pos="16884"/>
   <xml-att-quote pos="16885"/>
   <xml-literal-start pos="16886"/>
   <xml-att-quote pos="16892"/>
   <x-tag-end pos="16893" length="1"/>
   <xml-open-tag pos="16944" xxq-fnlevel="1"/>
   <xml-name-end pos="16946"/>
   <x-equals pos="16951"/>
   <xml-att-quote pos="16952"/>
   <xml-literal-start pos="16953"/>
   <nested-query pos="16964"/>
   <start-xquery pos="16965" xq-fnLevel="2"/>
   <literal type="34" start="16997" end="16999"/>
   <literal type="34" start="17002" end="17007"/>
   <unnested-xquery pos="17010"/>
   <xml-att-quote pos="17011"/>
   <x-tag-end pos="17012" length="1"/>
   <xml-close-tag pos="17028"/>
   <x-tag-end pos="17031" length="1"/>
   <xml-close-tag pos="17032"/>
   <x-tag-end pos="17037" length="1"/>
   <nested-query pos="17048"/>
   <start-xquery pos="17049" xq-fnLevel="2"/>
   <unnested-xquery pos="17150"/>
   <resume-x-literal-txt pos="17151"/>
   <xml-close-tag pos="17157"/>
   <x-tag-end pos="17162" length="1"/>
   <start-xquery pos="17163" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="17183" end="17258"/>
   <literal type="34" start="17471" end="17476"/>
   <literal type="34" start="17528" end="17530"/>
   <literal type="34" start="17701" end="17706"/>
   <comment start="17720" end="17746"/>
   <comment start="17753" end="17854"/>
   <literal type="34" start="18026" end="18028"/>
   <xml-open-tag pos="18503" xxq-fnlevel="1"/>
   <x-tag-end pos="18507" length="1"/>
   <nested-query pos="18512"/>
   <start-xquery pos="18513" xq-fnLevel="2"/>
   <xml-open-tag pos="18531" xxq-fnlevel="2"/>
   <x-tag-end pos="18534" length="1"/>
   <nested-query pos="18535"/>
   <start-xquery pos="18536" xq-fnLevel="3"/>
   <unnested-xquery pos="18542"/>
   <xml-close-tag pos="18543"/>
   <x-tag-end pos="18547" length="1"/>
   <start-xquery pos="18548" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="18557"/>
   <resume-x-literal-txt pos="18558"/>
   <xml-open-tag pos="18562" xxq-fnlevel="1"/>
   <xml-name-end pos="18566"/>
   <x-equals pos="18572"/>
   <xml-att-quote pos="18573"/>
   <xml-literal-start pos="18574"/>
   <xml-att-quote pos="18586"/>
   <x-tag-end pos="18587" length="1"/>
   <nested-query pos="18592"/>
   <start-xquery pos="18593" xq-fnLevel="2"/>
   <comment start="18594" end="18602"/>
   <literal type="34" start="18822" end="18828"/>
   <literal type="34" start="18837" end="18839"/>
   <xml-open-tag pos="18865" xxq-fnlevel="2"/>
   <x-tag-end pos="18869" length="1"/>
   <xml-open-tag pos="18870" xxq-fnlevel="2"/>
   <xml-name-end pos="18872"/>
   <x-equals pos="18877"/>
   <xml-att-quote pos="18878"/>
   <xml-literal-start pos="18879"/>
   <nested-query pos="18890"/>
   <start-xquery pos="18891" xq-fnLevel="3"/>
   <unnested-xquery pos="18894"/>
   <xml-att-quote pos="18895"/>
   <x-tag-end pos="18896" length="1"/>
   <nested-query pos="18909"/>
   <start-xquery pos="18910" xq-fnLevel="3"/>
   <xml-open-tag pos="19064" xxq-fnlevel="3"/>
   <xml-name-end pos="19068"/>
   <x-equals pos="19072"/>
   <xml-att-quote pos="19073"/>
   <xml-literal-start pos="19074"/>
   <xml-att-quote pos="19102"/>
   <xml-literal-end pos="19103"/>
   <x-equals pos="19109"/>
   <xml-att-quote pos="19110"/>
   <xml-literal-start pos="19111"/>
   <xml-att-quote pos="19124"/>
   <x-tag-end pos="19125" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="19127" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="19128" xxq-fnlevel="3"/>
   <x-tag-end pos="19135" length="1"/>
   <nested-query pos="19136"/>
   <start-xquery pos="19137" xq-fnLevel="4"/>
   <unnested-xquery pos="19142"/>
   <xml-close-tag pos="19143"/>
   <x-tag-end pos="19151" length="1"/>
   <start-xquery pos="19152" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="19187"/>
   <resume-x-literal-txt pos="19188"/>
   <xml-close-tag pos="19199"/>
   <x-tag-end pos="19202" length="1"/>
   <xml-close-tag pos="19203"/>
   <x-tag-end pos="19208" length="1"/>
   <start-xquery pos="19209" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="19219"/>
   <resume-x-literal-txt pos="19220"/>
   <nested-query pos="19227"/>
   <start-xquery pos="19228" xq-fnLevel="2"/>
   <comment start="19229" end="19245"/>
   <literal type="34" start="19400" end="19402"/>
   <literal type="34" start="19497" end="19500"/>
   <literal type="34" start="19509" end="19511"/>
   <comment start="19533" end="19640"/>
   <literal type="34" start="19971" end="19973"/>
   <literal type="34" start="19984" end="19986"/>
   <xml-open-tag pos="20038" xxq-fnlevel="2"/>
   <x-tag-end pos="20042" length="1"/>
   <xml-open-tag pos="20043" xxq-fnlevel="2"/>
   <xml-name-end pos="20045"/>
   <x-equals pos="20050"/>
   <xml-att-quote pos="20051"/>
   <xml-literal-start pos="20052"/>
   <nested-query pos="20063"/>
   <start-xquery pos="20064" xq-fnLevel="3"/>
   <unnested-xquery pos="20067"/>
   <xml-att-quote pos="20068"/>
   <x-tag-end pos="20069" length="1"/>
   <nested-query pos="20080"/>
   <start-xquery pos="20081" xq-fnLevel="3"/>
   <xml-open-tag pos="20194" xxq-fnlevel="3"/>
   <xml-name-end pos="20198"/>
   <x-equals pos="20202"/>
   <xml-att-quote pos="20203"/>
   <xml-literal-start pos="20204"/>
   <xml-att-quote pos="20233"/>
   <xml-literal-end pos="20234"/>
   <x-equals pos="20240"/>
   <xml-att-quote pos="20241"/>
   <xml-literal-start pos="20242"/>
   <xml-att-quote pos="20255"/>
   <x-tag-end pos="20256" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="20258" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="20259" xxq-fnlevel="3"/>
   <x-tag-end pos="20266" length="1"/>
   <nested-query pos="20267"/>
   <start-xquery pos="20268" xq-fnLevel="4"/>
   <unnested-xquery pos="20273"/>
   <xml-close-tag pos="20274"/>
   <x-tag-end pos="20282" length="1"/>
   <start-xquery pos="20283" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="20314"/>
   <resume-x-literal-txt pos="20315"/>
   <xml-close-tag pos="20324"/>
   <x-tag-end pos="20327" length="1"/>
   <xml-close-tag pos="20328"/>
   <x-tag-end pos="20333" length="1"/>
   <start-xquery pos="20334" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="20354"/>
   <resume-x-literal-txt pos="20355"/>
   <xml-close-tag pos="20360"/>
   <x-tag-end pos="20365" length="1"/>
   <xml-close-tag pos="20370"/>
   <x-tag-end pos="20375" length="1"/>
   <start-xquery pos="20376" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="20647" end="20677"/>
   <literal type="34" start="21038" end="21042"/>
   <literal type="34" start="21094" end="21096"/>
   <literal type="34" start="21228" end="21233"/>
   <comment start="21247" end="21268"/>
   <comment start="21275" end="21376"/>
   <literal type="34" start="21533" end="21535"/>
   <xml-open-tag pos="21985" xxq-fnlevel="1"/>
   <x-tag-end pos="21989" length="1"/>
   <nested-query pos="21994"/>
   <start-xquery pos="21995" xq-fnLevel="2"/>
   <xml-open-tag pos="22013" xxq-fnlevel="2"/>
   <x-tag-end pos="22016" length="1"/>
   <nested-query pos="22017"/>
   <start-xquery pos="22018" xq-fnLevel="3"/>
   <unnested-xquery pos="22024"/>
   <xml-close-tag pos="22025"/>
   <x-tag-end pos="22029" length="1"/>
   <start-xquery pos="22030" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="22039"/>
   <resume-x-literal-txt pos="22040"/>
   <xml-open-tag pos="22044" xxq-fnlevel="1"/>
   <xml-name-end pos="22048"/>
   <x-equals pos="22054"/>
   <xml-att-quote pos="22055"/>
   <xml-literal-start pos="22056"/>
   <xml-att-quote pos="22068"/>
   <x-tag-end pos="22069" length="1"/>
   <nested-query pos="22074"/>
   <start-xquery pos="22075" xq-fnLevel="2"/>
   <comment start="22076" end="22084"/>
   <literal type="34" start="22303" end="22309"/>
   <literal type="34" start="22318" end="22320"/>
   <xml-open-tag pos="22346" xxq-fnlevel="2"/>
   <x-tag-end pos="22350" length="1"/>
   <xml-open-tag pos="22351" xxq-fnlevel="2"/>
   <xml-name-end pos="22353"/>
   <x-equals pos="22358"/>
   <xml-att-quote pos="22359"/>
   <xml-literal-start pos="22360"/>
   <nested-query pos="22371"/>
   <start-xquery pos="22372" xq-fnLevel="3"/>
   <unnested-xquery pos="22375"/>
   <xml-att-quote pos="22376"/>
   <x-tag-end pos="22377" length="1"/>
   <nested-query pos="22390"/>
   <start-xquery pos="22391" xq-fnLevel="3"/>
   <xml-open-tag pos="22541" xxq-fnlevel="3"/>
   <xml-name-end pos="22545"/>
   <x-equals pos="22549"/>
   <xml-att-quote pos="22550"/>
   <xml-literal-start pos="22551"/>
   <xml-att-quote pos="22579"/>
   <xml-literal-end pos="22580"/>
   <x-equals pos="22586"/>
   <xml-att-quote pos="22587"/>
   <xml-literal-start pos="22588"/>
   <xml-att-quote pos="22601"/>
   <xml-literal-end pos="22602"/>
   <x-tag-end pos="22603" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="22605" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="22606" xxq-fnlevel="3"/>
   <x-tag-end pos="22613" length="1"/>
   <nested-query pos="22614"/>
   <start-xquery pos="22615" xq-fnLevel="4"/>
   <unnested-xquery pos="22620"/>
   <xml-close-tag pos="22621"/>
   <x-tag-end pos="22629" length="1"/>
   <start-xquery pos="22630" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="22665"/>
   <resume-x-literal-txt pos="22666"/>
   <xml-close-tag pos="22677"/>
   <x-tag-end pos="22680" length="1"/>
   <xml-close-tag pos="22681"/>
   <x-tag-end pos="22686" length="1"/>
   <start-xquery pos="22687" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="22697"/>
   <resume-x-literal-txt pos="22698"/>
   <nested-query pos="22705"/>
   <start-xquery pos="22706" xq-fnLevel="2"/>
   <comment start="22707" end="22718"/>
   <literal type="34" start="22861" end="22863"/>
   <literal type="34" start="22982" end="22985"/>
   <literal type="34" start="22994" end="22996"/>
   <comment start="23025" end="23135"/>
   <literal type="34" start="23485" end="23487"/>
   <literal type="34" start="23515" end="23517"/>
   <comment start="23552" end="23662"/>
   <literal type="34" start="23969" end="23971"/>
   <literal type="34" start="23999" end="24001"/>
   <literal type="34" start="24068" end="24072"/>
   <xml-open-tag pos="24092" xxq-fnlevel="2"/>
   <x-tag-end pos="24096" length="1"/>
   <xml-open-tag pos="24097" xxq-fnlevel="2"/>
   <xml-name-end pos="24099"/>
   <x-equals pos="24104"/>
   <xml-att-quote pos="24105"/>
   <xml-literal-start pos="24106"/>
   <nested-query pos="24117"/>
   <start-xquery pos="24118" xq-fnLevel="3"/>
   <unnested-xquery pos="24125"/>
   <xml-att-quote pos="24126"/>
   <x-tag-end pos="24127" length="1"/>
   <nested-query pos="24142"/>
   <start-xquery pos="24143" xq-fnLevel="3"/>
   <xml-open-tag pos="24266" xxq-fnlevel="3"/>
   <xml-name-end pos="24270"/>
   <x-equals pos="24274"/>
   <xml-att-quote pos="24275"/>
   <xml-literal-start pos="24276"/>
   <xml-att-quote pos="24305"/>
   <xml-literal-end pos="24306"/>
   <x-equals pos="24312"/>
   <xml-att-quote pos="24313"/>
   <xml-literal-start pos="24314"/>
   <xml-att-quote pos="24327"/>
   <x-tag-end pos="24328" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="24330" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="24331" xxq-fnlevel="3"/>
   <x-tag-end pos="24338" length="1"/>
   <nested-query pos="24339"/>
   <start-xquery pos="24340" xq-fnLevel="4"/>
   <unnested-xquery pos="24345"/>
   <xml-close-tag pos="24346"/>
   <x-tag-end pos="24354" length="1"/>
   <start-xquery pos="24355" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="24394"/>
   <resume-x-literal-txt pos="24395"/>
   <xml-close-tag pos="24408"/>
   <x-tag-end pos="24411" length="1"/>
   <xml-close-tag pos="24412"/>
   <x-tag-end pos="24417" length="1"/>
   <start-xquery pos="24418" xml-exit-level="2" xq-fnLevel="2"/>
   <literal type="34" start="24453" end="24459"/>
   <xml-open-tag pos="24479" xxq-fnlevel="2"/>
   <x-tag-end pos="24483" length="1"/>
   <xml-open-tag pos="24484" xxq-fnlevel="2"/>
   <xml-name-end pos="24486"/>
   <x-equals pos="24491"/>
   <xml-att-quote pos="24492"/>
   <xml-literal-start pos="24493"/>
   <nested-query pos="24504"/>
   <start-xquery pos="24505" xq-fnLevel="3"/>
   <unnested-xquery pos="24512"/>
   <xml-att-quote pos="24513"/>
   <x-tag-end pos="24514" length="1"/>
   <nested-query pos="24529"/>
   <start-xquery pos="24530" xq-fnLevel="3"/>
   <xml-open-tag pos="24653" xxq-fnlevel="3"/>
   <xml-name-end pos="24657"/>
   <x-equals pos="24661"/>
   <xml-att-quote pos="24662"/>
   <xml-literal-start pos="24663"/>
   <xml-att-quote pos="24692"/>
   <xml-literal-end pos="24693"/>
   <x-equals pos="24699"/>
   <xml-att-quote pos="24700"/>
   <xml-literal-start pos="24701"/>
   <xml-att-quote pos="24714"/>
   <x-tag-end pos="24715" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="24717" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="24718" xxq-fnlevel="3"/>
   <x-tag-end pos="24725" length="1"/>
   <nested-query pos="24726"/>
   <start-xquery pos="24727" xq-fnLevel="4"/>
   <unnested-xquery pos="24732"/>
   <xml-close-tag pos="24733"/>
   <x-tag-end pos="24741" length="1"/>
   <start-xquery pos="24742" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="24781"/>
   <resume-x-literal-txt pos="24782"/>
   <xml-close-tag pos="24795"/>
   <x-tag-end pos="24798" length="1"/>
   <nested-query pos="24799"/>
   <start-xquery pos="24800" xq-fnLevel="3"/>
   <literal type="34" start="24800" end="24802"/>
   <unnested-xquery pos="24803"/>
   <xml-open-tag pos="24804" xxq-fnlevel="2"/>
   <xml-name-end pos="24806"/>
   <x-equals pos="24811"/>
   <xml-att-quote pos="24812"/>
   <xml-literal-start pos="24813"/>
   <nested-query pos="24824"/>
   <start-xquery pos="24825" xq-fnLevel="3"/>
   <unnested-xquery pos="24832"/>
   <xml-att-quote pos="24833"/>
   <x-tag-end pos="24834" length="1"/>
   <xml-close-tag pos="24841"/>
   <x-tag-end pos="24844" length="1"/>
   <xml-close-tag pos="24845"/>
   <x-tag-end pos="24850" length="1"/>
   <start-xquery pos="24851" xml-exit-level="2" xq-fnLevel="2"/>
   <xml-open-tag pos="24886" xxq-fnlevel="2"/>
   <x-tag-end pos="24890" length="1"/>
   <xml-open-tag pos="24891" xxq-fnlevel="2"/>
   <xml-name-end pos="24893"/>
   <x-equals pos="24898"/>
   <xml-att-quote pos="24899"/>
   <xml-literal-start pos="24900"/>
   <nested-query pos="24911"/>
   <start-xquery pos="24912" xq-fnLevel="3"/>
   <unnested-xquery pos="24919"/>
   <xml-att-quote pos="24920"/>
   <x-tag-end pos="24921" length="1"/>
   <nested-query pos="24936"/>
   <start-xquery pos="24937" xq-fnLevel="3"/>
   <xml-open-tag pos="25060" xxq-fnlevel="3"/>
   <xml-name-end pos="25064"/>
   <x-equals pos="25068"/>
   <xml-att-quote pos="25069"/>
   <xml-literal-start pos="25070"/>
   <xml-att-quote pos="25098"/>
   <xml-literal-end pos="25099"/>
   <x-equals pos="25105"/>
   <xml-att-quote pos="25106"/>
   <xml-literal-start pos="25107"/>
   <xml-att-quote pos="25120"/>
   <x-tag-end pos="25121" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="25123" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="25124" xxq-fnlevel="3"/>
   <x-tag-end pos="25131" length="1"/>
   <nested-query pos="25132"/>
   <start-xquery pos="25133" xq-fnLevel="4"/>
   <unnested-xquery pos="25138"/>
   <xml-close-tag pos="25139"/>
   <x-tag-end pos="25147" length="1"/>
   <start-xquery pos="25148" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="25187"/>
   <resume-x-literal-txt pos="25188"/>
   <xml-close-tag pos="25201"/>
   <x-tag-end pos="25204" length="1"/>
   <xml-close-tag pos="25205"/>
   <x-tag-end pos="25210" length="1"/>
   <start-xquery pos="25211" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="25249"/>
   <resume-x-literal-txt pos="25250"/>
   <xml-close-tag pos="25255"/>
   <x-tag-end pos="25260" length="1"/>
   <xml-close-tag pos="25265"/>
   <x-tag-end pos="25270" length="1"/>
   <start-xquery pos="25271" xml-exit-level="0" xq-fnLevel="1"/>
   <literal type="34" start="25788" end="25793"/>
   <literal type="34" start="25849" end="25851"/>
   <literal type="34" start="25991" end="25996"/>
   <comment start="26018" end="26039"/>
   <comment start="26050" end="26151"/>
   <literal type="34" start="26316" end="26318"/>
   <xml-open-tag pos="26829" xxq-fnlevel="1"/>
   <x-tag-end pos="26833" length="1"/>
   <nested-query pos="26848"/>
   <start-xquery pos="26849" xq-fnLevel="2"/>
   <xml-open-tag pos="26866" xxq-fnlevel="2"/>
   <xml-name-end pos="26870"/>
   <x-equals pos="26876"/>
   <xml-att-quote pos="26877"/>
   <xml-literal-start pos="26878"/>
   <xml-att-quote pos="26882"/>
   <xml-literal-end pos="26883"/>
   <x-equals pos="26887"/>
   <xml-att-quote pos="26888"/>
   <nested-query pos="26889"/>
   <start-xquery pos="26890" xq-fnLevel="3"/>
   <unnested-xquery pos="26895"/>
   <xml-att-quote pos="26896"/>
   <xml-literal-end pos="26897"/>
   <x-tag-end pos="26898" length="2" level="2" xq-fnlevel="2"/>
   <start-xquery pos="26900" xml-exit-level="1" xq-fnLevel="2"/>
   <literal type="34" start="26901" end="26903"/>
   <unnested-xquery pos="26913"/>
   <xml-open-tag pos="26914" xxq-fnlevel="1"/>
   <x-tag-end pos="26921" length="1"/>
   <nested-query pos="26922"/>
   <start-xquery pos="26923" xq-fnLevel="2"/>
   <unnested-xquery pos="26929"/>
   <xml-close-tag pos="26930"/>
   <x-tag-end pos="26938" length="1"/>
   <xml-open-tag pos="26955" xxq-fnlevel="1"/>
   <xml-name-end pos="26960"/>
   <x-equals pos="26966"/>
   <xml-att-quote pos="26967"/>
   <xml-literal-start pos="26968"/>
   <xml-att-quote pos="26975"/>
   <xml-literal-end pos="26976"/>
   <x-equals pos="26986"/>
   <xml-att-quote pos="26987"/>
   <xml-literal-start pos="26988"/>
   <xml-att-quote pos="26996"/>
   <x-tag-end pos="26997" length="1"/>
   <nested-query pos="27006"/>
   <start-xquery pos="27007" xq-fnLevel="2"/>
   <comment start="27008" end="27016"/>
   <literal type="34" start="27251" end="27267"/>
   <xml-open-tag pos="27462" xxq-fnlevel="2"/>
   <xml-name-end pos="27464"/>
   <x-equals pos="27469"/>
   <xml-att-quote pos="27470"/>
   <xml-literal-start pos="27471"/>
   <nested-query pos="27482"/>
   <start-xquery pos="27483" xq-fnLevel="3"/>
   <unnested-xquery pos="27486"/>
   <xml-att-quote pos="27487"/>
   <x-tag-end pos="27488" length="1"/>
   <xml-open-tag pos="27489" xxq-fnlevel="2"/>
   <x-tag-end pos="27496" length="1"/>
   <nested-query pos="27497"/>
   <start-xquery pos="27498" xq-fnLevel="3"/>
   <unnested-xquery pos="27503"/>
   <xml-close-tag pos="27504"/>
   <x-tag-end pos="27512" length="1"/>
   <xml-close-tag pos="27513"/>
   <x-tag-end pos="27516" length="1"/>
   <start-xquery pos="27517" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="27531"/>
   <resume-x-literal-txt pos="27532"/>
   <nested-query pos="27543"/>
   <start-xquery pos="27544" xq-fnLevel="2"/>
   <comment start="27545" end="27556"/>
   <literal type="34" start="27707" end="27709"/>
   <comment start="27867" end="27978"/>
   <literal type="34" start="28337" end="28339"/>
   <literal type="34" start="28367" end="28369"/>
   <literal type="34" start="28434" end="28436"/>
   <xml-open-tag pos="28438" xxq-fnlevel="2"/>
   <xml-name-end pos="28440"/>
   <x-equals pos="28445"/>
   <xml-att-quote pos="28446"/>
   <xml-literal-start pos="28447"/>
   <nested-query pos="28458"/>
   <start-xquery pos="28459" xq-fnLevel="3"/>
   <unnested-xquery pos="28462"/>
   <xml-att-quote pos="28463"/>
   <x-tag-end pos="28464" length="1"/>
   <xml-open-tag pos="28465" xxq-fnlevel="2"/>
   <xml-name-end pos="28470"/>
   <x-equals pos="28476"/>
   <xml-att-quote pos="28477"/>
   <nested-query pos="28478"/>
   <start-xquery pos="28479" xq-fnLevel="3"/>
   <unnested-xquery pos="28485"/>
   <resume-x-literal pos="28486"/>
   <xml-att-quote pos="28496"/>
   <xml-literal-end pos="28497"/>
   <x-equals pos="28503"/>
   <xml-att-quote pos="28504"/>
   <xml-literal-start pos="28505"/>
   <nested-query pos="28509"/>
   <start-xquery pos="28510" xq-fnLevel="3"/>
   <unnested-xquery pos="28556"/>
   <xml-att-quote pos="28557"/>
   <x-tag-end pos="28558" length="1"/>
   <nested-query pos="28573"/>
   <start-xquery pos="28574" xq-fnLevel="3"/>
   <xml-open-tag pos="28699" xxq-fnlevel="3"/>
   <xml-name-end pos="28706"/>
   <x-equals pos="28712"/>
   <xml-att-quote pos="28713"/>
   <xml-literal-start pos="28714"/>
   <xml-att-quote pos="28722"/>
   <x-tag-end pos="28723" length="1"/>
   <nested-query pos="28724"/>
   <start-xquery pos="28725" xq-fnLevel="4"/>
   <unnested-xquery pos="28730"/>
   <xml-close-tag pos="28731"/>
   <x-tag-end pos="28739" length="1"/>
   <start-xquery pos="28740" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="28779"/>
   <resume-x-literal-txt pos="28780"/>
   <xml-close-tag pos="28793"/>
   <x-tag-end pos="28799" length="1"/>
   <xml-close-tag pos="28800"/>
   <x-tag-end pos="28803" length="1"/>
   <start-xquery pos="28804" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="28833"/>
   <resume-x-literal-txt pos="28834"/>
   <xml-close-tag pos="28863"/>
   <x-tag-end pos="28869" length="1"/>
   <xml-close-tag pos="28878"/>
   <x-tag-end pos="28883" length="1"/>
   <start-xquery pos="28884" xml-exit-level="0" xq-fnLevel="1"/>
   <literal type="34" start="29141" end="29143"/>
   <xml-open-tag pos="29171" xxq-fnlevel="1"/>
   <x-tag-end pos="29175" length="1"/>
   <nested-query pos="29187"/>
   <start-xquery pos="29188" xq-fnLevel="2"/>
   <comment start="29188" end="29269"/>
   <unnested-xquery pos="29270"/>
   <resume-x-literal-txt pos="29271"/>
   <nested-query pos="29282"/>
   <start-xquery pos="29283" xq-fnLevel="2"/>
   <xml-open-tag pos="29300" xxq-fnlevel="2"/>
   <x-tag-end pos="29303" length="1"/>
   <nested-query pos="29304"/>
   <start-xquery pos="29305" xq-fnLevel="3"/>
   <unnested-xquery pos="29311"/>
   <xml-close-tag pos="29312"/>
   <x-tag-end pos="29316" length="1"/>
   <start-xquery pos="29317" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="29325"/>
   <resume-x-literal-txt pos="29326"/>
   <xml-open-tag pos="29340" xxq-fnlevel="1"/>
   <xml-name-end pos="29344"/>
   <x-equals pos="29350"/>
   <xml-att-quote pos="29351"/>
   <xml-literal-start pos="29352"/>
   <xml-att-quote pos="29364"/>
   <x-tag-end pos="29365" length="1"/>
   <nested-query pos="29374"/>
   <start-xquery pos="29375" xq-fnLevel="2"/>
   <comment start="29384" end="29392"/>
   <literal type="34" start="29459" end="29463"/>
   <literal type="34" start="29631" end="29637"/>
   <literal type="34" start="29646" end="29648"/>
   <xml-open-tag pos="29680" xxq-fnlevel="2"/>
   <x-tag-end pos="29684" length="1"/>
   <xml-open-tag pos="29685" xxq-fnlevel="2"/>
   <xml-name-end pos="29687"/>
   <x-equals pos="29692"/>
   <xml-att-quote pos="29693"/>
   <xml-literal-start pos="29694"/>
   <nested-query pos="29705"/>
   <start-xquery pos="29706" xq-fnLevel="3"/>
   <unnested-xquery pos="29709"/>
   <xml-att-quote pos="29710"/>
   <x-tag-end pos="29711" length="1"/>
   <nested-query pos="29722"/>
   <start-xquery pos="29723" xq-fnLevel="3"/>
   <xml-open-tag pos="29783" xxq-fnlevel="3"/>
   <xml-name-end pos="29787"/>
   <x-equals pos="29791"/>
   <xml-att-quote pos="29792"/>
   <xml-literal-start pos="29793"/>
   <xml-att-quote pos="29818"/>
   <xml-literal-end pos="29819"/>
   <x-equals pos="29825"/>
   <xml-att-quote pos="29826"/>
   <xml-literal-start pos="29827"/>
   <xml-att-quote pos="29840"/>
   <x-tag-end pos="29841" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="29843" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="29844" xxq-fnlevel="3"/>
   <x-tag-end pos="29851" length="1"/>
   <nested-query pos="29852"/>
   <start-xquery pos="29853" xq-fnLevel="4"/>
   <unnested-xquery pos="29858"/>
   <xml-close-tag pos="29859"/>
   <x-tag-end pos="29867" length="1"/>
   <start-xquery pos="29868" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="29909"/>
   <resume-x-literal-txt pos="29910"/>
   <xml-close-tag pos="29920"/>
   <x-tag-end pos="29923" length="1"/>
   <xml-close-tag pos="29934"/>
   <x-tag-end pos="29939" length="1"/>
   <start-xquery pos="29940" xml-exit-level="2" xq-fnLevel="2"/>
   <comment start="29959" end="29973"/>
   <literal type="34" start="30183" end="30187"/>
   <xml-open-tag pos="30190" xxq-fnlevel="2"/>
   <x-tag-end pos="30194" length="1"/>
   <nested-query pos="30195"/>
   <start-xquery pos="30196" xq-fnLevel="3"/>
   <unnested-xquery pos="30202"/>
   <xml-close-tag pos="30203"/>
   <x-tag-end pos="30208" length="1"/>
   <start-xquery pos="30209" xml-exit-level="2" xq-fnLevel="2"/>
   <literal type="34" start="30376" end="30379"/>
   <literal type="34" start="30388" end="30390"/>
   <xml-open-tag pos="30441" xxq-fnlevel="2"/>
   <x-tag-end pos="30445" length="1"/>
   <xml-open-tag pos="30446" xxq-fnlevel="2"/>
   <xml-name-end pos="30448"/>
   <x-equals pos="30453"/>
   <xml-att-quote pos="30454"/>
   <xml-literal-start pos="30455"/>
   <nested-query pos="30466"/>
   <start-xquery pos="30467" xq-fnLevel="3"/>
   <unnested-xquery pos="30470"/>
   <xml-att-quote pos="30471"/>
   <x-tag-end pos="30472" length="1"/>
   <nested-query pos="30499"/>
   <start-xquery pos="30500" xq-fnLevel="3"/>
   <xml-open-tag pos="30585" xxq-fnlevel="3"/>
   <xml-name-end pos="30589"/>
   <x-equals pos="30593"/>
   <xml-att-quote pos="30594"/>
   <xml-literal-start pos="30595"/>
   <xml-att-quote pos="30620"/>
   <xml-literal-end pos="30621"/>
   <x-equals pos="30627"/>
   <xml-att-quote pos="30628"/>
   <xml-literal-start pos="30629"/>
   <xml-att-quote pos="30642"/>
   <x-tag-end pos="30643" length="2" level="5" xq-fnlevel="3"/>
   <start-xquery pos="30645" xml-exit-level="4" xq-fnLevel="3"/>
   <xml-open-tag pos="30646" xxq-fnlevel="3"/>
   <x-tag-end pos="30653" length="1"/>
   <nested-query pos="30654"/>
   <start-xquery pos="30655" xq-fnLevel="4"/>
   <unnested-xquery pos="30660"/>
   <xml-close-tag pos="30661"/>
   <x-tag-end pos="30669" length="1"/>
   <start-xquery pos="30670" xml-exit-level="4" xq-fnLevel="3"/>
   <unnested-xquery pos="30733"/>
   <resume-x-literal-txt pos="30734"/>
   <xml-close-tag pos="30756"/>
   <x-tag-end pos="30759" length="1"/>
   <xml-close-tag pos="30760"/>
   <x-tag-end pos="30765" length="1"/>
   <start-xquery pos="30766" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="30780"/>
   <resume-x-literal-txt pos="30781"/>
   <xml-close-tag pos="30789"/>
   <x-tag-end pos="30794" length="1"/>
   <xml-close-tag pos="30805"/>
   <x-tag-end pos="30810" length="1"/>
   <start-xquery pos="30811" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="30966" end="31018"/>
   <comment start="31025" end="31071"/>
   <comment start="31289" end="31317"/>
   <comment start="31324" end="31383"/>
   <literal type="34" start="31938" end="31947"/>
   <literal type="34" start="32088" end="32098"/>
   <literal type="34" start="32240" end="32246"/>
   <comment start="32400" end="32427"/>
   <comment start="32432" end="32817"/>
   <xml-open-tag pos="33075" xxq-fnlevel="1"/>
   <xml-name-end pos="33080"/>
   <x-equals pos="33086"/>
   <xml-att-quote pos="33087"/>
   <xml-literal-start pos="33088"/>
   <xml-att-quote pos="33100"/>
   <x-tag-end pos="33101" length="1"/>
   <nested-query pos="33102"/>
   <start-xquery pos="33103" xq-fnLevel="2"/>
   <unnested-xquery pos="33112"/>
   <xml-close-tag pos="33113"/>
   <x-tag-end pos="33119" length="1"/>
   <start-xquery pos="33120" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="33145" end="33425"/>
   <comment start="33598" end="33627"/>
   <comment start="33632" end="34767"/>
   <xml-open-tag pos="35098" xxq-fnlevel="1"/>
   <xml-name-end pos="35100"/>
   <x-equals pos="35106"/>
   <xml-att-quote pos="35107"/>
   <xml-literal-start pos="35108"/>
   <xml-att-quote pos="35115"/>
   <x-tag-end pos="35116" length="1"/>
   <nested-query pos="35117"/>
   <start-xquery pos="35118" xq-fnLevel="2"/>
   <xml-open-tag pos="35210" xxq-fnlevel="2"/>
   <x-tag-end pos="35215" length="1"/>
   <nested-query pos="35229"/>
   <start-xquery pos="35230" xq-fnLevel="3"/>
   <unnested-xquery pos="35242"/>
   <resume-x-literal-txt pos="35243"/>
   <xml-open-tag pos="35256" xxq-fnlevel="2"/>
   <x-tag-end pos="35261" length="1"/>
   <nested-query pos="35275"/>
   <start-xquery pos="35276" xq-fnLevel="3"/>
   <unnested-xquery pos="35288"/>
   <resume-x-literal-txt pos="35289"/>
   <xml-open-tag pos="35302" xxq-fnlevel="2"/>
   <x-tag-end pos="35304" length="1"/>
   <xml-close-tag pos="35308"/>
   <x-tag-end pos="35311" length="1"/>
   <xml-close-tag pos="35328"/>
   <x-tag-end pos="35334" length="1"/>
   <xml-close-tag pos="35345"/>
   <x-tag-end pos="35351" length="1"/>
   <start-xquery pos="35352" xml-exit-level="1" xq-fnLevel="2"/>
   <xml-open-tag pos="35378" xxq-fnlevel="2"/>
   <xml-name-end pos="35380"/>
   <x-equals pos="35385"/>
   <xml-att-quote pos="35386"/>
   <xml-literal-start pos="35387"/>
   <xml-att-quote pos="35406"/>
   <xml-literal-end pos="35407"/>
   <x-equals pos="35418"/>
   <xml-att-quote pos="35419"/>
   <xml-literal-start pos="35420"/>
   <nested-query pos="35427"/>
   <start-xquery pos="35428" xq-fnLevel="3"/>
   <unnested-xquery pos="35432"/>
   <resume-x-literal pos="35433"/>
   <xml-att-quote pos="35460"/>
   <xml-literal-end pos="35461"/>
   <x-equals pos="35469"/>
   <xml-att-quote pos="35470"/>
   <xml-literal-start pos="35471"/>
   <nested-query pos="35496"/>
   <start-xquery pos="35497" xq-fnLevel="3"/>
   <unnested-xquery pos="35510"/>
   <resume-x-literal pos="35511"/>
   <nested-query pos="35577"/>
   <start-xquery pos="35578" xq-fnLevel="3"/>
   <unnested-xquery pos="35599"/>
   <resume-x-literal pos="35600"/>
   <nested-query pos="35606"/>
   <start-xquery pos="35607" xq-fnLevel="3"/>
   <unnested-xquery pos="35630"/>
   <resume-x-literal pos="35631"/>
   <xml-att-quote pos="35658"/>
   <x-tag-end pos="35659" length="1"/>
   <nested-query pos="35673"/>
   <start-xquery pos="35674" xq-fnLevel="3"/>
   <unnested-xquery pos="35686"/>
   <resume-x-literal-txt pos="35687"/>
   <xml-open-tag pos="35700" xxq-fnlevel="2"/>
   <x-tag-end pos="35705" length="1"/>
   <nested-query pos="35719"/>
   <start-xquery pos="35720" xq-fnLevel="3"/>
   <unnested-xquery pos="35732"/>
   <resume-x-literal-txt pos="35733"/>
   <xml-open-tag pos="35746" xxq-fnlevel="2"/>
   <x-tag-end pos="35748" length="1"/>
   <xml-close-tag pos="35752"/>
   <x-tag-end pos="35755" length="1"/>
   <xml-close-tag pos="35772"/>
   <x-tag-end pos="35778" length="1"/>
   <xml-close-tag pos="35789"/>
   <x-tag-end pos="35792" length="1"/>
   <start-xquery pos="35793" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="35798"/>
   <xml-close-tag pos="35799"/>
   <x-tag-end pos="35802" length="1"/>
   <start-xquery pos="35803" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="35852" xxq-fnlevel="1"/>
   <xml-name-end pos="35856"/>
   <x-equals pos="35862"/>
   <xml-att-quote pos="35863"/>
   <xml-literal-start pos="35864"/>
   <xml-att-quote pos="35871"/>
   <x-tag-end pos="35872" length="1"/>
   <nested-query pos="35877"/>
   <start-xquery pos="35878" xq-fnLevel="2"/>
   <literal type="34" start="35888" end="35890"/>
   <unnested-xquery pos="35891"/>
   <resume-x-literal-txt pos="35892"/>
   <xml-close-tag pos="35896"/>
   <x-tag-end pos="35901" length="1"/>
   <start-xquery pos="35902" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="35913" xxq-fnlevel="1"/>
   <xml-name-end pos="35917"/>
   <x-equals pos="35920"/>
   <xml-att-quote pos="35921"/>
   <xml-literal-start pos="35922"/>
   <nested-query pos="35926"/>
   <start-xquery pos="35927" xq-fnLevel="2"/>
   <unnested-xquery pos="35931"/>
   <xml-att-quote pos="35932"/>
   <xml-literal-end pos="35933"/>
   <x-equals pos="35939"/>
   <xml-att-quote pos="35940"/>
   <xml-literal-start pos="35941"/>
   <xml-att-quote pos="35956"/>
   <x-tag-end pos="35957" length="1"/>
   <xml-close-tag pos="35959"/>
   <x-tag-end pos="35964" length="1"/>
   <start-xquery pos="35965" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="35973" end="36329"/>
   <comment start="36443" end="36954"/>
   <literal type="34" start="37158" end="37171"/>
   <literal type="34" start="37299" end="37305"/>
   <xml-open-tag pos="37316" xxq-fnlevel="1"/>
   <xml-name-end pos="37321"/>
   <x-equals pos="37327"/>
   <xml-att-quote pos="37328"/>
   <nested-query pos="37329"/>
   <start-xquery pos="37330" xq-fnLevel="2"/>
   <unnested-xquery pos="37351"/>
   <xml-att-quote pos="37352"/>
   <xml-literal-end pos="37353"/>
   <x-equals pos="37359"/>
   <xml-att-quote pos="37360"/>
   <xml-literal-start pos="37361"/>
   <xml-att-quote pos="37371"/>
   <x-tag-end pos="37372" length="1"/>
   <nested-query pos="37373"/>
   <start-xquery pos="37374" xq-fnLevel="2"/>
   <xml-open-tag pos="37406" xxq-fnlevel="2"/>
   <xml-name-end pos="37411"/>
   <x-equals pos="37417"/>
   <xml-att-quote pos="37418"/>
   <xml-literal-start pos="37419"/>
   <xml-att-quote pos="37429"/>
   <x-tag-end pos="37430" length="1"/>
   <nested-query pos="37431"/>
   <start-xquery pos="37432" xq-fnLevel="3"/>
   <unnested-xquery pos="37508"/>
   <xml-close-tag pos="37509"/>
   <x-tag-end pos="37515" length="1"/>
   <start-xquery pos="37516" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="37548"/>
   <xml-close-tag pos="37549"/>
   <x-tag-end pos="37555" length="1"/>
   <start-xquery pos="37556" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="37600" xxq-fnlevel="1"/>
   <xml-name-end pos="37604"/>
   <x-equals pos="37610"/>
   <xml-att-quote pos="37611"/>
   <xml-literal-start pos="37612"/>
   <xml-att-quote pos="37620"/>
   <x-tag-end pos="37621" length="1"/>
   <nested-query pos="37622"/>
   <start-xquery pos="37623" xq-fnLevel="2"/>
   <unnested-xquery pos="37628"/>
   <xml-close-tag pos="37629"/>
   <x-tag-end pos="37634" length="1"/>
   <start-xquery pos="37635" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="37664" end="37795"/>
   <comment start="37868" end="38027"/>
   <comment start="38218" end="38256"/>
   <literal type="34" start="38330" end="38343"/>
   <comment start="38376" end="38416"/>
   <comment start="38612" end="38618"/>
   <comment start="38851" end="38857"/>
   <comment start="38891" end="38928"/>
   <literal type="34" start="39018" end="39031"/>
   <comment start="39074" end="39189"/>
   <comment start="39295" end="39355"/>
   <literal type="34" start="39476" end="39477"/>
   <literal type="34" start="39520" end="39522"/>
   <literal type="34" start="39550" end="39551"/>
   <comment start="39655" end="39715"/>
   <literal type="34" start="39844" end="39845"/>
   <literal type="34" start="39888" end="39890"/>
   <literal type="34" start="39928" end="39929"/>
   <literal type="34" start="39972" end="39974"/>
   <literal type="34" start="40064" end="40065"/>
   <comment start="40082" end="40119"/>
   <literal type="34" start="40191" end="40204"/>
   <comment start="40229" end="40268"/>
   <comment start="40456" end="40462"/>
   <comment start="40691" end="40697"/>
   <literal type="34" start="40762" end="40763"/>
   <comment start="40786" end="40849"/>
   <literal type="34" start="40982" end="40984"/>
   <literal type="34" start="41025" end="41026"/>
   <literal type="34" start="41134" end="41135"/>
   <comment start="41158" end="41221"/>
   <literal type="34" start="41354" end="41356"/>
   <literal type="34" start="41397" end="41398"/>
   <literal type="34" start="41476" end="41477"/>
   <literal type="34" start="41550" end="41563"/>
   <comment start="41732" end="41922"/>
   <literal type="34" start="42090" end="42092"/>
   <literal type="34" start="42103" end="42113"/>
   <literal type="34" start="42120" end="42123"/>
   <literal type="34" start="42238" end="42260"/>
   <comment start="42300" end="42319"/>
   <comment start="42324" end="42599"/>
   <literal type="34" start="42714" end="42715"/>
   <xml-open-tag pos="42728" xxq-fnlevel="1"/>
   <xml-name-end pos="42732"/>
   <x-equals pos="42738"/>
   <xml-att-quote pos="42739"/>
   <xml-literal-start pos="42740"/>
   <xml-att-quote pos="42757"/>
   <x-tag-end pos="42758" length="1"/>
   <nested-query pos="42769"/>
   <start-xquery pos="42770" xq-fnLevel="2"/>
   <literal type="34" start="42771" end="42780"/>
   <xml-open-tag pos="42782" xxq-fnlevel="2"/>
   <x-tag-end pos="42787" length="1"/>
   <xml-open-tag pos="42792" xxq-fnlevel="2"/>
   <x-tag-end pos="42794" length="1"/>
   <nested-query pos="42795"/>
   <start-xquery pos="42796" xq-fnLevel="3"/>
   <unnested-xquery pos="42805"/>
   <xml-close-tag pos="42806"/>
   <x-tag-end pos="42809" length="1"/>
   <xml-close-tag pos="42810"/>
   <x-tag-end pos="42816" length="1"/>
   <start-xquery pos="42817" xml-exit-level="1" xq-fnLevel="2"/>
   <literal type="34" start="42818" end="42820"/>
   <xml-open-tag pos="42867" xxq-fnlevel="2"/>
   <x-tag-end pos="42872" length="1"/>
   <xml-open-tag pos="42876" xxq-fnlevel="2"/>
   <x-tag-end pos="42878" length="1"/>
   <nested-query pos="42879"/>
   <start-xquery pos="42880" xq-fnLevel="3"/>
   <unnested-xquery pos="42893"/>
   <xml-close-tag pos="42894"/>
   <x-tag-end pos="42897" length="1"/>
   <xml-close-tag pos="42898"/>
   <x-tag-end pos="42904" length="1"/>
   <start-xquery pos="42905" xml-exit-level="1" xq-fnLevel="2"/>
   <xml-open-tag pos="42925" xxq-fnlevel="2"/>
   <xml-name-end pos="42927"/>
   <x-equals pos="42932"/>
   <xml-att-quote pos="42933"/>
   <xml-literal-start pos="42934"/>
   <nested-query pos="42945"/>
   <start-xquery pos="42946" xq-fnLevel="3"/>
   <literal type="34" start="42978" end="42980"/>
   <unnested-xquery pos="42983"/>
   <xml-att-quote pos="42984"/>
   <x-tag-end pos="42985" length="1"/>
   <xml-close-tag pos="42989"/>
   <x-tag-end pos="42992" length="1"/>
   <start-xquery pos="42993" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="42994"/>
   <resume-x-literal-txt pos="42995"/>
   <xml-close-tag pos="43001"/>
   <x-tag-end pos="43006" length="1"/>
   <start-xquery pos="43007" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="43063" end="43476"/>
   <xml-open-tag pos="43760" xxq-fnlevel="1"/>
   <xml-name-end pos="43764"/>
   <x-equals pos="43770"/>
   <xml-att-quote pos="43771"/>
   <xml-literal-start pos="43772"/>
   <xml-att-quote pos="43784"/>
   <x-tag-end pos="43785" length="1"/>
   <xml-open-tag pos="43793" xxq-fnlevel="1"/>
   <x-tag-end pos="43798" length="1"/>
   <xml-open-tag pos="43810" xxq-fnlevel="1"/>
   <x-tag-end pos="43817" length="1"/>
   <nested-query pos="43818"/>
   <start-xquery pos="43819" xq-fnLevel="2"/>
   <unnested-xquery pos="43846"/>
   <resume-x-literal-txt pos="43847"/>
   <nested-query pos="43851"/>
   <start-xquery pos="43852" xq-fnLevel="2"/>
   <unnested-xquery pos="43877"/>
   <xml-close-tag pos="43878"/>
   <x-tag-end pos="43886" length="1"/>
   <xml-open-tag pos="43897" xxq-fnlevel="1"/>
   <x-tag-end pos="43904" length="1"/>
   <nested-query pos="43905"/>
   <start-xquery pos="43906" xq-fnLevel="2"/>
   <unnested-xquery pos="43933"/>
   <xml-close-tag pos="43934"/>
   <x-tag-end pos="43942" length="1"/>
   <xml-open-tag pos="43965" xxq-fnlevel="1"/>
   <x-tag-end pos="43972" length="1"/>
   <nested-query pos="43973"/>
   <start-xquery pos="43974" xq-fnLevel="2"/>
   <unnested-xquery pos="43979"/>
   <resume-x-literal-txt pos="43980"/>
   <xml-close-tag pos="43981"/>
   <x-tag-end pos="43989" length="1"/>
   <xml-close-tag pos="43991"/>
   <x-tag-end pos="43997" length="1"/>
   <nested-query pos="43999"/>
   <start-xquery pos="44000" xq-fnLevel="2"/>
   <literal type="34" start="44021" end="44023"/>
   <xml-open-tag pos="44025" xxq-fnlevel="2"/>
   <xml-name-end pos="44027"/>
   <x-equals pos="44032"/>
   <xml-att-quote pos="44033"/>
   <xml-literal-start pos="44034"/>
   <xml-att-quote pos="44044"/>
   <x-tag-end pos="44045" length="1"/>
   <xml-close-tag pos="44060"/>
   <x-tag-end pos="44063" length="1"/>
   <start-xquery pos="44064" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="44073"/>
   <xml-close-tag pos="44074"/>
   <x-tag-end pos="44079" length="1"/>
   <start-xquery pos="44080" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="44087" end="44465"/>
   <xml-open-tag pos="44575" xxq-fnlevel="1"/>
   <xml-name-end pos="44579"/>
   <x-equals pos="44585"/>
   <xml-att-quote pos="44586"/>
   <xml-literal-start pos="44587"/>
   <xml-att-quote pos="44607"/>
   <x-tag-end pos="44608" length="1"/>
   <xml-open-tag pos="44616" xxq-fnlevel="1"/>
   <xml-name-end pos="44621"/>
   <x-equals pos="44628"/>
   <xml-att-quote pos="44629"/>
   <xml-literal-start pos="44630"/>
   <xml-att-quote pos="44633"/>
   <xml-literal-end pos="44634"/>
   <x-equals pos="44641"/>
   <xml-att-quote pos="44642"/>
   <xml-literal-start pos="44643"/>
   <xml-att-quote pos="44653"/>
   <x-tag-end pos="44654" length="1"/>
   <xml-open-tag pos="44669" xxq-fnlevel="1"/>
   <xml-name-end pos="44676"/>
   <x-equals pos="44681"/>
   <xml-att-quote pos="44682"/>
   <xml-literal-start pos="44683"/>
   <xml-att-quote pos="44687"/>
   <xml-literal-end pos="44688"/>
   <x-equals pos="44697"/>
   <xml-att-quote pos="44698"/>
   <xml-literal-start pos="44699"/>
   <xml-att-quote pos="44718"/>
   <x-tag-end pos="44719" length="1"/>
   <xml-open-tag pos="44734" xxq-fnlevel="1"/>
   <xml-name-end pos="44741"/>
   <x-equals pos="44747"/>
   <xml-att-quote pos="44748"/>
   <xml-literal-start pos="44749"/>
   <xml-att-quote pos="44752"/>
   <x-tag-end pos="44753" length="1"/>
   <nested-query pos="44772"/>
   <start-xquery pos="44773" xq-fnLevel="2"/>
   <literal type="34" start="44819" end="44823"/>
   <literal type="34" start="44826" end="44827"/>
   <literal type="34" start="44856" end="44865"/>
   <unnested-xquery pos="44875"/>
   <resume-x-literal-txt pos="44876"/>
   <xml-close-tag pos="44925"/>
   <x-tag-end pos="44933" length="1"/>
   <xml-open-tag pos="44948" xxq-fnlevel="1"/>
   <xml-name-end pos="44955"/>
   <x-equals pos="44961"/>
   <xml-att-quote pos="44962"/>
   <xml-literal-start pos="44963"/>
   <xml-att-quote pos="44967"/>
   <x-tag-end pos="44968" length="1"/>
   <nested-query pos="44987"/>
   <start-xquery pos="44988" xq-fnLevel="2"/>
   <literal type="34" start="45008" end="45013"/>
   <literal type="34" start="45042" end="45051"/>
   <unnested-xquery pos="45061"/>
   <resume-x-literal-txt pos="45062"/>
   <xml-close-tag pos="45106"/>
   <x-tag-end pos="45114" length="1"/>
   <xml-close-tag pos="45129"/>
   <x-tag-end pos="45137" length="1"/>
   <nested-query pos="45146"/>
   <start-xquery pos="45147" xq-fnLevel="2"/>
   <literal type="34" start="45192" end="45197"/>
   <xml-open-tag pos="45227" xxq-fnlevel="2"/>
   <xml-name-end pos="45233"/>
   <x-equals pos="45238"/>
   <xml-att-quote pos="45239"/>
   <xml-literal-start pos="45240"/>
   <xml-att-quote pos="45246"/>
   <xml-literal-end pos="45247"/>
   <x-equals pos="45252"/>
   <xml-att-quote pos="45253"/>
   <nested-query pos="45254"/>
   <start-xquery pos="45255" xq-fnLevel="3"/>
   <unnested-xquery pos="45276"/>
   <xml-att-quote pos="45277"/>
   <xml-literal-end pos="45278"/>
   <x-equals pos="45284"/>
   <xml-att-quote pos="45285"/>
   <xml-literal-start pos="45286"/>
   <xml-att-quote pos="45290"/>
   <xml-literal-end pos="45291"/>
   <x-equals pos="45297"/>
   <xml-att-quote pos="45298"/>
   <nested-query pos="45299"/>
   <start-xquery pos="45300" xq-fnLevel="3"/>
   <unnested-xquery pos="45306"/>
   <xml-att-quote pos="45307"/>
   <xml-literal-end pos="45308"/>
   <x-tag-end pos="45309" length="2" level="3" xq-fnlevel="2"/>
   <start-xquery pos="45311" xml-exit-level="2" xq-fnLevel="2"/>
   <unnested-xquery pos="45311"/>
   <resume-x-literal-txt pos="45312"/>
   <xml-close-tag pos="45319"/>
   <x-tag-end pos="45325" length="1"/>
   <xml-close-tag pos="45332"/>
   <x-tag-end pos="45337" length="1"/>
   <start-xquery pos="45338" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="45358" end="45622"/>
   <literal type="34" start="45745" end="45747"/>
   <xml-open-tag pos="45772" xxq-fnlevel="1"/>
   <xml-name-end pos="45777"/>
   <x-equals pos="45784"/>
   <xml-att-quote pos="45785"/>
   <xml-literal-start pos="45786"/>
   <xml-att-quote pos="45789"/>
   <xml-literal-end pos="45790"/>
   <x-equals pos="45797"/>
   <xml-att-quote pos="45798"/>
   <xml-literal-start pos="45799"/>
   <xml-att-quote pos="45809"/>
   <x-tag-end pos="45810" length="1"/>
   <xml-open-tag pos="45819" xxq-fnlevel="1"/>
   <xml-name-end pos="45825"/>
   <x-equals pos="45830"/>
   <xml-att-quote pos="45831"/>
   <xml-literal-start pos="45832"/>
   <xml-att-quote pos="45836"/>
   <xml-literal-end pos="45837"/>
   <x-equals pos="45842"/>
   <xml-att-quote pos="45843"/>
   <xml-literal-start pos="45844"/>
   <xml-att-quote pos="45845"/>
   <xml-literal-end pos="45846"/>
   <x-equals pos="45852"/>
   <xml-att-quote pos="45853"/>
   <xml-literal-start pos="45854"/>
   <xml-att-quote pos="45864"/>
   <xml-literal-end pos="45865"/>
   <x-equals pos="45868"/>
   <xml-att-quote pos="45869"/>
   <xml-literal-start pos="45870"/>
   <xml-att-quote pos="45883"/>
   <xml-literal-end pos="45884"/>
   <x-equals pos="45890"/>
   <xml-att-quote pos="45891"/>
   <xml-literal-start pos="45892"/>
   <xml-att-quote pos="45899"/>
   <xml-literal-end pos="45900"/>
   <x-equals pos="45906"/>
   <xml-att-quote pos="45907"/>
   <nested-query pos="45908"/>
   <start-xquery pos="45909" xq-fnLevel="2"/>
   <unnested-xquery pos="45968"/>
   <xml-att-quote pos="45969"/>
   <xml-literal-end pos="45970"/>
   <x-tag-end pos="45971" length="2" level="2" xq-fnlevel="1"/>
   <nested-query pos="45973"/>
   <start-xquery pos="45974" xq-fnLevel="2"/>
   <literal type="34" start="45974" end="45976"/>
   <unnested-xquery pos="45977"/>
   <resume-x-literal-txt pos="45978"/>
   <nested-query pos="45986"/>
   <start-xquery pos="45987" xq-fnLevel="2"/>
   <xml-open-tag pos="46027" xxq-fnlevel="2"/>
   <xml-name-end pos="46034"/>
   <x-equals pos="46039"/>
   <xml-att-quote pos="46040"/>
   <xml-literal-start pos="46041"/>
   <xml-att-quote pos="46046"/>
   <xml-literal-end pos="46047"/>
   <x-equals pos="46053"/>
   <xml-att-quote pos="46054"/>
   <xml-literal-start pos="46055"/>
   <xml-att-quote pos="46089"/>
   <x-tag-end pos="46090" length="1"/>
   <nested-query pos="46107"/>
   <start-xquery pos="46108" xq-fnLevel="3"/>
   <literal type="34" start="46211" end="46214"/>
   <literal type="34" start="46346" end="46347"/>
   <literal type="34" start="46417" end="46426"/>
   <unnested-xquery pos="46485"/>
   <resume-x-literal-txt pos="46486"/>
   <xml-close-tag pos="46495"/>
   <x-tag-end pos="46503" length="1"/>
   <start-xquery pos="46504" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="46521"/>
   <resume-x-literal-txt pos="46522"/>
   <xml-open-tag pos="46530" xxq-fnlevel="1"/>
   <xml-name-end pos="46536"/>
   <x-equals pos="46541"/>
   <xml-att-quote pos="46542"/>
   <xml-literal-start pos="46543"/>
   <xml-att-quote pos="46549"/>
   <xml-literal-end pos="46550"/>
   <x-equals pos="46556"/>
   <xml-att-quote pos="46557"/>
   <xml-literal-start pos="46558"/>
   <xml-att-quote pos="46564"/>
   <xml-literal-end pos="46565"/>
   <x-equals pos="46571"/>
   <xml-att-quote pos="46572"/>
   <xml-literal-start pos="46573"/>
   <xml-att-quote pos="46579"/>
   <xml-literal-end pos="46580"/>
   <x-tag-end pos="46581" length="2" level="2" xq-fnlevel="1"/>
   <nested-query pos="46591"/>
   <start-xquery pos="46592" xq-fnLevel="2"/>
   <literal type="34" start="46643" end="46645"/>
   <literal type="34" start="46648" end="46654"/>
   <xml-open-tag pos="46679" xxq-fnlevel="2"/>
   <xml-name-end pos="46685"/>
   <x-equals pos="46690"/>
   <xml-att-quote pos="46691"/>
   <xml-literal-start pos="46692"/>
   <xml-att-quote pos="46698"/>
   <xml-literal-end pos="46699"/>
   <x-equals pos="46704"/>
   <xml-att-quote pos="46705"/>
   <nested-query pos="46706"/>
   <start-xquery pos="46707" xq-fnLevel="3"/>
   <unnested-xquery pos="46728"/>
   <xml-att-quote pos="46729"/>
   <xml-literal-end pos="46730"/>
   <x-equals pos="46736"/>
   <xml-att-quote pos="46737"/>
   <xml-literal-start pos="46738"/>
   <xml-att-quote pos="46742"/>
   <xml-literal-end pos="46743"/>
   <x-equals pos="46749"/>
   <xml-att-quote pos="46750"/>
   <nested-query pos="46751"/>
   <start-xquery pos="46752" xq-fnLevel="3"/>
   <unnested-xquery pos="46758"/>
   <xml-att-quote pos="46759"/>
   <xml-literal-end pos="46760"/>
   <x-tag-end pos="46761" length="2" level="2" xq-fnlevel="2"/>
   <start-xquery pos="46763" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="46763"/>
   <resume-x-literal-txt pos="46764"/>
   <xml-close-tag pos="46771"/>
   <x-tag-end pos="46777" length="1"/>
   <start-xquery pos="46778" xml-exit-level="0" xq-fnLevel="1"/>
   <comment start="46785" end="47135"/>
   <xml-open-tag pos="47372" xxq-fnlevel="1"/>
   <xml-name-end pos="47376"/>
   <x-equals pos="47382"/>
   <xml-att-quote pos="47383"/>
   <xml-literal-start pos="47384"/>
   <xml-att-quote pos="47389"/>
   <x-tag-end pos="47390" length="1"/>
   <nested-query pos="47405"/>
   <start-xquery pos="47406" xq-fnLevel="2"/>
   <xml-open-tag pos="47439" xxq-fnlevel="2"/>
   <xml-name-end pos="47441"/>
   <x-equals pos="47447"/>
   <xml-att-quote pos="47448"/>
   <xml-literal-start pos="47449"/>
   <xml-att-quote pos="47457"/>
   <xml-literal-end pos="47458"/>
   <x-equals pos="47464"/>
   <xml-att-quote pos="47465"/>
   <xml-literal-start pos="47466"/>
   <xml-att-quote pos="47485"/>
   <xml-literal-end pos="47486"/>
   <x-equals pos="47491"/>
   <xml-att-quote pos="47492"/>
   <xml-literal-start pos="47493"/>
   <nested-query pos="47504"/>
   <start-xquery pos="47505" xq-fnLevel="3"/>
   <literal type="34" start="47537" end="47539"/>
   <unnested-xquery pos="47542"/>
   <resume-x-literal pos="47543"/>
   <nested-query pos="47546"/>
   <start-xquery pos="47547" xq-fnLevel="3"/>
   <unnested-xquery pos="47556"/>
   <xml-att-quote pos="47557"/>
   <x-tag-end pos="47558" length="1"/>
   <xml-close-tag pos="47580"/>
   <x-tag-end pos="47583" length="1"/>
   <start-xquery pos="47584" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="47619"/>
   <resume-x-literal-txt pos="47620"/>
   <nested-query pos="47634"/>
   <start-xquery pos="47635" xq-fnLevel="2"/>
   <xml-open-tag pos="47695" xxq-fnlevel="2"/>
   <xml-name-end pos="47697"/>
   <x-equals pos="47703"/>
   <xml-att-quote pos="47704"/>
   <xml-literal-start pos="47705"/>
   <xml-att-quote pos="47713"/>
   <xml-literal-end pos="47714"/>
   <x-equals pos="47720"/>
   <xml-att-quote pos="47721"/>
   <nested-query pos="47722"/>
   <start-xquery pos="47723" xq-fnLevel="3"/>
   <unnested-xquery pos="47743"/>
   <xml-att-quote pos="47744"/>
   <xml-literal-end pos="47745"/>
   <x-equals pos="47750"/>
   <xml-att-quote pos="47751"/>
   <xml-literal-start pos="47752"/>
   <nested-query pos="47763"/>
   <start-xquery pos="47764" xq-fnLevel="3"/>
   <literal type="34" start="47796" end="47798"/>
   <unnested-xquery pos="47801"/>
   <resume-x-literal pos="47802"/>
   <nested-query pos="47805"/>
   <start-xquery pos="47806" xq-fnLevel="3"/>
   <unnested-xquery pos="47815"/>
   <xml-att-quote pos="47816"/>
   <x-tag-end pos="47817" length="1"/>
   <nested-query pos="47818"/>
   <start-xquery pos="47819" xq-fnLevel="3"/>
   <unnested-xquery pos="47839"/>
   <xml-close-tag pos="47840"/>
   <x-tag-end pos="47843" length="1"/>
   <start-xquery pos="47844" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="47879"/>
   <resume-x-literal-txt pos="47880"/>
   <nested-query pos="47894"/>
   <start-xquery pos="47895" xq-fnLevel="2"/>
   <xml-open-tag pos="47981" xxq-fnlevel="2"/>
   <xml-name-end pos="47983"/>
   <x-equals pos="47989"/>
   <xml-att-quote pos="47990"/>
   <xml-literal-start pos="47991"/>
   <xml-att-quote pos="47999"/>
   <xml-literal-end pos="48000"/>
   <x-equals pos="48006"/>
   <xml-att-quote pos="48007"/>
   <nested-query pos="48008"/>
   <start-xquery pos="48009" xq-fnLevel="3"/>
   <unnested-xquery pos="48029"/>
   <xml-att-quote pos="48030"/>
   <xml-literal-end pos="48031"/>
   <x-equals pos="48036"/>
   <xml-att-quote pos="48037"/>
   <xml-literal-start pos="48038"/>
   <nested-query pos="48049"/>
   <start-xquery pos="48050" xq-fnLevel="3"/>
   <literal type="34" start="48082" end="48084"/>
   <unnested-xquery pos="48087"/>
   <resume-x-literal pos="48088"/>
   <nested-query pos="48091"/>
   <start-xquery pos="48092" xq-fnLevel="3"/>
   <unnested-xquery pos="48101"/>
   <xml-att-quote pos="48102"/>
   <x-tag-end pos="48103" length="1"/>
   <nested-query pos="48104"/>
   <start-xquery pos="48105" xq-fnLevel="3"/>
   <unnested-xquery pos="48125"/>
   <xml-close-tag pos="48126"/>
   <x-tag-end pos="48129" length="1"/>
   <start-xquery pos="48130" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="48165"/>
   <resume-x-literal-txt pos="48166"/>
   <nested-query pos="48180"/>
   <start-xquery pos="48181" xq-fnLevel="2"/>
   <xml-open-tag pos="48267" xxq-fnlevel="2"/>
   <xml-name-end pos="48269"/>
   <x-equals pos="48275"/>
   <xml-att-quote pos="48276"/>
   <xml-literal-start pos="48277"/>
   <xml-att-quote pos="48285"/>
   <xml-literal-end pos="48286"/>
   <x-equals pos="48292"/>
   <xml-att-quote pos="48293"/>
   <nested-query pos="48294"/>
   <start-xquery pos="48295" xq-fnLevel="3"/>
   <unnested-xquery pos="48315"/>
   <xml-att-quote pos="48316"/>
   <xml-literal-end pos="48317"/>
   <x-equals pos="48322"/>
   <xml-att-quote pos="48323"/>
   <xml-literal-start pos="48324"/>
   <nested-query pos="48335"/>
   <start-xquery pos="48336" xq-fnLevel="3"/>
   <literal type="34" start="48368" end="48370"/>
   <unnested-xquery pos="48373"/>
   <resume-x-literal pos="48374"/>
   <nested-query pos="48377"/>
   <start-xquery pos="48378" xq-fnLevel="3"/>
   <unnested-xquery pos="48387"/>
   <xml-att-quote pos="48388"/>
   <x-tag-end pos="48389" length="1"/>
   <nested-query pos="48390"/>
   <start-xquery pos="48391" xq-fnLevel="3"/>
   <unnested-xquery pos="48411"/>
   <xml-close-tag pos="48412"/>
   <x-tag-end pos="48415" length="1"/>
   <start-xquery pos="48416" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="48451"/>
   <resume-x-literal-txt pos="48452"/>
   <nested-query pos="48466"/>
   <start-xquery pos="48467" xq-fnLevel="2"/>
   <xml-open-tag pos="48522" xxq-fnlevel="2"/>
   <xml-name-end pos="48524"/>
   <x-equals pos="48530"/>
   <xml-att-quote pos="48531"/>
   <xml-literal-start pos="48532"/>
   <xml-att-quote pos="48540"/>
   <xml-literal-end pos="48541"/>
   <x-equals pos="48547"/>
   <xml-att-quote pos="48548"/>
   <nested-query pos="48549"/>
   <start-xquery pos="48550" xq-fnLevel="3"/>
   <unnested-xquery pos="48570"/>
   <xml-att-quote pos="48571"/>
   <xml-literal-end pos="48572"/>
   <x-equals pos="48577"/>
   <xml-att-quote pos="48578"/>
   <xml-literal-start pos="48579"/>
   <nested-query pos="48590"/>
   <start-xquery pos="48591" xq-fnLevel="3"/>
   <literal type="34" start="48623" end="48625"/>
   <unnested-xquery pos="48628"/>
   <resume-x-literal pos="48629"/>
   <nested-query pos="48632"/>
   <start-xquery pos="48633" xq-fnLevel="3"/>
   <unnested-xquery pos="48642"/>
   <xml-att-quote pos="48643"/>
   <x-tag-end pos="48644" length="1"/>
   <nested-query pos="48645"/>
   <start-xquery pos="48646" xq-fnLevel="3"/>
   <unnested-xquery pos="48666"/>
   <xml-close-tag pos="48667"/>
   <x-tag-end pos="48670" length="1"/>
   <start-xquery pos="48671" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="48706"/>
   <resume-x-literal-txt pos="48707"/>
   <nested-query pos="48721"/>
   <start-xquery pos="48722" xq-fnLevel="2"/>
   <xml-open-tag pos="48761" xxq-fnlevel="2"/>
   <xml-name-end pos="48763"/>
   <x-equals pos="48769"/>
   <xml-att-quote pos="48770"/>
   <xml-literal-start pos="48771"/>
   <xml-att-quote pos="48779"/>
   <xml-literal-end pos="48780"/>
   <x-equals pos="48786"/>
   <xml-att-quote pos="48787"/>
   <nested-query pos="48788"/>
   <start-xquery pos="48789" xq-fnLevel="3"/>
   <unnested-xquery pos="48805"/>
   <xml-att-quote pos="48806"/>
   <xml-literal-end pos="48807"/>
   <x-equals pos="48812"/>
   <xml-att-quote pos="48813"/>
   <xml-literal-start pos="48814"/>
   <nested-query pos="48825"/>
   <start-xquery pos="48826" xq-fnLevel="3"/>
   <literal type="34" start="48858" end="48860"/>
   <unnested-xquery pos="48863"/>
   <resume-x-literal pos="48864"/>
   <nested-query pos="48867"/>
   <start-xquery pos="48868" xq-fnLevel="3"/>
   <unnested-xquery pos="48873"/>
   <xml-att-quote pos="48874"/>
   <x-tag-end pos="48875" length="1"/>
   <xml-open-tag pos="48876" xxq-fnlevel="2"/>
   <x-tag-end pos="48883" length="1"/>
   <nested-query pos="48884"/>
   <start-xquery pos="48885" xq-fnLevel="3"/>
   <unnested-xquery pos="48901"/>
   <xml-close-tag pos="48902"/>
   <x-tag-end pos="48910" length="1"/>
   <xml-close-tag pos="48911"/>
   <x-tag-end pos="48914" length="1"/>
   <start-xquery pos="48915" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="48950"/>
   <resume-x-literal-txt pos="48951"/>
   <nested-query pos="48965"/>
   <start-xquery pos="48966" xq-fnLevel="2"/>
   <xml-open-tag pos="49009" xxq-fnlevel="2"/>
   <xml-name-end pos="49011"/>
   <x-equals pos="49017"/>
   <xml-att-quote pos="49018"/>
   <xml-literal-start pos="49019"/>
   <xml-att-quote pos="49027"/>
   <xml-literal-end pos="49028"/>
   <x-equals pos="49034"/>
   <xml-att-quote pos="49035"/>
   <nested-query pos="49036"/>
   <start-xquery pos="49037" xq-fnLevel="3"/>
   <unnested-xquery pos="49057"/>
   <xml-att-quote pos="49058"/>
   <xml-literal-end pos="49059"/>
   <x-equals pos="49064"/>
   <xml-att-quote pos="49065"/>
   <xml-literal-start pos="49066"/>
   <nested-query pos="49077"/>
   <start-xquery pos="49078" xq-fnLevel="3"/>
   <literal type="34" start="49110" end="49112"/>
   <unnested-xquery pos="49115"/>
   <resume-x-literal pos="49116"/>
   <nested-query pos="49119"/>
   <start-xquery pos="49120" xq-fnLevel="3"/>
   <unnested-xquery pos="49129"/>
   <xml-att-quote pos="49130"/>
   <x-tag-end pos="49131" length="1"/>
   <nested-query pos="49132"/>
   <start-xquery pos="49133" xq-fnLevel="3"/>
   <unnested-xquery pos="49153"/>
   <xml-close-tag pos="49154"/>
   <x-tag-end pos="49157" length="1"/>
   <start-xquery pos="49158" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="49193"/>
   <resume-x-literal-txt pos="49194"/>
   <nested-query pos="49208"/>
   <start-xquery pos="49209" xq-fnLevel="2"/>
   <xml-open-tag pos="49252" xxq-fnlevel="2"/>
   <xml-name-end pos="49254"/>
   <x-equals pos="49260"/>
   <xml-att-quote pos="49261"/>
   <xml-literal-start pos="49262"/>
   <xml-att-quote pos="49271"/>
   <xml-literal-end pos="49272"/>
   <x-equals pos="49278"/>
   <xml-att-quote pos="49279"/>
   <nested-query pos="49280"/>
   <start-xquery pos="49281" xq-fnLevel="3"/>
   <unnested-xquery pos="49301"/>
   <xml-att-quote pos="49302"/>
   <xml-literal-end pos="49303"/>
   <x-equals pos="49308"/>
   <xml-att-quote pos="49309"/>
   <xml-literal-start pos="49310"/>
   <nested-query pos="49321"/>
   <start-xquery pos="49322" xq-fnLevel="3"/>
   <literal type="34" start="49354" end="49356"/>
   <unnested-xquery pos="49359"/>
   <resume-x-literal pos="49360"/>
   <nested-query pos="49363"/>
   <start-xquery pos="49364" xq-fnLevel="3"/>
   <unnested-xquery pos="49373"/>
   <xml-att-quote pos="49374"/>
   <x-tag-end pos="49375" length="1"/>
   <nested-query pos="49376"/>
   <start-xquery pos="49377" xq-fnLevel="3"/>
   <unnested-xquery pos="49397"/>
   <xml-close-tag pos="49398"/>
   <x-tag-end pos="49401" length="1"/>
   <start-xquery pos="49402" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="49437"/>
   <resume-x-literal-txt pos="49438"/>
   <nested-query pos="49452"/>
   <start-xquery pos="49453" xq-fnLevel="2"/>
   <xml-open-tag pos="49496" xxq-fnlevel="2"/>
   <xml-name-end pos="49498"/>
   <x-equals pos="49504"/>
   <xml-att-quote pos="49505"/>
   <xml-literal-start pos="49506"/>
   <xml-att-quote pos="49515"/>
   <xml-literal-end pos="49516"/>
   <x-equals pos="49522"/>
   <xml-att-quote pos="49523"/>
   <nested-query pos="49524"/>
   <start-xquery pos="49525" xq-fnLevel="3"/>
   <unnested-xquery pos="49545"/>
   <xml-att-quote pos="49546"/>
   <xml-literal-end pos="49547"/>
   <x-equals pos="49552"/>
   <xml-att-quote pos="49553"/>
   <xml-literal-start pos="49554"/>
   <nested-query pos="49565"/>
   <start-xquery pos="49566" xq-fnLevel="3"/>
   <literal type="34" start="49598" end="49600"/>
   <unnested-xquery pos="49603"/>
   <resume-x-literal pos="49604"/>
   <nested-query pos="49607"/>
   <start-xquery pos="49608" xq-fnLevel="3"/>
   <unnested-xquery pos="49617"/>
   <xml-att-quote pos="49618"/>
   <x-tag-end pos="49619" length="1"/>
   <nested-query pos="49620"/>
   <start-xquery pos="49621" xq-fnLevel="3"/>
   <unnested-xquery pos="49641"/>
   <xml-close-tag pos="49642"/>
   <x-tag-end pos="49645" length="1"/>
   <start-xquery pos="49646" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="49681"/>
   <resume-x-literal-txt pos="49682"/>
   <nested-query pos="49696"/>
   <start-xquery pos="49697" xq-fnLevel="2"/>
   <xml-open-tag pos="49740" xxq-fnlevel="2"/>
   <xml-name-end pos="49742"/>
   <x-equals pos="49748"/>
   <xml-att-quote pos="49749"/>
   <xml-literal-start pos="49750"/>
   <xml-att-quote pos="49759"/>
   <xml-literal-end pos="49760"/>
   <x-equals pos="49766"/>
   <xml-att-quote pos="49767"/>
   <nested-query pos="49768"/>
   <start-xquery pos="49769" xq-fnLevel="3"/>
   <unnested-xquery pos="49789"/>
   <xml-att-quote pos="49790"/>
   <xml-literal-end pos="49791"/>
   <x-equals pos="49796"/>
   <xml-att-quote pos="49797"/>
   <xml-literal-start pos="49798"/>
   <nested-query pos="49809"/>
   <start-xquery pos="49810" xq-fnLevel="3"/>
   <literal type="34" start="49842" end="49844"/>
   <unnested-xquery pos="49847"/>
   <resume-x-literal pos="49848"/>
   <nested-query pos="49851"/>
   <start-xquery pos="49852" xq-fnLevel="3"/>
   <unnested-xquery pos="49861"/>
   <xml-att-quote pos="49862"/>
   <x-tag-end pos="49863" length="1"/>
   <nested-query pos="49864"/>
   <start-xquery pos="49865" xq-fnLevel="3"/>
   <unnested-xquery pos="49885"/>
   <xml-close-tag pos="49886"/>
   <x-tag-end pos="49889" length="1"/>
   <start-xquery pos="49890" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="49925"/>
   <resume-x-literal-txt pos="49926"/>
   <nested-query pos="49940"/>
   <start-xquery pos="49941" xq-fnLevel="2"/>
   <xml-open-tag pos="49984" xxq-fnlevel="2"/>
   <xml-name-end pos="49986"/>
   <x-equals pos="49992"/>
   <xml-att-quote pos="49993"/>
   <xml-literal-start pos="49994"/>
   <xml-att-quote pos="50003"/>
   <xml-literal-end pos="50004"/>
   <x-equals pos="50010"/>
   <xml-att-quote pos="50011"/>
   <nested-query pos="50012"/>
   <start-xquery pos="50013" xq-fnLevel="3"/>
   <unnested-xquery pos="50033"/>
   <xml-att-quote pos="50034"/>
   <xml-literal-end pos="50035"/>
   <x-equals pos="50040"/>
   <xml-att-quote pos="50041"/>
   <xml-literal-start pos="50042"/>
   <nested-query pos="50053"/>
   <start-xquery pos="50054" xq-fnLevel="3"/>
   <literal type="34" start="50086" end="50088"/>
   <unnested-xquery pos="50091"/>
   <resume-x-literal pos="50092"/>
   <nested-query pos="50095"/>
   <start-xquery pos="50096" xq-fnLevel="3"/>
   <unnested-xquery pos="50105"/>
   <xml-att-quote pos="50106"/>
   <x-tag-end pos="50107" length="1"/>
   <nested-query pos="50108"/>
   <start-xquery pos="50109" xq-fnLevel="3"/>
   <unnested-xquery pos="50129"/>
   <xml-close-tag pos="50130"/>
   <x-tag-end pos="50133" length="1"/>
   <start-xquery pos="50134" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="50169"/>
   <resume-x-literal-txt pos="50170"/>
   <nested-query pos="50184"/>
   <start-xquery pos="50185" xq-fnLevel="2"/>
   <xml-open-tag pos="50228" xxq-fnlevel="2"/>
   <xml-name-end pos="50230"/>
   <x-equals pos="50236"/>
   <xml-att-quote pos="50237"/>
   <xml-literal-start pos="50238"/>
   <xml-att-quote pos="50247"/>
   <xml-literal-end pos="50248"/>
   <x-equals pos="50254"/>
   <xml-att-quote pos="50255"/>
   <nested-query pos="50256"/>
   <start-xquery pos="50257" xq-fnLevel="3"/>
   <unnested-xquery pos="50277"/>
   <xml-att-quote pos="50278"/>
   <xml-literal-end pos="50279"/>
   <x-equals pos="50284"/>
   <xml-att-quote pos="50285"/>
   <xml-literal-start pos="50286"/>
   <nested-query pos="50297"/>
   <start-xquery pos="50298" xq-fnLevel="3"/>
   <literal type="34" start="50330" end="50332"/>
   <unnested-xquery pos="50335"/>
   <resume-x-literal pos="50336"/>
   <nested-query pos="50339"/>
   <start-xquery pos="50340" xq-fnLevel="3"/>
   <unnested-xquery pos="50349"/>
   <xml-att-quote pos="50350"/>
   <x-tag-end pos="50351" length="1"/>
   <nested-query pos="50352"/>
   <start-xquery pos="50353" xq-fnLevel="3"/>
   <unnested-xquery pos="50373"/>
   <xml-close-tag pos="50374"/>
   <x-tag-end pos="50377" length="1"/>
   <start-xquery pos="50378" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="50413"/>
   <resume-x-literal-txt pos="50414"/>
   <nested-query pos="50428"/>
   <start-xquery pos="50429" xq-fnLevel="2"/>
   <xml-open-tag pos="50472" xxq-fnlevel="2"/>
   <xml-name-end pos="50474"/>
   <x-equals pos="50480"/>
   <xml-att-quote pos="50481"/>
   <xml-literal-start pos="50482"/>
   <xml-att-quote pos="50491"/>
   <xml-literal-end pos="50492"/>
   <x-equals pos="50498"/>
   <xml-att-quote pos="50499"/>
   <nested-query pos="50500"/>
   <start-xquery pos="50501" xq-fnLevel="3"/>
   <unnested-xquery pos="50521"/>
   <xml-att-quote pos="50522"/>
   <xml-literal-end pos="50523"/>
   <x-equals pos="50528"/>
   <xml-att-quote pos="50529"/>
   <xml-literal-start pos="50530"/>
   <nested-query pos="50541"/>
   <start-xquery pos="50542" xq-fnLevel="3"/>
   <literal type="34" start="50574" end="50576"/>
   <unnested-xquery pos="50579"/>
   <resume-x-literal pos="50580"/>
   <nested-query pos="50583"/>
   <start-xquery pos="50584" xq-fnLevel="3"/>
   <unnested-xquery pos="50593"/>
   <xml-att-quote pos="50594"/>
   <x-tag-end pos="50595" length="1"/>
   <nested-query pos="50596"/>
   <start-xquery pos="50597" xq-fnLevel="3"/>
   <unnested-xquery pos="50617"/>
   <xml-close-tag pos="50618"/>
   <x-tag-end pos="50621" length="1"/>
   <start-xquery pos="50622" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="50657"/>
   <resume-x-literal-txt pos="50658"/>
   <nested-query pos="50672"/>
   <start-xquery pos="50673" xq-fnLevel="2"/>
   <xml-open-tag pos="50716" xxq-fnlevel="2"/>
   <xml-name-end pos="50718"/>
   <x-equals pos="50724"/>
   <xml-att-quote pos="50725"/>
   <xml-literal-start pos="50726"/>
   <xml-att-quote pos="50735"/>
   <xml-literal-end pos="50736"/>
   <x-equals pos="50742"/>
   <xml-att-quote pos="50743"/>
   <nested-query pos="50744"/>
   <start-xquery pos="50745" xq-fnLevel="3"/>
   <unnested-xquery pos="50765"/>
   <xml-att-quote pos="50766"/>
   <xml-literal-end pos="50767"/>
   <x-equals pos="50772"/>
   <xml-att-quote pos="50773"/>
   <xml-literal-start pos="50774"/>
   <nested-query pos="50785"/>
   <start-xquery pos="50786" xq-fnLevel="3"/>
   <literal type="34" start="50818" end="50820"/>
   <unnested-xquery pos="50823"/>
   <resume-x-literal pos="50824"/>
   <nested-query pos="50827"/>
   <start-xquery pos="50828" xq-fnLevel="3"/>
   <unnested-xquery pos="50837"/>
   <xml-att-quote pos="50838"/>
   <x-tag-end pos="50839" length="1"/>
   <nested-query pos="50840"/>
   <start-xquery pos="50841" xq-fnLevel="3"/>
   <unnested-xquery pos="50861"/>
   <xml-close-tag pos="50862"/>
   <x-tag-end pos="50865" length="1"/>
   <start-xquery pos="50866" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="50901"/>
   <resume-x-literal-txt pos="50902"/>
   <nested-query pos="50916"/>
   <start-xquery pos="50917" xq-fnLevel="2"/>
   <xml-open-tag pos="50978" xxq-fnlevel="2"/>
   <xml-name-end pos="50980"/>
   <x-equals pos="50986"/>
   <xml-att-quote pos="50987"/>
   <xml-literal-start pos="50988"/>
   <xml-att-quote pos="50997"/>
   <xml-literal-end pos="50998"/>
   <x-equals pos="51004"/>
   <xml-att-quote pos="51005"/>
   <nested-query pos="51006"/>
   <start-xquery pos="51007" xq-fnLevel="3"/>
   <unnested-xquery pos="51027"/>
   <xml-att-quote pos="51028"/>
   <xml-literal-end pos="51029"/>
   <x-equals pos="51034"/>
   <xml-att-quote pos="51035"/>
   <xml-literal-start pos="51036"/>
   <nested-query pos="51047"/>
   <start-xquery pos="51048" xq-fnLevel="3"/>
   <literal type="34" start="51080" end="51082"/>
   <unnested-xquery pos="51085"/>
   <resume-x-literal pos="51086"/>
   <nested-query pos="51089"/>
   <start-xquery pos="51090" xq-fnLevel="3"/>
   <unnested-xquery pos="51099"/>
   <xml-att-quote pos="51100"/>
   <x-tag-end pos="51101" length="1"/>
   <nested-query pos="51102"/>
   <start-xquery pos="51103" xq-fnLevel="3"/>
   <unnested-xquery pos="51123"/>
   <xml-close-tag pos="51124"/>
   <x-tag-end pos="51127" length="1"/>
   <start-xquery pos="51128" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="51163"/>
   <resume-x-literal-txt pos="51164"/>
   <nested-query pos="51178"/>
   <start-xquery pos="51179" xq-fnLevel="2"/>
   <xml-open-tag pos="51222" xxq-fnlevel="2"/>
   <xml-name-end pos="51224"/>
   <x-equals pos="51230"/>
   <xml-att-quote pos="51231"/>
   <xml-literal-start pos="51232"/>
   <xml-att-quote pos="51240"/>
   <xml-literal-end pos="51241"/>
   <x-equals pos="51247"/>
   <xml-att-quote pos="51248"/>
   <xml-literal-start pos="51249"/>
   <xml-att-quote pos="51264"/>
   <xml-literal-end pos="51265"/>
   <x-equals pos="51270"/>
   <xml-att-quote pos="51271"/>
   <xml-literal-start pos="51272"/>
   <nested-query pos="51283"/>
   <start-xquery pos="51284" xq-fnLevel="3"/>
   <literal type="34" start="51316" end="51318"/>
   <unnested-xquery pos="51321"/>
   <resume-x-literal pos="51322"/>
   <nested-query pos="51325"/>
   <start-xquery pos="51326" xq-fnLevel="3"/>
   <unnested-xquery pos="51335"/>
   <xml-att-quote pos="51336"/>
   <x-tag-end pos="51337" length="1"/>
   <xml-close-tag pos="51355"/>
   <x-tag-end pos="51358" length="1"/>
   <start-xquery pos="51359" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="51394"/>
   <resume-x-literal-txt pos="51395"/>
   <xml-close-tag pos="51405"/>
   <x-tag-end pos="51410" length="1"/>
   <start-xquery pos="51411" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="51620" xxq-fnlevel="1"/>
   <xml-name-end pos="51624"/>
   <x-equals pos="51630"/>
   <xml-att-quote pos="51631"/>
   <xml-literal-start pos="51632"/>
   <xml-att-quote pos="51649"/>
   <x-tag-end pos="51650" length="1"/>
   <xml-open-tag pos="51673" xxq-fnlevel="1"/>
   <x-tag-end pos="51678" length="1"/>
   <xml-close-tag pos="51682"/>
   <x-tag-end pos="51688" length="1"/>
   <nested-query pos="51689"/>
   <start-xquery pos="51690" xq-fnLevel="2"/>
   <literal type="34" start="51690" end="51692"/>
   <unnested-xquery pos="51693"/>
   <resume-x-literal-txt pos="51694"/>
   <nested-query pos="51708"/>
   <start-xquery pos="51709" xq-fnLevel="2"/>
   <literal type="34" start="52043" end="52046"/>
   <xml-open-tag pos="52074" xxq-fnlevel="2"/>
   <x-tag-end pos="52079" length="1"/>
   <nested-query pos="52080"/>
   <start-xquery pos="52081" xq-fnLevel="3"/>
   <unnested-xquery pos="52091"/>
   <resume-x-literal-txt pos="52092"/>
   <nested-query pos="52113"/>
   <start-xquery pos="52114" xq-fnLevel="3"/>
   <literal type="34" start="52239" end="52244"/>
   <xml-open-tag pos="52255" xxq-fnlevel="3"/>
   <x-tag-end pos="52257" length="1"/>
   <nested-query pos="52258"/>
   <start-xquery pos="52259" xq-fnLevel="4"/>
   <unnested-xquery pos="52288"/>
   <xml-close-tag pos="52289"/>
   <x-tag-end pos="52292" length="1"/>
   <start-xquery pos="52293" xml-exit-level="2" xq-fnLevel="3"/>
   <literal type="34" start="52295" end="52297"/>
   <xml-open-tag pos="52325" xxq-fnlevel="3"/>
   <xml-name-end pos="52327"/>
   <x-equals pos="52332"/>
   <xml-att-quote pos="52333"/>
   <xml-literal-start pos="52334"/>
   <nested-query pos="52345"/>
   <start-xquery pos="52346" xq-fnLevel="4"/>
   <literal type="34" start="52432" end="52434"/>
   <unnested-xquery pos="52448"/>
   <xml-att-quote pos="52449"/>
   <x-tag-end pos="52450" length="1"/>
   <xml-close-tag pos="52454"/>
   <x-tag-end pos="52457" length="1"/>
   <start-xquery pos="52458" xml-exit-level="2" xq-fnLevel="3"/>
   <unnested-xquery pos="52477"/>
   <resume-x-literal-txt pos="52478"/>
   <xml-close-tag pos="52496"/>
   <x-tag-end pos="52502" length="1"/>
   <start-xquery pos="52503" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="52536"/>
   <resume-x-literal-txt pos="52537"/>
   <nested-query pos="52551"/>
   <start-xquery pos="52552" xq-fnLevel="2"/>
   <literal type="34" start="52591" end="52609"/>
   <xml-open-tag pos="52612" xxq-fnlevel="2"/>
   <x-tag-end pos="52614" length="1"/>
   <nested-query pos="52615"/>
   <start-xquery pos="52616" xq-fnLevel="3"/>
   <literal type="34" start="52656" end="52659"/>
   <literal type="34" start="52662" end="52663"/>
   <unnested-xquery pos="52665"/>
   <resume-x-literal-txt pos="52666"/>
   <nested-query pos="52666"/>
   <start-xquery pos="52667" xq-fnLevel="3"/>
   <literal type="34" start="52667" end="52673"/>
   <unnested-xquery pos="52674"/>
   <xml-close-tag pos="52675"/>
   <x-tag-end pos="52678" length="1"/>
   <start-xquery pos="52679" xml-exit-level="1" xq-fnLevel="2"/>
   <literal type="34" start="52681" end="52683"/>
   <xml-open-tag pos="52699" xxq-fnlevel="2"/>
   <xml-name-end pos="52701"/>
   <x-equals pos="52706"/>
   <xml-att-quote pos="52707"/>
   <xml-literal-start pos="52708"/>
   <nested-query pos="52719"/>
   <start-xquery pos="52720" xq-fnLevel="3"/>
   <literal type="34" start="52772" end="52776"/>
   <unnested-xquery pos="52799"/>
   <xml-att-quote pos="52800"/>
   <x-tag-end pos="52801" length="1"/>
   <xml-close-tag pos="52805"/>
   <x-tag-end pos="52808" length="1"/>
   <start-xquery pos="52809" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="52831"/>
   <resume-x-literal-txt pos="52832"/>
   <xml-close-tag pos="52842"/>
   <x-tag-end pos="52847" length="1"/>
   <start-xquery pos="52848" xml-exit-level="0" xq-fnLevel="1"/>
   <xml-open-tag pos="53264" xxq-fnlevel="1"/>
   <x-tag-end pos="53282" length="1"/>
   <nested-query pos="53283"/>
   <start-xquery pos="53284" xq-fnLevel="2"/>
   <literal type="34" start="53301" end="53306"/>
   <literal type="34" start="53309" end="53313"/>
   <literal type="34" start="53316" end="53320"/>
   <literal type="34" start="53526" end="53530"/>
   <xml-open-tag pos="53606" xxq-fnlevel="2"/>
   <xml-name-end pos="53612"/>
   <x-equals pos="53618"/>
   <xml-att-quote pos="53619"/>
   <nested-query pos="53620"/>
   <start-xquery pos="53621" xq-fnLevel="3"/>
   <unnested-xquery pos="53623"/>
   <xml-att-quote pos="53624"/>
   <x-tag-end pos="53625" length="1"/>
   <nested-query pos="53626"/>
   <start-xquery pos="53627" xq-fnLevel="3"/>
   <xml-open-tag pos="53674" xxq-fnlevel="3"/>
   <xml-name-end pos="53679"/>
   <x-equals pos="53685"/>
   <xml-att-quote pos="53686"/>
   <nested-query pos="53687"/>
   <start-xquery pos="53688" xq-fnLevel="4"/>
   <unnested-xquery pos="53693"/>
   <xml-att-quote pos="53694"/>
   <x-tag-end pos="53695" length="2" level="3" xq-fnlevel="3"/>
   <start-xquery pos="53697" xml-exit-level="2" xq-fnLevel="3"/>
   <unnested-xquery pos="53703"/>
   <xml-close-tag pos="53704"/>
   <x-tag-end pos="53711" length="1"/>
   <start-xquery pos="53712" xml-exit-level="1" xq-fnLevel="2"/>
   <unnested-xquery pos="53718"/>
   <xml-close-tag pos="53719"/>
   <x-tag-end pos="53738" length="1"/>
   <start-xquery pos="53739" xml-exit-level="0" xq-fnLevel="1"/>
   <literal type="34" start="53868" end="53870"/>
   <literal type="34" start="54035" end="54037"/>
   <terminate-xquery/>
   <tokens>
      <span class="comment" pos="1" xq="yes">(:&#xD;
 : search-ui.xqy&#xD;
 :&#xD;
 : Copyright (c) 2008 Mark Logic Corporation. All rights reserved.&#xD;
 :&#xD;
 : Licensed under the Apache License, Version 2.0 (the "License");&#xD;
 : you may not use this file except in compliance with the License.&#xD;
 : You may obtain a copy of the License at&#xD;
 :&#xD;
 :     http://www.apache.org/licenses/LICENSE-2.0&#xD;
 :&#xD;
 : Unless required by applicable law or agreed to in writing, software&#xD;
 : distributed under the License is distributed on an "AS IS" BASIS,&#xD;
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&#xD;
 : See the License for the specific language governing permissions and&#xD;
 : limitations under the License.&#xD;
 :&#xD;
 :&#xD;
 : Search UI Library&#xD;
 : This library has over 1,000 lines of code used specifically for&#xD;
 : creating search experiences in an end-to-end XQuery application.&#xD;
 : Primarily used in demos and prototypes to speed development of common&#xD;
 : search-related tasks.&#xD;
 : &#xD;
 : This library is meant to be changed to suit your application's needs.&#xD;
 : Please test your application when using this library.&#xD;
 :&#xD;
 : Coordinator:&#xD;
 : @author &lt;a href="mailto:chris.welch@marklogic.com"&gt;Chris Welch&lt;/a&gt;&#xD;
 :&#xD;
 : @requires MarkLogic Server 3.2&#xD;
 : @requires Versi&#xD;
 : @requires lib-search&#xD;
 : @requires lib-uitools&#xD;
 : All are available for download on developer.marklogic.com&#xD;
 : Format: 3.2-YYYY-MM-DD.[Incremental]&#xD;
 : @version 3.2-2008-06-10&#xD;
 :&#xD;
 :)</span>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="5" prev-is-closed="false" class="qname">module</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="1420" xq="yes">http://www.marklogic.com/ps/versi/search-ui</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="5" prev-is-closed="true" class="qname">import</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="true" class="qname">module</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="qname">namespace</span>
      <span xq="yes" start="28" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="29" prev-is-closed="true" class="qname">search</span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">=</span>
      <span class="op">"</span>
      <span class="literal" pos="1500" xq="yes">http://www.marklogic.com/ps/lib/lib-search</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="1548" xq="yes">lib-search.xqy</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">import</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">module</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="1580" xq="yes">http://www.marklogic.com/ps/lib/lib-search</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="1628" xq="yes">lib-search-custom.xqy</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">import</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">module</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="qname">namespace</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="qname">uit</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">=</span>
      <span class="op">"</span>
      <span class="literal" pos="1681" xq="yes">http://www.marklogic.com/ps/lib/lib-uitools</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="1730" xq="yes">lib-uitools.xqy</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="1751" xq="yes">(: Defines the fields in which a user can search in. Each item should be in the format "[scope-id]|[display-name]" :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">variable</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="variable">$SEARCH-FIELDS</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="47" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="49" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="50" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="1919" xq="yes">|Anywhere</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="1934" xq="yes">title|Headline</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="4" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="5" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="1958" xq="yes">(: Enable the date range search boxes in the advance search forms :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">variable</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="variable">$ENABLE-DATE-CRITERIA</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="type-name">xs:boolean</span>
      <span xq="yes" start="54" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="56" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="57" prev-is-closed="false" class="function">fn:false</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="66" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="67" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="2098" xq="yes">(: The default rendering mode for value facets :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">variable</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="variable">$DEFAULT-FACET-MODE</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="41" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="51" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="53" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="2200" xq="yes">add</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="3" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="2208" xq="yes">(: "mixed | one | add" :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="2237" xq="yes">(:-- Search UI Functions --:)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="2270" xq="yes">(:~&#xD;
:&#xD;
: (Public) Converts &lt;params&gt; into &lt;search:search-criteria&gt;.  &#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @return The equivalent search-criteria XML.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">params-to-query</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="35" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="42" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="45" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="54" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="60" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="61" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="62" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="63" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="64" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="66" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="75" prev-is-closed="false" class="qname">search:search-criteria</span>
      <span xq="yes" start="97" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="98" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="104" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="108" prev-is-closed="false" class="variable">$start-date</span>
      <span xq="yes" start="119" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="122" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="123" prev-is-closed="false" class="function">uit:build-date</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="138" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="145" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="146" prev-is-closed="false" class="qname">start-year</span>
      <span xq="yes" start="156" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="157" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="158" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="159" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="160" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="161" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="168" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="169" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="180" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="181" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="182" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="183" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="184" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="185" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="192" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="193" prev-is-closed="false" class="qname">start-day</span>
      <span xq="yes" start="202" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="203" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="204" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="205" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="206" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="209" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="212" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="213" prev-is-closed="false" class="variable">$end-date</span>
      <span xq="yes" start="222" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="223" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="225" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="226" prev-is-closed="false" class="function">uit:build-date</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="241" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="248" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="249" prev-is-closed="false" class="qname">end-year</span>
      <span xq="yes" start="257" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="258" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="259" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="260" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="261" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="262" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="269" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="270" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="279" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="280" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="281" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="282" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="283" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="284" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="291" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="292" prev-is-closed="false" class="qname">end-day</span>
      <span xq="yes" start="299" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="300" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="301" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="302" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="303" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="306" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="312" prev-is-closed="false" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="319" prev-is-closed="false" class="function">build-query-element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="339" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="347" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="349" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="350" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="351" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="358" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="359" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="360" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="361" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="362" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="366" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="367" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="377" prev-is-closed="false" class="function">xdmp:url-decode</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="393" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="400" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="401" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="402" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="403" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="404" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="405" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="406" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="407" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="408" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="412" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="413" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="414" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="415" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="416" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="424" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="426" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="427" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="428" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="435" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="436" prev-is-closed="false" class="qname">field</span>
      <span xq="yes" start="441" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="442" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="443" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="447" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="448" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="455" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="456" prev-is-closed="false" class="qname">field</span>
      <span xq="yes" start="461" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="462" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="463" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="464" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="465" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="469" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="470" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="471" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="472" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="473" prev-is-closed="false" class="whitespace"> &#xD;
    		</span>
      <span xq="yes" start="482" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="489" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="490" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="494" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="495" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="503" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="504" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="511" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="512" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="515" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="516" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="517" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="524" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="525" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="529" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="530" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="531" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="539" prev-is-closed="false" class="variable">$start-date</span>
      <span xq="yes" start="550" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="551" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="559" prev-is-closed="false" class="variable">$end-date</span>
      <span xq="yes" start="568" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="569" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="577" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="584" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="585" prev-is-closed="false" class="qname">dur</span>
      <span xq="yes" start="588" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="589" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="597" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="604" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="605" prev-is-closed="false" class="qname">sort</span>
      <span xq="yes" start="609" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="619" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="620" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="622" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="623" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="627" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="633" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="634" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="642" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="643" prev-is-closed="true" class="function">build-query-element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="663" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="669" prev-is-closed="false" class="variable">$text</span>
      <span xq="yes" start="674" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="675" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="677" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="678" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="687" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="688" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="689" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="695" prev-is-closed="false" class="variable">$field</span>
      <span xq="yes" start="701" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="702" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="704" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="705" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="714" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="715" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="716" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="722" prev-is-closed="false" class="variable">$collections</span>
      <span xq="yes" start="734" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="735" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="737" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="738" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="748" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="749" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="755" prev-is-closed="false" class="variable">$values</span>
      <span xq="yes" start="762" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="763" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="765" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="766" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="776" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="777" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="783" prev-is-closed="false" class="variable">$start-date</span>
      <span xq="yes" start="794" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="795" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="797" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="798" prev-is-closed="false" class="type-name">xs:date</span>
      <span xq="yes" start="805" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="806" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="807" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="813" prev-is-closed="false" class="variable">$end-date</span>
      <span xq="yes" start="822" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="823" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="825" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="826" prev-is-closed="false" class="type-name">xs:date</span>
      <span xq="yes" start="833" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="834" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="835" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="841" prev-is-closed="false" class="variable">$duration</span>
      <span xq="yes" start="850" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="851" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="853" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="854" prev-is-closed="false" class="type-name">xs:duration</span>
      <span xq="yes" start="865" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="866" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="867" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="873" prev-is-closed="false" class="variable">$sort</span>
      <span xq="yes" start="878" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="879" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="881" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="882" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="891" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="892" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="898" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="899" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="900" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="902" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="903" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="911" prev-is-closed="false" class="qname">search:search-criteria</span>
      <span xq="yes" start="933" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="934" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="936" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="937" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="3391" class="es">&lt;</span>
      <span name="xml-open-tag" pos="3392" class="en">search-criteria</span>
      <span name="xml-name-end" pos="3407" class="atn"> fast-pagination</span>
      <span name="x-equals" pos="3423" class="atneq">=</span>
      <span name="xml-att-quote" pos="3424" class="z">"</span>
      <span name="xml-literal-start" pos="3425" class="av">true</span>
      <span name="xml-att-quote" pos="3429" class="z">"</span>
      <span name="xml-literal-end" pos="3430" class="atn"> xmlns</span>
      <span name="x-equals" pos="3436" class="atneq">=</span>
      <span name="xml-att-quote" pos="3437" class="z">"</span>
      <span name="xml-literal-start" pos="3438" class="av">http://www.marklogic.com/ps/lib/lib-search</span>
      <span name="xml-att-quote" pos="3480" class="z">"</span>
      <span name="x-tag-end" pos="3481" class="z">&gt;</span>
      <span pos="3482" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="3492" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$text</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span pos="3528" class="es">&lt;</span>
      <span name="xml-open-tag" pos="3529" class="en">term</span>
      <span name="x-tag-end" pos="3533" class="z">&gt;</span>
      <span pos="3534" class="txt">&#xD;
            </span>
      <span pos="3548" class="es">&lt;</span>
      <span name="xml-open-tag" pos="3549" class="en">text</span>
      <span name="x-tag-end" pos="3553" class="z">&gt;</span>
      <span name="nested-query" pos="3554" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$text</span>
      <span name="unnested-xquery" pos="3560" class="op">}</span>
      <span pos="3561" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="3563" class="cl">text</span>
      <span name="x-tag-end" pos="3567" class="z">&gt;</span>
      <span pos="3568" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="3582" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$field</span>
      <span xq="yes" start="25" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span pos="3631" class="es">&lt;</span>
      <span name="xml-open-tag" pos="3632" class="en">scope-id</span>
      <span name="x-tag-end" pos="3640" class="z">&gt;</span>
      <span name="nested-query" pos="3641" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$field</span>
      <span name="unnested-xquery" pos="3648" class="op">}</span>
      <span pos="3649" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="3651" class="cl">scope-id</span>
      <span name="x-tag-end" pos="3659" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="3695" class="op">}</span>
      <span name="resume-x-literal-txt" pos="3696" class="txt">&#xD;
        </span>
      <span pos="3706" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="3708" class="cl">term</span>
      <span name="x-tag-end" pos="3712" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span name="unnested-xquery" pos="3740" class="op">}</span>
      <span name="resume-x-literal-txt" pos="3741" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="3751" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">construct-collection-criteria</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="31" prev-is-closed="false" class="variable">$collections</span>
      <span xq="yes" start="43" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="3795" class="op">}</span>
      <span name="resume-x-literal-txt" pos="3796" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="3806" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">construct-value-criteria</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$values</span>
      <span xq="yes" start="33" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="3840" class="op">}</span>
      <span name="resume-x-literal-txt" pos="3841" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="3851" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$start-date</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$end-date</span>
      <span xq="yes" start="39" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="45" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="3910" class="es">&lt;</span>
      <span name="xml-open-tag" pos="3911" class="en">date-range</span>
      <span name="x-tag-end" pos="3921" class="z">&gt;</span>
      <span pos="3922" class="txt">&#xD;
                </span>
      <span name="nested-query" pos="3940" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$start-date</span>
      <span xq="yes" start="16" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span pos="3963" class="es">&lt;</span>
      <span name="xml-open-tag" pos="3964" class="en">from</span>
      <span name="x-tag-end" pos="3968" class="z">&gt;</span>
      <span name="nested-query" pos="3969" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$start-date</span>
      <span name="unnested-xquery" pos="3981" class="op">}</span>
      <span pos="3982" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="3984" class="cl">from</span>
      <span name="x-tag-end" pos="3988" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="3997" class="op">}</span>
      <span name="resume-x-literal-txt" pos="3998" class="txt">&#xD;
                </span>
      <span name="nested-query" pos="4016" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$end-date</span>
      <span xq="yes" start="14" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="15" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span pos="4037" class="es">&lt;</span>
      <span name="xml-open-tag" pos="4038" class="en">to</span>
      <span name="x-tag-end" pos="4040" class="z">&gt;</span>
      <span name="nested-query" pos="4041" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$end-date</span>
      <span name="unnested-xquery" pos="4051" class="op">}</span>
      <span pos="4052" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4054" class="cl">to</span>
      <span name="x-tag-end" pos="4056" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="4065" class="op">}</span>
      <span name="resume-x-literal-txt" pos="4066" class="txt">&#xD;
            </span>
      <span pos="4080" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4082" class="cl">date-range</span>
      <span name="x-tag-end" pos="4092" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$duration</span>
      <span xq="yes" start="29" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="35" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="4141" class="es">&lt;</span>
      <span name="xml-open-tag" pos="4142" class="en">date-range</span>
      <span name="x-tag-end" pos="4152" class="z">&gt;</span>
      <span pos="4153" class="txt">&#xD;
                </span>
      <span pos="4171" class="es">&lt;</span>
      <span name="xml-open-tag" pos="4172" class="en">trailing-duration</span>
      <span name="x-tag-end" pos="4189" class="z">&gt;</span>
      <span name="nested-query" pos="4190" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$duration</span>
      <span name="unnested-xquery" pos="4200" class="op">}</span>
      <span pos="4201" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4203" class="cl">trailing-duration</span>
      <span name="x-tag-end" pos="4220" class="z">&gt;</span>
      <span pos="4221" class="txt">&#xD;
            </span>
      <span pos="4235" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4237" class="cl">date-range</span>
      <span name="x-tag-end" pos="4247" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="29" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="30" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span name="unnested-xquery" pos="4288" class="op">}</span>
      <span name="resume-x-literal-txt" pos="4289" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="4299" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$text</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="40" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="variable">$sort</span>
      <span xq="yes" start="49" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="50" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="4351" xq="yes">rel</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="25" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="45" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="48" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="50" prev-is-closed="false" class="variable">$sort</span>
      <span xq="yes" start="55" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="56" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="57" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="61" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span pos="4434" class="es">&lt;</span>
      <span name="xml-open-tag" pos="4435" class="en">sort</span>
      <span name="x-tag-end" pos="4439" class="z">&gt;</span>
      <span pos="4440" class="es">&lt;</span>
      <span name="xml-open-tag" pos="4441" class="en">sort-field-id</span>
      <span name="x-tag-end" pos="4454" class="z">&gt;</span>
      <span name="nested-query" pos="4455" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$sort</span>
      <span name="unnested-xquery" pos="4461" class="op">}</span>
      <span pos="4462" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4464" class="cl">sort-field-id</span>
      <span name="x-tag-end" pos="4477" class="z">&gt;</span>
      <span pos="4478" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4480" class="cl">sort</span>
      <span name="x-tag-end" pos="4484" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="37" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="38" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="39" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="49" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="53" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="4551" class="es">&lt;</span>
      <span name="xml-open-tag" pos="4552" class="en">sort</span>
      <span name="x-tag-end" pos="4556" class="z">&gt;</span>
      <span pos="4557" class="es">&lt;</span>
      <span name="xml-open-tag" pos="4558" class="en">sort-field-id</span>
      <span name="x-tag-end" pos="4571" class="z">&gt;</span>
      <span pos="4572" class="txt">date</span>
      <span pos="4576" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4578" class="cl">sort-field-id</span>
      <span name="x-tag-end" pos="4591" class="z">&gt;</span>
      <span pos="4592" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4594" class="cl">sort</span>
      <span name="x-tag-end" pos="4598" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span name="unnested-xquery" pos="4605" class="op">}</span>
      <span name="resume-x-literal-txt" pos="4606" class="txt">&#xD;
    </span>
      <span pos="4612" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="4614" class="cl">search-criteria</span>
      <span name="x-tag-end" pos="4629" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">construct-collection-criteria</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="54" prev-is-closed="false" class="variable">$collections</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="69" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="80" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="81" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="82" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="84" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="85" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="93" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="94" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="95" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="97" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="98" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="104" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="108" prev-is-closed="false" class="variable">$set-ids</span>
      <span xq="yes" start="116" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="129" prev-is-closed="false" class="function">fn:distinct-values</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="148" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="162" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="165" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="166" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="171" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="172" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="174" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="175" prev-is-closed="false" class="variable">$collections</span>
      <span xq="yes" start="187" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="201" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="204" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="205" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="212" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="213" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="215" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="216" prev-is-closed="false" class="function">split-search-item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="234" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="239" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="240" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="254" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="259" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="260" prev-is-closed="false" class="function">fn:count</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="269" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="276" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="277" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="278" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="279" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="280" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="281" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="295" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="301" prev-is-closed="false" class="whitespace">&#xD;
               </span>
      <span xq="yes" start="318" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="325" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="326" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="327" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="328" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="338" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="339" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="345" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="348" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="349" prev-is-closed="false" class="variable">$criteria</span>
      <span xq="yes" start="358" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="359" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="361" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="371" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="374" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="375" prev-is-closed="false" class="variable">$set-id</span>
      <span xq="yes" start="382" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="383" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="385" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="386" prev-is-closed="false" class="variable">$set-ids</span>
      <span xq="yes" start="394" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="404" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="407" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="408" prev-is-closed="false" class="variable">$names</span>
      <span xq="yes" start="414" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="415" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="417" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="431" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="434" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="435" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="440" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="441" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="443" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="444" prev-is-closed="false" class="variable">$collections</span>
      <span xq="yes" start="456" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="470" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="473" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="474" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="481" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="482" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="484" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="485" prev-is-closed="false" class="function">split-search-item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="503" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="508" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="509" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="523" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="528" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="529" prev-is-closed="false" class="function">fn:count</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="538" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="545" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="546" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="547" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="548" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="549" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="550" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="551" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="554" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="555" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="562" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="563" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="564" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="565" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="566" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="567" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="568" prev-is-closed="false" class="variable">$set-id</span>
      <span xq="yes" start="575" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="589" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="595" prev-is-closed="false" class="whitespace"> </span>
      <span pos="5225" class="es">&lt;</span>
      <span name="xml-open-tag" pos="5226" class="en">search:value</span>
      <span name="x-tag-end" pos="5238" class="z">&gt;</span>
      <span name="nested-query" pos="5239" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$tokens</span>
      <span xq="yes" start="8" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="10" prev-is-closed="true" class="filter">]</span>
      <span name="unnested-xquery" pos="5250" class="op">}</span>
      <span pos="5251" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="5253" class="cl">search:value</span>
      <span name="x-tag-end" pos="5265" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$names</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="32" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="5298" xq="yes">all</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> &#xD;
        </span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="5335" class="es">&lt;</span>
      <span name="xml-open-tag" pos="5336" class="en">collections</span>
      <span name="xml-name-end" pos="5347" class="atn"> xmlns</span>
      <span name="x-equals" pos="5353" class="atneq">=</span>
      <span name="xml-att-quote" pos="5354" class="z">"</span>
      <span name="xml-literal-start" pos="5355" class="av">http://www.marklogic.com/ps/lib/lib-search</span>
      <span name="xml-att-quote" pos="5397" class="z">"</span>
      <span name="x-tag-end" pos="5398" class="z">&gt;</span>
      <span pos="5399" class="txt">&#xD;
                </span>
      <span pos="5417" class="es">&lt;</span>
      <span name="xml-open-tag" pos="5418" class="en">set-id</span>
      <span name="x-tag-end" pos="5424" class="z">&gt;</span>
      <span name="nested-query" pos="5425" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$set-id</span>
      <span name="unnested-xquery" pos="5433" class="op">}</span>
      <span pos="5434" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="5436" class="cl">set-id</span>
      <span name="x-tag-end" pos="5442" class="z">&gt;</span>
      <span pos="5443" class="txt">&#xD;
                </span>
      <span name="nested-query" pos="5461" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$names</span>
      <span name="unnested-xquery" pos="5468" class="op">}</span>
      <span name="resume-x-literal-txt" pos="5469" class="txt">&#xD;
            </span>
      <span pos="5483" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="5485" class="cl">collections</span>
      <span name="x-tag-end" pos="5496" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$criteria</span>
      <span xq="yes" start="32" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="39" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="54" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="true" class="function">construct-value-criteria</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="80" prev-is-closed="false" class="variable">$search-values</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="108" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="109" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="110" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="112" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="113" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="121" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="122" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="123" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="125" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="126" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="132" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="135" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="136" prev-is-closed="false" class="variable">$scope-ids</span>
      <span xq="yes" start="146" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="147" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="149" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="159" prev-is-closed="false" class="function">fn:distinct-values</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="178" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="192" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="195" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="196" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="200" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="201" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="203" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="204" prev-is-closed="false" class="variable">$search-values</span>
      <span xq="yes" start="218" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="232" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="235" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="236" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="243" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="244" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="246" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="247" prev-is-closed="false" class="function">split-search-item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="265" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="269" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="270" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="284" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="289" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="290" prev-is-closed="false" class="function">fn:count</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="299" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="306" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="307" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="308" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="309" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="310" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="311" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="325" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="331" prev-is-closed="false" class="whitespace">&#xD;
               </span>
      <span xq="yes" start="348" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="355" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="356" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="357" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="358" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="368" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="369" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="375" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="378" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="379" prev-is-closed="false" class="variable">$criteria</span>
      <span xq="yes" start="388" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="389" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="391" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="401" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="404" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="405" prev-is-closed="false" class="variable">$set-id</span>
      <span xq="yes" start="412" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="413" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="415" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="416" prev-is-closed="false" class="variable">$scope-ids</span>
      <span xq="yes" start="426" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="436" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="439" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="440" prev-is-closed="false" class="variable">$values</span>
      <span xq="yes" start="447" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="448" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="450" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="464" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="467" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="468" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="472" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="473" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="475" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="476" prev-is-closed="false" class="variable">$search-values</span>
      <span xq="yes" start="490" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="504" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="507" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="508" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="515" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="516" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="518" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="519" prev-is-closed="false" class="function">split-search-item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="537" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="541" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="542" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="556" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="561" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="562" prev-is-closed="false" class="function">fn:count</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="571" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="578" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="579" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="580" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="581" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="582" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="583" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="584" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="587" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="588" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="595" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="596" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="597" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="598" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="599" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="600" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="601" prev-is-closed="false" class="variable">$set-id</span>
      <span xq="yes" start="608" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="622" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="628" prev-is-closed="false" class="whitespace"> </span>
      <span pos="6125" class="es">&lt;</span>
      <span name="xml-open-tag" pos="6126" class="en">search:value</span>
      <span name="x-tag-end" pos="6138" class="z">&gt;</span>
      <span name="nested-query" pos="6139" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$tokens</span>
      <span xq="yes" start="8" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="10" prev-is-closed="true" class="filter">]</span>
      <span name="unnested-xquery" pos="6150" class="op">}</span>
      <span pos="6151" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="6153" class="cl">search:value</span>
      <span name="x-tag-end" pos="6165" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$values</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="6199" xq="yes">all</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> &#xD;
        </span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="6236" class="es">&lt;</span>
      <span name="xml-open-tag" pos="6237" class="en">values</span>
      <span name="xml-name-end" pos="6243" class="atn"> xmlns</span>
      <span name="x-equals" pos="6249" class="atneq">=</span>
      <span name="xml-att-quote" pos="6250" class="z">"</span>
      <span name="xml-literal-start" pos="6251" class="av">http://www.marklogic.com/ps/lib/lib-search</span>
      <span name="xml-att-quote" pos="6293" class="z">"</span>
      <span name="x-tag-end" pos="6294" class="z">&gt;</span>
      <span pos="6295" class="txt">&#xD;
                </span>
      <span pos="6313" class="es">&lt;</span>
      <span name="xml-open-tag" pos="6314" class="en">scope-id</span>
      <span name="x-tag-end" pos="6322" class="z">&gt;</span>
      <span name="nested-query" pos="6323" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$set-id</span>
      <span name="unnested-xquery" pos="6331" class="op">}</span>
      <span pos="6332" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="6334" class="cl">scope-id</span>
      <span name="x-tag-end" pos="6342" class="z">&gt;</span>
      <span pos="6343" class="txt">&#xD;
                </span>
      <span name="nested-query" pos="6361" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$values</span>
      <span name="unnested-xquery" pos="6369" class="op">}</span>
      <span name="resume-x-literal-txt" pos="6370" class="txt">&#xD;
            </span>
      <span pos="6384" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="6386" class="cl">values</span>
      <span name="x-tag-end" pos="6392" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$criteria</span>
      <span xq="yes" start="32" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="39" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="54" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="true" class="function">split-search-item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="73" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="77" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="78" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="80" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="81" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="87" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="90" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="91" prev-is-closed="false" class="variable">$raw</span>
      <span xq="yes" start="95" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="96" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="98" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="99" prev-is-closed="false" class="function">fn:tokenize</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="111" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="115" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="116" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">'</span>
      <span class="literal" pos="6509" xq="yes">:</span>
      <span class="op">'</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="24" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="28" prev-is-closed="false" class="function">fn:count</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="37" prev-is-closed="false" class="variable">$raw</span>
      <span xq="yes" start="41" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="42" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="46" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="47" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="52" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="62" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="63" prev-is-closed="false" class="variable">$raw</span>
      <span xq="yes" start="67" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="68" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="69" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="70" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="71" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="72" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="87" prev-is-closed="false" class="variable">$raw</span>
      <span xq="yes" start="91" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="92" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="93" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">to</span>
      <span xq="yes" start="96" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="97" prev-is-closed="false" class="function">fn:last</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="105" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="106" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="107" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="108" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="6620" xq="yes">:</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$raw</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="6651" xq="yes">(:-- Search Form Controls --:)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="6685" xq="yes">(:~&#xD;
:&#xD;
: (Public) Renders an advanced search form, including building&#xD;
: parametric select boxes based on facet information. &#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @param $facet-defs The facets to use to build the advanced search form.&#xD;
: @return A &lt;form&gt; containing the rendered search form.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">search-form</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="34" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="53" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="59" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="60" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="61" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="62" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="65" prev-is-closed="false" class="variable">$facet-defs</span>
      <span xq="yes" start="76" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="79" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="80" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="88" prev-is-closed="false" class="qname">search:facet-defs</span>
      <span xq="yes" start="105" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="106" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="109" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="110" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="111" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="113" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="114" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="122" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="123" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="125" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="126" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="7137" class="es">&lt;</span>
      <span name="xml-open-tag" pos="7138" class="en">form</span>
      <span name="xml-name-end" pos="7142" class="atn"> action</span>
      <span name="x-equals" pos="7149" class="atneq">=</span>
      <span name="xml-att-quote" pos="7150" class="z">"</span>
      <span name="xml-literal-start" pos="7151" class="av">search.xqy</span>
      <span name="xml-att-quote" pos="7161" class="z">"</span>
      <span name="xml-literal-end" pos="7162" class="atn"> method</span>
      <span name="x-equals" pos="7169" class="atneq">=</span>
      <span name="xml-att-quote" pos="7170" class="z">"</span>
      <span name="xml-literal-start" pos="7171" class="av">get</span>
      <span name="xml-att-quote" pos="7174" class="z">"</span>
      <span name="x-tag-end" pos="7175" class="z">&gt;</span>
      <span pos="7176" class="txt">	    &#xD;
        </span>
      <span pos="7191" class="es">&lt;</span>
      <span name="xml-open-tag" pos="7192" class="en">div</span>
      <span name="xml-name-end" pos="7195" class="atn"> style</span>
      <span name="x-equals" pos="7201" class="atneq">=</span>
      <span name="xml-att-quote" pos="7202" class="z">"</span>
      <span name="xml-literal-start" pos="7203" class="av">background:#F8F8F8;border:1px solid #D0D0D0;width:38em;padding:.6em .7em;</span>
      <span name="xml-att-quote" pos="7276" class="z">"</span>
      <span name="x-tag-end" pos="7277" class="z">&gt;</span>
      <span pos="7278" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="7292" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">element</span>
      <span xq="yes" start="8" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="true" class="qname">input</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace">&#xD;
                    </span>
      <span xq="yes" start="38" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="47" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="true" class="qname">id</span>
      <span xq="yes" start="50" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="7344" xq="yes">adv-search-terms</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                    </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="25" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="qname">name</span>
      <span xq="yes" start="39" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="7402" xq="yes">q</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                    </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="25" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="qname">type</span>
      <span xq="yes" start="39" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="7445" xq="yes">text</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                    </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="25" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="qname">style</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="7492" xq="yes">display:inline;width:250px;padding:.2em .3em;</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                    </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="25" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="29" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="39" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="46" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="47" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="48" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="49" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="50" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="57" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="true" class="qname">value</span>
      <span xq="yes" start="72" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="73" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="74" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="84" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="91" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="92" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="93" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="95" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="96" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="97" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="102" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="103" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="104" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="118" prev-is-closed="true" class="op">}</span>
      <span name="unnested-xquery" pos="7657" class="op">}</span>
      <span name="resume-x-literal-txt" pos="7658" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="7672" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="4" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$SEARCH-FIELDS</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="7712" class="es">&lt;</span>
      <span name="xml-open-tag" pos="7713" class="en">select</span>
      <span name="xml-name-end" pos="7719" class="atn"> name</span>
      <span name="x-equals" pos="7724" class="atneq">=</span>
      <span name="xml-att-quote" pos="7725" class="z">"</span>
      <span name="xml-literal-start" pos="7726" class="av">field</span>
      <span name="xml-att-quote" pos="7731" class="z">"</span>
      <span name="xml-literal-end" pos="7732" class="atn"> style</span>
      <span name="x-equals" pos="7738" class="atneq">=</span>
      <span name="xml-att-quote" pos="7739" class="z">"</span>
      <span name="xml-literal-start" pos="7740" class="av">display:inline;margin-left:.3em;</span>
      <span name="xml-att-quote" pos="7772" class="z">"</span>
      <span name="x-tag-end" pos="7773" class="z">&gt;</span>
      <span pos="7774" class="txt">&#xD;
            	</span>
      <span name="nested-query" pos="7789" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">     &#xD;
    			</span>
      <span xq="yes" start="15" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$option</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$SEARCH-FIELDS</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="59" prev-is-closed="false" class="whitespace">&#xD;
					</span>
      <span xq="yes" start="66" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="69" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="76" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="79" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="80" prev-is-closed="false" class="function">fn:tokenize</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="92" prev-is-closed="false" class="variable">$option</span>
      <span xq="yes" start="99" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="100" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="7890" xq="yes">\|</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
					</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> &#xD;
						</span>
      <span xq="yes" start="24" prev-is-closed="false" class="op">element</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="true" class="qname">option</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="40" prev-is-closed="false" class="whitespace">&#xD;
							</span>
      <span xq="yes" start="49" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="true" class="qname">value</span>
      <span xq="yes" start="64" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="65" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="66" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="72" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="73" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="74" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="75" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="76" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="77" prev-is-closed="false" class="whitespace">&#xD;
							</span>
      <span xq="yes" start="86" prev-is-closed="false" class="if">if(</span>
      <span xq="yes" start="89" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="90" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="97" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="104" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="105" prev-is-closed="false" class="qname">field</span>
      <span xq="yes" start="110" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="111" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="115" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="116" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="122" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="123" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="124" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="125" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="126" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="8021" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="5" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="13" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="14" prev-is-closed="false" class="qname">field</span>
      <span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">eq</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="29" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="30" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="31" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="32" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> &#xD;
								</span>
      <span xq="yes" start="49" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="true" class="qname">selected</span>
      <span xq="yes" start="67" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="8091" xq="yes">selected</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
							</span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="18" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace">&#xD;
							</span>
      <span xq="yes" start="28" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="34" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="35" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="36" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="37" prev-is-closed="true" class="whitespace">&#xD;
						</span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="46" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span name="unnested-xquery" pos="8155" class="op">}</span>
      <span name="resume-x-literal-txt" pos="8156" class="txt">&#xD;
		    </span>
      <span pos="8164" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="8166" class="cl">select</span>
      <span name="x-tag-end" pos="8172" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
		    </span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span name="unnested-xquery" pos="8189" class="op">}</span>
      <span name="resume-x-literal-txt" pos="8190" class="txt">&#xD;
        </span>
      <span pos="8200" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="8202" class="cl">div</span>
      <span name="x-tag-end" pos="8205" class="z">&gt;</span>
      <span pos="8206" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="8216" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="24" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="true" class="variable">$pos</span>
      <span xq="yes" start="29" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="32" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="33" prev-is-closed="false" class="variable">$facet-defs</span>
      <span xq="yes" start="44" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="45" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="61" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="62" prev-is-closed="false" class="qname">search:collection-set-facet</span>
      <span xq="yes" start="89" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="106" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="120" prev-is-closed="false" class="function">search-form-control-collection-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="155" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="173" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="180" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="181" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="199" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="205" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="206" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="224" prev-is-closed="false" class="variable">$pos</span>
      <span xq="yes" start="228" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="246" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="8463" class="op">}</span>
      <span name="resume-x-literal-txt" pos="8464" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="8474" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$ENABLE-DATE-CRITERIA</span>
      <span xq="yes" start="26" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="32" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="33" prev-is-closed="false" class="function">search-form-control-discrete-date</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="67" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="74" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="75" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="80" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="81" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="82" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="8557" class="op">}</span>
      <span name="resume-x-literal-txt" pos="8558" class="txt">&#xD;
		</span>
      <span pos="8562" class="es">&lt;</span>
      <span name="xml-open-tag" pos="8563" class="en">input</span>
      <span name="xml-name-end" pos="8568" class="atn"> value</span>
      <span name="x-equals" pos="8574" class="atneq">=</span>
      <span name="xml-att-quote" pos="8575" class="z">"</span>
      <span name="xml-literal-start" pos="8576" class="av">Search</span>
      <span name="xml-att-quote" pos="8582" class="z">"</span>
      <span name="xml-literal-end" pos="8583" class="atn"> type</span>
      <span name="x-equals" pos="8588" class="atneq">=</span>
      <span name="xml-att-quote" pos="8589" class="z">"</span>
      <span name="xml-literal-start" pos="8590" class="av">submit</span>
      <span name="xml-att-quote" pos="8596" class="z">"</span>
      <span name="xml-literal-end" pos="8597" class="atn"> class</span>
      <span name="x-equals" pos="8603" class="atneq">=</span>
      <span name="xml-att-quote" pos="8604" class="z">"</span>
      <span name="xml-literal-start" pos="8605" class="av">button</span>
      <span name="xml-att-quote" pos="8611" class="z">"</span>
      <span name="xml-literal-end" pos="8612" class="atn"> style</span>
      <span name="x-equals" pos="8618" class="atneq">=</span>
      <span name="xml-att-quote" pos="8619" class="z">"</span>
      <span name="xml-literal-start" pos="8620" class="av">display:block;margin:.5em .5em;</span>
      <span name="xml-att-quote" pos="8651" class="z">"</span>
      <span name="xml-literal-end" pos="8652" class="atn"> </span>
      <span name="x-tag-end" pos="8653" class="z">/&gt;</span>
      <span pos="8655" class="txt">&#xD;
	</span>
      <span pos="8658" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="8660" class="cl">form</span>
      <span name="x-tag-end" pos="8664" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">search-form-control-collection-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="59" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="65" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="72" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="73" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="75" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="84" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="90" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="91" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="92" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="98" prev-is-closed="false" class="variable">$facet-def</span>
      <span xq="yes" start="108" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="109" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="111" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="120" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="136" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="137" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="138" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="144" prev-is-closed="false" class="variable">$position</span>
      <span xq="yes" start="153" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="154" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="156" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="157" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="167" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="173" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="174" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="175" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="178" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="186" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="187" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="188" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="190" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="191" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="197" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="200" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="201" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="219" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="220" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="222" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="223" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="233" prev-is-closed="false" class="variable">$facet-def</span>
      <span xq="yes" start="243" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="244" prev-is-closed="false" class="qname">search:collection-set-facet</span>
      <span xq="yes" start="271" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="272" prev-is-closed="false" class="qname">search:set-id</span>
      <span xq="yes" start="285" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="286" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="292" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="295" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="296" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="302" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="303" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="305" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="306" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="316" prev-is-closed="false" class="variable">$facet-def</span>
      <span xq="yes" start="326" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="327" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="340" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="341" prev-is-closed="false" class="qname">search:title</span>
      <span xq="yes" start="353" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="354" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="360" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="363" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="364" prev-is-closed="false" class="variable">$resolved-facet</span>
      <span xq="yes" start="379" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="380" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="382" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="392" prev-is-closed="false" class="function">search:resolve-facet</span>
      <span class="parenthesis">(</span>
      <span pos="9077" class="es">&lt;</span>
      <span name="xml-open-tag" pos="9078" class="en">search:search-criteria</span>
      <span name="xml-name-end" pos="9100" class="atn"> </span>
      <span name="x-tag-end" pos="9101" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$facet-def</span>
      <span xq="yes" start="13" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="9134" class="es">&lt;</span>
      <span name="xml-open-tag" pos="9135" class="en">div</span>
      <span name="xml-name-end" pos="9138" class="atn"> style</span>
      <span name="x-equals" pos="9144" class="atneq">=</span>
      <span name="xml-att-quote" pos="9145" class="z">"</span>
      <span name="xml-literal-start" pos="9146" class="av">margin: .7em .7em;</span>
      <span name="xml-att-quote" pos="9164" class="z">"</span>
      <span name="x-tag-end" pos="9165" class="z">&gt;</span>
      <span pos="9166" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="9176" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$title</span>
      <span name="unnested-xquery" pos="9183" class="op">}</span>
      <span name="resume-x-literal-txt" pos="9184" class="txt"> [Article Count]:</span>
      <span pos="9201" class="es">&lt;</span>
      <span name="xml-open-tag" pos="9202" class="en">br</span>
      <span name="x-tag-end" pos="9204" class="z">/&gt;</span>
      <span pos="9206" class="txt">&#xD;
        </span>
      <span pos="9216" class="es">&lt;</span>
      <span name="xml-open-tag" pos="9217" class="en">select</span>
      <span name="xml-name-end" pos="9223" class="atn"> id</span>
      <span name="x-equals" pos="9226" class="atneq">=</span>
      <span name="xml-att-quote" pos="9227" class="z">"</span>
      <span name="xml-literal-start" pos="9228" class="av">select-</span>
      <span name="nested-query" pos="9235" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$position</span>
      <span name="unnested-xquery" pos="9245" class="op">}</span>
      <span name="xml-att-quote" pos="9246" class="z">"</span>
      <span name="xml-literal-end" pos="9247" class="atn"> multiple</span>
      <span name="x-equals" pos="9256" class="atneq">=</span>
      <span name="xml-att-quote" pos="9257" class="z">"</span>
      <span name="xml-literal-start" pos="9258" class="av">multiple</span>
      <span name="xml-att-quote" pos="9266" class="z">"</span>
      <span name="xml-literal-end" pos="9267" class="atn"> name</span>
      <span name="x-equals" pos="9272" class="atneq">=</span>
      <span name="xml-att-quote" pos="9273" class="z">"</span>
      <span name="xml-literal-start" pos="9274" class="av">coll</span>
      <span name="xml-att-quote" pos="9278" class="z">"</span>
      <span name="xml-literal-end" pos="9279" class="atn"> size</span>
      <span name="x-equals" pos="9284" class="atneq">=</span>
      <span name="xml-att-quote" pos="9285" class="z">"</span>
      <span name="xml-literal-start" pos="9286" class="av">4</span>
      <span name="xml-att-quote" pos="9287" class="z">"</span>
      <span name="xml-literal-end" pos="9288" class="atn"> style</span>
      <span name="x-equals" pos="9294" class="atneq">=</span>
      <span name="xml-att-quote" pos="9295" class="z">"</span>
      <span name="xml-literal-start" pos="9296" class="av">width:300px;</span>
      <span name="xml-att-quote" pos="9308" class="z">"</span>
      <span name="xml-literal-end" pos="9309" class="atn"> </span>
      <span name="x-tag-end" pos="9310" class="z">&gt;</span>
      <span pos="9311" class="txt">&#xD;
            </span>
      <span pos="9325" class="es">&lt;</span>
      <span name="xml-open-tag" pos="9326" class="en">option</span>
      <span name="xml-name-end" pos="9332" class="atn"> value</span>
      <span name="x-equals" pos="9338" class="atneq">=</span>
      <span name="xml-att-quote" pos="9339" class="z">"</span>
      <span name="nested-query" pos="9340" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="29" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="9371" xq="yes">:all</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="9378" class="op">}</span>
      <span name="xml-att-quote" pos="9379" class="z">"</span>
      <span name="x-tag-end" pos="9380" class="z">&gt;</span>
      <span pos="9381" class="txt">&#xD;
                </span>
      <span name="nested-query" pos="9399" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="12" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="19" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="20" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="28" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="29" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="36" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="37" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="41" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="42" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="47" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="48" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="50" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="61" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="79" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="80" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="9480" xq="yes">:all</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="26" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="true" class="qname">selected</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="9531" xq="yes">selected</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="24" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="9567" class="op">}</span>
      <span name="resume-x-literal-txt" pos="9568" class="txt">&#xD;
                All </span>
      <span name="nested-query" pos="9590" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$title</span>
      <span name="unnested-xquery" pos="9597" class="op">}</span>
      <span name="resume-x-literal-txt" pos="9598" class="txt">&#xD;
            </span>
      <span pos="9612" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="9614" class="cl">option</span>
      <span name="x-tag-end" pos="9620" class="z">&gt;</span>
      <span pos="9621" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="9635" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="4" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="function">facet-item-sort</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$resolved-facet</span>
      <span xq="yes" start="45" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="46" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="57" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="58" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="false" class="variable">$facet-def</span>
      <span xq="yes" start="69" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="70" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="83" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="84" prev-is-closed="false" class="qname">search:sort</span>
      <span xq="yes" start="95" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="96" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="110" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="113" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="114" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="120" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="121" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="123" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="124" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="134" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="152" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="153" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="9789" xq="yes">:</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="12" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="17" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="18" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="19" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="40" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> &#xD;
                </span>
      <span pos="9856" class="es">&lt;</span>
      <span name="xml-open-tag" pos="9857" class="en">option</span>
      <span name="xml-name-end" pos="9863" class="atn"> value</span>
      <span name="x-equals" pos="9869" class="atneq">=</span>
      <span name="xml-att-quote" pos="9870" class="z">"</span>
      <span name="nested-query" pos="9871" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$value</span>
      <span name="unnested-xquery" pos="9878" class="op">}</span>
      <span name="xml-att-quote" pos="9879" class="z">"</span>
      <span name="x-tag-end" pos="9880" class="z">&gt;</span>
      <span pos="9881" class="txt">&#xD;
                	</span>
      <span name="nested-query" pos="9900" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="12" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="13" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="17" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="18" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="24" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="33" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace">&#xD;
                	</span>
      <span xq="yes" start="58" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="67" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="true" class="qname">selected</span>
      <span xq="yes" start="76" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="9978" xq="yes">selected</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                	</span>
      <span xq="yes" start="21" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="27" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="10015" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10016" class="txt">&#xD;
                	</span>
      <span name="nested-query" pos="10035" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="16" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="17" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="22" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="23" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="10059" xq="yes"> [</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="12" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="17" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="18" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="19" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="10088" xq="yes">]</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="10092" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10093" class="txt">&#xD;
                </span>
      <span pos="10111" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10113" class="cl">option</span>
      <span name="x-tag-end" pos="10119" class="z">&gt;</span>
      <span name="unnested-xquery" pos="10120" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10121" class="txt">&#xD;
     	</span>
      <span pos="10129" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10131" class="cl">select</span>
      <span name="x-tag-end" pos="10137" class="z">&gt;</span>
      <span pos="10138" class="txt">&#xD;
     </span>
      <span pos="10145" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10147" class="cl">div</span>
      <span name="x-tag-end" pos="10150" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">search-form-control-discrete-date</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="58" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="65" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="68" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="69" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="77" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="83" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="84" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="85" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="86" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="88" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="97" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="98" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="99" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="101" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="102" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="10258" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10259" class="en">div</span>
      <span name="xml-name-end" pos="10262" class="atn"> style</span>
      <span name="x-equals" pos="10268" class="atneq">=</span>
      <span name="xml-att-quote" pos="10269" class="z">"</span>
      <span name="xml-literal-start" pos="10270" class="av">margin: .7em .7em;</span>
      <span name="xml-att-quote" pos="10288" class="z">"</span>
      <span name="x-tag-end" pos="10289" class="z">&gt;</span>
      <span pos="10290" class="txt">&#xD;
        Date:</span>
      <span pos="10305" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10306" class="en">br</span>
      <span name="x-tag-end" pos="10308" class="z">/&gt;</span>
      <span pos="10310" class="txt">&#xD;
        </span>
      <span pos="10320" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10321" class="en">div</span>
      <span name="xml-name-end" pos="10324" class="atn"> style</span>
      <span name="x-equals" pos="10330" class="atneq">=</span>
      <span name="xml-att-quote" pos="10331" class="z">"</span>
      <span name="xml-literal-start" pos="10332" class="av">margin-top:.3em</span>
      <span name="xml-att-quote" pos="10347" class="z">"</span>
      <span name="x-tag-end" pos="10348" class="z">&gt;</span>
      <span pos="10349" class="txt">&#xD;
            </span>
      <span pos="10363" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10364" class="en">label</span>
      <span name="xml-name-end" pos="10369" class="atn"> style</span>
      <span name="x-equals" pos="10375" class="atneq">=</span>
      <span name="xml-att-quote" pos="10376" class="z">"</span>
      <span name="xml-literal-start" pos="10377" class="av">font-weight:bold;float:left;margin-top:.4em;width:4em;</span>
      <span name="xml-att-quote" pos="10431" class="z">"</span>
      <span name="x-tag-end" pos="10432" class="z">&gt;</span>
      <span pos="10433" class="txt">Start: </span>
      <span pos="10440" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10442" class="cl">label</span>
      <span name="x-tag-end" pos="10447" class="z">&gt;</span>
      <span pos="10448" class="txt">&#xD;
            </span>
      <span pos="10462" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10463" class="en">select</span>
      <span name="xml-name-end" pos="10469" class="atn"> name</span>
      <span name="x-equals" pos="10474" class="atneq">=</span>
      <span name="xml-att-quote" pos="10475" class="z">"</span>
      <span name="xml-literal-start" pos="10476" class="av">start-month</span>
      <span name="xml-att-quote" pos="10487" class="z">"</span>
      <span name="x-tag-end" pos="10488" class="z">&gt;</span>
      <span pos="10489" class="txt">&#xD;
            	</span>
      <span pos="10504" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10505" class="en">option</span>
      <span name="xml-name-end" pos="10511" class="atn"> value</span>
      <span name="x-equals" pos="10517" class="atneq">=</span>
      <span name="xml-att-quote" pos="10518" class="z">"</span>
      <span name="xml-literal-start" pos="10519" class="av">01</span>
      <span name="xml-att-quote" pos="10521" class="z">"</span>
      <span name="x-tag-end" pos="10522" class="z">&gt;</span>
      <span name="nested-query" pos="10523" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="10558" xq="yes">01</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="10563" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10564" class="txt">January</span>
      <span pos="10571" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10573" class="cl">option</span>
      <span name="x-tag-end" pos="10579" class="z">&gt;</span>
      <span pos="10580" class="txt">&#xD;
            	</span>
      <span pos="10595" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10596" class="en">option</span>
      <span name="xml-name-end" pos="10602" class="atn"> value</span>
      <span name="x-equals" pos="10608" class="atneq">=</span>
      <span name="xml-att-quote" pos="10609" class="z">"</span>
      <span name="xml-literal-start" pos="10610" class="av">02</span>
      <span name="xml-att-quote" pos="10612" class="z">"</span>
      <span name="x-tag-end" pos="10613" class="z">&gt;</span>
      <span name="nested-query" pos="10614" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="10649" xq="yes">02</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="10654" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10655" class="txt">February</span>
      <span pos="10663" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10665" class="cl">option</span>
      <span name="x-tag-end" pos="10671" class="z">&gt;</span>
      <span pos="10672" class="txt">&#xD;
            	</span>
      <span pos="10687" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10688" class="en">option</span>
      <span name="xml-name-end" pos="10694" class="atn"> value</span>
      <span name="x-equals" pos="10700" class="atneq">=</span>
      <span name="xml-att-quote" pos="10701" class="z">"</span>
      <span name="xml-literal-start" pos="10702" class="av">03</span>
      <span name="xml-att-quote" pos="10704" class="z">"</span>
      <span name="x-tag-end" pos="10705" class="z">&gt;</span>
      <span name="nested-query" pos="10706" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="10741" xq="yes">03</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="10746" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10747" class="txt">March</span>
      <span pos="10752" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10754" class="cl">option</span>
      <span name="x-tag-end" pos="10760" class="z">&gt;</span>
      <span pos="10761" class="txt">&#xD;
            	</span>
      <span pos="10776" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10777" class="en">option</span>
      <span name="xml-name-end" pos="10783" class="atn"> value</span>
      <span name="x-equals" pos="10789" class="atneq">=</span>
      <span name="xml-att-quote" pos="10790" class="z">"</span>
      <span name="xml-literal-start" pos="10791" class="av">04</span>
      <span name="xml-att-quote" pos="10793" class="z">"</span>
      <span name="x-tag-end" pos="10794" class="z">&gt;</span>
      <span name="nested-query" pos="10795" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="10830" xq="yes">04</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="10835" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10836" class="txt">April</span>
      <span pos="10841" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10843" class="cl">option</span>
      <span name="x-tag-end" pos="10849" class="z">&gt;</span>
      <span pos="10850" class="txt">&#xD;
            	</span>
      <span pos="10865" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10866" class="en">option</span>
      <span name="xml-name-end" pos="10872" class="atn"> value</span>
      <span name="x-equals" pos="10878" class="atneq">=</span>
      <span name="xml-att-quote" pos="10879" class="z">"</span>
      <span name="xml-literal-start" pos="10880" class="av">05</span>
      <span name="xml-att-quote" pos="10882" class="z">"</span>
      <span name="x-tag-end" pos="10883" class="z">&gt;</span>
      <span name="nested-query" pos="10884" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="10919" xq="yes">05</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="10924" class="op">}</span>
      <span name="resume-x-literal-txt" pos="10925" class="txt">May</span>
      <span pos="10928" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="10930" class="cl">option</span>
      <span name="x-tag-end" pos="10936" class="z">&gt;</span>
      <span pos="10937" class="txt">&#xD;
            	</span>
      <span pos="10952" class="es">&lt;</span>
      <span name="xml-open-tag" pos="10953" class="en">option</span>
      <span name="xml-name-end" pos="10959" class="atn"> value</span>
      <span name="x-equals" pos="10965" class="atneq">=</span>
      <span name="xml-att-quote" pos="10966" class="z">"</span>
      <span name="xml-literal-start" pos="10967" class="av">06</span>
      <span name="xml-att-quote" pos="10969" class="z">"</span>
      <span name="x-tag-end" pos="10970" class="z">&gt;</span>
      <span name="nested-query" pos="10971" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="11006" xq="yes">06</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11011" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11012" class="txt">June</span>
      <span pos="11016" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11018" class="cl">option</span>
      <span name="x-tag-end" pos="11024" class="z">&gt;</span>
      <span pos="11025" class="txt">&#xD;
            	</span>
      <span pos="11040" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11041" class="en">option</span>
      <span name="xml-name-end" pos="11047" class="atn"> value</span>
      <span name="x-equals" pos="11053" class="atneq">=</span>
      <span name="xml-att-quote" pos="11054" class="z">"</span>
      <span name="xml-literal-start" pos="11055" class="av">07</span>
      <span name="xml-att-quote" pos="11057" class="z">"</span>
      <span name="x-tag-end" pos="11058" class="z">&gt;</span>
      <span name="nested-query" pos="11059" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="11094" xq="yes">07</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11099" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11100" class="txt">July</span>
      <span pos="11104" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11106" class="cl">option</span>
      <span name="x-tag-end" pos="11112" class="z">&gt;</span>
      <span pos="11113" class="txt">&#xD;
            	</span>
      <span pos="11128" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11129" class="en">option</span>
      <span name="xml-name-end" pos="11135" class="atn"> value</span>
      <span name="x-equals" pos="11141" class="atneq">=</span>
      <span name="xml-att-quote" pos="11142" class="z">"</span>
      <span name="xml-literal-start" pos="11143" class="av">08</span>
      <span name="xml-att-quote" pos="11145" class="z">"</span>
      <span name="x-tag-end" pos="11146" class="z">&gt;</span>
      <span name="nested-query" pos="11147" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="11182" xq="yes">08</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11187" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11188" class="txt">August</span>
      <span pos="11194" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11196" class="cl">option</span>
      <span name="x-tag-end" pos="11202" class="z">&gt;</span>
      <span pos="11203" class="txt">&#xD;
            	</span>
      <span pos="11218" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11219" class="en">option</span>
      <span name="xml-name-end" pos="11225" class="atn"> value</span>
      <span name="x-equals" pos="11231" class="atneq">=</span>
      <span name="xml-att-quote" pos="11232" class="z">"</span>
      <span name="xml-literal-start" pos="11233" class="av">09</span>
      <span name="xml-att-quote" pos="11235" class="z">"</span>
      <span name="x-tag-end" pos="11236" class="z">&gt;</span>
      <span name="nested-query" pos="11237" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="11272" xq="yes">09</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11277" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11278" class="txt">September</span>
      <span pos="11287" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11289" class="cl">option</span>
      <span name="x-tag-end" pos="11295" class="z">&gt;</span>
      <span pos="11296" class="txt">&#xD;
            	</span>
      <span pos="11311" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11312" class="en">option</span>
      <span name="xml-name-end" pos="11318" class="atn"> value</span>
      <span name="x-equals" pos="11324" class="atneq">=</span>
      <span name="xml-att-quote" pos="11325" class="z">"</span>
      <span name="xml-literal-start" pos="11326" class="av">10</span>
      <span name="xml-att-quote" pos="11328" class="z">"</span>
      <span name="x-tag-end" pos="11329" class="z">&gt;</span>
      <span name="nested-query" pos="11330" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="11365" xq="yes">10</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11370" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11371" class="txt">October</span>
      <span pos="11378" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11380" class="cl">option</span>
      <span name="x-tag-end" pos="11386" class="z">&gt;</span>
      <span pos="11387" class="txt">&#xD;
            	</span>
      <span pos="11402" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11403" class="en">option</span>
      <span name="xml-name-end" pos="11409" class="atn"> value</span>
      <span name="x-equals" pos="11415" class="atneq">=</span>
      <span name="xml-att-quote" pos="11416" class="z">"</span>
      <span name="xml-literal-start" pos="11417" class="av">11</span>
      <span name="xml-att-quote" pos="11419" class="z">"</span>
      <span name="x-tag-end" pos="11420" class="z">&gt;</span>
      <span name="nested-query" pos="11421" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="11456" xq="yes">11</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11461" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11462" class="txt">November</span>
      <span pos="11470" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11472" class="cl">option</span>
      <span name="x-tag-end" pos="11478" class="z">&gt;</span>
      <span pos="11479" class="txt">&#xD;
            	</span>
      <span pos="11494" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11495" class="en">option</span>
      <span name="xml-name-end" pos="11501" class="atn"> value</span>
      <span name="x-equals" pos="11507" class="atneq">=</span>
      <span name="xml-att-quote" pos="11508" class="z">"</span>
      <span name="xml-literal-start" pos="11509" class="av">12</span>
      <span name="xml-att-quote" pos="11511" class="z">"</span>
      <span name="x-tag-end" pos="11512" class="z">&gt;</span>
      <span name="nested-query" pos="11513" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">start-month</span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="11548" xq="yes">12</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11553" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11554" class="txt">December</span>
      <span pos="11562" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11564" class="cl">option</span>
      <span name="x-tag-end" pos="11570" class="z">&gt;</span>
      <span pos="11571" class="txt">&#xD;
            </span>
      <span pos="11585" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11587" class="cl">select</span>
      <span name="x-tag-end" pos="11593" class="z">&gt;</span>
      <span pos="11594" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="11608" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="11609" xq="yes"> / </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="11614" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11615" class="txt">&#xD;
            </span>
      <span pos="11629" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11630" class="en">input</span>
      <span name="xml-name-end" pos="11635" class="atn"> type</span>
      <span name="x-equals" pos="11640" class="atneq">=</span>
      <span name="xml-att-quote" pos="11641" class="z">"</span>
      <span name="xml-literal-start" pos="11642" class="av">text</span>
      <span name="xml-att-quote" pos="11646" class="z">"</span>
      <span name="xml-literal-end" pos="11647" class="atn"> name</span>
      <span name="x-equals" pos="11652" class="atneq">=</span>
      <span name="xml-att-quote" pos="11653" class="z">"</span>
      <span name="xml-literal-start" pos="11654" class="av">start-day</span>
      <span name="xml-att-quote" pos="11663" class="z">"</span>
      <span name="xml-literal-end" pos="11664" class="atn"> value</span>
      <span name="x-equals" pos="11670" class="atneq">=</span>
      <span name="xml-att-quote" pos="11671" class="z">"</span>
      <span name="nested-query" pos="11672" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="18" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="19" prev-is-closed="false" class="qname">start-day</span>
      <span xq="yes" start="28" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11701" class="op">}</span>
      <span name="xml-att-quote" pos="11702" class="z">"</span>
      <span name="xml-literal-end" pos="11703" class="atn"> style</span>
      <span name="x-equals" pos="11709" class="atneq">=</span>
      <span name="xml-att-quote" pos="11710" class="z">"</span>
      <span name="xml-literal-start" pos="11711" class="av">width:2em;</span>
      <span name="xml-att-quote" pos="11721" class="z">"</span>
      <span name="xml-literal-end" pos="11722" class="atn"> </span>
      <span name="x-tag-end" pos="11723" class="z">/&gt;</span>
      <span pos="11725" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="11739" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="11740" xq="yes"> / </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="11745" class="op">}</span>
      <span name="resume-x-literal-txt" pos="11746" class="txt">&#xD;
            </span>
      <span pos="11760" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11761" class="en">input</span>
      <span name="xml-name-end" pos="11766" class="atn"> type</span>
      <span name="x-equals" pos="11771" class="atneq">=</span>
      <span name="xml-att-quote" pos="11772" class="z">"</span>
      <span name="xml-literal-start" pos="11773" class="av">text</span>
      <span name="xml-att-quote" pos="11777" class="z">"</span>
      <span name="xml-literal-end" pos="11778" class="atn"> name</span>
      <span name="x-equals" pos="11783" class="atneq">=</span>
      <span name="xml-att-quote" pos="11784" class="z">"</span>
      <span name="xml-literal-start" pos="11785" class="av">start-year</span>
      <span name="xml-att-quote" pos="11795" class="z">"</span>
      <span name="xml-literal-end" pos="11796" class="atn"> value</span>
      <span name="x-equals" pos="11802" class="atneq">=</span>
      <span name="xml-att-quote" pos="11803" class="z">"</span>
      <span name="nested-query" pos="11804" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="18" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="19" prev-is-closed="false" class="qname">start-year</span>
      <span xq="yes" start="29" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="11834" class="op">}</span>
      <span name="xml-att-quote" pos="11835" class="z">"</span>
      <span name="xml-literal-end" pos="11836" class="atn"> style</span>
      <span name="x-equals" pos="11842" class="atneq">=</span>
      <span name="xml-att-quote" pos="11843" class="z">"</span>
      <span name="xml-literal-start" pos="11844" class="av">width:4em;</span>
      <span name="xml-att-quote" pos="11854" class="z">"</span>
      <span name="xml-literal-end" pos="11855" class="atn"> </span>
      <span name="x-tag-end" pos="11856" class="z">/&gt;</span>
      <span pos="11858" class="txt">&#xD;
        </span>
      <span pos="11868" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11870" class="cl">div</span>
      <span name="x-tag-end" pos="11873" class="z">&gt;</span>
      <span pos="11874" class="txt">&#xD;
        </span>
      <span pos="11884" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11885" class="en">div</span>
      <span name="x-tag-end" pos="11888" class="z">&gt;</span>
      <span pos="11889" class="txt">&#xD;
            </span>
      <span pos="11903" class="es">&lt;</span>
      <span name="xml-open-tag" pos="11904" class="en">label</span>
      <span name="xml-name-end" pos="11909" class="atn"> style</span>
      <span name="x-equals" pos="11915" class="atneq">=</span>
      <span name="xml-att-quote" pos="11916" class="z">"</span>
      <span name="xml-literal-start" pos="11917" class="av">font-weight:bold;float:left;margin-top:.4em;width:4em;</span>
      <span name="xml-att-quote" pos="11971" class="z">"</span>
      <span name="x-tag-end" pos="11972" class="z">&gt;</span>
      <span pos="11973" class="txt">End: </span>
      <span pos="11978" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="11980" class="cl">label</span>
      <span name="x-tag-end" pos="11985" class="z">&gt;</span>
      <span pos="11986" class="txt">&#xD;
            </span>
      <span pos="12000" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12001" class="en">select</span>
      <span name="xml-name-end" pos="12007" class="atn"> name</span>
      <span name="x-equals" pos="12012" class="atneq">=</span>
      <span name="xml-att-quote" pos="12013" class="z">"</span>
      <span name="xml-literal-start" pos="12014" class="av">end-month</span>
      <span name="xml-att-quote" pos="12023" class="z">"</span>
      <span name="x-tag-end" pos="12024" class="z">&gt;</span>
      <span pos="12025" class="txt">&#xD;
            	</span>
      <span pos="12040" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12041" class="en">option</span>
      <span name="xml-name-end" pos="12047" class="atn"> value</span>
      <span name="x-equals" pos="12053" class="atneq">=</span>
      <span name="xml-att-quote" pos="12054" class="z">"</span>
      <span name="xml-literal-start" pos="12055" class="av">01</span>
      <span name="xml-att-quote" pos="12057" class="z">"</span>
      <span name="x-tag-end" pos="12058" class="z">&gt;</span>
      <span name="nested-query" pos="12059" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12092" xq="yes">01</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12097" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12098" class="txt">January</span>
      <span pos="12105" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12107" class="cl">option</span>
      <span name="x-tag-end" pos="12113" class="z">&gt;</span>
      <span pos="12114" class="txt">&#xD;
            	</span>
      <span pos="12129" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12130" class="en">option</span>
      <span name="xml-name-end" pos="12136" class="atn"> value</span>
      <span name="x-equals" pos="12142" class="atneq">=</span>
      <span name="xml-att-quote" pos="12143" class="z">"</span>
      <span name="xml-literal-start" pos="12144" class="av">02</span>
      <span name="xml-att-quote" pos="12146" class="z">"</span>
      <span name="x-tag-end" pos="12147" class="z">&gt;</span>
      <span name="nested-query" pos="12148" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12181" xq="yes">02</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12186" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12187" class="txt">February</span>
      <span pos="12195" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12197" class="cl">option</span>
      <span name="x-tag-end" pos="12203" class="z">&gt;</span>
      <span pos="12204" class="txt">&#xD;
            	</span>
      <span pos="12219" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12220" class="en">option</span>
      <span name="xml-name-end" pos="12226" class="atn"> value</span>
      <span name="x-equals" pos="12232" class="atneq">=</span>
      <span name="xml-att-quote" pos="12233" class="z">"</span>
      <span name="xml-literal-start" pos="12234" class="av">03</span>
      <span name="xml-att-quote" pos="12236" class="z">"</span>
      <span name="x-tag-end" pos="12237" class="z">&gt;</span>
      <span name="nested-query" pos="12238" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12271" xq="yes">03</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12276" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12277" class="txt">March</span>
      <span pos="12282" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12284" class="cl">option</span>
      <span name="x-tag-end" pos="12290" class="z">&gt;</span>
      <span pos="12291" class="txt">&#xD;
            	</span>
      <span pos="12306" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12307" class="en">option</span>
      <span name="xml-name-end" pos="12313" class="atn"> value</span>
      <span name="x-equals" pos="12319" class="atneq">=</span>
      <span name="xml-att-quote" pos="12320" class="z">"</span>
      <span name="xml-literal-start" pos="12321" class="av">04</span>
      <span name="xml-att-quote" pos="12323" class="z">"</span>
      <span name="x-tag-end" pos="12324" class="z">&gt;</span>
      <span name="nested-query" pos="12325" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12358" xq="yes">04</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12363" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12364" class="txt">April</span>
      <span pos="12369" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12371" class="cl">option</span>
      <span name="x-tag-end" pos="12377" class="z">&gt;</span>
      <span pos="12378" class="txt">&#xD;
            	</span>
      <span pos="12393" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12394" class="en">option</span>
      <span name="xml-name-end" pos="12400" class="atn"> value</span>
      <span name="x-equals" pos="12406" class="atneq">=</span>
      <span name="xml-att-quote" pos="12407" class="z">"</span>
      <span name="xml-literal-start" pos="12408" class="av">05</span>
      <span name="xml-att-quote" pos="12410" class="z">"</span>
      <span name="x-tag-end" pos="12411" class="z">&gt;</span>
      <span name="nested-query" pos="12412" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12445" xq="yes">05</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12450" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12451" class="txt">May</span>
      <span pos="12454" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12456" class="cl">option</span>
      <span name="x-tag-end" pos="12462" class="z">&gt;</span>
      <span pos="12463" class="txt">&#xD;
            	</span>
      <span pos="12478" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12479" class="en">option</span>
      <span name="xml-name-end" pos="12485" class="atn"> value</span>
      <span name="x-equals" pos="12491" class="atneq">=</span>
      <span name="xml-att-quote" pos="12492" class="z">"</span>
      <span name="xml-literal-start" pos="12493" class="av">06</span>
      <span name="xml-att-quote" pos="12495" class="z">"</span>
      <span name="x-tag-end" pos="12496" class="z">&gt;</span>
      <span name="nested-query" pos="12497" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12530" xq="yes">06</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12535" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12536" class="txt">June</span>
      <span pos="12540" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12542" class="cl">option</span>
      <span name="x-tag-end" pos="12548" class="z">&gt;</span>
      <span pos="12549" class="txt">&#xD;
            	</span>
      <span pos="12564" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12565" class="en">option</span>
      <span name="xml-name-end" pos="12571" class="atn"> value</span>
      <span name="x-equals" pos="12577" class="atneq">=</span>
      <span name="xml-att-quote" pos="12578" class="z">"</span>
      <span name="xml-literal-start" pos="12579" class="av">07</span>
      <span name="xml-att-quote" pos="12581" class="z">"</span>
      <span name="x-tag-end" pos="12582" class="z">&gt;</span>
      <span name="nested-query" pos="12583" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12616" xq="yes">07</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12621" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12622" class="txt">July</span>
      <span pos="12626" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12628" class="cl">option</span>
      <span name="x-tag-end" pos="12634" class="z">&gt;</span>
      <span pos="12635" class="txt">&#xD;
            	</span>
      <span pos="12650" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12651" class="en">option</span>
      <span name="xml-name-end" pos="12657" class="atn"> value</span>
      <span name="x-equals" pos="12663" class="atneq">=</span>
      <span name="xml-att-quote" pos="12664" class="z">"</span>
      <span name="xml-literal-start" pos="12665" class="av">08</span>
      <span name="xml-att-quote" pos="12667" class="z">"</span>
      <span name="x-tag-end" pos="12668" class="z">&gt;</span>
      <span name="nested-query" pos="12669" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12702" xq="yes">08</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12707" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12708" class="txt">August</span>
      <span pos="12714" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12716" class="cl">option</span>
      <span name="x-tag-end" pos="12722" class="z">&gt;</span>
      <span pos="12723" class="txt">&#xD;
            	</span>
      <span pos="12738" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12739" class="en">option</span>
      <span name="xml-name-end" pos="12745" class="atn"> value</span>
      <span name="x-equals" pos="12751" class="atneq">=</span>
      <span name="xml-att-quote" pos="12752" class="z">"</span>
      <span name="xml-literal-start" pos="12753" class="av">09</span>
      <span name="xml-att-quote" pos="12755" class="z">"</span>
      <span name="x-tag-end" pos="12756" class="z">&gt;</span>
      <span name="nested-query" pos="12757" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12790" xq="yes">09</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12795" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12796" class="txt">September</span>
      <span pos="12805" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12807" class="cl">option</span>
      <span name="x-tag-end" pos="12813" class="z">&gt;</span>
      <span pos="12814" class="txt">&#xD;
            	</span>
      <span pos="12829" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12830" class="en">option</span>
      <span name="xml-name-end" pos="12836" class="atn"> value</span>
      <span name="x-equals" pos="12842" class="atneq">=</span>
      <span name="xml-att-quote" pos="12843" class="z">"</span>
      <span name="xml-literal-start" pos="12844" class="av">10</span>
      <span name="xml-att-quote" pos="12846" class="z">"</span>
      <span name="x-tag-end" pos="12847" class="z">&gt;</span>
      <span name="nested-query" pos="12848" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12881" xq="yes">10</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12886" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12887" class="txt">October</span>
      <span pos="12894" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12896" class="cl">option</span>
      <span name="x-tag-end" pos="12902" class="z">&gt;</span>
      <span pos="12903" class="txt">&#xD;
            	</span>
      <span pos="12918" class="es">&lt;</span>
      <span name="xml-open-tag" pos="12919" class="en">option</span>
      <span name="xml-name-end" pos="12925" class="atn"> value</span>
      <span name="x-equals" pos="12931" class="atneq">=</span>
      <span name="xml-att-quote" pos="12932" class="z">"</span>
      <span name="xml-literal-start" pos="12933" class="av">11</span>
      <span name="xml-att-quote" pos="12935" class="z">"</span>
      <span name="x-tag-end" pos="12936" class="z">&gt;</span>
      <span name="nested-query" pos="12937" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="12970" xq="yes">11</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="12975" class="op">}</span>
      <span name="resume-x-literal-txt" pos="12976" class="txt">November</span>
      <span pos="12984" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="12986" class="cl">option</span>
      <span name="x-tag-end" pos="12992" class="z">&gt;</span>
      <span pos="12993" class="txt">&#xD;
            	</span>
      <span pos="13008" class="es">&lt;</span>
      <span name="xml-open-tag" pos="13009" class="en">option</span>
      <span name="xml-name-end" pos="13015" class="atn"> value</span>
      <span name="x-equals" pos="13021" class="atneq">=</span>
      <span name="xml-att-quote" pos="13022" class="z">"</span>
      <span name="xml-literal-start" pos="13023" class="av">12</span>
      <span name="xml-att-quote" pos="13025" class="z">"</span>
      <span name="x-tag-end" pos="13026" class="z">&gt;</span>
      <span name="nested-query" pos="13027" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">end-month</span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="13060" xq="yes">12</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="13065" class="op">}</span>
      <span name="resume-x-literal-txt" pos="13066" class="txt">December</span>
      <span pos="13074" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="13076" class="cl">option</span>
      <span name="x-tag-end" pos="13082" class="z">&gt;</span>
      <span pos="13083" class="txt">&#xD;
            </span>
      <span pos="13097" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="13099" class="cl">select</span>
      <span name="x-tag-end" pos="13105" class="z">&gt;</span>
      <span pos="13106" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="13120" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="13121" xq="yes"> / </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="13126" class="op">}</span>
      <span name="resume-x-literal-txt" pos="13127" class="txt">&#xD;
            </span>
      <span pos="13141" class="es">&lt;</span>
      <span name="xml-open-tag" pos="13142" class="en">input</span>
      <span name="xml-name-end" pos="13147" class="atn"> type</span>
      <span name="x-equals" pos="13152" class="atneq">=</span>
      <span name="xml-att-quote" pos="13153" class="z">"</span>
      <span name="xml-literal-start" pos="13154" class="av">text</span>
      <span name="xml-att-quote" pos="13158" class="z">"</span>
      <span name="xml-literal-end" pos="13159" class="atn"> name</span>
      <span name="x-equals" pos="13164" class="atneq">=</span>
      <span name="xml-att-quote" pos="13165" class="z">"</span>
      <span name="xml-literal-start" pos="13166" class="av">end-day</span>
      <span name="xml-att-quote" pos="13173" class="z">"</span>
      <span name="xml-literal-end" pos="13174" class="atn"> value</span>
      <span name="x-equals" pos="13180" class="atneq">=</span>
      <span name="xml-att-quote" pos="13181" class="z">"</span>
      <span name="nested-query" pos="13182" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="18" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="19" prev-is-closed="false" class="qname">end-day</span>
      <span xq="yes" start="26" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="13209" class="op">}</span>
      <span name="xml-att-quote" pos="13210" class="z">"</span>
      <span name="xml-literal-end" pos="13211" class="atn"> style</span>
      <span name="x-equals" pos="13217" class="atneq">=</span>
      <span name="xml-att-quote" pos="13218" class="z">"</span>
      <span name="xml-literal-start" pos="13219" class="av">width:2em;</span>
      <span name="xml-att-quote" pos="13229" class="z">"</span>
      <span name="xml-literal-end" pos="13230" class="atn"> </span>
      <span name="x-tag-end" pos="13231" class="z">/&gt;</span>
      <span pos="13233" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="13247" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="13248" xq="yes"> / </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="13253" class="op">}</span>
      <span name="resume-x-literal-txt" pos="13254" class="txt">&#xD;
            </span>
      <span pos="13268" class="es">&lt;</span>
      <span name="xml-open-tag" pos="13269" class="en">input</span>
      <span name="xml-name-end" pos="13274" class="atn"> type</span>
      <span name="x-equals" pos="13279" class="atneq">=</span>
      <span name="xml-att-quote" pos="13280" class="z">"</span>
      <span name="xml-literal-start" pos="13281" class="av">text</span>
      <span name="xml-att-quote" pos="13285" class="z">"</span>
      <span name="xml-literal-end" pos="13286" class="atn"> name</span>
      <span name="x-equals" pos="13291" class="atneq">=</span>
      <span name="xml-att-quote" pos="13292" class="z">"</span>
      <span name="xml-literal-start" pos="13293" class="av">end-year</span>
      <span name="xml-att-quote" pos="13301" class="z">"</span>
      <span name="xml-literal-end" pos="13302" class="atn"> value</span>
      <span name="x-equals" pos="13308" class="atneq">=</span>
      <span name="xml-att-quote" pos="13309" class="z">"</span>
      <span name="nested-query" pos="13310" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="18" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="19" prev-is-closed="false" class="qname">end-year</span>
      <span xq="yes" start="27" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="13338" class="op">}</span>
      <span name="xml-att-quote" pos="13339" class="z">"</span>
      <span name="xml-literal-end" pos="13340" class="atn"> style</span>
      <span name="x-equals" pos="13346" class="atneq">=</span>
      <span name="xml-att-quote" pos="13347" class="z">"</span>
      <span name="xml-literal-start" pos="13348" class="av">width:4em;</span>
      <span name="xml-att-quote" pos="13358" class="z">"</span>
      <span name="xml-literal-end" pos="13359" class="atn"> </span>
      <span name="x-tag-end" pos="13360" class="z">/&gt;</span>
      <span pos="13362" class="txt">&#xD;
        </span>
      <span pos="13372" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="13374" class="cl">div</span>
      <span name="x-tag-end" pos="13377" class="z">&gt;</span>
      <span pos="13378" class="txt">&#xD;
 	</span>
      <span pos="13382" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="13384" class="cl">div</span>
      <span name="x-tag-end" pos="13387" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">select-option</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="38" prev-is-closed="false" class="variable">$param</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="47" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="56" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="57" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="58" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="59" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="60" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="69" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="79" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="80" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="81" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="83" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="84" prev-is-closed="false" class="node-type">attribute</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="94" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="95" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="96" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="98" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="99" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="102" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="104" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="105" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="106" prev-is-closed="false" class="variable">$param</span>
      <span xq="yes" start="112" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="113" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="121" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="122" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="123" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="128" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="137" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="138" prev-is-closed="true" class="qname">selected</span>
      <span xq="yes" start="146" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="147" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="13535" xq="yes">selected</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="9" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="13" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="13561" xq="yes">(: Search Facets Functions :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="13594" xq="yes">(: &#xD;
   The format of the facet definitions is proscribed by lib-search. You can also&#xD;
   include custom elements which search-ui.xqy will use when rendering your facet.&#xD;
   Make sure to pass the custom section for each facet, which contains:&#xD;
   facet-def/custom/title : The heading used to display all related UI controls.&#xD;
   facet-def/custom/sort : default (default), count, name-asc, name-desc&#xD;
   facet-def/custom/icon : an image filename, used in the analysis panel only&#xD;
   facet-def/custom/qs-id : for collection and value facets, scope-ids should be used,&#xD;
       and this should match the name of the scope-id&#xD;
   facet-def/custom/mode : currently used only in value facets, changes how the user&#xD;
       interacts with the facet.&#xD;
   &#xD;
   For more information on defining facets, see the Search Library Guide.&#xD;
&#xD;
    &lt;facet-defs xmlns="http://www.marklogic.com/ps/lib/lib-search"&gt;&#xD;
        &lt;facet-def&gt;&#xD;
        ...&#xD;
        &lt;custom&gt;&#xD;
            &lt;sort&gt;name-asc&lt;/sort&gt;&#xD;
            &lt;qs-id&gt;comp&lt;/qs-id&gt;&#xD;
            &lt;title&gt;Companies&lt;/title&gt;&#xD;
            &lt;icon&gt;/images/silk/building.png&lt;/icon&gt;&#xD;
            &lt;mode&gt;mixed|one|add&lt;/mode&gt;&#xD;
        &lt;/custom&gt;&#xD;
        &lt;/facet-def&gt;&#xD;
    &lt;/facet-defs&gt;&#xD;
:)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="14803" xq="yes">(:~&#xD;
:&#xD;
: (Public) Renders an facets meant to be displayed on the sidebar of&#xD;
: the search page.&#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @param $facet-defs The facets to use to build the advanced search form.&#xD;
: @return The rendered HTML facets.&#xD;
:)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">search-facets</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="33" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="52" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="54" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="false" class="variable">$facet-defs</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="69" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="78" prev-is-closed="false" class="qname">search:facet-defs</span>
      <span xq="yes" start="95" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="96" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="97" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="100" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="101" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="109" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="110" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="111" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="113" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="120" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="123" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="124" prev-is-closed="false" class="variable">$rendered-facets</span>
      <span xq="yes" start="140" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="141" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="143" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="153" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="156" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="157" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="163" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="164" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="166" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="167" prev-is-closed="false" class="function">params-to-query</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="183" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="190" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="191" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="201" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="204" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="205" prev-is-closed="false" class="variable">$facets</span>
      <span xq="yes" start="212" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="213" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="215" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="216" prev-is-closed="false" class="function">search:resolve-facets</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="238" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="244" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="245" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="246" prev-is-closed="false" class="variable">$facet-defs</span>
      <span xq="yes" start="257" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="258" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="268" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="271" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="272" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="278" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="279" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="281" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="282" prev-is-closed="false" class="variable">$facets</span>
      <span xq="yes" start="289" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="290" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="302" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="312" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="318" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="332" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="334" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="335" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="336" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="342" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="343" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="359" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="360" prev-is-closed="false" class="qname">search:collection-set-facet</span>
      <span xq="yes" start="387" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="388" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="389" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="390" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="394" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="412" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="413" prev-is-closed="false" class="function">collection-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="430" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="437" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="438" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="439" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="445" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="446" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="447" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="461" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="465" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="466" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="468" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="469" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="470" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="476" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="477" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="493" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="494" prev-is-closed="false" class="qname">search:value-facet</span>
      <span xq="yes" start="512" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="513" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="514" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="515" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="519" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="537" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="538" prev-is-closed="false" class="function">value-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="550" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="557" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="558" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="559" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="565" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="566" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="567" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="581" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="585" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="586" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="588" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="589" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="590" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="596" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="597" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="613" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="614" prev-is-closed="false" class="qname">search:trailing-date-facet</span>
      <span xq="yes" start="640" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="641" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="642" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="643" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="647" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="665" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="666" prev-is-closed="false" class="function">trailing-date-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="686" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="693" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="694" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="695" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="701" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="702" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="703" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span class="comment" pos="15790" xq="yes">(: Unhandled facet type&#xD;
            else if ($facet[search:facet-def/search:date-group-facet]) then&#xD;
                (date-group-facet($params, $facet)):)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="34" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="44" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="48" prev-is-closed="false" class="variable">$rendered-facets</span>
      <span xq="yes" start="64" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="65" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="16028" class="es">&lt;</span>
      <span name="xml-open-tag" pos="16029" class="en">div</span>
      <span name="x-tag-end" pos="16032" class="z">&gt;</span>
      <span name="nested-query" pos="16033" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$rendered-facets</span>
      <span name="unnested-xquery" pos="16050" class="op">}</span>
      <span pos="16051" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="16053" class="cl">div</span>
      <span name="x-tag-end" pos="16056" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="16081" xq="yes">(:~&#xD;
:&#xD;
: (Public) Renders tag clouds meant to be displayed on the top of&#xD;
: the search page. The items in the tag cloud are given a 1-6 "heat" rating,&#xD;
: which can be individually styled. The heat rating is determined, and can&#xD;
: be customized using the "determine-heat" function.&#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @param $facet-defs The facets to use to build the advanced search form.&#xD;
: @return The rendered HTML tag clouds&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">search-results-analysis</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="50" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="53" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="54" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="62" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="68" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="71" prev-is-closed="false" class="variable">$facet-defs</span>
      <span xq="yes" start="82" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="83" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="85" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="86" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="94" prev-is-closed="false" class="qname">search:facet-defs</span>
      <span xq="yes" start="111" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="112" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="113" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="114" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="116" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="125" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="126" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="127" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="129" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="130" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="133" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="136" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="137" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="143" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="144" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="146" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="147" prev-is-closed="false" class="function">params-to-query</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="163" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="170" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="171" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="174" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="178" prev-is-closed="false" class="variable">$facets</span>
      <span xq="yes" start="185" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="186" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="188" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="189" prev-is-closed="false" class="function">search:resolve-facets</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="211" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="217" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="218" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="219" prev-is-closed="false" class="variable">$facet-defs</span>
      <span xq="yes" start="230" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="231" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="237" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="243" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="249" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="251" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="252" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="253" prev-is-closed="false" class="variable">$facets</span>
      <span xq="yes" start="260" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="261" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="273" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="274" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="285" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="286" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="287" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="291" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="16836" class="es">&lt;</span>
      <span name="xml-open-tag" pos="16837" class="en">div</span>
      <span name="xml-name-end" pos="16840" class="atn"> class</span>
      <span name="x-equals" pos="16846" class="atneq">=</span>
      <span name="xml-att-quote" pos="16847" class="z">"</span>
      <span name="xml-literal-start" pos="16848" class="av">analysis-panel</span>
      <span name="xml-att-quote" pos="16862" class="z">"</span>
      <span name="x-tag-end" pos="16863" class="z">&gt;</span>
      <span pos="16864" class="txt">&#xD;
        </span>
      <span pos="16874" class="es">&lt;</span>
      <span name="xml-open-tag" pos="16875" class="en">div</span>
      <span name="xml-name-end" pos="16878" class="atn"> class</span>
      <span name="x-equals" pos="16884" class="atneq">=</span>
      <span name="xml-att-quote" pos="16885" class="z">"</span>
      <span name="xml-literal-start" pos="16886" class="av">header</span>
      <span name="xml-att-quote" pos="16892" class="z">"</span>
      <span name="x-tag-end" pos="16893" class="z">&gt;</span>
      <span pos="16894" class="txt">These documents contain references to:&amp;nbsp;&amp;nbsp;</span>
      <span pos="16944" class="es">&lt;</span>
      <span name="xml-open-tag" pos="16945" class="en">a</span>
      <span name="xml-name-end" pos="16946" class="atn"> href</span>
      <span name="x-equals" pos="16951" class="atneq">=</span>
      <span name="xml-att-quote" pos="16952" class="z">"</span>
      <span name="xml-literal-start" pos="16953" class="av">search.xqy?</span>
      <span name="nested-query" pos="16964" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="16997" xq="yes">p</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="17002" xq="yes">hval</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="17010" class="op">}</span>
      <span name="xml-att-quote" pos="17011" class="z">"</span>
      <span name="x-tag-end" pos="17012" class="z">&gt;</span>
      <span pos="17013" class="txt">[CLEAR FILTERS]</span>
      <span pos="17028" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="17030" class="cl">a</span>
      <span name="x-tag-end" pos="17031" class="z">&gt;</span>
      <span pos="17032" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="17034" class="cl">div</span>
      <span name="x-tag-end" pos="17037" class="z">&gt;</span>
      <span pos="17038" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="17048" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="24" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="false" class="variable">$facets</span>
      <span xq="yes" start="32" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="33" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="61" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="62" prev-is-closed="false" class="function">value-heatmap</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="76" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="83" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="84" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="85" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="91" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="92" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span name="unnested-xquery" pos="17150" class="op">}</span>
      <span name="resume-x-literal-txt" pos="17151" class="txt">&#xD;
    </span>
      <span pos="17157" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="17159" class="cl">div</span>
      <span name="x-tag-end" pos="17162" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="13" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="17183" xq="yes">(: NB: This facet doesn't yet support facet modes. It must be added later :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">collection-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="36" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="43" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="55" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="56" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="64" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="65" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="67" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="76" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="88" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="89" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="91" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="93" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="102" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="103" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="104" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="106" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="113" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="116" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="123" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="124" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="126" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="127" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="137" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="143" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="144" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="160" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="161" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="174" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="175" prev-is-closed="false" class="qname">search:title</span>
      <span xq="yes" start="187" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="188" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="194" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="197" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="198" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="209" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="210" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="212" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="17471" xq="yes">coll</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="21" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="50" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="17528" xq="yes">p</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="5" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="12" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="37" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="38" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="48" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="54" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="55" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="71" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="72" prev-is-closed="false" class="qname">search:collection-set-facet</span>
      <span xq="yes" start="99" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="100" prev-is-closed="false" class="qname">search:set-id</span>
      <span xq="yes" start="113" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="114" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="120" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="123" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="124" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="137" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="138" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="140" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="141" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="151" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="169" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="170" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="17701" xq="yes">:all</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    &#xD;
    </span>
      <span class="comment" pos="17720" xq="yes">(: Collection Management :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span class="comment" pos="17753" xq="yes">(: Selects the param values that are within scope (ie have been returned from) of the current facet :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$facet-colls</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="37" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="38" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="40" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="47" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="48" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="59" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="60" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="61" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="72" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="75" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="false" class="variable">$facet-colls</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="91" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="92" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="93" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="106" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="108" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="111" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="118" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="121" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="122" prev-is-closed="false" class="variable">$facet-colls</span>
      <span xq="yes" start="134" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="135" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="141" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="142" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="152" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="170" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="171" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="18026" xq="yes">:</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="9" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="10" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="17" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$passed-colls</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="37" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="47" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="50" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="56" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="57" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="59" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="60" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="72" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="73" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="80" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="81" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="85" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="95" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="100" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="101" prev-is-closed="false" class="function">fn:starts-with</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="116" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="121" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="122" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="123" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="141" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="142" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="152" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="158" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="159" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="164" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="170" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="173" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="174" prev-is-closed="false" class="variable">$out-of-scope-colls</span>
      <span xq="yes" start="193" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="194" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="196" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="206" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="209" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="210" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="215" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="216" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="218" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="219" prev-is-closed="false" class="variable">$passed-colls</span>
      <span xq="yes" start="232" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="242" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="247" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="248" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="255" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="260" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="261" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="262" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="263" prev-is-closed="false" class="variable">$facet-colls</span>
      <span xq="yes" start="275" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="276" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="286" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="292" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="293" prev-is-closed="false" class="variable">$coll</span>
      <span xq="yes" start="298" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="304" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="307" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="308" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="315" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="316" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="318" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="328" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="330" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="331" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="332" prev-is-closed="false" class="variable">$out-of-scope-colls</span>
      <span xq="yes" start="351" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="352" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="353" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="357" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="371" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="392" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="399" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="400" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="411" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="412" prev-is-closed="false" class="variable">$out-of-scope-colls</span>
      <span xq="yes" start="431" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="432" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="433" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="434" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="435" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="445" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="449" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="450" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="457" prev-is-closed="true" class="whitespace">&#xD;
    &#xD;
	</span>
      <span xq="yes" start="466" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="472" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span pos="18503" class="es">&lt;</span>
      <span name="xml-open-tag" pos="18504" class="en">div</span>
      <span name="x-tag-end" pos="18507" class="z">&gt;</span>
      <span pos="18508" class="txt">&#xD;
		</span>
      <span name="nested-query" pos="18512" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="4" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="12" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="13" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span pos="18531" class="es">&lt;</span>
      <span name="xml-open-tag" pos="18532" class="en">h3</span>
      <span name="x-tag-end" pos="18534" class="z">&gt;</span>
      <span name="nested-query" pos="18535" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$title</span>
      <span name="unnested-xquery" pos="18542" class="op">}</span>
      <span pos="18543" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="18545" class="cl">h3</span>
      <span name="x-tag-end" pos="18547" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span name="unnested-xquery" pos="18557" class="op">}</span>
      <span name="resume-x-literal-txt" pos="18558" class="txt">&#xD;
		</span>
      <span pos="18562" class="es">&lt;</span>
      <span name="xml-open-tag" pos="18563" class="en">div</span>
      <span name="xml-name-end" pos="18566" class="atn"> class</span>
      <span name="x-equals" pos="18572" class="atneq">=</span>
      <span name="xml-att-quote" pos="18573" class="z">"</span>
      <span name="xml-literal-start" pos="18574" class="av">search_facet</span>
      <span name="xml-att-quote" pos="18586" class="z">"</span>
      <span name="x-tag-end" pos="18587" class="z">&gt;</span>
      <span pos="18588" class="txt">&#xD;
		</span>
      <span name="nested-query" pos="18592" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="18594" xq="yes">(: ALL :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="5" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="51" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="52" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="64" prev-is-closed="false" class="variable">$facet-colls</span>
      <span xq="yes" start="76" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="77" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="90" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="91" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="95" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="98" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="99" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="105" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="106" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="108" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="109" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="117" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="123" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="124" prev-is-closed="false" class="qname">search:all</span>
      <span xq="yes" start="134" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="135" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="136" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="141" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="142" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="146" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="149" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="150" prev-is-closed="false" class="variable">$qs</span>
      <span xq="yes" start="153" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="154" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="156" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="157" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="179" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="189" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="190" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="191" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="192" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="193" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="197" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="200" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="201" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="206" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="207" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="209" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="210" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="18822" xq="yes">All [</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="18837" xq="yes">]</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="6" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace">			&#xD;
        	</span>
      <span pos="18865" class="es">&lt;</span>
      <span name="xml-open-tag" pos="18866" class="en">div</span>
      <span name="x-tag-end" pos="18869" class="z">&gt;</span>
      <span pos="18870" class="es">&lt;</span>
      <span name="xml-open-tag" pos="18871" class="en">a</span>
      <span name="xml-name-end" pos="18872" class="atn"> href</span>
      <span name="x-equals" pos="18877" class="atneq">=</span>
      <span name="xml-att-quote" pos="18878" class="z">"</span>
      <span name="xml-literal-start" pos="18879" class="av">search.xqy?</span>
      <span name="nested-query" pos="18890" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$qs</span>
      <span name="unnested-xquery" pos="18894" class="op">}</span>
      <span name="xml-att-quote" pos="18895" class="z">"</span>
      <span name="x-tag-end" pos="18896" class="z">&gt;</span>
      <span pos="18897" class="txt">&#xD;
        		</span>
      <span name="nested-query" pos="18909" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        		</span>
      <span xq="yes" start="13" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="function">fn:empty</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="38" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="39" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace">&#xD;
        		    </span>
      <span xq="yes" start="58" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="65" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="72" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="73" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="77" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="78" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="79" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="80" prev-is-closed="false" class="variable">$facet-colls</span>
      <span xq="yes" start="92" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="93" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="96" prev-is-closed="false" class="whitespace">&#xD;
        			</span>
      <span xq="yes" start="109" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="116" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="117" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="121" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="122" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="123" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="124" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="137" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="138" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="139" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="143" prev-is-closed="false" class="whitespace">&#xD;
	     			</span>
      <span xq="yes" start="154" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="19064" class="es">&lt;</span>
      <span name="xml-open-tag" pos="19065" class="en">img</span>
      <span name="xml-name-end" pos="19068" class="atn"> src</span>
      <span name="x-equals" pos="19072" class="atneq">=</span>
      <span name="xml-att-quote" pos="19073" class="z">"</span>
      <span name="xml-literal-start" pos="19074" class="av">images/silk/bullet_black.png</span>
      <span name="xml-att-quote" pos="19102" class="z">"</span>
      <span name="xml-literal-end" pos="19103" class="atn"> class</span>
      <span name="x-equals" pos="19109" class="atneq">=</span>
      <span name="xml-att-quote" pos="19110" class="z">"</span>
      <span name="xml-literal-start" pos="19111" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="19124" class="z">"</span>
      <span name="x-tag-end" pos="19125" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="19128" class="es">&lt;</span>
      <span name="xml-open-tag" pos="19129" class="en">strong</span>
      <span name="x-tag-end" pos="19135" class="z">&gt;</span>
      <span name="nested-query" pos="19136" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="19142" class="op">}</span>
      <span pos="19143" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="19145" class="cl">strong</span>
      <span name="x-tag-end" pos="19151" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        		</span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="24" prev-is-closed="true" class="whitespace">&#xD;
        		</span>
      <span name="unnested-xquery" pos="19187" class="op">}</span>
      <span name="resume-x-literal-txt" pos="19188" class="txt">&#xD;
        	</span>
      <span pos="19199" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="19201" class="cl">a</span>
      <span name="x-tag-end" pos="19202" class="z">&gt;</span>
      <span pos="19203" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="19205" class="cl">div</span>
      <span name="x-tag-end" pos="19208" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span name="unnested-xquery" pos="19219" class="op">}</span>
      <span name="resume-x-literal-txt" pos="19220" class="txt">&#xD;
    	</span>
      <span name="nested-query" pos="19227" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="19229" xq="yes">(: COLLECTIONS :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="8" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="function">facet-item-sort</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="37" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="43" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="44" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="56" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="57" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="63" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="64" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="80" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="81" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="94" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="95" prev-is-closed="false" class="qname">search:sort</span>
      <span xq="yes" start="106" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="107" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="111" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="121" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="122" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="124" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="125" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="135" prev-is-closed="false" class="variable">$collection-set-id</span>
      <span xq="yes" start="153" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="154" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="19400" xq="yes">:</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="8" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="9" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="10" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="15" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="20" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="42" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="47" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="48" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="49" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="54" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="55" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="59" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="62" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="68" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="71" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="72" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="82" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="87" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="88" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="93" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="19497" xq="yes"> [</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="19509" xq="yes">]</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="6" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="false" class="variable">$qs</span>
      <span xq="yes" start="13" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace">&#xD;
 			</span>
      <span class="comment" pos="19533" xq="yes">(: If the current collection exists in the params, then remove&#xD;
			   from params, else add to the params :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
			</span>
      <span xq="yes" start="6" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="10" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="24" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="25" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="29" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="30" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="35" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="52" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="53" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="54" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> &#xD;
	    		</span>
      <span xq="yes" start="67" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="74" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="75" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="79" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="80" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="81" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="82" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="88" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="89" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="90" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="94" prev-is-closed="false" class="whitespace">&#xD;
				</span>
      <span xq="yes" start="100" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="122" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="143" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="150" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="151" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="162" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="163" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="169" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="170" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="171" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="172" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="173" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="174" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="175" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="176" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="177" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="178" prev-is-closed="true" class="whitespace">&#xD;
			</span>
      <span xq="yes" start="183" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="187" prev-is-closed="false" class="whitespace">&#xD;
				</span>
      <span xq="yes" start="193" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="208" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="209" prev-is-closed="false" class="whitespace">&#xD;
					</span>
      <span xq="yes" start="216" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="238" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="259" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="266" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="267" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="278" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="279" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="292" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="293" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="294" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="295" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="296" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="297" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="298" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="299" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="300" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="301" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="302" prev-is-closed="false" class="whitespace">&#xD;
					</span>
      <span xq="yes" start="309" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="319" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="330" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="19971" xq="yes">=</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="8" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="9" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="19984" xq="yes">&amp;</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="23" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="35" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="false" class="numeric">0</span>
      <span xq="yes" start="37" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace">&#xD;
	    		</span>
      <span pos="20038" class="es">&lt;</span>
      <span name="xml-open-tag" pos="20039" class="en">div</span>
      <span name="x-tag-end" pos="20042" class="z">&gt;</span>
      <span pos="20043" class="es">&lt;</span>
      <span name="xml-open-tag" pos="20044" class="en">a</span>
      <span name="xml-name-end" pos="20045" class="atn"> href</span>
      <span name="x-equals" pos="20050" class="atneq">=</span>
      <span name="xml-att-quote" pos="20051" class="z">"</span>
      <span name="xml-literal-start" pos="20052" class="av">search.xqy?</span>
      <span name="nested-query" pos="20063" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$qs</span>
      <span name="unnested-xquery" pos="20067" class="op">}</span>
      <span name="xml-att-quote" pos="20068" class="z">"</span>
      <span name="x-tag-end" pos="20069" class="z">&gt;</span>
      <span pos="20070" class="txt">&#xD;
	    			</span>
      <span name="nested-query" pos="20080" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
	    			</span>
      <span xq="yes" start="11" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="22" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="29" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="30" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="34" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="35" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="40" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="57" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="62" prev-is-closed="false" class="whitespace"> &#xD;
	    				</span>
      <span xq="yes" start="74" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="81" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="82" prev-is-closed="false" class="qname">coll</span>
      <span xq="yes" start="86" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="87" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="88" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="95" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="96" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="97" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace">&#xD;
	     				</span>
      <span xq="yes" start="113" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="20194" class="es">&lt;</span>
      <span name="xml-open-tag" pos="20195" class="en">img</span>
      <span name="xml-name-end" pos="20198" class="atn"> src</span>
      <span name="x-equals" pos="20202" class="atneq">=</span>
      <span name="xml-att-quote" pos="20203" class="z">"</span>
      <span name="xml-literal-start" pos="20204" class="av">images/silk/bullet_delete.png</span>
      <span name="xml-att-quote" pos="20233" class="z">"</span>
      <span name="xml-literal-end" pos="20234" class="atn"> class</span>
      <span name="x-equals" pos="20240" class="atneq">=</span>
      <span name="xml-att-quote" pos="20241" class="z">"</span>
      <span name="xml-literal-start" pos="20242" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="20255" class="z">"</span>
      <span name="x-tag-end" pos="20256" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="20259" class="es">&lt;</span>
      <span name="xml-open-tag" pos="20260" class="en">strong</span>
      <span name="x-tag-end" pos="20266" class="z">&gt;</span>
      <span name="nested-query" pos="20267" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="20273" class="op">}</span>
      <span pos="20274" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="20276" class="cl">strong</span>
      <span name="x-tag-end" pos="20282" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
	    			</span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
	    			</span>
      <span name="unnested-xquery" pos="20314" class="op">}</span>
      <span name="resume-x-literal-txt" pos="20315" class="txt">&#xD;
	    		</span>
      <span pos="20324" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="20326" class="cl">a</span>
      <span name="x-tag-end" pos="20327" class="z">&gt;</span>
      <span pos="20328" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="20330" class="cl">div</span>
      <span name="x-tag-end" pos="20333" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
	    	</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace">&#xD;
 		</span>
      <span name="unnested-xquery" pos="20354" class="op">}</span>
      <span name="resume-x-literal-txt" pos="20355" class="txt">&#xD;
 		</span>
      <span pos="20360" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="20362" class="cl">div</span>
      <span name="x-tag-end" pos="20365" class="z">&gt;</span>
      <span pos="20366" class="txt">&#xD;
 	</span>
      <span pos="20370" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="20372" class="cl">div</span>
      <span name="x-tag-end" pos="20375" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">value-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="36" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="43" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="55" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="56" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="64" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="65" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="67" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="76" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="88" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="89" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="91" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="93" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="102" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="103" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="104" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="106" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="108" prev-is-closed="false" class="function">value-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="120" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="127" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="128" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="129" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="135" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="136" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="137" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="138" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="139" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="140" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="141" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="142" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="146" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="152" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="153" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="161" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="162" prev-is-closed="true" class="function">value-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="174" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="181" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="182" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="184" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="185" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="193" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="194" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="195" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="196" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="202" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="203" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="205" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="206" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="214" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="226" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="227" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="228" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="229" prev-is-closed="false" class="variable">$mode</span>
      <span xq="yes" start="234" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="235" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="237" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="238" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="247" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="248" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="249" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="250" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="252" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="253" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="261" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="262" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="263" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="265" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="266" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span class="comment" pos="20647" xq="yes">(: mode == (one, add, mixed) :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="4" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="8" prev-is-closed="false" class="variable">$mode</span>
      <span xq="yes" start="13" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace">&#xD;
	    </span>
      <span xq="yes" start="23" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$mode</span>
      <span xq="yes" start="32" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="variable">$mode</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="49" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="63" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="67" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="73" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="74" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="90" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="91" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="104" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="105" prev-is-closed="false" class="qname">search:mode</span>
      <span xq="yes" start="116" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="117" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="118" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="123" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="141" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="151" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="152" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="158" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="159" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="175" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="176" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="189" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="190" prev-is-closed="false" class="qname">search:mode</span>
      <span xq="yes" start="201" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="202" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="203" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="204" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="205" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="206" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="220" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="224" prev-is-closed="false" class="whitespace">&#xD;
	            </span>
      <span xq="yes" start="239" prev-is-closed="false" class="variable">$DEFAULT-FACET-MODE</span>
      <span xq="yes" start="258" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="261" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="264" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="265" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="271" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="272" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="274" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="275" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="285" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="291" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="292" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="308" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="309" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="322" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="323" prev-is-closed="false" class="qname">search:title</span>
      <span xq="yes" start="335" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="336" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="342" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="345" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="346" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="357" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="358" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="360" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="21038" xq="yes">val</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="21" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="50" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="21094" xq="yes">p</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="5" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="12" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="36" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="42" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="43" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="59" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="60" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="73" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="74" prev-is-closed="false" class="qname">search:qs-id</span>
      <span xq="yes" start="86" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="87" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="93" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="96" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="97" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="110" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="111" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="113" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="114" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="124" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="130" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="131" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="21228" xq="yes">:all</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    &#xD;
    </span>
      <span class="comment" pos="21247" xq="yes">(: Value Management :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span class="comment" pos="21275" xq="yes">(: Selects the param values that are within scope (ie have been returned from) of the current facet :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="46" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="47" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="58" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="59" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="60" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="65" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="71" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="74" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="75" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="86" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="87" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="89" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="90" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="91" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="104" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="105" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="106" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="109" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="110" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="116" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="131" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="132" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="138" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="139" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="149" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="155" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="156" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="21533" xq="yes">:</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="9" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="10" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="17" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$passed-vals</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="46" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="49" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="50" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="54" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="67" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="71" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="78" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="79" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="82" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="92" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="function">fn:starts-with</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="113" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="117" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="118" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="125" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="126" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="136" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="142" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="143" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="147" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="153" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="156" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="157" prev-is-closed="false" class="variable">$out-of-scope-vals</span>
      <span xq="yes" start="175" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="176" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="178" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="188" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="191" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="192" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="196" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="197" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="199" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="200" prev-is-closed="false" class="variable">$passed-vals</span>
      <span xq="yes" start="212" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="222" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="227" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="228" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="235" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="239" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="240" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="241" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="242" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="253" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="254" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="264" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="270" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="271" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="275" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="281" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="284" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="285" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="292" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="293" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="295" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="305" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="307" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="308" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="309" prev-is-closed="false" class="variable">$out-of-scope-vals</span>
      <span xq="yes" start="327" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="328" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="329" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="333" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="347" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="368" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="375" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="376" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="387" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="388" prev-is-closed="false" class="variable">$out-of-scope-vals</span>
      <span xq="yes" start="406" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="407" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="408" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="409" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="410" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="420" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="424" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="425" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="432" prev-is-closed="true" class="whitespace">&#xD;
    &#xD;
	</span>
      <span xq="yes" start="441" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="447" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span pos="21985" class="es">&lt;</span>
      <span name="xml-open-tag" pos="21986" class="en">div</span>
      <span name="x-tag-end" pos="21989" class="z">&gt;</span>
      <span pos="21990" class="txt">&#xD;
		</span>
      <span name="nested-query" pos="21994" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="4" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="12" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="13" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span pos="22013" class="es">&lt;</span>
      <span name="xml-open-tag" pos="22014" class="en">h3</span>
      <span name="x-tag-end" pos="22016" class="z">&gt;</span>
      <span name="nested-query" pos="22017" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$title</span>
      <span name="unnested-xquery" pos="22024" class="op">}</span>
      <span pos="22025" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="22027" class="cl">h3</span>
      <span name="x-tag-end" pos="22029" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span name="unnested-xquery" pos="22039" class="op">}</span>
      <span name="resume-x-literal-txt" pos="22040" class="txt">&#xD;
		</span>
      <span pos="22044" class="es">&lt;</span>
      <span name="xml-open-tag" pos="22045" class="en">div</span>
      <span name="xml-name-end" pos="22048" class="atn"> class</span>
      <span name="x-equals" pos="22054" class="atneq">=</span>
      <span name="xml-att-quote" pos="22055" class="z">"</span>
      <span name="xml-literal-start" pos="22056" class="av">search_facet</span>
      <span name="xml-att-quote" pos="22068" class="z">"</span>
      <span name="x-tag-end" pos="22069" class="z">&gt;</span>
      <span pos="22070" class="txt">&#xD;
		</span>
      <span name="nested-query" pos="22074" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="22076" xq="yes">(: ALL :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="5" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="51" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="52" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="64" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="75" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="76" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="89" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="94" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="104" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="105" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="108" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="116" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="122" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="123" prev-is-closed="false" class="qname">search:all</span>
      <span xq="yes" start="133" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="134" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="135" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="140" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="141" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="145" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="148" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="149" prev-is-closed="false" class="variable">$qs</span>
      <span xq="yes" start="152" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="153" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="155" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="156" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="178" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="188" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="189" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="190" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="191" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="192" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="196" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="199" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="200" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="205" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="206" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="208" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="209" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="22303" xq="yes">All [</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="22318" xq="yes">]</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="6" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace">			&#xD;
        	</span>
      <span pos="22346" class="es">&lt;</span>
      <span name="xml-open-tag" pos="22347" class="en">div</span>
      <span name="x-tag-end" pos="22350" class="z">&gt;</span>
      <span pos="22351" class="es">&lt;</span>
      <span name="xml-open-tag" pos="22352" class="en">a</span>
      <span name="xml-name-end" pos="22353" class="atn"> href</span>
      <span name="x-equals" pos="22358" class="atneq">=</span>
      <span name="xml-att-quote" pos="22359" class="z">"</span>
      <span name="xml-literal-start" pos="22360" class="av">search.xqy?</span>
      <span name="nested-query" pos="22371" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$qs</span>
      <span name="unnested-xquery" pos="22375" class="op">}</span>
      <span name="xml-att-quote" pos="22376" class="z">"</span>
      <span name="x-tag-end" pos="22377" class="z">&gt;</span>
      <span pos="22378" class="txt">&#xD;
        		</span>
      <span name="nested-query" pos="22390" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        		</span>
      <span xq="yes" start="13" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="function">fn:empty</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="37" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="41" prev-is-closed="false" class="whitespace">&#xD;
        		    </span>
      <span xq="yes" start="57" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="64" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="71" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="72" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="75" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="77" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="78" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="89" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="91" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="93" prev-is-closed="false" class="whitespace">&#xD;
        			</span>
      <span xq="yes" start="106" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="113" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="114" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="117" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="118" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="133" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="134" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="135" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="139" prev-is-closed="false" class="whitespace">&#xD;
	     			</span>
      <span xq="yes" start="150" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="22541" class="es">&lt;</span>
      <span name="xml-open-tag" pos="22542" class="en">img</span>
      <span name="xml-name-end" pos="22545" class="atn"> src</span>
      <span name="x-equals" pos="22549" class="atneq">=</span>
      <span name="xml-att-quote" pos="22550" class="z">"</span>
      <span name="xml-literal-start" pos="22551" class="av">images/silk/bullet_black.png</span>
      <span name="xml-att-quote" pos="22579" class="z">"</span>
      <span name="xml-literal-end" pos="22580" class="atn"> class</span>
      <span name="x-equals" pos="22586" class="atneq">=</span>
      <span name="xml-att-quote" pos="22587" class="z">"</span>
      <span name="xml-literal-start" pos="22588" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="22601" class="z">"</span>
      <span name="xml-literal-end" pos="22602" class="atn"> </span>
      <span name="x-tag-end" pos="22603" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="22606" class="es">&lt;</span>
      <span name="xml-open-tag" pos="22607" class="en">strong</span>
      <span name="x-tag-end" pos="22613" class="z">&gt;</span>
      <span name="nested-query" pos="22614" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="22620" class="op">}</span>
      <span pos="22621" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="22623" class="cl">strong</span>
      <span name="x-tag-end" pos="22629" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        		</span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="24" prev-is-closed="true" class="whitespace">&#xD;
        		</span>
      <span name="unnested-xquery" pos="22665" class="op">}</span>
      <span name="resume-x-literal-txt" pos="22666" class="txt">&#xD;
        	</span>
      <span pos="22677" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="22679" class="cl">a</span>
      <span name="x-tag-end" pos="22680" class="z">&gt;</span>
      <span pos="22681" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="22683" class="cl">div</span>
      <span name="x-tag-end" pos="22686" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span name="unnested-xquery" pos="22697" class="op">}</span>
      <span name="resume-x-literal-txt" pos="22698" class="txt">&#xD;
    	</span>
      <span name="nested-query" pos="22705" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="22707" xq="yes">(: VALUES :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="8" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="function">facet-item-sort</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="37" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="43" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="44" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="56" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="57" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="63" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="64" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="80" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="81" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="94" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="95" prev-is-closed="false" class="qname">search:sort</span>
      <span xq="yes" start="106" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="107" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="111" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="121" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="122" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="124" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="125" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="135" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="141" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="142" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="22861" xq="yes">:</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="8" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="9" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="10" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="15" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="20" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="42" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="47" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="48" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="49" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="54" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="55" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="59" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="62" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="68" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="71" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="72" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="82" prev-is-closed="false" class="function">capitalize-first-chars</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="105" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="110" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="111" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="116" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="117" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="118" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="22982" xq="yes"> [</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="22994" xq="yes">]</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="6" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="false" class="variable">$add-qs</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace">&#xD;
     		</span>
      <span class="comment" pos="23025" xq="yes">(: If the current collection exists in the params, then remove&#xD;
    		   from params, else add to the params :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="9" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="13" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="27" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="28" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="31" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="32" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="37" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="40" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="54" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="55" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="59" prev-is-closed="false" class="whitespace"> &#xD;
        		</span>
      <span xq="yes" start="72" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="79" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="80" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="83" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="84" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="85" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="86" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="92" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="93" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="98" prev-is-closed="false" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="107" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="129" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="150" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="157" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="158" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="169" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="170" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="176" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="178" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="179" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="180" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="181" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="182" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="183" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="184" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="185" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="193" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="197" prev-is-closed="false" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="206" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="221" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="222" prev-is-closed="false" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="232" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="254" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="275" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="282" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="283" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="294" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="295" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="308" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="309" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="310" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="311" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="312" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="313" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="314" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="315" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="316" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="317" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="318" prev-is-closed="false" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="328" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="338" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="349" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="23485" xq="yes">=</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="function">xdmp:url-encode</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="26" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="23515" xq="yes">&amp;</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="12" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="variable">$one-qs</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">&#xD;
     		</span>
      <span class="comment" pos="23552" xq="yes">(: If the current collection exists in the params, then remove&#xD;
    		   from params, else add to the params :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="9" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="variable">$stripped-params</span>
      <span xq="yes" start="29" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="32" prev-is-closed="false" class="whitespace"> &#xD;
    			</span>
      <span xq="yes" start="42" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="46" prev-is-closed="false" class="variable">$passed-vals</span>
      <span xq="yes" start="58" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="59" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="60" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="64" prev-is-closed="false" class="whitespace">&#xD;
    			    </span>
      <span xq="yes" start="77" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="98" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="105" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="106" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="117" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="118" prev-is-closed="false" class="variable">$passed-vals</span>
      <span xq="yes" start="130" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="131" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="132" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="133" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="134" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="135" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="144" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="148" prev-is-closed="false" class="whitespace">&#xD;
    			    </span>
      <span xq="yes" start="161" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="168" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="182" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="188" prev-is-closed="false" class="whitespace">&#xD;
        		</span>
      <span xq="yes" start="200" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="215" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="216" prev-is-closed="false" class="whitespace">&#xD;
        			</span>
      <span xq="yes" start="229" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="251" prev-is-closed="false" class="variable">$stripped-params</span>
      <span xq="yes" start="267" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="268" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="269" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="270" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="271" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="272" prev-is-closed="false" class="whitespace">&#xD;
        			</span>
      <span xq="yes" start="285" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="295" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="306" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="23969" xq="yes">=</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="function">xdmp:url-encode</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="26" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="23999" xq="yes">&amp;</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="26" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="28" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="29" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="numeric">0</span>
      <span xq="yes" start="40" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace">&#xD;
	    		</span>
      <span xq="yes" start="55" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="59" prev-is-closed="false" class="variable">$mode</span>
      <span xq="yes" start="64" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="65" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="66" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="24068" xq="yes">add</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
    	    		</span>
      <span pos="24092" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24093" class="en">div</span>
      <span name="x-tag-end" pos="24096" class="z">&gt;</span>
      <span pos="24097" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24098" class="en">a</span>
      <span name="xml-name-end" pos="24099" class="atn"> href</span>
      <span name="x-equals" pos="24104" class="atneq">=</span>
      <span name="xml-att-quote" pos="24105" class="z">"</span>
      <span name="xml-literal-start" pos="24106" class="av">search.xqy?</span>
      <span name="nested-query" pos="24117" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$add-qs</span>
      <span name="unnested-xquery" pos="24125" class="op">}</span>
      <span name="xml-att-quote" pos="24126" class="z">"</span>
      <span name="x-tag-end" pos="24127" class="z">&gt;</span>
      <span pos="24128" class="txt">&#xD;
    	    			</span>
      <span name="nested-query" pos="24142" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="15" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="37" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="38" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="60" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="61" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="62" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> &#xD;
    	    				</span>
      <span xq="yes" start="81" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="88" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="89" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="92" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="94" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="101" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="102" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="103" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace">&#xD;
    	     				</span>
      <span xq="yes" start="123" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="24266" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24267" class="en">img</span>
      <span name="xml-name-end" pos="24270" class="atn"> src</span>
      <span name="x-equals" pos="24274" class="atneq">=</span>
      <span name="xml-att-quote" pos="24275" class="z">"</span>
      <span name="xml-literal-start" pos="24276" class="av">images/silk/bullet_delete.png</span>
      <span name="xml-att-quote" pos="24305" class="z">"</span>
      <span name="xml-literal-end" pos="24306" class="atn"> class</span>
      <span name="x-equals" pos="24312" class="atneq">=</span>
      <span name="xml-att-quote" pos="24313" class="z">"</span>
      <span name="xml-literal-start" pos="24314" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="24327" class="z">"</span>
      <span name="x-tag-end" pos="24328" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="24331" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24332" class="en">strong</span>
      <span name="x-tag-end" pos="24338" class="z">&gt;</span>
      <span name="nested-query" pos="24339" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="24345" class="op">}</span>
      <span pos="24346" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="24348" class="cl">strong</span>
      <span name="x-tag-end" pos="24354" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span name="unnested-xquery" pos="24394" class="op">}</span>
      <span name="resume-x-literal-txt" pos="24395" class="txt">&#xD;
    	    		</span>
      <span pos="24408" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="24410" class="cl">a</span>
      <span name="x-tag-end" pos="24411" class="z">&gt;</span>
      <span pos="24412" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="24414" class="cl">div</span>
      <span name="x-tag-end" pos="24417" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="19" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="28" prev-is-closed="false" class="variable">$mode</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="35" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="24453" xq="yes">mixed</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
    	    		</span>
      <span pos="24479" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24480" class="en">div</span>
      <span name="x-tag-end" pos="24483" class="z">&gt;</span>
      <span pos="24484" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24485" class="en">a</span>
      <span name="xml-name-end" pos="24486" class="atn"> href</span>
      <span name="x-equals" pos="24491" class="atneq">=</span>
      <span name="xml-att-quote" pos="24492" class="z">"</span>
      <span name="xml-literal-start" pos="24493" class="av">search.xqy?</span>
      <span name="nested-query" pos="24504" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$add-qs</span>
      <span name="unnested-xquery" pos="24512" class="op">}</span>
      <span name="xml-att-quote" pos="24513" class="z">"</span>
      <span name="x-tag-end" pos="24514" class="z">&gt;</span>
      <span pos="24515" class="txt">&#xD;
    	    			</span>
      <span name="nested-query" pos="24529" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="15" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="37" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="38" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="60" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="61" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="62" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> &#xD;
    	    				</span>
      <span xq="yes" start="81" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="88" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="89" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="92" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="94" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="101" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="102" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="103" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace">&#xD;
    	     				</span>
      <span xq="yes" start="123" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="24653" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24654" class="en">img</span>
      <span name="xml-name-end" pos="24657" class="atn"> src</span>
      <span name="x-equals" pos="24661" class="atneq">=</span>
      <span name="xml-att-quote" pos="24662" class="z">"</span>
      <span name="xml-literal-start" pos="24663" class="av">images/silk/bullet_delete.png</span>
      <span name="xml-att-quote" pos="24692" class="z">"</span>
      <span name="xml-literal-end" pos="24693" class="atn"> class</span>
      <span name="x-equals" pos="24699" class="atneq">=</span>
      <span name="xml-att-quote" pos="24700" class="z">"</span>
      <span name="xml-literal-start" pos="24701" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="24714" class="z">"</span>
      <span name="x-tag-end" pos="24715" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="24718" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24719" class="en">strong</span>
      <span name="x-tag-end" pos="24725" class="z">&gt;</span>
      <span name="nested-query" pos="24726" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="24732" class="op">}</span>
      <span pos="24733" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="24735" class="cl">strong</span>
      <span name="x-tag-end" pos="24741" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span name="unnested-xquery" pos="24781" class="op">}</span>
      <span name="resume-x-literal-txt" pos="24782" class="txt">&#xD;
    	    		</span>
      <span pos="24795" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="24797" class="cl">a</span>
      <span name="x-tag-end" pos="24798" class="z">&gt;</span>
      <span name="nested-query" pos="24799" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="24800" xq="yes"> </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="24803" class="op">}</span>
      <span pos="24804" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24805" class="en">a</span>
      <span name="xml-name-end" pos="24806" class="atn"> href</span>
      <span name="x-equals" pos="24811" class="atneq">=</span>
      <span name="xml-att-quote" pos="24812" class="z">"</span>
      <span name="xml-literal-start" pos="24813" class="av">search.xqy?</span>
      <span name="nested-query" pos="24824" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$one-qs</span>
      <span name="unnested-xquery" pos="24832" class="op">}</span>
      <span name="xml-att-quote" pos="24833" class="z">"</span>
      <span name="x-tag-end" pos="24834" class="z">&gt;</span>
      <span pos="24835" class="txt">(only)</span>
      <span pos="24841" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="24843" class="cl">a</span>
      <span name="x-tag-end" pos="24844" class="z">&gt;</span>
      <span pos="24845" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="24847" class="cl">div</span>
      <span name="x-tag-end" pos="24850" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="19" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace">&#xD;
    	    		</span>
      <span pos="24886" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24887" class="en">div</span>
      <span name="x-tag-end" pos="24890" class="z">&gt;</span>
      <span pos="24891" class="es">&lt;</span>
      <span name="xml-open-tag" pos="24892" class="en">a</span>
      <span name="xml-name-end" pos="24893" class="atn"> href</span>
      <span name="x-equals" pos="24898" class="atneq">=</span>
      <span name="xml-att-quote" pos="24899" class="z">"</span>
      <span name="xml-literal-start" pos="24900" class="av">search.xqy?</span>
      <span name="nested-query" pos="24911" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$one-qs</span>
      <span name="unnested-xquery" pos="24919" class="op">}</span>
      <span name="xml-att-quote" pos="24920" class="z">"</span>
      <span name="x-tag-end" pos="24921" class="z">&gt;</span>
      <span pos="24922" class="txt">&#xD;
    	    			</span>
      <span name="nested-query" pos="24936" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="15" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="37" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="38" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="60" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="61" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="62" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> &#xD;
    	    				</span>
      <span xq="yes" start="81" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="88" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="89" prev-is-closed="false" class="qname">val</span>
      <span xq="yes" start="92" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="94" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="101" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="102" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="103" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace">&#xD;
    	     				</span>
      <span xq="yes" start="123" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="25060" class="es">&lt;</span>
      <span name="xml-open-tag" pos="25061" class="en">img</span>
      <span name="xml-name-end" pos="25064" class="atn"> src</span>
      <span name="x-equals" pos="25068" class="atneq">=</span>
      <span name="xml-att-quote" pos="25069" class="z">"</span>
      <span name="xml-literal-start" pos="25070" class="av">images/silk/bullet_black.png</span>
      <span name="xml-att-quote" pos="25098" class="z">"</span>
      <span name="xml-literal-end" pos="25099" class="atn"> class</span>
      <span name="x-equals" pos="25105" class="atneq">=</span>
      <span name="xml-att-quote" pos="25106" class="z">"</span>
      <span name="xml-literal-start" pos="25107" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="25120" class="z">"</span>
      <span name="x-tag-end" pos="25121" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="25124" class="es">&lt;</span>
      <span name="xml-open-tag" pos="25125" class="en">strong</span>
      <span name="x-tag-end" pos="25131" class="z">&gt;</span>
      <span name="nested-query" pos="25132" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="25138" class="op">}</span>
      <span pos="25139" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="25141" class="cl">strong</span>
      <span name="x-tag-end" pos="25147" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span name="unnested-xquery" pos="25187" class="op">}</span>
      <span name="resume-x-literal-txt" pos="25188" class="txt">&#xD;
    	    		</span>
      <span pos="25201" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="25203" class="cl">a</span>
      <span name="x-tag-end" pos="25204" class="z">&gt;</span>
      <span pos="25205" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="25207" class="cl">div</span>
      <span name="x-tag-end" pos="25210" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                &#xD;
	    	</span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="33" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace">&#xD;
 		</span>
      <span name="unnested-xquery" pos="25249" class="op">}</span>
      <span name="resume-x-literal-txt" pos="25250" class="txt">&#xD;
 		</span>
      <span pos="25255" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="25257" class="cl">div</span>
      <span name="x-tag-end" pos="25260" class="z">&gt;</span>
      <span pos="25261" class="txt">&#xD;
 	</span>
      <span pos="25265" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="25267" class="cl">div</span>
      <span name="x-tag-end" pos="25270" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">value-heatmap</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="38" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="48" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="57" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="58" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="59" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="60" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="69" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="78" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="90" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="91" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="92" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="95" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="96" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="104" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="105" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="106" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="108" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="109" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="112" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="116" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="122" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="123" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="134" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="135" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="136" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="140" prev-is-closed="false" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="147" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="150" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="151" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="157" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="158" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="160" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="161" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="171" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="177" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="178" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="194" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="195" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="208" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="209" prev-is-closed="false" class="qname">search:title</span>
      <span xq="yes" start="221" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="222" prev-is-closed="true" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="229" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="232" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="233" prev-is-closed="false" class="variable">$icon</span>
      <span xq="yes" start="238" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="239" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="241" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="242" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="252" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="258" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="259" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="275" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="276" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="289" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="290" prev-is-closed="false" class="qname">search:icon</span>
      <span xq="yes" start="301" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="302" prev-is-closed="true" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="309" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="312" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="313" prev-is-closed="false" class="variable">$all-count</span>
      <span xq="yes" start="323" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="324" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="326" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="327" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="337" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="338" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="339" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="341" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="342" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="348" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="349" prev-is-closed="false" class="qname">search:all</span>
      <span xq="yes" start="359" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="360" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="361" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="366" prev-is-closed="true" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="373" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="376" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="377" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="387" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="388" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="390" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="391" prev-is-closed="false" class="type-name">xs:integer*</span>
      <span xq="yes" start="402" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="403" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="405" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="406" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="412" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="413" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="424" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="425" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="426" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="431" prev-is-closed="true" class="whitespace">&#xD;
    	</span>
      <span xq="yes" start="438" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="441" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="442" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="452" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="453" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="455" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="456" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="466" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="467" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="468" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="470" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="471" prev-is-closed="false" class="function">fn:max</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="478" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="488" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="489" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="499" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="502" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="503" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="514" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="515" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="517" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="25788" xq="yes">hval</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="54" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="25849" xq="yes">p</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="5" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="16" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="46" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="47" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="63" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="64" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="77" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="78" prev-is-closed="false" class="qname">search:qs-id</span>
      <span xq="yes" start="90" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="91" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="101" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="104" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="105" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="118" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="121" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="122" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="132" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="138" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="139" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="25991" xq="yes">:all</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        &#xD;
        </span>
      <span class="comment" pos="26018" xq="yes">(: Value Management :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span class="comment" pos="26050" xq="yes">(: Selects the param values that are within scope of (ie have been returned from) the current facet :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="50" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="51" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="62" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="63" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="64" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="79" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="82" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="83" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="99" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="112" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="113" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="114" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="117" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="118" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="124" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="125" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="128" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="139" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="140" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="146" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="147" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="157" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="163" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="164" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="26316" xq="yes">:</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="9" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="10" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="21" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="24" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="false" class="variable">$passed-vals</span>
      <span xq="yes" start="37" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="38" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="40" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="54" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="62" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="75" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="78" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="79" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="86" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="87" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="91" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="105" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="110" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="111" prev-is-closed="false" class="function">fn:starts-with</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="126" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="130" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="131" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="132" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="138" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="139" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="153" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="159" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="160" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="164" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="174" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="178" prev-is-closed="false" class="variable">$out-of-scope-vals</span>
      <span xq="yes" start="196" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="197" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="199" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="213" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="216" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="217" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="221" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="222" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="224" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="225" prev-is-closed="false" class="variable">$passed-vals</span>
      <span xq="yes" start="237" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="251" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="256" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="257" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="264" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="268" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="269" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="270" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="271" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="282" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="283" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="297" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="303" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="304" prev-is-closed="false" class="variable">$val</span>
      <span xq="yes" start="308" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="318" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="321" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="322" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="329" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="330" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="332" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="346" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="348" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="349" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="350" prev-is-closed="false" class="variable">$out-of-scope-vals</span>
      <span xq="yes" start="368" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="369" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="370" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="374" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="392" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="413" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="420" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="421" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="432" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="433" prev-is-closed="false" class="variable">$out-of-scope-vals</span>
      <span xq="yes" start="451" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="452" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="453" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="454" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="455" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="469" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="473" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="474" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="481" prev-is-closed="true" class="whitespace">&#xD;
        &#xD;
    	</span>
      <span xq="yes" start="498" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="504" prev-is-closed="false" class="whitespace">&#xD;
    	</span>
      <span pos="26829" class="es">&lt;</span>
      <span name="xml-open-tag" pos="26830" class="en">div</span>
      <span name="x-tag-end" pos="26833" class="z">&gt;</span>
      <span pos="26834" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="26848" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$icon</span>
      <span xq="yes" start="10" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="26866" class="es">&lt;</span>
      <span name="xml-open-tag" pos="26867" class="en">img</span>
      <span name="xml-name-end" pos="26870" class="atn"> class</span>
      <span name="x-equals" pos="26876" class="atneq">=</span>
      <span name="xml-att-quote" pos="26877" class="z">"</span>
      <span name="xml-literal-start" pos="26878" class="av">icon</span>
      <span name="xml-att-quote" pos="26882" class="z">"</span>
      <span name="xml-literal-end" pos="26883" class="atn"> src</span>
      <span name="x-equals" pos="26887" class="atneq">=</span>
      <span name="xml-att-quote" pos="26888" class="z">"</span>
      <span name="nested-query" pos="26889" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$icon</span>
      <span name="unnested-xquery" pos="26895" class="op">}</span>
      <span name="xml-att-quote" pos="26896" class="z">"</span>
      <span name="xml-literal-end" pos="26897" class="atn"> </span>
      <span name="x-tag-end" pos="26898" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="26901" xq="yes"> </span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="9" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="26913" class="op">}</span>
      <span pos="26914" class="es">&lt;</span>
      <span name="xml-open-tag" pos="26915" class="en">strong</span>
      <span name="x-tag-end" pos="26921" class="z">&gt;</span>
      <span name="nested-query" pos="26922" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$title</span>
      <span name="unnested-xquery" pos="26929" class="op">}</span>
      <span pos="26930" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="26932" class="cl">strong</span>
      <span name="x-tag-end" pos="26938" class="z">&gt;</span>
      <span pos="26939" class="txt">: &#xD;
            </span>
      <span pos="26955" class="es">&lt;</span>
      <span name="xml-open-tag" pos="26956" class="en">span</span>
      <span name="xml-name-end" pos="26960" class="atn"> class</span>
      <span name="x-equals" pos="26966" class="atneq">=</span>
      <span name="xml-att-quote" pos="26967" class="z">"</span>
      <span name="xml-literal-start" pos="26968" class="av">heatmap</span>
      <span name="xml-att-quote" pos="26975" class="z">"</span>
      <span name="xml-literal-end" pos="26976" class="atn"> xml:space</span>
      <span name="x-equals" pos="26986" class="atneq">=</span>
      <span name="xml-att-quote" pos="26987" class="z">"</span>
      <span name="xml-literal-start" pos="26988" class="av">preserve</span>
      <span name="xml-att-quote" pos="26996" class="z">"</span>
      <span name="x-tag-end" pos="26997" class="z">&gt;</span>
      <span pos="26998" class="txt">&#xD;
    		</span>
      <span name="nested-query" pos="27006" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="27008" xq="yes">(: ALL :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="9" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="48" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="56" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="67" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="68" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="79" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="80" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="93" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="102" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="105" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="106" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="112" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="113" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="115" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="116" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="124" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="130" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="131" prev-is-closed="false" class="qname">search:all</span>
      <span xq="yes" start="141" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="142" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="143" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="148" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="149" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="157" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="160" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="161" prev-is-closed="false" class="variable">$qs</span>
      <span xq="yes" start="164" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="165" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="167" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="168" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="190" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="200" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="201" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="202" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="203" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="204" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="212" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="215" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="216" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="221" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="222" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="224" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="225" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="27251" xq="yes">[CLEAR &amp;raquo;]</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace">			&#xD;
            	</span>
      <span xq="yes" start="34" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="38" prev-is-closed="false" class="function">fn:empty</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="54" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="55" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="59" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="60" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="61" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="63" prev-is-closed="false" class="whitespace">&#xD;
            	    </span>
      <span xq="yes" start="82" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="89" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="96" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="97" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="101" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="102" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="103" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="104" prev-is-closed="false" class="variable">$facet-vals</span>
      <span xq="yes" start="115" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="116" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace">&#xD;
            		</span>
      <span xq="yes" start="135" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="142" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="143" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="147" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="148" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="149" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="150" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="163" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="164" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="165" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="169" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="170" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="171" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="172" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="190" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="194" prev-is-closed="false" class="whitespace"> </span>
      <span pos="27462" class="es">&lt;</span>
      <span name="xml-open-tag" pos="27463" class="en">a</span>
      <span name="xml-name-end" pos="27464" class="atn"> href</span>
      <span name="x-equals" pos="27469" class="atneq">=</span>
      <span name="xml-att-quote" pos="27470" class="z">"</span>
      <span name="xml-literal-start" pos="27471" class="av">search.xqy?</span>
      <span name="nested-query" pos="27482" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$qs</span>
      <span name="unnested-xquery" pos="27486" class="op">}</span>
      <span name="xml-att-quote" pos="27487" class="z">"</span>
      <span name="x-tag-end" pos="27488" class="z">&gt;</span>
      <span pos="27489" class="es">&lt;</span>
      <span name="xml-open-tag" pos="27490" class="en">strong</span>
      <span name="x-tag-end" pos="27496" class="z">&gt;</span>
      <span name="nested-query" pos="27497" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="27503" class="op">}</span>
      <span pos="27504" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="27506" class="cl">strong</span>
      <span name="x-tag-end" pos="27512" class="z">&gt;</span>
      <span pos="27513" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="27515" class="cl">a</span>
      <span name="x-tag-end" pos="27516" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="27531" class="op">}</span>
      <span name="resume-x-literal-txt" pos="27532" class="txt">&#xD;
        	</span>
      <span name="nested-query" pos="27543" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="27545" xq="yes">(: VALUES :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        	</span>
      <span xq="yes" start="12" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="24" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="false" class="function">facet-item-sort</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="41" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="47" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="48" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="59" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="60" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="61" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="67" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="68" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="84" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="85" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="98" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="99" prev-is-closed="false" class="qname">search:sort</span>
      <span xq="yes" start="110" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="111" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="119" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="122" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="123" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="129" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="130" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="132" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="133" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="143" prev-is-closed="false" class="variable">$qs-id</span>
      <span xq="yes" start="149" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="150" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="27707" xq="yes">:</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="8" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="9" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="10" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="15" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="24" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="37" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="38" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="48" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="60" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="65" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="66" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="67" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="72" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="73" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="81" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="84" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="85" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="91" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="93" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="false" class="function">capitalize-first-chars</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="117" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="122" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="123" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="128" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="129" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="130" prev-is-closed="true" class="whitespace">&#xD;
    		</span>
      <span xq="yes" start="138" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="141" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="142" prev-is-closed="false" class="variable">$qs</span>
      <span xq="yes" start="145" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="146" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="148" prev-is-closed="false" class="whitespace">&#xD;
     			</span>
      <span class="comment" pos="27867" xq="yes">(: If the current collection exists in the params, then remove&#xD;
    			   from params, else add to the params :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="10" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="14" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="28" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="29" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="39" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="56" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="57" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="61" prev-is-closed="false" class="whitespace"> &#xD;
    	    		</span>
      <span xq="yes" start="75" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="82" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="83" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="87" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="89" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="90" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="96" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="97" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="102" prev-is-closed="false" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="112" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="134" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="155" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="162" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="163" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="174" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="175" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="181" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="182" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="183" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="184" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="185" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="186" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="187" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="188" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="189" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="190" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="199" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="203" prev-is-closed="false" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="213" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="228" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="229" prev-is-closed="false" class="whitespace">&#xD;
    					</span>
      <span xq="yes" start="240" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="262" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="283" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="290" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="291" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="302" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="303" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="316" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="317" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="318" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="319" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="320" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="321" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="322" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="323" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="324" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="325" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="326" prev-is-closed="false" class="whitespace">&#xD;
    					</span>
      <span xq="yes" start="337" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="347" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="358" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="28337" xq="yes">=</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="function">xdmp:url-encode</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="26" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="28367" xq="yes">&amp;</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        	</span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace">&#xD;
        		</span>
      <span xq="yes" start="31" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="35" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="numeric">0</span>
      <span xq="yes" start="45" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="46" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace">&#xD;
    	    		</span>
      <span xq="yes" start="64" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="28434" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="28438" class="es">&lt;</span>
      <span name="xml-open-tag" pos="28439" class="en">a</span>
      <span name="xml-name-end" pos="28440" class="atn"> href</span>
      <span name="x-equals" pos="28445" class="atneq">=</span>
      <span name="xml-att-quote" pos="28446" class="z">"</span>
      <span name="xml-literal-start" pos="28447" class="av">search.xqy?</span>
      <span name="nested-query" pos="28458" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$qs</span>
      <span name="unnested-xquery" pos="28462" class="op">}</span>
      <span name="xml-att-quote" pos="28463" class="z">"</span>
      <span name="x-tag-end" pos="28464" class="z">&gt;</span>
      <span pos="28465" class="es">&lt;</span>
      <span name="xml-open-tag" pos="28466" class="en">span</span>
      <span name="xml-name-end" pos="28470" class="atn"> title</span>
      <span name="x-equals" pos="28476" class="atneq">=</span>
      <span name="xml-att-quote" pos="28477" class="z">"</span>
      <span name="nested-query" pos="28478" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$count</span>
      <span name="unnested-xquery" pos="28485" class="op">}</span>
      <span name="resume-x-literal" pos="28486" class="av"> documents</span>
      <span name="xml-att-quote" pos="28496" class="z">"</span>
      <span name="xml-literal-end" pos="28497" class="atn"> class</span>
      <span name="x-equals" pos="28503" class="atneq">=</span>
      <span name="xml-att-quote" pos="28504" class="z">"</span>
      <span name="xml-literal-start" pos="28505" class="av">heat</span>
      <span name="nested-query" pos="28509" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">determine-heat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="16" prev-is-closed="false" class="variable">$all-count</span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="38" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="46" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="28556" class="op">}</span>
      <span name="xml-att-quote" pos="28557" class="z">"</span>
      <span name="x-tag-end" pos="28558" class="z">&gt;</span>
      <span pos="28559" class="txt">&#xD;
    	    			</span>
      <span name="nested-query" pos="28573" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="15" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="38" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="39" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="47" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="false" class="variable">$set-selector</span>
      <span xq="yes" start="61" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="62" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="66" prev-is-closed="false" class="whitespace"> &#xD;
    	    				</span>
      <span xq="yes" start="82" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="89" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="90" prev-is-closed="false" class="qname">hval</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="96" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="97" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="103" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="104" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="105" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="109" prev-is-closed="false" class="whitespace">&#xD;
    	     				</span>
      <span xq="yes" start="125" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="28699" class="es">&lt;</span>
      <span name="xml-open-tag" pos="28700" class="en">strong</span>
      <span name="xml-name-end" pos="28706" class="atn"> class</span>
      <span name="x-equals" pos="28712" class="atneq">=</span>
      <span name="xml-att-quote" pos="28713" class="z">"</span>
      <span name="xml-literal-start" pos="28714" class="av">selected</span>
      <span name="xml-att-quote" pos="28722" class="z">"</span>
      <span name="x-tag-end" pos="28723" class="z">&gt;</span>
      <span name="nested-query" pos="28724" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="28730" class="op">}</span>
      <span pos="28731" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="28733" class="cl">strong</span>
      <span name="x-tag-end" pos="28739" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace">&#xD;
    	    			</span>
      <span name="unnested-xquery" pos="28779" class="op">}</span>
      <span name="resume-x-literal-txt" pos="28780" class="txt">&#xD;
    	    		</span>
      <span pos="28793" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="28795" class="cl">span</span>
      <span name="x-tag-end" pos="28799" class="z">&gt;</span>
      <span pos="28800" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="28802" class="cl">a</span>
      <span name="x-tag-end" pos="28803" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    	    	</span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace">&#xD;
     		</span>
      <span name="unnested-xquery" pos="28833" class="op">}</span>
      <span name="resume-x-literal-txt" pos="28834" class="txt">&#xD;
             &#xD;
            </span>
      <span pos="28863" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="28865" class="cl">span</span>
      <span name="x-tag-end" pos="28869" class="z">&gt;</span>
      <span pos="28870" class="txt">&#xD;
     	</span>
      <span pos="28878" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="28880" class="cl">div</span>
      <span name="x-tag-end" pos="28883" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
 	</span>
      <span xq="yes" start="5" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="12" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="15" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="19" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="function">trailing-date-facet</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="55" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="62" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="74" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="75" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="76" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="83" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="84" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="86" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="87" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="95" prev-is-closed="false" class="qname">search:facet</span>
      <span xq="yes" start="107" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="108" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="109" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="110" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="112" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="113" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="121" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="122" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="123" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="125" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="126" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="132" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="135" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="136" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="142" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="143" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="145" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="146" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="156" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="162" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="163" prev-is-closed="false" class="qname">search:facet-def</span>
      <span xq="yes" start="179" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="180" prev-is-closed="false" class="qname">search:custom</span>
      <span xq="yes" start="193" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="194" prev-is-closed="false" class="qname">search:title</span>
      <span xq="yes" start="206" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="207" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="213" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="216" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="217" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="224" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="225" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="227" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="228" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="249" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="256" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="257" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="29141" xq="yes">p</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="5" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span pos="29171" class="es">&lt;</span>
      <span name="xml-open-tag" pos="29172" class="en">div</span>
      <span name="x-tag-end" pos="29175" class="z">&gt;</span>
      <span pos="29176" class="txt">&#xD;
        	</span>
      <span name="nested-query" pos="29187" class="op">{</span>
      <span class="comment" pos="29188" xq="yes">(: Only display the date facets when there is no start and non-valid end fields :)</span>
      <span name="unnested-xquery" pos="29270" class="op">}</span>
      <span name="resume-x-literal-txt" pos="29271" class="txt">&#xD;
    	    </span>
      <span name="nested-query" pos="29282" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$title</span>
      <span xq="yes" start="11" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="12" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span pos="29300" class="es">&lt;</span>
      <span name="xml-open-tag" pos="29301" class="en">h3</span>
      <span name="x-tag-end" pos="29303" class="z">&gt;</span>
      <span name="nested-query" pos="29304" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$title</span>
      <span name="unnested-xquery" pos="29311" class="op">}</span>
      <span pos="29312" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="29314" class="cl">h3</span>
      <span name="x-tag-end" pos="29316" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="29325" class="op">}</span>
      <span name="resume-x-literal-txt" pos="29326" class="txt">&#xD;
            </span>
      <span pos="29340" class="es">&lt;</span>
      <span name="xml-open-tag" pos="29341" class="en">div</span>
      <span name="xml-name-end" pos="29344" class="atn"> class</span>
      <span name="x-equals" pos="29350" class="atneq">=</span>
      <span name="xml-att-quote" pos="29351" class="z">"</span>
      <span name="xml-literal-start" pos="29352" class="av">search_facet</span>
      <span name="xml-att-quote" pos="29364" class="z">"</span>
      <span name="x-tag-end" pos="29365" class="z">&gt;</span>
      <span pos="29366" class="txt">&#xD;
    		</span>
      <span name="nested-query" pos="29374" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span class="comment" pos="29384" xq="yes">(: ALL :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="10" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="24" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="27" prev-is-closed="false" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="37" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="58" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="65" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="66" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="29459" xq="yes">dur</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="5" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="15" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="28" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="29" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="37" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="43" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="44" prev-is-closed="false" class="qname">search:all</span>
      <span xq="yes" start="54" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="55" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="56" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="61" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="62" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="80" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="83" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="84" prev-is-closed="false" class="variable">$qs</span>
      <span xq="yes" start="87" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="90" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="91" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="113" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="123" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="124" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="125" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="126" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="127" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="145" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="148" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="149" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="154" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="155" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="157" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="158" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="29631" xq="yes">All [</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="29646" xq="yes">]</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace">					&#xD;
    				</span>
      <span pos="29680" class="es">&lt;</span>
      <span name="xml-open-tag" pos="29681" class="en">div</span>
      <span name="x-tag-end" pos="29684" class="z">&gt;</span>
      <span pos="29685" class="es">&lt;</span>
      <span name="xml-open-tag" pos="29686" class="en">a</span>
      <span name="xml-name-end" pos="29687" class="atn"> href</span>
      <span name="x-equals" pos="29692" class="atneq">=</span>
      <span name="xml-att-quote" pos="29693" class="z">"</span>
      <span name="xml-literal-start" pos="29694" class="av">search.xqy?</span>
      <span name="nested-query" pos="29705" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$qs</span>
      <span name="unnested-xquery" pos="29709" class="op">}</span>
      <span name="xml-att-quote" pos="29710" class="z">"</span>
      <span name="x-tag-end" pos="29711" class="z">&gt;</span>
      <span pos="29712" class="txt">&#xD;
    				</span>
      <span name="nested-query" pos="29722" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="11" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="function">fn:empty</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="31" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="32" prev-is-closed="false" class="qname">dur</span>
      <span xq="yes" start="35" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="36" prev-is-closed="false" class="node">text(</span>
      <span xq="yes" start="41" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="42" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="43" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="49" prev-is-closed="false" class="whitespace">&#xD;
    					</span>
      <span xq="yes" start="60" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="29783" class="es">&lt;</span>
      <span name="xml-open-tag" pos="29784" class="en">img</span>
      <span name="xml-name-end" pos="29787" class="atn"> src</span>
      <span name="x-equals" pos="29791" class="atneq">=</span>
      <span name="xml-att-quote" pos="29792" class="z">"</span>
      <span name="xml-literal-start" pos="29793" class="av">images/silk/bullet_go.png</span>
      <span name="xml-att-quote" pos="29818" class="z">"</span>
      <span name="xml-literal-end" pos="29819" class="atn"> class</span>
      <span name="x-equals" pos="29825" class="atneq">=</span>
      <span name="xml-att-quote" pos="29826" class="z">"</span>
      <span name="xml-literal-start" pos="29827" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="29840" class="z">"</span>
      <span name="x-tag-end" pos="29841" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="29844" class="es">&lt;</span>
      <span name="xml-open-tag" pos="29845" class="en">strong</span>
      <span name="x-tag-end" pos="29851" class="z">&gt;</span>
      <span name="nested-query" pos="29852" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="29858" class="op">}</span>
      <span pos="29859" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="29861" class="cl">strong</span>
      <span name="x-tag-end" pos="29867" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace">&#xD;
    					</span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="32" prev-is-closed="true" class="whitespace">&#xD;
    				</span>
      <span name="unnested-xquery" pos="29909" class="op">}</span>
      <span name="resume-x-literal-txt" pos="29910" class="txt">&#xD;
    				</span>
      <span pos="29920" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="29922" class="cl">a</span>
      <span name="x-tag-end" pos="29923" class="z">&gt;</span>
      <span pos="29924" class="txt">&#xD;
    				</span>
      <span pos="29934" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="29936" class="cl">div</span>
      <span name="x-tag-end" pos="29939" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace">&#xD;
    			</span>
      <span class="comment" pos="29959" xq="yes">(: DURATIONS :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="19" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="28" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="29" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="true" class="variable">$pos</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$facet</span>
      <span xq="yes" start="46" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="47" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="67" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="71" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="77" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="78" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="80" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="81" prev-is-closed="false" class="function">xs:duration</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="93" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="98" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="99" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="100" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="105" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="106" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="115" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="118" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="false" class="variable">$desc</span>
      <span xq="yes" start="124" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="125" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="128" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="138" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="143" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="144" prev-is-closed="true" class="whitespace">&#xD;
    			</span>
      <span xq="yes" start="153" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="156" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="157" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="167" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="168" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="170" prev-is-closed="false" class="whitespace">&#xD;
    				</span>
      <span xq="yes" start="180" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="201" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="208" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="209" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="30183" xq="yes">dur</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span pos="30190" class="es">&lt;</span>
      <span name="xml-open-tag" pos="30191" class="en">dur</span>
      <span name="x-tag-end" pos="30194" class="z">&gt;</span>
      <span name="nested-query" pos="30195" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$value</span>
      <span name="unnested-xquery" pos="30202" class="op">}</span>
      <span pos="30203" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="30205" class="cl">dur</span>
      <span name="x-tag-end" pos="30208" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="20" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="false" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="42" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="47" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="48" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="49" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="54" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="55" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="73" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="76" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="false" class="variable">$qs</span>
      <span xq="yes" start="80" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="81" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="83" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="84" prev-is-closed="false" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="106" prev-is-closed="false" class="variable">$newParams</span>
      <span xq="yes" start="116" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="117" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="118" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="119" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="120" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="138" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="141" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="142" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="147" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="148" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="150" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="151" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="161" prev-is-closed="false" class="variable">$desc</span>
      <span xq="yes" start="166" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="167" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="30376" xq="yes"> [</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="30388" xq="yes">]</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">			&#xD;
                    </span>
      <span pos="30441" class="es">&lt;</span>
      <span name="xml-open-tag" pos="30442" class="en">div</span>
      <span name="x-tag-end" pos="30445" class="z">&gt;</span>
      <span pos="30446" class="es">&lt;</span>
      <span name="xml-open-tag" pos="30447" class="en">a</span>
      <span name="xml-name-end" pos="30448" class="atn"> href</span>
      <span name="x-equals" pos="30453" class="atneq">=</span>
      <span name="xml-att-quote" pos="30454" class="z">"</span>
      <span name="xml-literal-start" pos="30455" class="av">search.xqy?</span>
      <span name="nested-query" pos="30466" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$qs</span>
      <span name="unnested-xquery" pos="30470" class="op">}</span>
      <span name="xml-att-quote" pos="30471" class="z">"</span>
      <span name="x-tag-end" pos="30472" class="z">&gt;</span>
      <span pos="30473" class="txt">&#xD;
                        </span>
      <span name="nested-query" pos="30499" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="27" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="31" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="38" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="39" prev-is-closed="false" class="qname">dur</span>
      <span xq="yes" start="42" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="false" class="variable">$value</span>
      <span xq="yes" start="51" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="52" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace">&#xD;
                         	</span>
      <span xq="yes" start="85" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="30585" class="es">&lt;</span>
      <span name="xml-open-tag" pos="30586" class="en">img</span>
      <span name="xml-name-end" pos="30589" class="atn"> src</span>
      <span name="x-equals" pos="30593" class="atneq">=</span>
      <span name="xml-att-quote" pos="30594" class="z">"</span>
      <span name="xml-literal-start" pos="30595" class="av">images/silk/bullet_go.png</span>
      <span name="xml-att-quote" pos="30620" class="z">"</span>
      <span name="xml-literal-end" pos="30621" class="atn"> class</span>
      <span name="x-equals" pos="30627" class="atneq">=</span>
      <span name="xml-att-quote" pos="30628" class="z">"</span>
      <span name="xml-literal-start" pos="30629" class="av">selected_icon</span>
      <span name="xml-att-quote" pos="30642" class="z">"</span>
      <span name="x-tag-end" pos="30643" class="z">/&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="30646" class="es">&lt;</span>
      <span name="xml-open-tag" pos="30647" class="en">strong</span>
      <span name="x-tag-end" pos="30653" class="z">&gt;</span>
      <span name="nested-query" pos="30654" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$link</span>
      <span name="unnested-xquery" pos="30660" class="op">}</span>
      <span pos="30661" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="30663" class="cl">strong</span>
      <span name="x-tag-end" pos="30669" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="32" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="33" prev-is-closed="false" class="variable">$link</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span name="unnested-xquery" pos="30733" class="op">}</span>
      <span name="resume-x-literal-txt" pos="30734" class="txt">&#xD;
                    </span>
      <span pos="30756" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="30758" class="cl">a</span>
      <span name="x-tag-end" pos="30759" class="z">&gt;</span>
      <span pos="30760" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="30762" class="cl">div</span>
      <span name="x-tag-end" pos="30765" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="30780" class="op">}</span>
      <span name="resume-x-literal-txt" pos="30781" class="txt">&#xD;
    		</span>
      <span pos="30789" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="30791" class="cl">div</span>
      <span name="x-tag-end" pos="30794" class="z">&gt;</span>
      <span pos="30795" class="txt">&#xD;
        </span>
      <span pos="30805" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="30807" class="cl">div</span>
      <span name="x-tag-end" pos="30810" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">determine-heat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="45" prev-is-closed="false" class="variable">$all-count</span>
      <span xq="yes" start="55" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="58" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="76" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="86" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="87" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="89" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="90" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="107" prev-is-closed="false" class="variable">$item-count</span>
      <span xq="yes" start="118" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="121" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="122" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="132" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="133" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="134" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="136" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="137" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="147" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="149" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="150" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span class="comment" pos="30966" xq="yes">(: With this formula, an item can range from 0-67% :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span class="comment" pos="31025" xq="yes">(: Lower ranges are wider than higher ranges :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$comp-num</span>
      <span xq="yes" start="20" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="38" prev-is-closed="false" class="variable">$all-count</span>
      <span xq="yes" start="48" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="true" class="op">*</span>
      <span xq="yes" start="50" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="false" class="numeric">.5</span>
      <span xq="yes" start="53" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="54" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="60" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="63" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="64" prev-is-closed="false" class="variable">$item-pct</span>
      <span xq="yes" start="73" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="74" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="76" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="false" class="variable">$item-count</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="true" class="op">div</span>
      <span xq="yes" start="92" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="false" class="variable">$comp-num</span>
      <span xq="yes" start="102" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="108" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="111" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="false" class="variable">$max-pct</span>
      <span xq="yes" start="120" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="121" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="123" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="124" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="134" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="135" prev-is-closed="true" class="op">div</span>
      <span xq="yes" start="138" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="139" prev-is-closed="false" class="variable">$comp-num</span>
      <span xq="yes" start="148" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="154" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="157" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="158" prev-is-closed="false" class="variable">$xfrm-pct</span>
      <span xq="yes" start="167" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="168" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="170" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="171" prev-is-closed="false" class="variable">$item-pct</span>
      <span xq="yes" start="180" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="181" prev-is-closed="true" class="op">div</span>
      <span xq="yes" start="184" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="185" prev-is-closed="false" class="variable">$max-pct</span>
      <span xq="yes" start="193" prev-is-closed="true" class="whitespace"> &#xD;
    </span>
      <span xq="yes" start="200" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="206" prev-is-closed="false" class="whitespace">&#xD;
    &#xD;
    </span>
      <span class="comment" pos="31289" xq="yes">(: apply specific controls :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span class="comment" pos="31324" xq="yes">(: These are a hack for now. Will need to tune this later :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$item-count</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="45" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="46" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> &#xD;
        </span>
      <span xq="yes" start="62" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="63" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="73" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="74" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="76" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="78" prev-is-closed="false" class="variable">$all-count</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="91" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="92" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="93" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="variable">$max-count</span>
      <span xq="yes" start="108" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="109" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="110" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="111" prev-is-closed="false" class="variable">$item-count</span>
      <span xq="yes" start="122" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="123" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="124" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="128" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="138" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="139" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="145" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="149" prev-is-closed="false" class="whitespace">&#xD;
    &#xD;
    </span>
      <span xq="yes" start="161" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="163" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="164" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="165" prev-is-closed="false" class="variable">$xfrm-pct</span>
      <span xq="yes" start="174" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="175" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="178" prev-is-closed="false" class="numeric">.25</span>
      <span xq="yes" start="181" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="182" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="183" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="187" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="197" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="198" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="204" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="208" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="209" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="211" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="212" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="213" prev-is-closed="false" class="variable">$xfrm-pct</span>
      <span xq="yes" start="222" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="223" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="225" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="226" prev-is-closed="false" class="numeric">.46</span>
      <span xq="yes" start="229" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="230" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="231" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="235" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="245" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="246" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="252" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="256" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="257" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="259" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="260" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="261" prev-is-closed="false" class="variable">$xfrm-pct</span>
      <span xq="yes" start="270" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="271" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="273" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="274" prev-is-closed="false" class="numeric">.63</span>
      <span xq="yes" start="277" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="278" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="279" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="283" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="293" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="294" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="300" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="304" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="305" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="307" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="308" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="309" prev-is-closed="false" class="variable">$xfrm-pct</span>
      <span xq="yes" start="318" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="319" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="321" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="322" prev-is-closed="false" class="numeric">.77</span>
      <span xq="yes" start="325" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="326" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="327" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="331" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="341" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="342" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="348" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="352" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="353" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="355" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="356" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="357" prev-is-closed="false" class="variable">$xfrm-pct</span>
      <span xq="yes" start="366" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="367" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="369" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="370" prev-is-closed="false" class="numeric">.89</span>
      <span xq="yes" start="373" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="374" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="375" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="379" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="389" prev-is-closed="false" class="numeric">5</span>
      <span xq="yes" start="390" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="396" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="400" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="401" prev-is-closed="false" class="numeric">6</span>
      <span xq="yes" start="402" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="404" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="405" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="409" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="415" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="416" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="424" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="425" prev-is-closed="true" class="function">facet-item-sort</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="441" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="447" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="448" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="450" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="451" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="459" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="470" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="471" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="472" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="473" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="474" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="479" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="480" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="482" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="483" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="492" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="493" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="494" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="495" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="497" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="498" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="506" prev-is-closed="false" class="qname">search:item</span>
      <span xq="yes" start="517" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="518" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="519" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="521" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="522" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="528" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="530" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="531" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="532" prev-is-closed="false" class="function">fn:lower-case</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="546" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="551" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="552" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="553" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="554" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="31938" xq="yes">name-asc</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="17" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="46" prev-is-closed="true" class="type-op">order by</span>
      <span xq="yes" start="54" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="false" class="node-type">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="65" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="70" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="71" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="72" prev-is-closed="true" class="qname">ascending</span>
      <span xq="yes" start="81" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="91" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="103" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="109" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="113" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="114" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="116" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="118" prev-is-closed="false" class="function">fn:lower-case</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="132" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="137" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="138" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="139" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="140" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="32088" xq="yes">name-desc</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="17" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="46" prev-is-closed="true" class="type-op">order by</span>
      <span xq="yes" start="54" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="false" class="node-type">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="65" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="70" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="71" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="72" prev-is-closed="true" class="qname">descending</span>
      <span xq="yes" start="82" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="92" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="98" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="99" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="104" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="110" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="117" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="118" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="119" prev-is-closed="false" class="function">fn:lower-case</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="133" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="138" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="139" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="140" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="141" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="32240" xq="yes">count</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="17" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="46" prev-is-closed="true" class="type-op">order by</span>
      <span xq="yes" start="54" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="false" class="node-type">xs:integer</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="66" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="71" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="72" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="73" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="78" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="79" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="80" prev-is-closed="true" class="qname">descending</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="106" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="107" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="112" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="118" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="122" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="132" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="138" prev-is-closed="true" class="whitespace">        &#xD;
</span>
      <span xq="yes" start="148" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="149" prev-is-closed="true" class="whitespace"> &#xD;
&#xD;
</span>
      <span class="comment" pos="32400" xq="yes">(: Highlighting functions :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="32432" xq="yes">(:~&#xD;
:&#xD;
: (Public) Will highlight a node based on the full-text search inside&#xD;
: a search-criteria. Compatible with the create-snippet and create-summary functions.&#xD;
:&#xD;
: @param $node The node to be highlighted&#xD;
: @param $query The search-criteria to be used to perform the highlighting.&#xD;
: @return The highlighted node. If not highlighting query can be built, then returns nothing.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">highlight</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="29" prev-is-closed="false" class="variable">$node</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="37" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="38" prev-is-closed="false" class="node-type">node</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="44" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="45" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="52" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="64" prev-is-closed="false" class="qname">search:search-criteria</span>
      <span xq="yes" start="86" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="87" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="91" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="92" prev-is-closed="false" class="node-type">node</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="97" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="98" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="99" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="101" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="102" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="105" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="108" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="109" prev-is-closed="false" class="variable">$highlight-query</span>
      <span xq="yes" start="125" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="126" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="128" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="129" prev-is-closed="false" class="function">create-highlight-query</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="152" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="158" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="159" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="165" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="171" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="181" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="183" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="184" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="185" prev-is-closed="false" class="variable">$highlight-query</span>
      <span xq="yes" start="201" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="202" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="203" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="207" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="221" prev-is-closed="false" class="function">cts:highlight</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="235" prev-is-closed="false" class="variable">$node</span>
      <span xq="yes" start="240" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="241" prev-is-closed="false" class="variable">$highlight-query</span>
      <span xq="yes" start="257" prev-is-closed="true" class="op">,</span>
      <span pos="33075" class="es">&lt;</span>
      <span name="xml-open-tag" pos="33076" class="en">span</span>
      <span name="xml-name-end" pos="33080" class="atn"> class</span>
      <span name="x-equals" pos="33086" class="atneq">=</span>
      <span name="xml-att-quote" pos="33087" class="z">"</span>
      <span name="xml-literal-start" pos="33088" class="av">ml-highlight</span>
      <span name="xml-att-quote" pos="33100" class="z">"</span>
      <span name="x-tag-end" pos="33101" class="z">&gt;</span>
      <span name="nested-query" pos="33102" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$cts:text</span>
      <span name="unnested-xquery" pos="33112" class="op">}</span>
      <span pos="33113" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="33115" class="cl">span</span>
      <span name="x-tag-end" pos="33119" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="19" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="21" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="33145" xq="yes">(:~&#xD;
:&#xD;
: (Public) Builds a cts:query from a search-criteria element suitable for highlighting a node. &#xD;
:&#xD;
: @param $query The search-criteria to be used to perform the highlighting.&#xD;
: @return The highlight query. If not highlighting query can be built, then returns nothing.&#xD;
:)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">create-highlight-query</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="42" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="48" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="60" prev-is-closed="false" class="qname">search:search-criteria</span>
      <span xq="yes" start="82" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="83" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="84" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="85" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="87" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="false" class="type-name">cts:query</span>
      <span xq="yes" start="97" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="98" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="107" prev-is-closed="false" class="function">search:build-term-query</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="131" prev-is-closed="false" class="function">search:resolve</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="146" prev-is-closed="false" class="variable">$query</span>
      <span xq="yes" start="152" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="153" prev-is-closed="false" class="qname">search:term</span>
      <span xq="yes" start="164" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="165" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="166" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="168" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="169" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="33598" xq="yes">(: Search snippet functions :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="33632" xq="yes">(:~&#xD;
:&#xD;
: (Public) Renders a search result summary, which can be either the abstract of the document or&#xD;
: snippets of the document if it has been highlighted as a result of a full-text search.&#xD;
: If snippets are available, then a click-and-zoom link can also be enabled. To enable click-and-zoom&#xD;
: there must be a page that can handle a request in the format:&#xD;
: &#xD;
: request.xqy?action=show-section&amp;uri=[*]&amp;path=[*]&#xD;
: &#xD;
: The function sdis:show-section (below), can then be called to fullfil the request.&#xD;
:&#xD;
: @param $orig-node The original document. Should be an active reference to a node in the&#xD;
    repository and not dynamically constructed.&#xD;
: @param $snippet-node A highligted node, that contains the portions of the original&#xD;
    document that should be snippeted. A common design pattern is to pass only the body&#xD;
    of an article as the $snippet-node.&#xD;
: @param $default-summary If a snippet-node is not included, or nothing was highlighted,&#xD;
    then this variable will be used. This commonly is the first 1 or 2 paragraphs or the&#xD;
    abstract of a document.&#xD;
: @return A rendered HTML summary or snippet interface.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">create-summary</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="34" prev-is-closed="false" class="variable">$orig-node</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="47" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="false" class="node-type">node</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="53" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="54" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="false" class="variable">$snippet-node</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="72" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="73" prev-is-closed="false" class="node-type">node</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="78" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="79" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="80" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="81" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="82" prev-is-closed="false" class="variable">$default-summary</span>
      <span xq="yes" start="98" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="99" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="102" prev-is-closed="false" class="type">item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="107" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="108" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="109" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="110" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="111" prev-is-closed="false" class="variable">$do-zoom</span>
      <span xq="yes" start="119" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="122" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="123" prev-is-closed="false" class="type-name">xs:boolean</span>
      <span xq="yes" start="133" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="134" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="135" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="137" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="138" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="146" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="147" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="148" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="150" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="151" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="154" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="157" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="158" prev-is-closed="false" class="variable">$uri</span>
      <span xq="yes" start="162" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="163" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="165" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="166" prev-is-closed="false" class="function">xdmp:node-uri</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="180" prev-is-closed="false" class="variable">$orig-node</span>
      <span xq="yes" start="190" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="191" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="194" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="197" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="198" prev-is-closed="false" class="variable">$snippets</span>
      <span xq="yes" start="207" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="208" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="210" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="211" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="213" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="214" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="215" prev-is-closed="false" class="variable">$snippet-node</span>
      <span xq="yes" start="228" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="229" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="230" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="234" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="235" prev-is-closed="false" class="function">create-snippets</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="251" prev-is-closed="false" class="variable">$snippet-node</span>
      <span xq="yes" start="264" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="265" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="266" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="270" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="271" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="272" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="273" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="276" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="279" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="280" prev-is-closed="false" class="variable">$summary</span>
      <span xq="yes" start="288" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="289" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="291" prev-is-closed="false" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="295" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="297" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="298" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="299" prev-is-closed="false" class="function">fn:exists</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="309" prev-is-closed="false" class="variable">$snippets</span>
      <span xq="yes" start="318" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="319" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="320" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="321" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="325" prev-is-closed="false" class="whitespace">&#xD;
			</span>
      <span xq="yes" start="330" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="35098" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35099" class="en">p</span>
      <span name="xml-name-end" pos="35100" class="atn"> class</span>
      <span name="x-equals" pos="35106" class="atneq">=</span>
      <span name="xml-att-quote" pos="35107" class="z">"</span>
      <span name="xml-literal-start" pos="35108" class="av">summary</span>
      <span name="xml-att-quote" pos="35115" class="z">"</span>
      <span name="x-tag-end" pos="35116" class="z">&gt;</span>
      <span name="nested-query" pos="35117" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
			</span>
      <span xq="yes" start="6" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="15" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$snippets</span>
      <span xq="yes" start="28" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="29" prev-is-closed="false" class="qname">span</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace">&#xD;
			</span>
      <span xq="yes" start="38" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> &#xD;
			    </span>
      <span xq="yes" start="54" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="56" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="57" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="58" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="65" prev-is-closed="false" class="variable">$do-zoom</span>
      <span xq="yes" start="73" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="74" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="75" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="80" prev-is-closed="false" class="whitespace">&#xD;
    			    </span>
      <span pos="35210" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35211" class="en">span</span>
      <span name="x-tag-end" pos="35215" class="z">&gt;</span>
      <span pos="35216" class="txt">&#xD;
    			    </span>
      <span name="nested-query" pos="35229" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$item</span>
      <span xq="yes" start="6" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="7" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="8" prev-is-closed="false" class="qname">title</span>
      <span name="unnested-xquery" pos="35242" class="op">}</span>
      <span name="resume-x-literal-txt" pos="35243" class="txt">&#xD;
    			    </span>
      <span pos="35256" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35257" class="en">span</span>
      <span name="x-tag-end" pos="35261" class="z">&gt;</span>
      <span pos="35262" class="txt">&#xD;
    			    </span>
      <span name="nested-query" pos="35275" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$item</span>
      <span xq="yes" start="6" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="7" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="12" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="35288" class="op">}</span>
      <span name="resume-x-literal-txt" pos="35289" class="txt">&#xD;
    			    </span>
      <span pos="35302" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35303" class="en">b</span>
      <span name="x-tag-end" pos="35304" class="z">&gt;</span>
      <span pos="35305" class="txt">...</span>
      <span pos="35308" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35310" class="cl">b</span>
      <span name="x-tag-end" pos="35311" class="z">&gt;</span>
      <span pos="35312" class="txt">&amp;nbsp;&#xD;
    				</span>
      <span pos="35328" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35330" class="cl">span</span>
      <span name="x-tag-end" pos="35334" class="z">&gt;</span>
      <span pos="35335" class="txt">&#xD;
    				</span>
      <span pos="35345" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35347" class="cl">span</span>
      <span name="x-tag-end" pos="35351" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
			    </span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace">&#xD;
    			    </span>
      <span pos="35378" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35379" class="en">a</span>
      <span name="xml-name-end" pos="35380" class="atn"> href</span>
      <span name="x-equals" pos="35385" class="atneq">=</span>
      <span name="xml-att-quote" pos="35386" class="z">"</span>
      <span name="xml-literal-start" pos="35387" class="av">javascript:void(0);</span>
      <span name="xml-att-quote" pos="35406" class="z">"</span>
      <span name="xml-literal-end" pos="35407" class="atn"> onmouseout</span>
      <span name="x-equals" pos="35418" class="atneq">=</span>
      <span name="xml-att-quote" pos="35419" class="z">"</span>
      <span name="xml-literal-start" pos="35420" class="av">$('abs_</span>
      <span name="nested-query" pos="35427" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$uri</span>
      <span name="unnested-xquery" pos="35432" class="op">}</span>
      <span name="resume-x-literal" pos="35433" class="av">').addClassName(hideClass);</span>
      <span name="xml-att-quote" pos="35460" class="z">"</span>
      <span name="xml-literal-end" pos="35461" class="atn"> onclick</span>
      <span name="x-equals" pos="35469" class="atneq">=</span>
      <span name="xml-att-quote" pos="35470" class="z">"</span>
      <span name="xml-literal-start" pos="35471" class="av">toggleLoadedContent('abs_</span>
      <span name="nested-query" pos="35496" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:data</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="9" prev-is-closed="false" class="variable">$uri</span>
      <span xq="yes" start="13" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="35510" class="op">}</span>
      <span name="resume-x-literal" pos="35511" class="av">','request.xqy',{{method:'post',postBody:'action=show-section&amp;uri=</span>
      <span name="nested-query" pos="35577" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">xdmp:url-encode</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="variable">$uri</span>
      <span xq="yes" start="21" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="35599" class="op">}</span>
      <span name="resume-x-literal" pos="35600" class="av">&amp;path=</span>
      <span name="nested-query" pos="35606" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="16" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="17" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="18" prev-is-closed="false" class="qname">title</span>
      <span xq="yes" start="23" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="35630" class="op">}</span>
      <span name="resume-x-literal" pos="35631" class="av">',asynchronous:true},true);</span>
      <span name="xml-att-quote" pos="35658" class="z">"</span>
      <span name="x-tag-end" pos="35659" class="z">&gt;</span>
      <span pos="35660" class="txt">&#xD;
    			    </span>
      <span name="nested-query" pos="35673" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$item</span>
      <span xq="yes" start="6" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="7" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="8" prev-is-closed="false" class="qname">title</span>
      <span name="unnested-xquery" pos="35686" class="op">}</span>
      <span name="resume-x-literal-txt" pos="35687" class="txt">&#xD;
    			    </span>
      <span pos="35700" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35701" class="en">span</span>
      <span name="x-tag-end" pos="35705" class="z">&gt;</span>
      <span pos="35706" class="txt">&#xD;
    			    </span>
      <span name="nested-query" pos="35719" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$item</span>
      <span xq="yes" start="6" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="7" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="12" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="35732" class="op">}</span>
      <span name="resume-x-literal-txt" pos="35733" class="txt">&#xD;
    			    </span>
      <span pos="35746" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35747" class="en">b</span>
      <span name="x-tag-end" pos="35748" class="z">&gt;</span>
      <span pos="35749" class="txt">...</span>
      <span pos="35752" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35754" class="cl">b</span>
      <span name="x-tag-end" pos="35755" class="z">&gt;</span>
      <span pos="35756" class="txt">&amp;nbsp;&#xD;
    				</span>
      <span pos="35772" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35774" class="cl">span</span>
      <span name="x-tag-end" pos="35778" class="z">&gt;</span>
      <span pos="35779" class="txt">&#xD;
    				</span>
      <span pos="35789" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35791" class="cl">a</span>
      <span name="x-tag-end" pos="35792" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
			</span>
      <span name="unnested-xquery" pos="35798" class="op">}</span>
      <span pos="35799" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35801" class="cl">p</span>
      <span name="x-tag-end" pos="35802" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="6" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace">&#xD;
		   </span>
      <span xq="yes" start="17" prev-is-closed="false" class="variable">$default-summary</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="45" prev-is-closed="false" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="49" prev-is-closed="false" class="parenthesis">(</span>
      <span pos="35852" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35853" class="en">div</span>
      <span name="xml-name-end" pos="35856" class="atn"> class</span>
      <span name="x-equals" pos="35862" class="atneq">=</span>
      <span name="xml-att-quote" pos="35863" class="z">"</span>
      <span name="xml-literal-start" pos="35864" class="av">summary</span>
      <span name="xml-att-quote" pos="35871" class="z">"</span>
      <span name="x-tag-end" pos="35872" class="z">&gt;</span>
      <span pos="35873" class="txt">&#xD;
		</span>
      <span name="nested-query" pos="35877" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$summary</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="35888" xq="yes"> </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="35891" class="op">}</span>
      <span name="resume-x-literal-txt" pos="35892" class="txt">&#xD;
		</span>
      <span pos="35896" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35898" class="cl">div</span>
      <span name="x-tag-end" pos="35901" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span pos="35913" class="es">&lt;</span>
      <span name="xml-open-tag" pos="35914" class="en">div</span>
      <span name="xml-name-end" pos="35917" class="atn"> id</span>
      <span name="x-equals" pos="35920" class="atneq">=</span>
      <span name="xml-att-quote" pos="35921" class="z">"</span>
      <span name="xml-literal-start" pos="35922" class="av">abs_</span>
      <span name="nested-query" pos="35926" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$uri</span>
      <span name="unnested-xquery" pos="35931" class="op">}</span>
      <span name="xml-att-quote" pos="35932" class="z">"</span>
      <span name="xml-literal-end" pos="35933" class="atn"> class</span>
      <span name="x-equals" pos="35939" class="atneq">=</span>
      <span name="xml-att-quote" pos="35940" class="z">"</span>
      <span name="xml-literal-start" pos="35941" class="av">abstract hidden</span>
      <span name="xml-att-quote" pos="35956" class="z">"</span>
      <span name="x-tag-end" pos="35957" class="z">&gt;</span>
      <span pos="35958" class="txt">|</span>
      <span pos="35959" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="35961" class="cl">div</span>
      <span name="x-tag-end" pos="35964" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="4" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="5" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="35973" xq="yes">(:~&#xD;
:&#xD;
: (Public) Renders snippets based on a highlighted node. The element used for&#xD;
: highlighting should be &lt;span class="ml-highlight"&gt;. sdis:highlight is a great option&#xD;
: as a compatible highlighting function.&#xD;
:&#xD;
: @param $highlighted-node The node highlighted with &lt;span class="ml-highlight"&gt;&#xD;
: @return A &lt;div&gt; containing the rendered snippets.&#xD;
:)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">create-snippets</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="35" prev-is-closed="false" class="variable">$highlighted-node</span>
      <span xq="yes" start="52" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="false" class="node-type">node</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="61" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="62" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="63" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="65" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="66" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="false" class="function">create-snippets</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="83" prev-is-closed="false" class="variable">$highlighted-node</span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="102" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="103" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="104" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="105" prev-is-closed="false" class="numeric">11</span>
      <span xq="yes" start="107" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="108" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="109" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="110" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="36443" xq="yes">(:~&#xD;
:&#xD;
: (Public) Renders snippets based on a highlighted node. The element used for&#xD;
: highlighting should be &lt;span class="ml-highlight"&gt;. sdis:highlight is a great option&#xD;
: as a compatible highlighting function.&#xD;
:&#xD;
: @param $highlighted-node The node highlighted with &lt;span class="ml-highlight"&gt;&#xD;
: @param $max-snippet-matches The total number of snippets that are returned.&#xD;
: @param $truncate-words The total number of words a snippet will contain.&#xD;
: @return A &lt;div&gt; containing the rendered snippets.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">create-snippets</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="35" prev-is-closed="false" class="variable">$highlighted-node</span>
      <span xq="yes" start="52" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="false" class="node-type">node</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="61" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="62" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="63" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="64" prev-is-closed="false" class="variable">$max-snippet-matches</span>
      <span xq="yes" start="84" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="85" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="87" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="98" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="99" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="100" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="115" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="116" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="118" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="129" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="130" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="131" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="133" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="134" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="142" prev-is-closed="false" class="qname">div</span>
      <span xq="yes" start="145" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="146" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="147" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="149" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="150" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="156" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="159" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="160" prev-is-closed="false" class="variable">$matches</span>
      <span xq="yes" start="168" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="169" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="171" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="172" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="173" prev-is-closed="false" class="variable">$highlighted-node</span>
      <span xq="yes" start="190" prev-is-closed="true" class="step">//</span>
      <span xq="yes" start="192" prev-is-closed="false" class="qname">span</span>
      <span xq="yes" start="196" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="197" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="198" prev-is-closed="false" class="qname">class</span>
      <span xq="yes" start="203" prev-is-closed="true" class="op">=</span>
      <span class="op">"</span>
      <span class="literal" pos="37158" xq="yes">ml-highlight</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="4" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="5" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="6" prev-is-closed="true" class="op">to</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="variable">$max-snippet-matches</span>
      <span xq="yes" start="29" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="36" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$hits</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="48" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="58" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="61" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="62" prev-is-closed="false" class="variable">$hit</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="67" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="true" class="variable">$pos</span>
      <span xq="yes" start="74" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="75" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="77" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="78" prev-is-closed="false" class="variable">$matches</span>
      <span xq="yes" start="86" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="87" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="93" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="107" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="108" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="110" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="111" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="112" prev-is-closed="false" class="variable">$pos</span>
      <span xq="yes" start="116" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="true" class="op">gt</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="121" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="122" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="123" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="37299" xq="yes"> ... </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span pos="37316" class="es">&lt;</span>
      <span name="xml-open-tag" pos="37317" class="en">span</span>
      <span name="xml-name-end" pos="37321" class="atn"> title</span>
      <span name="x-equals" pos="37327" class="atneq">=</span>
      <span name="xml-att-quote" pos="37328" class="z">"</span>
      <span name="nested-query" pos="37329" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">xpath</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="7" prev-is-closed="false" class="variable">$hit</span>
      <span xq="yes" start="11" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="12" prev-is-closed="false" class="axis">parent::</span>
      <span xq="yes" start="20" prev-is-closed="false" class="qname">*</span>
      <span xq="yes" start="21" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="37351" class="op">}</span>
      <span name="xml-att-quote" pos="37352" class="z">"</span>
      <span name="xml-literal-end" pos="37353" class="atn"> class</span>
      <span name="x-equals" pos="37359" class="atneq">=</span>
      <span name="xml-att-quote" pos="37360" class="z">"</span>
      <span name="xml-literal-start" pos="37361" class="av">ml-snippet</span>
      <span name="xml-att-quote" pos="37371" class="z">"</span>
      <span name="x-tag-end" pos="37372" class="z">&gt;</span>
      <span name="nested-query" pos="37373" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">truncate-text</span>
      <span class="parenthesis">(</span>
      <span pos="37406" class="es">&lt;</span>
      <span name="xml-open-tag" pos="37407" class="en">span</span>
      <span name="xml-name-end" pos="37411" class="atn"> class</span>
      <span name="x-equals" pos="37417" class="atneq">=</span>
      <span name="xml-att-quote" pos="37418" class="z">"</span>
      <span name="xml-literal-start" pos="37419" class="av">ml-wrapper</span>
      <span name="xml-att-quote" pos="37429" class="z">"</span>
      <span name="x-tag-end" pos="37430" class="z">&gt;</span>
      <span name="nested-query" pos="37431" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">(</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$hit</span>
      <span xq="yes" start="6" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="7" prev-is-closed="false" class="axis">preceding-sibling::</span>
      <span xq="yes" start="26" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="31" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="32" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="33" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="34" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="false" class="variable">$hit</span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="false" class="variable">$hit</span>
      <span xq="yes" start="47" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="48" prev-is-closed="false" class="axis">following-sibling::</span>
      <span xq="yes" start="67" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="72" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="73" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="74" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="75" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="76" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="37508" class="op">}</span>
      <span pos="37509" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="37511" class="cl">span</span>
      <span name="x-tag-end" pos="37515" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="18" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="19" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="37548" class="op">}</span>
      <span pos="37549" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="37551" class="cl">span</span>
      <span name="x-tag-end" pos="37555" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="20" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$hits</span>
      <span xq="yes" start="29" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="35" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span pos="37600" class="es">&lt;</span>
      <span name="xml-open-tag" pos="37601" class="en">div</span>
      <span name="xml-name-end" pos="37604" class="atn"> class</span>
      <span name="x-equals" pos="37610" class="atneq">=</span>
      <span name="xml-att-quote" pos="37611" class="z">"</span>
      <span name="xml-literal-start" pos="37612" class="av">snippets</span>
      <span name="xml-att-quote" pos="37620" class="z">"</span>
      <span name="x-tag-end" pos="37621" class="z">&gt;</span>
      <span name="nested-query" pos="37622" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$hits</span>
      <span name="unnested-xquery" pos="37628" class="op">}</span>
      <span pos="37629" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="37631" class="cl">div</span>
      <span name="x-tag-end" pos="37634" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="22" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="25" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="37664" xq="yes">(: In order for this function to work properly, you must declare all the&#xD;
namespaces used in your content at the top of this file :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">xpath</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="25" prev-is-closed="false" class="variable">$node</span>
      <span xq="yes" start="30" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="false" class="node-type">node</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="39" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="40" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="43" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="50" prev-is-closed="false" class="function">xdmp:path</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="60" prev-is-closed="false" class="variable">$node</span>
      <span xq="yes" start="65" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="68" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="37868" xq="yes">(:~&#xD;
:&#xD;
: Returns the configured number of words before and after the highlight term.&#xD;
:&#xD;
: @param $x An item to be trucated.&#xD;
: @return The truncated text.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">truncate-text</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="33" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="type">item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="62" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="false" class="type-name">xs:integer</span>
      <span xq="yes" start="76" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="77" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="78" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="80" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="81" prev-is-closed="false" class="type">item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="86" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="87" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="90" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="91" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="97" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="99" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="100" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="101" prev-is-closed="false" class="function">fn:empty</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="110" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="112" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="113" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="114" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="121" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="122" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="123" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace">&#xD;
       </span>
      <span xq="yes" start="136" prev-is-closed="false" class="function">typeswitch</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="147" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="149" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="150" prev-is-closed="true" class="whitespace">&#xD;
       </span>
      <span xq="yes" start="159" prev-is-closed="true" class="qname">case</span>
      <span xq="yes" start="163" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="164" prev-is-closed="true" class="node">text(</span>
      <span xq="yes" start="169" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="170" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="171" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span class="comment" pos="38218" xq="yes">(: is there a highlight node before? :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
             </span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="24" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="25" prev-is-closed="false" class="axis">preceding-sibling::</span>
      <span xq="yes" start="44" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="49" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="50" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="51" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="52" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="53" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="54" prev-is-closed="false" class="axis">self::</span>
      <span xq="yes" start="60" prev-is-closed="false" class="qname">span</span>
      <span xq="yes" start="64" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="65" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="66" prev-is-closed="false" class="qname">class</span>
      <span xq="yes" start="71" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="72" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="73" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="38330" xq="yes">ml-highlight</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="comment" pos="38376" xq="yes">(: if so, print the first $g_num words :)</span>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="27" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="41" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="false" class="function">cts:tokenize</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="55" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="57" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="84" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="87" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="function">fn:count</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="107" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="114" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="115" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="141" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="144" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="145" prev-is-closed="false" class="variable">$truncateTokens</span>
      <span xq="yes" start="160" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="161" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="163" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="164" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="166" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="167" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="168" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="169" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="175" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="176" prev-is-closed="true" class="op">&lt;</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="178" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="193" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="194" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="195" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="38612" xq="yes">(: &gt; :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                                          </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="49" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="50" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="59" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="60" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="61" prev-is-closed="true" class="whitespace">&#xD;
                                          </span>
      <span xq="yes" start="105" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="109" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="110" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="111" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="119" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="120" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="121" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="122" prev-is-closed="true" class="op">to</span>
      <span xq="yes" start="124" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="125" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="140" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="141" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="142" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="143" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="169" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="175" prev-is-closed="false" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="201" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="203" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="204" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="205" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="206" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="212" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="213" prev-is-closed="true" class="op">&lt;</span>
      <span xq="yes" start="214" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="215" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="230" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="231" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="232" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="38851" xq="yes">(: &gt; :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span class="comment" pos="38891" xq="yes">(: is there a highlight node after? :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                              </span>
      <span xq="yes" start="33" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="35" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="37" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="38" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="40" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="41" prev-is-closed="false" class="axis">following-sibling::</span>
      <span xq="yes" start="60" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="65" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="66" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="67" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="68" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="69" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="70" prev-is-closed="false" class="axis">self::</span>
      <span xq="yes" start="76" prev-is-closed="false" class="qname">span</span>
      <span xq="yes" start="80" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="81" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="82" prev-is-closed="false" class="qname">class</span>
      <span xq="yes" start="87" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="89" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="39018" xq="yes">ml-highlight</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
                              </span>
      <span xq="yes" start="36" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="40" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span>
      <span class="comment" pos="39074" xq="yes">(: if there is a highlight node after, we do&#xD;
                                        not want to double count it :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="whitespace">&#xD;
                              </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="41" prev-is-closed="false" class="whitespace">&#xD;
                                </span>
      <span xq="yes" start="75" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="85" prev-is-closed="false" class="whitespace">&#xD;
                   </span>
      <span class="comment" pos="39295" xq="yes">(: If the first token is punctuation, then no space before :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="36" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="47" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="48" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="49" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="50" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="true" class="type-op">instance of</span>
      <span xq="yes" start="62" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="false" class="type-name">cts:punctuation</span>
      <span xq="yes" start="78" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="79" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="80" prev-is-closed="true" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="115" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="39476" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="37" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="41" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="39520" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="39550" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
                             </span>
      <span xq="yes" start="35" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="38" prev-is-closed="true" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="64" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="68" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="69" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="71" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="81" prev-is-closed="false" class="whitespace">&#xD;
                     </span>
      <span class="comment" pos="39655" xq="yes">(: If the first token is punctuation, then no space before :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="36" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$truncateTokens</span>
      <span xq="yes" start="55" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="56" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="57" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="true" class="type-op">instance of</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="71" prev-is-closed="false" class="type-name">cts:punctuation</span>
      <span xq="yes" start="86" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="87" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="123" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="128" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="39844" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="37" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="41" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="39888" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$truncateTokens</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="37" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="39928" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
                                      </span>
      <span class="op">"</span>
      <span class="literal" pos="39972" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                             </span>
      <span xq="yes" start="33" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace">&#xD;
                      </span>
      <span xq="yes" start="58" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="59" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
                     </span>
      <span xq="yes" start="84" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="88" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="40064" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span class="comment" pos="40082" xq="yes">(: is there a highlight node after? :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="axis">following-sibling::</span>
      <span xq="yes" start="42" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="47" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="48" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="49" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="50" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="51" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="52" prev-is-closed="false" class="axis">self::</span>
      <span xq="yes" start="58" prev-is-closed="false" class="qname">span</span>
      <span xq="yes" start="62" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="63" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="64" prev-is-closed="false" class="qname">class</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="71" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="40191" xq="yes">ml-highlight</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="18" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="whitespace"> </span>
      <span class="comment" pos="40229" xq="yes">(: if so, print the last $g_num words :)</span>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="24" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="27" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="function">cts:tokenize</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="52" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="54" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="55" prev-is-closed="true" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="78" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="81" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="82" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="91" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="92" prev-is-closed="false" class="function">fn:count</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="101" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="108" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="109" prev-is-closed="true" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="132" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="135" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="136" prev-is-closed="false" class="variable">$truncateTokens</span>
      <span xq="yes" start="151" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="152" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="154" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="155" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="157" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="158" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="159" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="160" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="166" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="167" prev-is-closed="true" class="op">&lt;</span>
      <span xq="yes" start="168" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="169" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="184" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="185" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="186" prev-is-closed="true" class="whitespace">  </span>
      <span class="comment" pos="40456" xq="yes">(: &gt; :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="36" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="40" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="50" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="52" prev-is-closed="true" class="whitespace">&#xD;
                                 </span>
      <span xq="yes" start="87" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="91" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="92" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="93" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="101" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="102" prev-is-closed="false" class="function">fn:last</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="110" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="111" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="113" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="114" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="129" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="130" prev-is-closed="true" class="op">to</span>
      <span xq="yes" start="132" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="133" prev-is-closed="false" class="function">fn:last</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="141" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="142" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="143" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="144" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="145" prev-is-closed="true" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="168" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="174" prev-is-closed="false" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="197" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="199" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="200" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="201" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="202" prev-is-closed="false" class="variable">$count</span>
      <span xq="yes" start="208" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="209" prev-is-closed="true" class="op">&lt;</span>
      <span xq="yes" start="210" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="211" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="226" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="227" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="228" prev-is-closed="true" class="whitespace"> </span>
      <span class="comment" pos="40691" xq="yes">(: &gt; :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="24" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="28" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="29" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="41" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="56" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="64" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="40762" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
                  </span>
      <span class="comment" pos="40786" xq="yes">(: If the last token is not punctuation, then add space after :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                               </span>
      <span xq="yes" start="34" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="38" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="45" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="52" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="53" prev-is-closed="false" class="function">fn:last</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="61" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="62" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="63" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="64" prev-is-closed="true" class="type-op">instance of</span>
      <span xq="yes" start="75" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="false" class="type-name">cts:punctuation</span>
      <span xq="yes" start="91" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="92" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace">&#xD;
                               </span>
      <span xq="yes" start="127" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="131" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="132" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="40982" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                               </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="41025" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
                           </span>
      <span xq="yes" start="33" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace">&#xD;
                     </span>
      <span xq="yes" start="57" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="61" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="62" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="63" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="64" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="74" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="89" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="90" prev-is-closed="false" class="variable">$truncateTokens</span>
      <span xq="yes" start="105" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="106" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="107" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="41134" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace">&#xD;
                  </span>
      <span class="comment" pos="41158" xq="yes">(: If the last token is not punctuation, then add space after :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="false" class="whitespace">&#xD;
                               </span>
      <span xq="yes" start="34" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="38" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="45" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="52" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="53" prev-is-closed="false" class="function">fn:last</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="61" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="62" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="63" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="64" prev-is-closed="true" class="type-op">instance of</span>
      <span xq="yes" start="75" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="76" prev-is-closed="false" class="type-name">cts:punctuation</span>
      <span xq="yes" start="91" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="92" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace">&#xD;
                               </span>
      <span xq="yes" start="127" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="131" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="132" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="41354" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                               </span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="39" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="41397" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
                           </span>
      <span xq="yes" start="33" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace">&#xD;
                   </span>
      <span xq="yes" start="55" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="56" prev-is-closed="true" class="whitespace">&#xD;
              </span>
      <span xq="yes" start="72" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="76" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="41476" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="whitespace">&#xD;
               </span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace">&#xD;
       </span>
      <span xq="yes" start="30" prev-is-closed="true" class="qname">case</span>
      <span xq="yes" start="34" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="true" class="qname">element</span>
      <span xq="yes" start="42" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="true" class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="qname">span</span>
      <span xq="yes" start="48" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="49" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="50" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="56" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="57" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="59" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="60" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="61" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="63" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="64" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="65" prev-is-closed="false" class="qname">class</span>
      <span xq="yes" start="70" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="71" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="72" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="41550" xq="yes">ml-highlight</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="8" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$z</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="28" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="29" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="34" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="false" class="function">truncate-text</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="57" prev-is-closed="false" class="variable">$z</span>
      <span xq="yes" start="59" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="60" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="61" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="76" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="77" prev-is-closed="true" class="whitespace">&#xD;
       </span>
      <span xq="yes" start="86" prev-is-closed="true" class="qname">default</span>
      <span xq="yes" start="93" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="100" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="101" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="104" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="105" prev-is-closed="false" class="variable">$z</span>
      <span xq="yes" start="107" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="108" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="110" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="111" prev-is-closed="false" class="variable">$x</span>
      <span xq="yes" start="113" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="114" prev-is-closed="false" class="node">node(</span>
      <span xq="yes" start="119" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="120" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="121" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="127" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="128" prev-is-closed="false" class="function">truncate-text</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="142" prev-is-closed="false" class="variable">$z</span>
      <span xq="yes" start="144" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="145" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="146" prev-is-closed="false" class="variable">$truncate-words</span>
      <span xq="yes" start="161" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="162" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="164" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="165" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="41732" xq="yes">(:~&#xD;
:&#xD;
: (Public) Returns a string version of any xpath in a document&#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @return The string version of any xpath in a document.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">show-section</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="32" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="39" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="40" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="51" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="52" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="53" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="56" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="59" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="62" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="false" class="variable">$uri</span>
      <span xq="yes" start="67" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="71" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="78" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="79" prev-is-closed="false" class="qname">uri</span>
      <span xq="yes" start="82" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="85" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="88" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="89" prev-is-closed="false" class="variable">$path</span>
      <span xq="yes" start="94" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="95" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="97" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="98" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="105" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="106" prev-is-closed="false" class="qname">path</span>
      <span xq="yes" start="110" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="113" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="116" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="117" prev-is-closed="false" class="variable">$nodeInstr</span>
      <span xq="yes" start="127" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="128" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="130" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="131" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="141" prev-is-closed="false" class="function">search:construct-prolog</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="165" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="166" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="167" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="42090" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
							</span>
      <span class="op">"</span>
      <span class="literal" pos="42103" xq="yes"> fn:doc('</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$uri</span>
      <span xq="yes" start="6" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="42120" xq="yes">')</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$path</span>
      <span xq="yes" start="7" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="8" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="11" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$node</span>
      <span xq="yes" start="20" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="23" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="false" class="function">xdmp:eval</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="34" prev-is-closed="false" class="variable">$nodeInstr</span>
      <span xq="yes" start="44" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="48" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="false" class="variable">$preview</span>
      <span xq="yes" start="60" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="61" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="63" prev-is-closed="false" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="67" prev-is-closed="false" class="if">if(</span>
      <span xq="yes" start="70" prev-is-closed="false" class="function">fn:exists</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="80" prev-is-closed="false" class="variable">$node</span>
      <span xq="yes" start="85" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="86" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="87" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="92" prev-is-closed="false" class="whitespace">&#xD;
			</span>
      <span xq="yes" start="97" prev-is-closed="false" class="variable">$node</span>
      <span xq="yes" start="102" prev-is-closed="true" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="106" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="110" prev-is-closed="false" class="whitespace">&#xD;
			</span>
      <span class="op">"</span>
      <span class="literal" pos="42238" xq="yes">No preview available.</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="4" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace">&#xD;
		</span>
      <span xq="yes" start="14" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$preview</span>
      <span xq="yes" start="32" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="35" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="42300" xq="yes">(: Search Widgets :)</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="42324" xq="yes">(:~&#xD;
:&#xD;
: (Public) A description of the query being displayed that will also&#xD;
: allow users to remove individual items from their search. &#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @return An HTML rendered, interactive description of the user's search.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">query-description</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="37" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="44" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="47" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="56" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="62" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="63" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="64" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="65" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="67" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="76" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="77" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="78" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="80" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="81" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="87" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="89" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="90" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="91" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="101" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="108" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="109" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="110" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="111" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="true" class="op">!=</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="42714" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="42728" class="es">&lt;</span>
      <span name="xml-open-tag" pos="42729" class="en">div</span>
      <span name="xml-name-end" pos="42732" class="atn"> class</span>
      <span name="x-equals" pos="42738" class="atneq">=</span>
      <span name="xml-att-quote" pos="42739" class="z">"</span>
      <span name="xml-literal-start" pos="42740" class="av">query_description</span>
      <span name="xml-att-quote" pos="42757" class="z">"</span>
      <span name="x-tag-end" pos="42758" class="z">&gt;</span>
      <span pos="42759" class="txt">&#xD;
        </span>
      <span name="nested-query" pos="42769" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="42771" xq="yes">Results </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="42782" class="es">&lt;</span>
      <span name="xml-open-tag" pos="42783" class="en">span</span>
      <span name="x-tag-end" pos="42787" class="z">&gt;</span>
      <span pos="42788" class="txt">for </span>
      <span pos="42792" class="es">&lt;</span>
      <span name="xml-open-tag" pos="42793" class="en">b</span>
      <span name="x-tag-end" pos="42794" class="z">&gt;</span>
      <span name="nested-query" pos="42795" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$params</span>
      <span xq="yes" start="8" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="9" prev-is-closed="false" class="qname">q</span>
      <span name="unnested-xquery" pos="42805" class="op">}</span>
      <span pos="42806" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="42808" class="cl">b</span>
      <span name="x-tag-end" pos="42809" class="z">&gt;</span>
      <span pos="42810" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="42812" class="cl">span</span>
      <span name="x-tag-end" pos="42816" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="42818" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="12" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="16" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="26" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="33" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="34" prev-is-closed="false" class="qname">field</span>
      <span xq="yes" start="39" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="40" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span pos="42867" class="es">&lt;</span>
      <span name="xml-open-tag" pos="42868" class="en">span</span>
      <span name="x-tag-end" pos="42872" class="z">&gt;</span>
      <span pos="42873" class="txt">in </span>
      <span pos="42876" class="es">&lt;</span>
      <span name="xml-open-tag" pos="42877" class="en">i</span>
      <span name="x-tag-end" pos="42878" class="z">&gt;</span>
      <span name="nested-query" pos="42879" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$params</span>
      <span xq="yes" start="8" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="9" prev-is-closed="false" class="qname">field</span>
      <span name="unnested-xquery" pos="42893" class="op">}</span>
      <span pos="42894" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="42896" class="cl">i</span>
      <span name="x-tag-end" pos="42897" class="z">&gt;</span>
      <span pos="42898" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="42900" class="cl">span</span>
      <span name="x-tag-end" pos="42904" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> &#xD;
        </span>
      <span pos="42925" class="es">&lt;</span>
      <span name="xml-open-tag" pos="42926" class="en">a</span>
      <span name="xml-name-end" pos="42927" class="atn"> href</span>
      <span name="x-equals" pos="42932" class="atneq">=</span>
      <span name="xml-att-quote" pos="42933" class="z">"</span>
      <span name="xml-literal-start" pos="42934" class="av">search.xqy?</span>
      <span name="nested-query" pos="42945" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="42978" xq="yes">q</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="42983" class="op">}</span>
      <span name="xml-att-quote" pos="42984" class="z">"</span>
      <span name="x-tag-end" pos="42985" class="z">&gt;</span>
      <span pos="42986" class="txt">[x]</span>
      <span pos="42989" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="42991" class="cl">a</span>
      <span name="x-tag-end" pos="42992" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="42994" class="op">}</span>
      <span name="resume-x-literal-txt" pos="42995" class="txt">&#xD;
    </span>
      <span pos="43001" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="43003" class="cl">div</span>
      <span name="x-tag-end" pos="43006" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="13" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="21" prev-is-closed="false" class="function">filter-description</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="40" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="47" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="48" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="50" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="51" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
&#xD;
</span>
      <span class="comment" pos="43063" xq="yes">(:~&#xD;
:&#xD;
: (Public) Information on the quanity of results and the time to render the results.&#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @param $query-time The amount of time required to execute the search.&#xD;
: @param $page-info The pagination element created by lib-uitools.&#xD;
: @return A rendered HTML &lt;div&gt; containing information on the quanity of results and the time to render the results.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">results-info</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="32" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="38" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="48" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="57" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="63" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="64" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="71" prev-is-closed="false" class="variable">$query-time</span>
      <span xq="yes" start="82" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="83" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="85" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="86" prev-is-closed="false" class="type-name">xs:duration</span>
      <span xq="yes" start="97" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="98" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="101" prev-is-closed="false" class="variable">$page-info</span>
      <span xq="yes" start="111" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="114" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="123" prev-is-closed="false" class="qname">pagination</span>
      <span xq="yes" start="133" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="134" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="137" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="138" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="139" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="141" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="142" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="150" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="151" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="152" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="154" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="155" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="161" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="164" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="165" prev-is-closed="false" class="variable">$time</span>
      <span xq="yes" start="170" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="171" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="173" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="174" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="184" prev-is-closed="false" class="variable">$query-time</span>
      <span xq="yes" start="195" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="196" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="202" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="205" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="206" prev-is-closed="false" class="variable">$time</span>
      <span xq="yes" start="211" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="212" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="214" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="215" prev-is-closed="false" class="function">fn:substring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="228" prev-is-closed="false" class="variable">$time</span>
      <span xq="yes" start="233" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="234" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="235" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="236" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="237" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="238" prev-is-closed="false" class="function">fn:string-length</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="255" prev-is-closed="false" class="variable">$time</span>
      <span xq="yes" start="260" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="261" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="262" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="263" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="264" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="265" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="266" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="272" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="278" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="43760" class="es">&lt;</span>
      <span name="xml-open-tag" pos="43761" class="en">div</span>
      <span name="xml-name-end" pos="43764" class="atn"> class</span>
      <span name="x-equals" pos="43770" class="atneq">=</span>
      <span name="xml-att-quote" pos="43771" class="z">"</span>
      <span name="xml-literal-start" pos="43772" class="av">results_info</span>
      <span name="xml-att-quote" pos="43784" class="z">"</span>
      <span name="x-tag-end" pos="43785" class="z">&gt;</span>
      <span pos="43786" class="txt">&#xD;
	    </span>
      <span pos="43793" class="es">&lt;</span>
      <span name="xml-open-tag" pos="43794" class="en">span</span>
      <span name="x-tag-end" pos="43798" class="z">&gt;</span>
      <span pos="43799" class="txt">Displaying </span>
      <span pos="43810" class="es">&lt;</span>
      <span name="xml-open-tag" pos="43811" class="en">strong</span>
      <span name="x-tag-end" pos="43817" class="z">&gt;</span>
      <span name="nested-query" pos="43818" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page-info</span>
      <span xq="yes" start="21" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="22" prev-is-closed="false" class="qname">start</span>
      <span xq="yes" start="27" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="43846" class="op">}</span>
      <span name="resume-x-literal-txt" pos="43847" class="txt"> to </span>
      <span name="nested-query" pos="43851" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page-info</span>
      <span xq="yes" start="21" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="22" prev-is-closed="false" class="qname">end</span>
      <span xq="yes" start="25" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="43877" class="op">}</span>
      <span pos="43878" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="43880" class="cl">strong</span>
      <span name="x-tag-end" pos="43886" class="z">&gt;</span>
      <span pos="43887" class="txt"> of about </span>
      <span pos="43897" class="es">&lt;</span>
      <span name="xml-open-tag" pos="43898" class="en">strong</span>
      <span name="x-tag-end" pos="43904" class="z">&gt;</span>
      <span name="nested-query" pos="43905" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page-info</span>
      <span xq="yes" start="21" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="22" prev-is-closed="false" class="qname">count</span>
      <span xq="yes" start="27" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="43933" class="op">}</span>
      <span pos="43934" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="43936" class="cl">strong</span>
      <span name="x-tag-end" pos="43942" class="z">&gt;</span>
      <span pos="43943" class="txt"> results. Searched in </span>
      <span pos="43965" class="es">&lt;</span>
      <span name="xml-open-tag" pos="43966" class="en">strong</span>
      <span name="x-tag-end" pos="43972" class="z">&gt;</span>
      <span name="nested-query" pos="43973" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$time</span>
      <span name="unnested-xquery" pos="43979" class="op">}</span>
      <span name="resume-x-literal-txt" pos="43980" class="txt">s</span>
      <span pos="43981" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="43983" class="cl">strong</span>
      <span name="x-tag-end" pos="43989" class="z">&gt;</span>
      <span pos="43990" class="txt">.</span>
      <span pos="43991" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="43993" class="cl">span</span>
      <span name="x-tag-end" pos="43997" class="z">&gt;</span>
      <span pos="43998" class="txt"> </span>
      <span name="nested-query" pos="43999" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="12" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="13" prev-is-closed="false" class="qname">*</span>
      <span xq="yes" start="14" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="15" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="44021" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span pos="44025" class="es">&lt;</span>
      <span name="xml-open-tag" pos="44026" class="en">a</span>
      <span name="xml-name-end" pos="44027" class="atn"> href</span>
      <span name="x-equals" pos="44032" class="atneq">=</span>
      <span name="xml-att-quote" pos="44033" class="z">"</span>
      <span name="xml-literal-start" pos="44034" class="av">search.xqy</span>
      <span name="xml-att-quote" pos="44044" class="z">"</span>
      <span name="x-tag-end" pos="44045" class="z">&gt;</span>
      <span pos="44046" class="txt">[Reset Search]</span>
      <span pos="44060" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="44062" class="cl">a</span>
      <span name="x-tag-end" pos="44063" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="9" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="44073" class="op">}</span>
      <span pos="44074" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="44076" class="cl">div</span>
      <span name="x-tag-end" pos="44079" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="44087" xq="yes">(:~&#xD;
:&#xD;
: (Public) A widget which is meant to be displayed on the sidebar&#xD;
: and will allow the user to choose a sort order for their results.&#xD;
: Appears only when there is a full-text search. Default browse&#xD;
: sort-order is used otherwise.&#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @return A select box which will allow the user to select the sort order.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">sort</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="34" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="43" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="49" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="50" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="51" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="54" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="63" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="64" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="65" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="67" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="68" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="74" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="76" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="78" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="88" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="95" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="96" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="97" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="98" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="99" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="104" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="44575" class="es">&lt;</span>
      <span name="xml-open-tag" pos="44576" class="en">div</span>
      <span name="xml-name-end" pos="44579" class="atn"> style</span>
      <span name="x-equals" pos="44585" class="atneq">=</span>
      <span name="xml-att-quote" pos="44586" class="z">"</span>
      <span name="xml-literal-start" pos="44587" class="av">margin: 7px 0 5px 0;</span>
      <span name="xml-att-quote" pos="44607" class="z">"</span>
      <span name="x-tag-end" pos="44608" class="z">&gt;</span>
      <span pos="44609" class="txt">&#xD;
    	</span>
      <span pos="44616" class="es">&lt;</span>
      <span name="xml-open-tag" pos="44617" class="en">form</span>
      <span name="xml-name-end" pos="44621" class="atn"> method</span>
      <span name="x-equals" pos="44628" class="atneq">=</span>
      <span name="xml-att-quote" pos="44629" class="z">"</span>
      <span name="xml-literal-start" pos="44630" class="av">get</span>
      <span name="xml-att-quote" pos="44633" class="z">"</span>
      <span name="xml-literal-end" pos="44634" class="atn"> action</span>
      <span name="x-equals" pos="44641" class="atneq">=</span>
      <span name="xml-att-quote" pos="44642" class="z">"</span>
      <span name="xml-literal-start" pos="44643" class="av">search.xqy</span>
      <span name="xml-att-quote" pos="44653" class="z">"</span>
      <span name="x-tag-end" pos="44654" class="z">&gt;</span>
      <span pos="44655" class="txt">&#xD;
            </span>
      <span pos="44669" class="es">&lt;</span>
      <span name="xml-open-tag" pos="44670" class="en">select</span>
      <span name="xml-name-end" pos="44676" class="atn"> name</span>
      <span name="x-equals" pos="44681" class="atneq">=</span>
      <span name="xml-att-quote" pos="44682" class="z">"</span>
      <span name="xml-literal-start" pos="44683" class="av">sort</span>
      <span name="xml-att-quote" pos="44687" class="z">"</span>
      <span name="xml-literal-end" pos="44688" class="atn"> onchange</span>
      <span name="x-equals" pos="44697" class="atneq">=</span>
      <span name="xml-att-quote" pos="44698" class="z">"</span>
      <span name="xml-literal-start" pos="44699" class="av">this.form.submit();</span>
      <span name="xml-att-quote" pos="44718" class="z">"</span>
      <span name="x-tag-end" pos="44719" class="z">&gt;</span>
      <span pos="44720" class="txt">&#xD;
            </span>
      <span pos="44734" class="es">&lt;</span>
      <span name="xml-open-tag" pos="44735" class="en">option</span>
      <span name="xml-name-end" pos="44741" class="atn"> value</span>
      <span name="x-equals" pos="44747" class="atneq">=</span>
      <span name="xml-att-quote" pos="44748" class="z">"</span>
      <span name="xml-literal-start" pos="44749" class="av">rel</span>
      <span name="xml-att-quote" pos="44752" class="z">"</span>
      <span name="x-tag-end" pos="44753" class="z">&gt;</span>
      <span pos="44754" class="txt">&#xD;
                </span>
      <span name="nested-query" pos="44772" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="function">fn:empty</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="14" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="21" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="22" prev-is-closed="false" class="qname">sort</span>
      <span xq="yes" start="26" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="38" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="39" prev-is-closed="false" class="qname">sort</span>
      <span xq="yes" start="43" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="45" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="46" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="44819" xq="yes">rel</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="44826" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="qname">selected</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="44856" xq="yes">selected</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="9" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="44875" class="op">}</span>
      <span name="resume-x-literal-txt" pos="44876" class="txt">&#xD;
                Sort by Relevence&#xD;
            </span>
      <span pos="44925" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="44927" class="cl">option</span>
      <span name="x-tag-end" pos="44933" class="z">&gt;</span>
      <span pos="44934" class="txt">&#xD;
            </span>
      <span pos="44948" class="es">&lt;</span>
      <span name="xml-open-tag" pos="44949" class="en">option</span>
      <span name="xml-name-end" pos="44955" class="atn"> value</span>
      <span name="x-equals" pos="44961" class="atneq">=</span>
      <span name="xml-att-quote" pos="44962" class="z">"</span>
      <span name="xml-literal-start" pos="44963" class="av">date</span>
      <span name="xml-att-quote" pos="44967" class="z">"</span>
      <span name="x-tag-end" pos="44968" class="z">&gt;</span>
      <span pos="44969" class="txt">&#xD;
                </span>
      <span name="nested-query" pos="44987" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="12" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="13" prev-is-closed="false" class="qname">sort</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="45008" xq="yes">date</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="qname">selected</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="45042" xq="yes">selected</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="7" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="9" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="45061" class="op">}</span>
      <span name="resume-x-literal-txt" pos="45062" class="txt">&#xD;
                Sort by Date&#xD;
            </span>
      <span pos="45106" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="45108" class="cl">option</span>
      <span name="x-tag-end" pos="45114" class="z">&gt;</span>
      <span pos="45115" class="txt">&#xD;
            </span>
      <span pos="45129" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="45131" class="cl">select</span>
      <span name="x-tag-end" pos="45137" class="z">&gt;</span>
      <span pos="45138" class="txt">&#xD;
    		</span>
      <span name="nested-query" pos="45146" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="4" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$param</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="36" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="43" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="45192" xq="yes">sort</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="6" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="7" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="8" prev-is-closed="false" class="qname">*</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="45227" class="es">&lt;</span>
      <span name="xml-open-tag" pos="45228" class="en">input</span>
      <span name="xml-name-end" pos="45233" class="atn"> type</span>
      <span name="x-equals" pos="45238" class="atneq">=</span>
      <span name="xml-att-quote" pos="45239" class="z">"</span>
      <span name="xml-literal-start" pos="45240" class="av">hidden</span>
      <span name="xml-att-quote" pos="45246" class="z">"</span>
      <span name="xml-literal-end" pos="45247" class="atn"> name</span>
      <span name="x-equals" pos="45252" class="atneq">=</span>
      <span name="xml-att-quote" pos="45253" class="z">"</span>
      <span name="nested-query" pos="45254" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:local-name</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$param</span>
      <span xq="yes" start="21" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="45276" class="op">}</span>
      <span name="xml-att-quote" pos="45277" class="z">"</span>
      <span name="xml-literal-end" pos="45278" class="atn"> class</span>
      <span name="x-equals" pos="45284" class="atneq">=</span>
      <span name="xml-att-quote" pos="45285" class="z">"</span>
      <span name="xml-literal-start" pos="45286" class="av">hide</span>
      <span name="xml-att-quote" pos="45290" class="z">"</span>
      <span name="xml-literal-end" pos="45291" class="atn"> value</span>
      <span name="x-equals" pos="45297" class="atneq">=</span>
      <span name="xml-att-quote" pos="45298" class="z">"</span>
      <span name="nested-query" pos="45299" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$param</span>
      <span name="unnested-xquery" pos="45306" class="op">}</span>
      <span name="xml-att-quote" pos="45307" class="z">"</span>
      <span name="xml-literal-end" pos="45308" class="atn"> </span>
      <span name="x-tag-end" pos="45309" class="z">/&gt;</span>
      <span name="unnested-xquery" pos="45311" class="op">}</span>
      <span name="resume-x-literal-txt" pos="45312" class="txt">&#xD;
    	</span>
      <span pos="45319" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="45321" class="cl">form</span>
      <span name="x-tag-end" pos="45325" class="z">&gt;</span>
      <span pos="45326" class="txt">&#xD;
    </span>
      <span pos="45332" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="45334" class="cl">div</span>
      <span name="x-tag-end" pos="45337" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="13" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="45358" xq="yes">(:~&#xD;
:&#xD;
: (Public) A widget meant for the sidebar that includes a search box and&#xD;
: field select box which a user can modify their current full-text search parameters.&#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @return A search filter widget.&#xD;
:)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">search-filter</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="33" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="52" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="53" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="54" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="66" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="67" prev-is-closed="true" class="quantifier">?</span>
      <span xq="yes" start="68" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="70" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="71" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="77" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="80" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="81" prev-is-closed="false" class="variable">$hparams</span>
      <span xq="yes" start="89" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="90" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="92" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="93" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="114" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="121" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="122" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="45745" xq="yes">q</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="5" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace">&#xD;
    	</span>
      <span pos="45772" class="es">&lt;</span>
      <span name="xml-open-tag" pos="45773" class="en">form</span>
      <span name="xml-name-end" pos="45777" class="atn"> method</span>
      <span name="x-equals" pos="45784" class="atneq">=</span>
      <span name="xml-att-quote" pos="45785" class="z">"</span>
      <span name="xml-literal-start" pos="45786" class="av">get</span>
      <span name="xml-att-quote" pos="45789" class="z">"</span>
      <span name="xml-literal-end" pos="45790" class="atn"> action</span>
      <span name="x-equals" pos="45797" class="atneq">=</span>
      <span name="xml-att-quote" pos="45798" class="z">"</span>
      <span name="xml-literal-start" pos="45799" class="av">search.xqy</span>
      <span name="xml-att-quote" pos="45809" class="z">"</span>
      <span name="x-tag-end" pos="45810" class="z">&gt;</span>
      <span pos="45811" class="txt">&#xD;
    		</span>
      <span pos="45819" class="es">&lt;</span>
      <span name="xml-open-tag" pos="45820" class="en">input</span>
      <span name="xml-name-end" pos="45825" class="atn"> type</span>
      <span name="x-equals" pos="45830" class="atneq">=</span>
      <span name="xml-att-quote" pos="45831" class="z">"</span>
      <span name="xml-literal-start" pos="45832" class="av">text</span>
      <span name="xml-att-quote" pos="45836" class="z">"</span>
      <span name="xml-literal-end" pos="45837" class="atn"> name</span>
      <span name="x-equals" pos="45842" class="atneq">=</span>
      <span name="xml-att-quote" pos="45843" class="z">"</span>
      <span name="xml-literal-start" pos="45844" class="av">q</span>
      <span name="xml-att-quote" pos="45845" class="z">"</span>
      <span name="xml-literal-end" pos="45846" class="atn"> style</span>
      <span name="x-equals" pos="45852" class="atneq">=</span>
      <span name="xml-att-quote" pos="45853" class="z">"</span>
      <span name="xml-literal-start" pos="45854" class="av">width:95%;</span>
      <span name="xml-att-quote" pos="45864" class="z">"</span>
      <span name="xml-literal-end" pos="45865" class="atn"> id</span>
      <span name="x-equals" pos="45868" class="atneq">=</span>
      <span name="xml-att-quote" pos="45869" class="z">"</span>
      <span name="xml-literal-start" pos="45870" class="av">quicksearch_q</span>
      <span name="xml-att-quote" pos="45883" class="z">"</span>
      <span name="xml-literal-end" pos="45884" class="atn"> class</span>
      <span name="x-equals" pos="45890" class="atneq">=</span>
      <span name="xml-att-quote" pos="45891" class="z">"</span>
      <span name="xml-literal-start" pos="45892" class="av">textbox</span>
      <span name="xml-att-quote" pos="45899" class="z">"</span>
      <span name="xml-literal-end" pos="45900" class="atn"> value</span>
      <span name="x-equals" pos="45906" class="atneq">=</span>
      <span name="xml-att-quote" pos="45907" class="z">"</span>
      <span name="nested-query" pos="45908" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="42" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="49" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="50" prev-is-closed="false" class="qname">q</span>
      <span xq="yes" start="51" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="52" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="59" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="45968" class="op">}</span>
      <span name="xml-att-quote" pos="45969" class="z">"</span>
      <span name="xml-literal-end" pos="45970" class="atn"> </span>
      <span name="x-tag-end" pos="45971" class="z">/&gt;</span>
      <span name="nested-query" pos="45973" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="45974" xq="yes"> </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="45977" class="op">}</span>
      <span name="resume-x-literal-txt" pos="45978" class="txt">&#xD;
    		</span>
      <span name="nested-query" pos="45986" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="4" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$SEARCH-FIELDS</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">&#xD;
	            </span>
      <span pos="46027" class="es">&lt;</span>
      <span name="xml-open-tag" pos="46028" class="en">select</span>
      <span name="xml-name-end" pos="46034" class="atn"> name</span>
      <span name="x-equals" pos="46039" class="atneq">=</span>
      <span name="xml-att-quote" pos="46040" class="z">"</span>
      <span name="xml-literal-start" pos="46041" class="av">field</span>
      <span name="xml-att-quote" pos="46046" class="z">"</span>
      <span name="xml-literal-end" pos="46047" class="atn"> style</span>
      <span name="x-equals" pos="46053" class="atneq">=</span>
      <span name="xml-att-quote" pos="46054" class="z">"</span>
      <span name="xml-literal-start" pos="46055" class="av">display:inline;margin:3px 3px 0 0;</span>
      <span name="xml-att-quote" pos="46089" class="z">"</span>
      <span name="x-tag-end" pos="46090" class="z">&gt;</span>
      <span pos="46091" class="txt">&#xD;
	            	</span>
      <span name="nested-query" pos="46107" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">     &#xD;
	    			</span>
      <span xq="yes" start="16" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$option</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="31" prev-is-closed="false" class="variable">$SEARCH-FIELDS</span>
      <span xq="yes" start="45" prev-is-closed="true" class="whitespace">&#xD;
	    			</span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="61" prev-is-closed="false" class="whitespace">&#xD;
						</span>
      <span xq="yes" start="69" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="72" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="73" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="79" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="80" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="82" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="83" prev-is-closed="false" class="function">fn:tokenize</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="95" prev-is-closed="false" class="variable">$option</span>
      <span xq="yes" start="102" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="103" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="46211" xq="yes">\|</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
						</span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> &#xD;
							</span>
      <span xq="yes" start="26" prev-is-closed="false" class="op">element</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="qname">option</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace">&#xD;
								</span>
      <span xq="yes" start="52" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="61" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="62" prev-is-closed="true" class="qname">value</span>
      <span xq="yes" start="67" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="68" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="69" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="75" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="76" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="77" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="78" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="79" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="80" prev-is-closed="false" class="whitespace">&#xD;
								</span>
      <span xq="yes" start="90" prev-is-closed="false" class="if">if(</span>
      <span xq="yes" start="93" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="94" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="101" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="108" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="109" prev-is-closed="false" class="qname">field</span>
      <span xq="yes" start="114" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="115" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="116" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="119" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="120" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="126" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="127" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="128" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="129" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="130" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="131" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="46346" xq="yes"/>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="5" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="13" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="14" prev-is-closed="false" class="qname">field</span>
      <span xq="yes" start="19" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">eq</span>
      <span xq="yes" start="22" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="29" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="30" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="31" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="32" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> &#xD;
									</span>
      <span xq="yes" start="50" prev-is-closed="false" class="op">attribute</span>
      <span xq="yes" start="59" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="60" prev-is-closed="true" class="qname">selected</span>
      <span xq="yes" start="68" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="46417" xq="yes">selected</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
								</span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="18" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="19" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace">&#xD;
								</span>
      <span xq="yes" start="30" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="36" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="37" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="38" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="39" prev-is-closed="true" class="whitespace">&#xD;
							</span>
      <span xq="yes" start="48" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="49" prev-is-closed="true" class="whitespace">&#xD;
	    			</span>
      <span name="unnested-xquery" pos="46485" class="op">}</span>
      <span name="resume-x-literal-txt" pos="46486" class="txt">&#xD;
			    </span>
      <span pos="46495" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="46497" class="cl">select</span>
      <span name="x-tag-end" pos="46503" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
			    </span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="17" prev-is-closed="true" class="whitespace"> </span>
      <span name="unnested-xquery" pos="46521" class="op">}</span>
      <span name="resume-x-literal-txt" pos="46522" class="txt">&#xD;
    		</span>
      <span pos="46530" class="es">&lt;</span>
      <span name="xml-open-tag" pos="46531" class="en">input</span>
      <span name="xml-name-end" pos="46536" class="atn"> type</span>
      <span name="x-equals" pos="46541" class="atneq">=</span>
      <span name="xml-att-quote" pos="46542" class="z">"</span>
      <span name="xml-literal-start" pos="46543" class="av">submit</span>
      <span name="xml-att-quote" pos="46549" class="z">"</span>
      <span name="xml-literal-end" pos="46550" class="atn"> value</span>
      <span name="x-equals" pos="46556" class="atneq">=</span>
      <span name="xml-att-quote" pos="46557" class="z">"</span>
      <span name="xml-literal-start" pos="46558" class="av">Filter</span>
      <span name="xml-att-quote" pos="46564" class="z">"</span>
      <span name="xml-literal-end" pos="46565" class="atn"> class</span>
      <span name="x-equals" pos="46571" class="atneq">=</span>
      <span name="xml-att-quote" pos="46572" class="z">"</span>
      <span name="xml-literal-start" pos="46573" class="av">button</span>
      <span name="xml-att-quote" pos="46579" class="z">"</span>
      <span name="xml-literal-end" pos="46580" class="atn"> </span>
      <span name="x-tag-end" pos="46581" class="z">/&gt;</span>
      <span pos="46583" class="txt">&#xD;
    		</span>
      <span name="nested-query" pos="46591" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="4" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$param</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="22" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="23" prev-is-closed="false" class="qname">*</span>
      <span xq="yes" start="24" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="25" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="32" prev-is-closed="false" class="function">fn:local-name</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="46" prev-is-closed="false" class="context">.</span>
      <span xq="yes" start="47" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="48" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="49" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="50" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="51" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="46643" xq="yes">q</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="46648" xq="yes">field</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="3" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="5" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="46679" class="es">&lt;</span>
      <span name="xml-open-tag" pos="46680" class="en">input</span>
      <span name="xml-name-end" pos="46685" class="atn"> type</span>
      <span name="x-equals" pos="46690" class="atneq">=</span>
      <span name="xml-att-quote" pos="46691" class="z">"</span>
      <span name="xml-literal-start" pos="46692" class="av">hidden</span>
      <span name="xml-att-quote" pos="46698" class="z">"</span>
      <span name="xml-literal-end" pos="46699" class="atn"> name</span>
      <span name="x-equals" pos="46704" class="atneq">=</span>
      <span name="xml-att-quote" pos="46705" class="z">"</span>
      <span name="nested-query" pos="46706" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:local-name</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$param</span>
      <span xq="yes" start="21" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="46728" class="op">}</span>
      <span name="xml-att-quote" pos="46729" class="z">"</span>
      <span name="xml-literal-end" pos="46730" class="atn"> class</span>
      <span name="x-equals" pos="46736" class="atneq">=</span>
      <span name="xml-att-quote" pos="46737" class="z">"</span>
      <span name="xml-literal-start" pos="46738" class="av">hide</span>
      <span name="xml-att-quote" pos="46742" class="z">"</span>
      <span name="xml-literal-end" pos="46743" class="atn"> value</span>
      <span name="x-equals" pos="46749" class="atneq">=</span>
      <span name="xml-att-quote" pos="46750" class="z">"</span>
      <span name="nested-query" pos="46751" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$param</span>
      <span name="unnested-xquery" pos="46758" class="op">}</span>
      <span name="xml-att-quote" pos="46759" class="z">"</span>
      <span name="xml-literal-end" pos="46760" class="atn"> </span>
      <span name="x-tag-end" pos="46761" class="z">/&gt;</span>
      <span name="unnested-xquery" pos="46763" class="op">}</span>
      <span name="resume-x-literal-txt" pos="46764" class="txt">&#xD;
    	</span>
      <span pos="46771" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="46773" class="cl">form</span>
      <span name="x-tag-end" pos="46777" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span class="comment" pos="46785" xq="yes">(:~&#xD;
:&#xD;
: (Public) Pagination controls for a page.&#xD;
:&#xD;
: @param $params The parameters from the page request.&#xD;
: @param $page-info The pagination element created by lib-uitools.&#xD;
: @return A fully functional pagination control&#xD;
  Disclaimer: We acknowledge that this function is seriously lacking, so&#xD;
   if you have the time and desire, please do. :)</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="9" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="function">pagination</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="36" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="43" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="46" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="47" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="55" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="61" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="62" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="63" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="66" prev-is-closed="false" class="variable">$page-info</span>
      <span xq="yes" start="76" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="77" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="79" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="80" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="88" prev-is-closed="false" class="qname">pagination</span>
      <span xq="yes" start="98" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="99" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="102" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="103" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="104" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="106" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="107" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="115" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="116" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="117" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="119" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="120" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="126" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="129" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="130" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="135" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="136" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="138" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="139" prev-is-closed="false" class="function">xs:integer</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="150" prev-is-closed="false" class="variable">$page-info</span>
      <span xq="yes" start="160" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="161" prev-is-closed="false" class="qname">page</span>
      <span xq="yes" start="165" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="166" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="172" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="175" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="176" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="182" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="183" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="185" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="186" prev-is-closed="false" class="function">xs:integer</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="197" prev-is-closed="false" class="variable">$page-info</span>
      <span xq="yes" start="207" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="208" prev-is-closed="false" class="qname">pages</span>
      <span xq="yes" start="213" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="214" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="217" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="223" prev-is-closed="false" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="226" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="227" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span pos="47372" class="es">&lt;</span>
      <span name="xml-open-tag" pos="47373" class="en">div</span>
      <span name="xml-name-end" pos="47376" class="atn"> class</span>
      <span name="x-equals" pos="47382" class="atneq">=</span>
      <span name="xml-att-quote" pos="47383" class="z">"</span>
      <span name="xml-literal-start" pos="47384" class="av">pages</span>
      <span name="xml-att-quote" pos="47389" class="z">"</span>
      <span name="x-tag-end" pos="47390" class="z">&gt;</span>
      <span pos="47391" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="47405" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="14" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="15" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="47439" class="es">&lt;</span>
      <span name="xml-open-tag" pos="47440" class="en">a</span>
      <span name="xml-name-end" pos="47441" class="atn"> class</span>
      <span name="x-equals" pos="47447" class="atneq">=</span>
      <span name="xml-att-quote" pos="47448" class="z">"</span>
      <span name="xml-literal-start" pos="47449" class="av">nextprev</span>
      <span name="xml-att-quote" pos="47457" class="z">"</span>
      <span name="xml-literal-end" pos="47458" class="atn"> title</span>
      <span name="x-equals" pos="47464" class="atneq">=</span>
      <span name="xml-att-quote" pos="47465" class="z">"</span>
      <span name="xml-literal-start" pos="47466" class="av">Go to Previous Page</span>
      <span name="xml-att-quote" pos="47485" class="z">"</span>
      <span name="xml-literal-end" pos="47486" class="atn"> href</span>
      <span name="x-equals" pos="47491" class="atneq">=</span>
      <span name="xml-att-quote" pos="47492" class="z">"</span>
      <span name="xml-literal-start" pos="47493" class="av">search.xqy?</span>
      <span name="nested-query" pos="47504" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="47537" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="47542" class="op">}</span>
      <span name="resume-x-literal" pos="47543" class="av">&amp;p=</span>
      <span name="nested-query" pos="47546" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">1</span>
      <span name="unnested-xquery" pos="47556" class="op">}</span>
      <span name="xml-att-quote" pos="47557" class="z">"</span>
      <span name="x-tag-end" pos="47558" class="z">&gt;</span>
      <span pos="47559" class="txt">&amp;laquo; Previous Page</span>
      <span pos="47580" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="47582" class="cl">a</span>
      <span name="x-tag-end" pos="47583" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="47619" class="op">}</span>
      <span name="resume-x-literal-txt" pos="47620" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="47634" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="32" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="33" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="34" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="36" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="39" prev-is-closed="false" class="numeric">0</span>
      <span xq="yes" start="40" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="41" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="42" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="43" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="47" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="47695" class="es">&lt;</span>
      <span name="xml-open-tag" pos="47696" class="en">a</span>
      <span name="xml-name-end" pos="47697" class="atn"> class</span>
      <span name="x-equals" pos="47703" class="atneq">=</span>
      <span name="xml-att-quote" pos="47704" class="z">"</span>
      <span name="xml-literal-start" pos="47705" class="av">lastpage</span>
      <span name="xml-att-quote" pos="47713" class="z">"</span>
      <span name="xml-literal-end" pos="47714" class="atn"> title</span>
      <span name="x-equals" pos="47720" class="atneq">=</span>
      <span name="xml-att-quote" pos="47721" class="z">"</span>
      <span name="nested-query" pos="47722" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="47743" class="op">}</span>
      <span name="xml-att-quote" pos="47744" class="z">"</span>
      <span name="xml-literal-end" pos="47745" class="atn"> href</span>
      <span name="x-equals" pos="47750" class="atneq">=</span>
      <span name="xml-att-quote" pos="47751" class="z">"</span>
      <span name="xml-literal-start" pos="47752" class="av">search.xqy?</span>
      <span name="nested-query" pos="47763" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="47796" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="47801" class="op">}</span>
      <span name="resume-x-literal" pos="47802" class="av">&amp;p=</span>
      <span name="nested-query" pos="47805" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">4</span>
      <span name="unnested-xquery" pos="47815" class="op">}</span>
      <span name="xml-att-quote" pos="47816" class="z">"</span>
      <span name="x-tag-end" pos="47817" class="z">&gt;</span>
      <span name="nested-query" pos="47818" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="47839" class="op">}</span>
      <span pos="47840" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="47842" class="cl">a</span>
      <span name="x-tag-end" pos="47843" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="47879" class="op">}</span>
      <span name="resume-x-literal-txt" pos="47880" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="47894" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="7" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="12" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="21" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="32" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="33" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="34" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="45" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="46" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="47" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="53" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="60" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="61" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="62" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="64" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="65" prev-is-closed="false" class="numeric">0</span>
      <span xq="yes" start="66" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="67" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="68" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="73" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="47981" class="es">&lt;</span>
      <span name="xml-open-tag" pos="47982" class="en">a</span>
      <span name="xml-name-end" pos="47983" class="atn"> class</span>
      <span name="x-equals" pos="47989" class="atneq">=</span>
      <span name="xml-att-quote" pos="47990" class="z">"</span>
      <span name="xml-literal-start" pos="47991" class="av">lastpage</span>
      <span name="xml-att-quote" pos="47999" class="z">"</span>
      <span name="xml-literal-end" pos="48000" class="atn"> title</span>
      <span name="x-equals" pos="48006" class="atneq">=</span>
      <span name="xml-att-quote" pos="48007" class="z">"</span>
      <span name="nested-query" pos="48008" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48029" class="op">}</span>
      <span name="xml-att-quote" pos="48030" class="z">"</span>
      <span name="xml-literal-end" pos="48031" class="atn"> href</span>
      <span name="x-equals" pos="48036" class="atneq">=</span>
      <span name="xml-att-quote" pos="48037" class="z">"</span>
      <span name="xml-literal-start" pos="48038" class="av">search.xqy?</span>
      <span name="nested-query" pos="48049" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="48082" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48087" class="op">}</span>
      <span name="resume-x-literal" pos="48088" class="av">&amp;p=</span>
      <span name="nested-query" pos="48091" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">3</span>
      <span name="unnested-xquery" pos="48101" class="op">}</span>
      <span name="xml-att-quote" pos="48102" class="z">"</span>
      <span name="x-tag-end" pos="48103" class="z">&gt;</span>
      <span name="nested-query" pos="48104" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48125" class="op">}</span>
      <span pos="48126" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="48128" class="cl">a</span>
      <span name="x-tag-end" pos="48129" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="48165" class="op">}</span>
      <span name="resume-x-literal-txt" pos="48166" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="48180" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="7" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="12" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="14" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="21" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="23" prev-is-closed="true" class="op">or</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="32" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="33" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="34" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="43" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="45" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="46" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="47" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="48" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="53" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="59" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="60" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="61" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="62" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="63" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="64" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="65" prev-is-closed="false" class="numeric">0</span>
      <span xq="yes" start="66" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="67" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="68" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="69" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="73" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="48267" class="es">&lt;</span>
      <span name="xml-open-tag" pos="48268" class="en">a</span>
      <span name="xml-name-end" pos="48269" class="atn"> class</span>
      <span name="x-equals" pos="48275" class="atneq">=</span>
      <span name="xml-att-quote" pos="48276" class="z">"</span>
      <span name="xml-literal-start" pos="48277" class="av">lastpage</span>
      <span name="xml-att-quote" pos="48285" class="z">"</span>
      <span name="xml-literal-end" pos="48286" class="atn"> title</span>
      <span name="x-equals" pos="48292" class="atneq">=</span>
      <span name="xml-att-quote" pos="48293" class="z">"</span>
      <span name="nested-query" pos="48294" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48315" class="op">}</span>
      <span name="xml-att-quote" pos="48316" class="z">"</span>
      <span name="xml-literal-end" pos="48317" class="atn"> href</span>
      <span name="x-equals" pos="48322" class="atneq">=</span>
      <span name="xml-att-quote" pos="48323" class="z">"</span>
      <span name="xml-literal-start" pos="48324" class="av">search.xqy?</span>
      <span name="nested-query" pos="48335" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="48368" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48373" class="op">}</span>
      <span name="resume-x-literal" pos="48374" class="av">&amp;p=</span>
      <span name="nested-query" pos="48377" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">2</span>
      <span name="unnested-xquery" pos="48387" class="op">}</span>
      <span name="xml-att-quote" pos="48388" class="z">"</span>
      <span name="x-tag-end" pos="48389" class="z">&gt;</span>
      <span name="nested-query" pos="48390" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48411" class="op">}</span>
      <span pos="48412" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="48414" class="cl">a</span>
      <span name="x-tag-end" pos="48415" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="48451" class="op">}</span>
      <span name="resume-x-literal-txt" pos="48452" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="48466" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="15" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="22" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="33" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="false" class="numeric">0</span>
      <span xq="yes" start="35" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="36" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="37" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="38" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="42" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="48522" class="es">&lt;</span>
      <span name="xml-open-tag" pos="48523" class="en">a</span>
      <span name="xml-name-end" pos="48524" class="atn"> class</span>
      <span name="x-equals" pos="48530" class="atneq">=</span>
      <span name="xml-att-quote" pos="48531" class="z">"</span>
      <span name="xml-literal-start" pos="48532" class="av">lastpage</span>
      <span name="xml-att-quote" pos="48540" class="z">"</span>
      <span name="xml-literal-end" pos="48541" class="atn"> title</span>
      <span name="x-equals" pos="48547" class="atneq">=</span>
      <span name="xml-att-quote" pos="48548" class="z">"</span>
      <span name="nested-query" pos="48549" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48570" class="op">}</span>
      <span name="xml-att-quote" pos="48571" class="z">"</span>
      <span name="xml-literal-end" pos="48572" class="atn"> href</span>
      <span name="x-equals" pos="48577" class="atneq">=</span>
      <span name="xml-att-quote" pos="48578" class="z">"</span>
      <span name="xml-literal-start" pos="48579" class="av">search.xqy?</span>
      <span name="nested-query" pos="48590" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="48623" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48628" class="op">}</span>
      <span name="resume-x-literal" pos="48629" class="av">&amp;p=</span>
      <span name="nested-query" pos="48632" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">1</span>
      <span name="unnested-xquery" pos="48642" class="op">}</span>
      <span name="xml-att-quote" pos="48643" class="z">"</span>
      <span name="x-tag-end" pos="48644" class="z">&gt;</span>
      <span name="nested-query" pos="48645" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">-</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48666" class="op">}</span>
      <span pos="48667" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="48669" class="cl">a</span>
      <span name="x-tag-end" pos="48670" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="48706" class="op">}</span>
      <span name="resume-x-literal-txt" pos="48707" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="48721" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="22" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="48761" class="es">&lt;</span>
      <span name="xml-open-tag" pos="48762" class="en">a</span>
      <span name="xml-name-end" pos="48763" class="atn"> class</span>
      <span name="x-equals" pos="48769" class="atneq">=</span>
      <span name="xml-att-quote" pos="48770" class="z">"</span>
      <span name="xml-literal-start" pos="48771" class="av">thispage</span>
      <span name="xml-att-quote" pos="48779" class="z">"</span>
      <span name="xml-literal-end" pos="48780" class="atn"> title</span>
      <span name="x-equals" pos="48786" class="atneq">=</span>
      <span name="xml-att-quote" pos="48787" class="z">"</span>
      <span name="nested-query" pos="48788" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48805" class="op">}</span>
      <span name="xml-att-quote" pos="48806" class="z">"</span>
      <span name="xml-literal-end" pos="48807" class="atn"> href</span>
      <span name="x-equals" pos="48812" class="atneq">=</span>
      <span name="xml-att-quote" pos="48813" class="z">"</span>
      <span name="xml-literal-start" pos="48814" class="av">search.xqy?</span>
      <span name="nested-query" pos="48825" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="48858" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48863" class="op">}</span>
      <span name="resume-x-literal" pos="48864" class="av">&amp;p=</span>
      <span name="nested-query" pos="48867" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span name="unnested-xquery" pos="48873" class="op">}</span>
      <span name="xml-att-quote" pos="48874" class="z">"</span>
      <span name="x-tag-end" pos="48875" class="z">&gt;</span>
      <span pos="48876" class="es">&lt;</span>
      <span name="xml-open-tag" pos="48877" class="en">strong</span>
      <span name="x-tag-end" pos="48883" class="z">&gt;</span>
      <span name="nested-query" pos="48884" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="48901" class="op">}</span>
      <span pos="48902" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="48904" class="cl">strong</span>
      <span name="x-tag-end" pos="48910" class="z">&gt;</span>
      <span pos="48911" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="48913" class="cl">a</span>
      <span name="x-tag-end" pos="48914" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="48950" class="op">}</span>
      <span name="resume-x-literal-txt" pos="48951" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="48965" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="49009" class="es">&lt;</span>
      <span name="xml-open-tag" pos="49010" class="en">a</span>
      <span name="xml-name-end" pos="49011" class="atn"> class</span>
      <span name="x-equals" pos="49017" class="atneq">=</span>
      <span name="xml-att-quote" pos="49018" class="z">"</span>
      <span name="xml-literal-start" pos="49019" class="av">nextpage</span>
      <span name="xml-att-quote" pos="49027" class="z">"</span>
      <span name="xml-literal-end" pos="49028" class="atn"> title</span>
      <span name="x-equals" pos="49034" class="atneq">=</span>
      <span name="xml-att-quote" pos="49035" class="z">"</span>
      <span name="nested-query" pos="49036" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49057" class="op">}</span>
      <span name="xml-att-quote" pos="49058" class="z">"</span>
      <span name="xml-literal-end" pos="49059" class="atn"> href</span>
      <span name="x-equals" pos="49064" class="atneq">=</span>
      <span name="xml-att-quote" pos="49065" class="z">"</span>
      <span name="xml-literal-start" pos="49066" class="av">search.xqy?</span>
      <span name="nested-query" pos="49077" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="49110" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49115" class="op">}</span>
      <span name="resume-x-literal" pos="49116" class="av">&amp;p=</span>
      <span name="nested-query" pos="49119" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">1</span>
      <span name="unnested-xquery" pos="49129" class="op">}</span>
      <span name="xml-att-quote" pos="49130" class="z">"</span>
      <span name="x-tag-end" pos="49131" class="z">&gt;</span>
      <span name="nested-query" pos="49132" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49153" class="op">}</span>
      <span pos="49154" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="49156" class="cl">a</span>
      <span name="x-tag-end" pos="49157" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="49193" class="op">}</span>
      <span name="resume-x-literal-txt" pos="49194" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="49208" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="49252" class="es">&lt;</span>
      <span name="xml-open-tag" pos="49253" class="en">a</span>
      <span name="xml-name-end" pos="49254" class="atn"> class</span>
      <span name="x-equals" pos="49260" class="atneq">=</span>
      <span name="xml-att-quote" pos="49261" class="z">"</span>
      <span name="xml-literal-start" pos="49262" class="av">nextpage2</span>
      <span name="xml-att-quote" pos="49271" class="z">"</span>
      <span name="xml-literal-end" pos="49272" class="atn"> title</span>
      <span name="x-equals" pos="49278" class="atneq">=</span>
      <span name="xml-att-quote" pos="49279" class="z">"</span>
      <span name="nested-query" pos="49280" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49301" class="op">}</span>
      <span name="xml-att-quote" pos="49302" class="z">"</span>
      <span name="xml-literal-end" pos="49303" class="atn"> href</span>
      <span name="x-equals" pos="49308" class="atneq">=</span>
      <span name="xml-att-quote" pos="49309" class="z">"</span>
      <span name="xml-literal-start" pos="49310" class="av">search.xqy?</span>
      <span name="nested-query" pos="49321" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="49354" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49359" class="op">}</span>
      <span name="resume-x-literal" pos="49360" class="av">&amp;p=</span>
      <span name="nested-query" pos="49363" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">2</span>
      <span name="unnested-xquery" pos="49373" class="op">}</span>
      <span name="xml-att-quote" pos="49374" class="z">"</span>
      <span name="x-tag-end" pos="49375" class="z">&gt;</span>
      <span name="nested-query" pos="49376" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49397" class="op">}</span>
      <span pos="49398" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="49400" class="cl">a</span>
      <span name="x-tag-end" pos="49401" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="49437" class="op">}</span>
      <span name="resume-x-literal-txt" pos="49438" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="49452" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="49496" class="es">&lt;</span>
      <span name="xml-open-tag" pos="49497" class="en">a</span>
      <span name="xml-name-end" pos="49498" class="atn"> class</span>
      <span name="x-equals" pos="49504" class="atneq">=</span>
      <span name="xml-att-quote" pos="49505" class="z">"</span>
      <span name="xml-literal-start" pos="49506" class="av">nextpage3</span>
      <span name="xml-att-quote" pos="49515" class="z">"</span>
      <span name="xml-literal-end" pos="49516" class="atn"> title</span>
      <span name="x-equals" pos="49522" class="atneq">=</span>
      <span name="xml-att-quote" pos="49523" class="z">"</span>
      <span name="nested-query" pos="49524" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49545" class="op">}</span>
      <span name="xml-att-quote" pos="49546" class="z">"</span>
      <span name="xml-literal-end" pos="49547" class="atn"> href</span>
      <span name="x-equals" pos="49552" class="atneq">=</span>
      <span name="xml-att-quote" pos="49553" class="z">"</span>
      <span name="xml-literal-start" pos="49554" class="av">search.xqy?</span>
      <span name="nested-query" pos="49565" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="49598" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49603" class="op">}</span>
      <span name="resume-x-literal" pos="49604" class="av">&amp;p=</span>
      <span name="nested-query" pos="49607" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">3</span>
      <span name="unnested-xquery" pos="49617" class="op">}</span>
      <span name="xml-att-quote" pos="49618" class="z">"</span>
      <span name="x-tag-end" pos="49619" class="z">&gt;</span>
      <span name="nested-query" pos="49620" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">3</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49641" class="op">}</span>
      <span pos="49642" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="49644" class="cl">a</span>
      <span name="x-tag-end" pos="49645" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="49681" class="op">}</span>
      <span name="resume-x-literal-txt" pos="49682" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="49696" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="49740" class="es">&lt;</span>
      <span name="xml-open-tag" pos="49741" class="en">a</span>
      <span name="xml-name-end" pos="49742" class="atn"> class</span>
      <span name="x-equals" pos="49748" class="atneq">=</span>
      <span name="xml-att-quote" pos="49749" class="z">"</span>
      <span name="xml-literal-start" pos="49750" class="av">nextpage4</span>
      <span name="xml-att-quote" pos="49759" class="z">"</span>
      <span name="xml-literal-end" pos="49760" class="atn"> title</span>
      <span name="x-equals" pos="49766" class="atneq">=</span>
      <span name="xml-att-quote" pos="49767" class="z">"</span>
      <span name="nested-query" pos="49768" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49789" class="op">}</span>
      <span name="xml-att-quote" pos="49790" class="z">"</span>
      <span name="xml-literal-end" pos="49791" class="atn"> href</span>
      <span name="x-equals" pos="49796" class="atneq">=</span>
      <span name="xml-att-quote" pos="49797" class="z">"</span>
      <span name="xml-literal-start" pos="49798" class="av">search.xqy?</span>
      <span name="nested-query" pos="49809" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="49842" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49847" class="op">}</span>
      <span name="resume-x-literal" pos="49848" class="av">&amp;p=</span>
      <span name="nested-query" pos="49851" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">4</span>
      <span name="unnested-xquery" pos="49861" class="op">}</span>
      <span name="xml-att-quote" pos="49862" class="z">"</span>
      <span name="x-tag-end" pos="49863" class="z">&gt;</span>
      <span name="nested-query" pos="49864" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">4</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="49885" class="op">}</span>
      <span pos="49886" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="49888" class="cl">a</span>
      <span name="x-tag-end" pos="49889" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="49925" class="op">}</span>
      <span name="resume-x-literal-txt" pos="49926" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="49940" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">5</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="49984" class="es">&lt;</span>
      <span name="xml-open-tag" pos="49985" class="en">a</span>
      <span name="xml-name-end" pos="49986" class="atn"> class</span>
      <span name="x-equals" pos="49992" class="atneq">=</span>
      <span name="xml-att-quote" pos="49993" class="z">"</span>
      <span name="xml-literal-start" pos="49994" class="av">nextpage5</span>
      <span name="xml-att-quote" pos="50003" class="z">"</span>
      <span name="xml-literal-end" pos="50004" class="atn"> title</span>
      <span name="x-equals" pos="50010" class="atneq">=</span>
      <span name="xml-att-quote" pos="50011" class="z">"</span>
      <span name="nested-query" pos="50012" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">5</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50033" class="op">}</span>
      <span name="xml-att-quote" pos="50034" class="z">"</span>
      <span name="xml-literal-end" pos="50035" class="atn"> href</span>
      <span name="x-equals" pos="50040" class="atneq">=</span>
      <span name="xml-att-quote" pos="50041" class="z">"</span>
      <span name="xml-literal-start" pos="50042" class="av">search.xqy?</span>
      <span name="nested-query" pos="50053" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="50086" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50091" class="op">}</span>
      <span name="resume-x-literal" pos="50092" class="av">&amp;p=</span>
      <span name="nested-query" pos="50095" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">5</span>
      <span name="unnested-xquery" pos="50105" class="op">}</span>
      <span name="xml-att-quote" pos="50106" class="z">"</span>
      <span name="x-tag-end" pos="50107" class="z">&gt;</span>
      <span name="nested-query" pos="50108" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">5</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50129" class="op">}</span>
      <span pos="50130" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="50132" class="cl">a</span>
      <span name="x-tag-end" pos="50133" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="50169" class="op">}</span>
      <span name="resume-x-literal-txt" pos="50170" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="50184" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">6</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="50228" class="es">&lt;</span>
      <span name="xml-open-tag" pos="50229" class="en">a</span>
      <span name="xml-name-end" pos="50230" class="atn"> class</span>
      <span name="x-equals" pos="50236" class="atneq">=</span>
      <span name="xml-att-quote" pos="50237" class="z">"</span>
      <span name="xml-literal-start" pos="50238" class="av">nextpage6</span>
      <span name="xml-att-quote" pos="50247" class="z">"</span>
      <span name="xml-literal-end" pos="50248" class="atn"> title</span>
      <span name="x-equals" pos="50254" class="atneq">=</span>
      <span name="xml-att-quote" pos="50255" class="z">"</span>
      <span name="nested-query" pos="50256" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">6</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50277" class="op">}</span>
      <span name="xml-att-quote" pos="50278" class="z">"</span>
      <span name="xml-literal-end" pos="50279" class="atn"> href</span>
      <span name="x-equals" pos="50284" class="atneq">=</span>
      <span name="xml-att-quote" pos="50285" class="z">"</span>
      <span name="xml-literal-start" pos="50286" class="av">search.xqy?</span>
      <span name="nested-query" pos="50297" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="50330" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50335" class="op">}</span>
      <span name="resume-x-literal" pos="50336" class="av">&amp;p=</span>
      <span name="nested-query" pos="50339" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">6</span>
      <span name="unnested-xquery" pos="50349" class="op">}</span>
      <span name="xml-att-quote" pos="50350" class="z">"</span>
      <span name="x-tag-end" pos="50351" class="z">&gt;</span>
      <span name="nested-query" pos="50352" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">6</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50373" class="op">}</span>
      <span pos="50374" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="50376" class="cl">a</span>
      <span name="x-tag-end" pos="50377" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="50413" class="op">}</span>
      <span name="resume-x-literal-txt" pos="50414" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="50428" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">7</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="50472" class="es">&lt;</span>
      <span name="xml-open-tag" pos="50473" class="en">a</span>
      <span name="xml-name-end" pos="50474" class="atn"> class</span>
      <span name="x-equals" pos="50480" class="atneq">=</span>
      <span name="xml-att-quote" pos="50481" class="z">"</span>
      <span name="xml-literal-start" pos="50482" class="av">nextpage7</span>
      <span name="xml-att-quote" pos="50491" class="z">"</span>
      <span name="xml-literal-end" pos="50492" class="atn"> title</span>
      <span name="x-equals" pos="50498" class="atneq">=</span>
      <span name="xml-att-quote" pos="50499" class="z">"</span>
      <span name="nested-query" pos="50500" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">7</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50521" class="op">}</span>
      <span name="xml-att-quote" pos="50522" class="z">"</span>
      <span name="xml-literal-end" pos="50523" class="atn"> href</span>
      <span name="x-equals" pos="50528" class="atneq">=</span>
      <span name="xml-att-quote" pos="50529" class="z">"</span>
      <span name="xml-literal-start" pos="50530" class="av">search.xqy?</span>
      <span name="nested-query" pos="50541" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="50574" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50579" class="op">}</span>
      <span name="resume-x-literal" pos="50580" class="av">&amp;p=</span>
      <span name="nested-query" pos="50583" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">7</span>
      <span name="unnested-xquery" pos="50593" class="op">}</span>
      <span name="xml-att-quote" pos="50594" class="z">"</span>
      <span name="x-tag-end" pos="50595" class="z">&gt;</span>
      <span name="nested-query" pos="50596" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">7</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50617" class="op">}</span>
      <span pos="50618" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="50620" class="cl">a</span>
      <span name="x-tag-end" pos="50621" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="50657" class="op">}</span>
      <span name="resume-x-literal-txt" pos="50658" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="50672" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">8</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="50716" class="es">&lt;</span>
      <span name="xml-open-tag" pos="50717" class="en">a</span>
      <span name="xml-name-end" pos="50718" class="atn"> class</span>
      <span name="x-equals" pos="50724" class="atneq">=</span>
      <span name="xml-att-quote" pos="50725" class="z">"</span>
      <span name="xml-literal-start" pos="50726" class="av">nextpage8</span>
      <span name="xml-att-quote" pos="50735" class="z">"</span>
      <span name="xml-literal-end" pos="50736" class="atn"> title</span>
      <span name="x-equals" pos="50742" class="atneq">=</span>
      <span name="xml-att-quote" pos="50743" class="z">"</span>
      <span name="nested-query" pos="50744" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">8</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50765" class="op">}</span>
      <span name="xml-att-quote" pos="50766" class="z">"</span>
      <span name="xml-literal-end" pos="50767" class="atn"> href</span>
      <span name="x-equals" pos="50772" class="atneq">=</span>
      <span name="xml-att-quote" pos="50773" class="z">"</span>
      <span name="xml-literal-start" pos="50774" class="av">search.xqy?</span>
      <span name="nested-query" pos="50785" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="50818" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50823" class="op">}</span>
      <span name="resume-x-literal" pos="50824" class="av">&amp;p=</span>
      <span name="nested-query" pos="50827" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">8</span>
      <span name="unnested-xquery" pos="50837" class="op">}</span>
      <span name="xml-att-quote" pos="50838" class="z">"</span>
      <span name="x-tag-end" pos="50839" class="z">&gt;</span>
      <span name="nested-query" pos="50840" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">8</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="50861" class="op">}</span>
      <span pos="50862" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="50864" class="cl">a</span>
      <span name="x-tag-end" pos="50865" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="50901" class="op">}</span>
      <span name="resume-x-literal-txt" pos="50902" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="50916" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="6" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="11" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="13" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="15" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">and</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="22" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="29" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="30" prev-is-closed="false" class="numeric">9</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="34" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="35" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="41" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="42" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="43" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="44" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="48" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="50978" class="es">&lt;</span>
      <span name="xml-open-tag" pos="50979" class="en">a</span>
      <span name="xml-name-end" pos="50980" class="atn"> class</span>
      <span name="x-equals" pos="50986" class="atneq">=</span>
      <span name="xml-att-quote" pos="50987" class="z">"</span>
      <span name="xml-literal-start" pos="50988" class="av">nextpage9</span>
      <span name="xml-att-quote" pos="50997" class="z">"</span>
      <span name="xml-literal-end" pos="50998" class="atn"> title</span>
      <span name="x-equals" pos="51004" class="atneq">=</span>
      <span name="xml-att-quote" pos="51005" class="z">"</span>
      <span name="nested-query" pos="51006" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">9</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="51027" class="op">}</span>
      <span name="xml-att-quote" pos="51028" class="z">"</span>
      <span name="xml-literal-end" pos="51029" class="atn"> href</span>
      <span name="x-equals" pos="51034" class="atneq">=</span>
      <span name="xml-att-quote" pos="51035" class="z">"</span>
      <span name="xml-literal-start" pos="51036" class="av">search.xqy?</span>
      <span name="nested-query" pos="51047" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="51080" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="51085" class="op">}</span>
      <span name="resume-x-literal" pos="51086" class="av">&amp;p=</span>
      <span name="nested-query" pos="51089" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">9</span>
      <span name="unnested-xquery" pos="51099" class="op">}</span>
      <span name="xml-att-quote" pos="51100" class="z">"</span>
      <span name="x-tag-end" pos="51101" class="z">&gt;</span>
      <span name="nested-query" pos="51102" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="numeric">9</span>
      <span xq="yes" start="20" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="51123" class="op">}</span>
      <span pos="51124" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="51126" class="cl">a</span>
      <span name="x-tag-end" pos="51127" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="51163" class="op">}</span>
      <span name="resume-x-literal-txt" pos="51164" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="51178" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$page</span>
      <span xq="yes" start="10" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="12" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="13" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">&lt;=</span>
      <span xq="yes" start="17" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="18" prev-is-closed="false" class="variable">$pages</span>
      <span xq="yes" start="24" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="25" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="26" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="30" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="51222" class="es">&lt;</span>
      <span name="xml-open-tag" pos="51223" class="en">a</span>
      <span name="xml-name-end" pos="51224" class="atn"> class</span>
      <span name="x-equals" pos="51230" class="atneq">=</span>
      <span name="xml-att-quote" pos="51231" class="z">"</span>
      <span name="xml-literal-start" pos="51232" class="av">nextpage</span>
      <span name="xml-att-quote" pos="51240" class="z">"</span>
      <span name="xml-literal-end" pos="51241" class="atn"> title</span>
      <span name="x-equals" pos="51247" class="atneq">=</span>
      <span name="xml-att-quote" pos="51248" class="z">"</span>
      <span name="xml-literal-start" pos="51249" class="av">Go to Next Page</span>
      <span name="xml-att-quote" pos="51264" class="z">"</span>
      <span name="xml-literal-end" pos="51265" class="atn"> href</span>
      <span name="x-equals" pos="51270" class="atneq">=</span>
      <span name="xml-att-quote" pos="51271" class="z">"</span>
      <span name="xml-literal-start" pos="51272" class="av">search.xqy?</span>
      <span name="nested-query" pos="51283" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="30" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="31" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="51316" xq="yes">p</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="51321" class="op">}</span>
      <span name="resume-x-literal" pos="51322" class="av">&amp;p=</span>
      <span name="nested-query" pos="51325" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$page</span>
      <span xq="yes" start="6" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">+</span>
      <span xq="yes" start="8" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="9" prev-is-closed="false" class="numeric">1</span>
      <span name="unnested-xquery" pos="51335" class="op">}</span>
      <span name="xml-att-quote" pos="51336" class="z">"</span>
      <span name="x-tag-end" pos="51337" class="z">&gt;</span>
      <span pos="51338" class="txt">Next Page &amp;raquo;</span>
      <span pos="51355" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="51357" class="cl">a</span>
      <span name="x-tag-end" pos="51358" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="51394" class="op">}</span>
      <span name="resume-x-literal-txt" pos="51395" class="txt">&#xD;
        </span>
      <span pos="51405" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="51407" class="cl">div</span>
      <span name="x-tag-end" pos="51410" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
	</span>
      <span xq="yes" start="4" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="5" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="7" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="8" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="12" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="function">filter-description</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="54" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="55" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="57" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="58" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="66" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="72" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="73" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="74" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="75" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="77" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="78" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="86" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="87" prev-is-closed="true" class="quantifier">*</span>
      <span xq="yes" start="88" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="90" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="91" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="97" prev-is-closed="false" class="higher">let</span>
      <span xq="yes" start="100" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="101" prev-is-closed="false" class="variable">$search-items</span>
      <span xq="yes" start="114" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="117" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="118" prev-is-closed="false" class="function">report-on-search-items</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="141" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="148" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="149" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="155" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="161" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="171" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="173" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="174" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="175" prev-is-closed="false" class="variable">$search-items</span>
      <span xq="yes" start="188" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="189" prev-is-closed="false" class="qname">param</span>
      <span xq="yes" start="194" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="195" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="196" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="200" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span pos="51620" class="es">&lt;</span>
      <span name="xml-open-tag" pos="51621" class="en">div</span>
      <span name="xml-name-end" pos="51624" class="atn"> class</span>
      <span name="x-equals" pos="51630" class="atneq">=</span>
      <span name="xml-att-quote" pos="51631" class="z">"</span>
      <span name="xml-literal-start" pos="51632" class="av">query_description</span>
      <span name="xml-att-quote" pos="51649" class="z">"</span>
      <span name="x-tag-end" pos="51650" class="z">&gt;</span>
      <span pos="51651" class="txt">&#xD;
            Filters </span>
      <span pos="51673" class="es">&lt;</span>
      <span name="xml-open-tag" pos="51674" class="en">span</span>
      <span name="x-tag-end" pos="51678" class="z">&gt;</span>
      <span pos="51679" class="txt">for</span>
      <span pos="51682" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="51684" class="cl">span</span>
      <span name="x-tag-end" pos="51688" class="z">&gt;</span>
      <span name="nested-query" pos="51689" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="51690" xq="yes"> </span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="51693" class="op">}</span>
      <span name="resume-x-literal-txt" pos="51694" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="51708" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="15" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="24" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="25" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="27" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="28" prev-is-closed="true" class="variable">$tpos</span>
      <span xq="yes" start="33" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="34" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="36" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="37" prev-is-closed="false" class="variable">$search-items</span>
      <span xq="yes" start="50" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="51" prev-is-closed="false" class="qname">param</span>
      <span xq="yes" start="56" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="57" prev-is-closed="false" class="qname">type</span>
      <span xq="yes" start="61" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="75" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="78" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="79" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="90" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="91" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="93" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="94" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="103" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="104" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="106" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="107" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="112" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="113" prev-is-closed="false" class="axis">parent::</span>
      <span xq="yes" start="121" prev-is-closed="false" class="qname">param</span>
      <span xq="yes" start="126" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="127" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="128" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="133" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="147" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="150" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="151" prev-is-closed="false" class="variable">$type-name</span>
      <span xq="yes" start="161" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="162" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="164" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="165" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="174" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="175" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="177" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="178" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="183" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="184" prev-is-closed="false" class="axis">@</span>
      <span xq="yes" start="185" prev-is-closed="false" class="qname">value</span>
      <span xq="yes" start="190" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="204" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="207" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="208" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="214" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="215" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="217" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="218" prev-is-closed="false" class="function">get-search-items-of-type</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="243" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="254" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="255" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="256" prev-is-closed="false" class="variable">$type-name</span>
      <span xq="yes" start="266" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="267" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="268" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="275" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="276" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="290" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="296" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="314" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="315" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="317" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="318" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="319" prev-is-closed="false" class="variable">$tpos</span>
      <span xq="yes" start="324" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="325" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="326" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="327" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="328" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="329" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="330" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="334" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="52043" xq="yes">, </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span pos="52074" class="es">&lt;</span>
      <span name="xml-open-tag" pos="52075" class="en">span</span>
      <span name="x-tag-end" pos="52079" class="z">&gt;</span>
      <span name="nested-query" pos="52080" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$type-name</span>
      <span name="unnested-xquery" pos="52091" class="op">}</span>
      <span name="resume-x-literal-txt" pos="52092" class="txt"> = &#xD;
                </span>
      <span name="nested-query" pos="52113" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                    </span>
      <span xq="yes" start="23" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="26" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="27" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="32" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="33" prev-is-closed="true" class="qname">at</span>
      <span xq="yes" start="35" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="36" prev-is-closed="true" class="variable">$ipos</span>
      <span xq="yes" start="41" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="42" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="45" prev-is-closed="false" class="variable">$items</span>
      <span xq="yes" start="51" prev-is-closed="true" class="whitespace">&#xD;
                    </span>
      <span xq="yes" start="73" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="79" prev-is-closed="false" class="whitespace">&#xD;
                        </span>
      <span xq="yes" start="105" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="106" prev-is-closed="false" class="if">if</span>
      <span xq="yes" start="108" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="109" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="110" prev-is-closed="false" class="variable">$ipos</span>
      <span xq="yes" start="115" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="116" prev-is-closed="true" class="op">&gt;</span>
      <span xq="yes" start="117" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="118" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="119" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="120" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="121" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="125" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="52239" xq="yes"> OR </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="2" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="6" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="7" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="8" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="9" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span pos="52255" class="es">&lt;</span>
      <span name="xml-open-tag" pos="52256" class="en">b</span>
      <span name="x-tag-end" pos="52257" class="z">&gt;</span>
      <span name="nested-query" pos="52258" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="function">capitalize-first-chars</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="29" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="52288" class="op">}</span>
      <span pos="52289" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="52291" class="cl">b</span>
      <span name="x-tag-end" pos="52292" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="52295" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
                        </span>
      <span pos="52325" class="es">&lt;</span>
      <span name="xml-open-tag" pos="52326" class="en">a</span>
      <span name="xml-name-end" pos="52327" class="atn"> href</span>
      <span name="x-equals" pos="52332" class="atneq">=</span>
      <span name="xml-att-quote" pos="52333" class="z">"</span>
      <span name="xml-literal-start" pos="52334" class="av">search.xqy?</span>
      <span name="nested-query" pos="52345" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="51" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="52" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="53" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="64" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="65" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="76" prev-is-closed="false" class="variable">$type-name</span>
      <span xq="yes" start="86" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="52432" xq="yes">:</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="7" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="8" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="9" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="10" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="11" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="12" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="13" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="52448" class="op">}</span>
      <span name="xml-att-quote" pos="52449" class="z">"</span>
      <span name="x-tag-end" pos="52450" class="z">&gt;</span>
      <span pos="52451" class="txt">[x]</span>
      <span pos="52454" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="52456" class="cl">a</span>
      <span name="x-tag-end" pos="52457" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span name="unnested-xquery" pos="52477" class="op">}</span>
      <span name="resume-x-literal-txt" pos="52478" class="txt">&#xD;
                </span>
      <span pos="52496" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="52498" class="cl">span</span>
      <span name="x-tag-end" pos="52502" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="19" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="20" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span name="unnested-xquery" pos="52536" class="op">}</span>
      <span name="resume-x-literal-txt" pos="52537" class="txt">&#xD;
            </span>
      <span name="nested-query" pos="52551" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="if">if</span>
      <span xq="yes" start="3" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="4" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="5" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="12" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="13" prev-is-closed="false" class="qname">dur</span>
      <span xq="yes" start="16" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="17" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="18" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="19" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="20" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="true" class="op">then</span>
      <span xq="yes" start="25" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="39" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="52591" xq="yes"> during the last </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span pos="52612" class="es">&lt;</span>
      <span name="xml-open-tag" pos="52613" class="en">b</span>
      <span name="x-tag-end" pos="52614" class="z">&gt;</span>
      <span name="nested-query" pos="52615" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">fn:translate</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="14" prev-is-closed="false" class="function">fn:string</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="24" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="31" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="32" prev-is-closed="false" class="qname">dur</span>
      <span xq="yes" start="35" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="36" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="37" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="38" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="39" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="40" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="52656" xq="yes">PD</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="52662" xq="yes"/>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="52665" class="op">}</span>
      <span name="resume-x-literal-txt" pos="52666" class="txt"/>
      <span name="nested-query" pos="52666" class="op">{</span>
      <span class="op">"</span>
      <span class="literal" pos="52667" xq="yes"> days</span>
      <span class="op">"</span>
      <span name="unnested-xquery" pos="52674" class="op">}</span>
      <span pos="52675" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="52677" class="cl">b</span>
      <span name="x-tag-end" pos="52678" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="52681" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace">&#xD;
            </span>
      <span pos="52699" class="es">&lt;</span>
      <span name="xml-open-tag" pos="52700" class="en">a</span>
      <span name="xml-name-end" pos="52701" class="atn"> href</span>
      <span name="x-equals" pos="52706" class="atneq">=</span>
      <span name="xml-att-quote" pos="52707" class="z">"</span>
      <span name="xml-literal-start" pos="52708" class="av">search.xqy?</span>
      <span name="nested-query" pos="52719" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="function">uit:build-querystring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="23" prev-is-closed="false" class="function">uit:modify-param-set</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="51" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="52" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="52772" xq="yes">dur</span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="3" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="10" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="11" prev-is-closed="false" class="qname">dur</span>
      <span xq="yes" start="14" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="15" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="16" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="20" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="21" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="22" prev-is-closed="true" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="52799" class="op">}</span>
      <span name="xml-att-quote" pos="52800" class="z">"</span>
      <span name="x-tag-end" pos="52801" class="z">&gt;</span>
      <span pos="52802" class="txt">[x]</span>
      <span pos="52805" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="52807" class="cl">a</span>
      <span name="x-tag-end" pos="52808" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="16" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="20" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="21" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="22" prev-is-closed="false" class="parenthesis">)</span>
      <span name="unnested-xquery" pos="52831" class="op">}</span>
      <span name="resume-x-literal-txt" pos="52832" class="txt">&#xD;
        </span>
      <span pos="52842" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="52844" class="cl">div</span>
      <span name="x-tag-end" pos="52847" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="11" prev-is-closed="true" class="op">else</span>
      <span xq="yes" start="15" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="16" prev-is-closed="false" class="parenthesis">(</span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">)</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="20" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="21" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="25" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="31" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="32" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="41" prev-is-closed="true" class="qname">get-search-items-of-type</span>
      <span xq="yes" start="65" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="66" prev-is-closed="true" class="parenthesis">(</span>
      <span xq="yes" start="67" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="73" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="84" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="85" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="87" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="88" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="97" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="98" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="104" prev-is-closed="false" class="variable">$type-name</span>
      <span xq="yes" start="114" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="115" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="117" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="118" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="127" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="128" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="134" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="141" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="142" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="144" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="145" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="153" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="159" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="160" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="161" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="162" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="164" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="165" prev-is-closed="false" class="type-name">xs:string*</span>
      <span xq="yes" start="175" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="177" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="178" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="184" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="187" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="188" prev-is-closed="false" class="variable">$i</span>
      <span xq="yes" start="190" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="191" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="193" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="194" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="201" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="202" prev-is-closed="false" class="qname">*</span>
      <span xq="yes" start="203" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="204" prev-is-closed="false" class="function">fn:local-name</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="218" prev-is-closed="false" class="context">.</span>
      <span xq="yes" start="219" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="220" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="221" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="222" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="223" prev-is-closed="false" class="variable">$param-name</span>
      <span xq="yes" start="234" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="235" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="241" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="244" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="245" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="252" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="253" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="255" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="256" prev-is-closed="false" class="function">split-search-item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="274" prev-is-closed="false" class="variable">$i</span>
      <span xq="yes" start="276" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="277" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="283" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="288" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="289" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="296" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="297" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="298" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="299" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="300" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="301" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="302" prev-is-closed="false" class="variable">$type-name</span>
      <span xq="yes" start="312" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="318" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="324" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="325" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="332" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="333" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="334" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="335" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="337" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="338" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="342" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="348" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="349" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="357" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="358" prev-is-closed="true" class="function">report-on-search-items</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="381" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="388" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="389" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="391" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="392" prev-is-closed="false" class="node-type">element</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="400" prev-is-closed="false" class="qname">params</span>
      <span xq="yes" start="406" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="407" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="408" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="410" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="411" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="53264" class="es">&lt;</span>
      <span name="xml-open-tag" pos="53265" class="en">search-item-types</span>
      <span name="x-tag-end" pos="53282" class="z">&gt;</span>
      <span name="nested-query" pos="53283" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$i</span>
      <span xq="yes" start="13" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="14" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="16" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="false" class="parenthesis">(</span>
      <span class="op">"</span>
      <span class="literal" pos="53301" xq="yes">hval</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="53309" xq="yes">val</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="2" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="53316" xq="yes">col</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="8" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="11" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="12" prev-is-closed="false" class="variable">$types</span>
      <span xq="yes" start="18" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="21" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="31" prev-is-closed="false" class="function">fn:distinct-values</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="50" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="60" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="63" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="64" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="69" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="70" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="72" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="73" prev-is-closed="false" class="variable">$params</span>
      <span xq="yes" start="80" prev-is-closed="true" class="step">/</span>
      <span xq="yes" start="81" prev-is-closed="false" class="qname">*</span>
      <span xq="yes" start="82" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="83" prev-is-closed="false" class="function">fn:local-name</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="97" prev-is-closed="false" class="context">.</span>
      <span xq="yes" start="98" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="99" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="102" prev-is-closed="false" class="variable">$i</span>
      <span xq="yes" start="104" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="105" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="115" prev-is-closed="true" class="higher">let</span>
      <span xq="yes" start="118" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="119" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="126" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="127" prev-is-closed="true" class="op">:=</span>
      <span xq="yes" start="129" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="130" prev-is-closed="false" class="function">split-search-item</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="148" prev-is-closed="false" class="variable">$item</span>
      <span xq="yes" start="153" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="154" prev-is-closed="true" class="whitespace"> &#xD;
        </span>
      <span xq="yes" start="165" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="170" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="171" prev-is-closed="false" class="function">fn:not</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="178" prev-is-closed="false" class="function">fn:lower-case</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="192" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="199" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="200" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="201" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="202" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="203" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="204" prev-is-closed="true" class="op">=</span>
      <span xq="yes" start="205" prev-is-closed="false" class="whitespace"> </span>
      <span class="op">"</span>
      <span class="literal" pos="53526" xq="yes">all</span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="12" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="18" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="19" prev-is-closed="false" class="variable">$tokens</span>
      <span xq="yes" start="26" prev-is-closed="true" class="filter">[</span>
      <span xq="yes" start="27" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="28" prev-is-closed="true" class="filter">]</span>
      <span xq="yes" start="29" prev-is-closed="true" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="39" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="40" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="46" prev-is-closed="true" class="op">where</span>
      <span xq="yes" start="51" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="52" prev-is-closed="false" class="variable">$types</span>
      <span xq="yes" start="58" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="64" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="70" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span pos="53606" class="es">&lt;</span>
      <span name="xml-open-tag" pos="53607" class="en">param</span>
      <span name="xml-name-end" pos="53612" class="atn"> value</span>
      <span name="x-equals" pos="53618" class="atneq">=</span>
      <span name="xml-att-quote" pos="53619" class="z">"</span>
      <span name="nested-query" pos="53620" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$i</span>
      <span name="unnested-xquery" pos="53623" class="op">}</span>
      <span name="xml-att-quote" pos="53624" class="z">"</span>
      <span name="x-tag-end" pos="53625" class="z">&gt;</span>
      <span name="nested-query" pos="53626" class="op">{</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="higher">for</span>
      <span xq="yes" start="10" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="11" prev-is-closed="false" class="variable">$type</span>
      <span xq="yes" start="16" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="17" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="20" prev-is-closed="false" class="variable">$types</span>
      <span xq="yes" start="26" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="32" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="38" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span pos="53674" class="es">&lt;</span>
      <span name="xml-open-tag" pos="53675" class="en">type</span>
      <span name="xml-name-end" pos="53679" class="atn"> value</span>
      <span name="x-equals" pos="53685" class="atneq">=</span>
      <span name="xml-att-quote" pos="53686" class="z">"</span>
      <span name="nested-query" pos="53687" class="op">{</span>
      <span xq="yes" start="1" prev-is-closed="true" class="variable">$type</span>
      <span name="unnested-xquery" pos="53693" class="op">}</span>
      <span name="xml-att-quote" pos="53694" class="z">"</span>
      <span name="x-tag-end" pos="53695" class="z">/&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span name="unnested-xquery" pos="53703" class="op">}</span>
      <span pos="53704" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="53706" class="cl">param</span>
      <span name="x-tag-end" pos="53711" class="z">&gt;</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span name="unnested-xquery" pos="53718" class="op">}</span>
      <span pos="53719" class="sc">&lt;/</span>
      <span name="xml-close-tag" pos="53721" class="cl">search-item-types</span>
      <span name="x-tag-end" pos="53738" class="z">&gt;</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="3" prev-is-closed="true" class="op">}</span>
      <span xq="yes" start="4" prev-is-closed="true" class="whitespace">&#xD;
&#xD;
</span>
      <span xq="yes" start="8" prev-is-closed="true" class="qname">define</span>
      <span xq="yes" start="14" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="15" prev-is-closed="true" class="qname">function</span>
      <span xq="yes" start="23" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="24" prev-is-closed="true" class="function">capitalize-first-chars</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="47" prev-is-closed="false" class="variable">$text</span>
      <span xq="yes" start="52" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="53" prev-is-closed="true" class="op">as</span>
      <span xq="yes" start="55" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="56" prev-is-closed="false" class="type-name">xs:string</span>
      <span xq="yes" start="65" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="66" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="68" prev-is-closed="true" class="op">{</span>
      <span xq="yes" start="69" prev-is-closed="false" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="75" prev-is-closed="false" class="function">fn:string-join</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="90" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span xq="yes" start="100" prev-is-closed="false" class="higher">for</span>
      <span xq="yes" start="103" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="104" prev-is-closed="false" class="variable">$tok</span>
      <span xq="yes" start="108" prev-is-closed="true" class="whitespace"> </span>
      <span xq="yes" start="109" prev-is-closed="true" class="op">in</span>
      <span xq="yes" start="111" prev-is-closed="false" class="whitespace"> </span>
      <span xq="yes" start="112" prev-is-closed="false" class="function">fn:tokenize</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="124" prev-is-closed="false" class="variable">$text</span>
      <span xq="yes" start="129" prev-is-closed="true" class="op">,</span>
      <span class="op">"</span>
      <span class="literal" pos="53868" xq="yes"> </span>
      <span class="op">"</span>
      <span class="open"/>
      <span xq="yes" start="1" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="2" prev-is-closed="true" class="whitespace"> &#xD;
        </span>
      <span xq="yes" start="13" prev-is-closed="true" class="op">return</span>
      <span xq="yes" start="19" prev-is-closed="false" class="whitespace"> &#xD;
            </span>
      <span xq="yes" start="34" prev-is-closed="false" class="function">fn:concat</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="44" prev-is-closed="false" class="whitespace"> &#xD;
                </span>
      <span xq="yes" start="63" prev-is-closed="false" class="function">fn:upper-case</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="77" prev-is-closed="false" class="function">fn:substring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="90" prev-is-closed="false" class="variable">$tok</span>
      <span xq="yes" start="94" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="95" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="96" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="97" prev-is-closed="false" class="numeric">1</span>
      <span xq="yes" start="98" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="99" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="100" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="101" prev-is-closed="false" class="whitespace">&#xD;
                </span>
      <span xq="yes" start="119" prev-is-closed="false" class="function">fn:substring</span>
      <span class="parenthesis">(</span>
      <span xq="yes" start="132" prev-is-closed="false" class="variable">$tok</span>
      <span xq="yes" start="136" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="137" prev-is-closed="false" class="numeric">2</span>
      <span xq="yes" start="138" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="139" prev-is-closed="true" class="whitespace">&#xD;
            </span>
      <span xq="yes" start="153" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="154" prev-is-closed="true" class="op">,</span>
      <span xq="yes" start="155" prev-is-closed="false" class="whitespace">&#xD;
        </span>
      <span class="op">"</span>
      <span class="literal" pos="54035" xq="yes"> </span>
      <span class="op">"</span>
      <span xq="yes" start="1" prev-is-closed="true" class="whitespace">&#xD;
    </span>
      <span xq="yes" start="7" prev-is-closed="true" class="parenthesis">)</span>
      <span xq="yes" start="8" prev-is-closed="true" class="whitespace">&#xD;
</span>
      <span xq="yes" start="10" prev-is-closed="true" class="op">}</span>
   </tokens>
</result>
