<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>XMLSpectrum output</title></head><body><div><pre class="spectrum" style="&#xA;    margin:0px;&#xA;    font-family:'Source Code Pro', monospace;&#xA;    font-size: 0.8em;&#xA;    white-space: pre-wrap;&#xA;    display: block;&#xA;    border: none thin;&#xA;    border-color: #405075;&#xA;    background-color:#002b36;&#xA;    padding: 2px;&#xA;    margin-bottom:5px;&#xA;"><span class="z" style="color: #586e75">&lt;?</span><span class="pi" style="color: #2aa198">xml version="1.0" encoding="utf-8"</span><span class="z" style="color: #586e75">?&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
A frontend for XMLSpectrum by Phil Fearon Qutoric Limited 2012 (c)

http://qutoric.com
License: Apache 2.0 http://www.apache.org/licenses/LICENSE-2.0.html

Purpose: Syntax highlighter for XPath (text), XML, XSLT and XSD 1.1 file formats

Description:

A sample XSLT stylesheet that exploits xmlspectrum.xsl

Takes the input file specified in the sourcepath XSLT parameter and generates an
HTML output file ( plus also include/import files if link-names=yes ) and a CSS file.

The input file may be 1 of 4 types:

1. XSLT 1.0 or 2.0
2. XSD 1.0 or 1.1
3. Generic XML
4. Plain-text XPath

Note that this file interface is a simple wrapper for xmlspectrum.xsl. This front-end
will auto-detect whether the file is XSLT, XSD or XPath based on well-formedness and
namespaces. If you're converting XML samples that are not well-formed or contained within
other XML you can code your own interface XSLT.

Dependencies:

1. xmlspectrum.xsl

Usage:

initial-template: 'main'
source-xml: (not used)
xsl parameters:
    sourcepath:  path or URI for source file
    color-theme: name of color-theme - default is 'solarized dark'
    link-names:  (yes|no) [Default:'no']
                 processes all linked xsl files and adds hrefs
                 for variables, functions, parameters and named templates
    css-path:    (path for output CSS)
    output-path: path in which to create html files - default is 'output/'
    output-method: [html|xml] default:html - for xml, no css file is created

Sample transform using Saxon-HE/Java on command-line (unbroken line):

java -cp "C:\Program Files (x86)\Saxon\saxon9he.jar" net.sf.saxon.Transform -t -it:main
-xsl:xsl/highlight-file.xsl sourcepath=../samples/xpathcolorer-x.xsl

</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:stylesheet</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">version</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">2.0</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">xmlns:xsl</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">http://www.w3.org/1999/XSL/Transform</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">xmlns:xs</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">http://www.w3.org/2001/XMLSchema</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">xmlns:loc</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">com.qutoric.sketchpath.functions</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">xmlns:css</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-defs.com</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">exclude-result-prefixes</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc f xs css</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">xmlns</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">xmlns:f</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">internal</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:import</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">href</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="href" style="color: #6c71c4">xmlspectrum.xsl</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:import</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">href</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="href" style="color: #6c71c4">make-toc.xsl</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:output</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">indent</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">no</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">method</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">html</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">sourcepath</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">  by default - rely on original indentation </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">indent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">2</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">color-theme</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">dark</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">css-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">auto-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">no</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">link-names</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">no</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">output-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">output/</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> set value to 'scp' for source-code-pro font </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">font-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">scp</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> set value to 'xml' or 'xhtml' for use in XProc step </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">output-method</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">html</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> set value to 'yes' to embed css inline with element </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">css-inline</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">no</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> identifies xslt/schematron/xproc etc - not required if root namespace can be used </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">document-type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">document-type-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> 
  w3c-xpath-functions-uri is use to add hyperlinks to built-in
  xpath functions when 'link-names' = 'yes'
  set uri to a proxy server storing the W3C resource to avoid
  excessive calls to the W3C server
   </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">w3c-xpath-functions-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
             </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">http://www.w3.org/TR/xpath-functions/</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">do-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$auto-trim</span><span class="whitespace" start="11" style="color: #b58900"> </span><span class="op" start="12" style="color: #b58900">eq</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="15" style="color: #93a1a1">yes</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">do-link</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$link-names</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">yes</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="19" select="quick" style="color: #cb4b16">xs:integer</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="12" select="quick" style="color: #d33682">$indent</span><span class="parenthesis" start="19" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">css-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">theme.css</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">do-output-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="higher" start="1" style="color: #b58900">for</span><span class="whitespace" start="4" style="color: #b58900"> </span><span id="rng-$c" class="variable" start="5" select="quick" style="color: #d33682">$c</span><span class="whitespace" start="7" style="color: #b58900"> </span><span class="op" start="8" style="color: #b58900">in</span><span class="whitespace" start="10" style="color: #b58900"> </span><span class="function" start="11" pair-end="37" select="quick" style="color: #cb4b16">f:path-to-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="25" select="quick" style="color: #d33682">$output-path</span><span class="parenthesis" start="37" style="color: #268bd2">)</span><span class="whitespace" start="38" style="color: #b58900"> </span><span class="op" start="39" style="color: #b58900">return</span><span class="whitespace" start="45" style="color: #b58900">
                        </span><span class="if" start="46" style="color: #b58900">if</span><span class="whitespace" start="48" style="color: #b58900"> </span><span class="parenthesis" start="49" pair-end="68" select="quick" style="color: #268bd2">(</span><span class="function" start="50" pair-end="67" select="quick" style="color: #cb4b16">ends-with</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="60" select="quick" style="color: #d33682">$c</span><span class="op" start="62" style="color: #b58900">,</span><span class="whitespace" start="63" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="64" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="67" style="color: #268bd2">)</span><span class="parenthesis" start="68" style="color: #268bd2">)</span><span class="whitespace" start="69" style="color: #b58900">
                        </span><span class="op" start="70" style="color: #b58900">then</span><span class="whitespace" start="74" style="color: #b58900"> </span><span class="variable" start="75" select="quick" style="color: #d33682">$c</span><span class="whitespace" start="77" style="color: #b58900">
                        </span><span class="op" start="78" style="color: #b58900">else</span><span class="whitespace" start="82" style="color: #b58900"> </span><span class="function" start="83" pair-end="97" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="90" select="quick" style="color: #d33682">$c</span><span class="op" start="92" style="color: #b58900">,</span><span class="whitespace" start="93" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="94" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="97" style="color: #268bd2">)</span><span class="whitespace" start="98" style="color: #b58900">
                        </span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> use only if file is know to be well-formed, otherwise use 'main' template </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="step" start="1" style="color: #b58900">/</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-qname</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="12" select="quick" style="color: #cb4b16">node-name</span><span class="parenthesis" style="color: #268bd2">(</span><span class="qname" start="11" select="quick" style="color: #6c71c4">*</span><span class="parenthesis" start="12" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:QName</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="parenthesis" start="1" pair-end="36" select="quick" style="color: #268bd2">(</span><span class="function" start="2" pair-end="31" select="quick" style="color: #cb4b16">prefix-from-QName</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="20" select="quick" style="color: #d33682">$root-qname</span><span class="parenthesis" start="31" style="color: #268bd2">)</span><span class="op" start="32" style="color: #b58900">,</span><span class="whitespace" start="33" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="34" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="36" style="color: #268bd2">)</span><span class="filter" start="37" pair-end="39" select="quick" style="color: #268bd2">[</span><span class="numeric" start="38" style="color: #2aa198">1</span><span class="filter" start="39" style="color: #268bd2">]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-namespace</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="37" select="quick" style="color: #cb4b16">namespace-uri-from-QName</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="26" select="quick" style="color: #d33682">$root-qname</span><span class="parenthesis" start="37" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                  </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="25" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$document-type</span><span class="whitespace" start="19" style="color: #b58900"> </span><span class="op" start="20" style="color: #b58900">ne</span><span class="whitespace" start="22" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="23" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="25" style="color: #268bd2">)</span><span class="whitespace" start="26" style="color: #b58900"> </span><span class="op" start="27" style="color: #b58900">then</span><span class="whitespace" start="31" style="color: #b58900">
                          </span><span class="variable" start="32" select="quick" style="color: #d33682">$document-type</span><span class="whitespace" start="46" style="color: #b58900">
                          </span><span class="op" start="47" style="color: #b58900">else</span><span class="whitespace" start="51" style="color: #b58900"> </span><span class="function" start="52" pair-end="90" select="quick" style="color: #cb4b16">f:doctype-from-xmlns</span><span class="parenthesis" style="color: #268bd2">(</span><span class="qname" start="73" select="quick" style="color: #6c71c4">*</span><span class="step" start="74" style="color: #b58900">/</span><span class="function" start="75" pair-end="89" select="quick" style="color: #cb4b16">namespace-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="89" style="color: #268bd2">)</span><span class="parenthesis" start="90" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">all-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">get-result-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">input-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="10" select="quick" style="color: #cb4b16">base-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="10" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xml</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="6" select="quick" style="color: #cb4b16">true</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="6" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="32" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$document-type-prefix</span><span class="whitespace" start="26" style="color: #b58900"> </span><span class="op" start="27" style="color: #b58900">ne</span><span class="whitespace" start="29" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="30" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="32" style="color: #268bd2">)</span><span class="whitespace" start="33" style="color: #b58900"> </span><span class="op" start="34" style="color: #b58900">then</span><span class="whitespace" start="38" style="color: #b58900"> </span><span class="variable" start="39" select="quick" style="color: #d33682">$document-type-prefix</span><span class="whitespace" start="60" style="color: #b58900">
                                                   </span><span class="op" start="61" style="color: #b58900">else</span><span class="whitespace" start="65" style="color: #b58900"> </span><span class="variable" start="66" select="quick" style="color: #d33682">$root-prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:message</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">processing</span><span class="op" style="color: #b58900">'</span><span class="op" start="13" style="color: #b58900">,</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="function" start="15" pair-end="31" select="quick" style="color: #cb4b16">count</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="21" select="quick" style="color: #d33682">$all-spans</span><span class="parenthesis" start="31" style="color: #268bd2">)</span><span class="op" start="32" style="color: #b58900">,</span><span class="whitespace" start="33" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="34" style="color: #93a1a1">tokens for</span><span class="op" style="color: #b58900">'</span><span class="op" start="46" style="color: #b58900">,</span><span class="whitespace" start="47" style="color: #b58900"> </span><span class="function" start="48" pair-end="57" select="quick" style="color: #cb4b16">base-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="57" style="color: #268bd2">)</span><span class="op" start="58" style="color: #b58900">,</span><span class="whitespace" start="59" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="60" style="color: #93a1a1">css-inline:</span><span class="op" style="color: #b58900">'</span><span class="op" start="73" style="color: #b58900">,</span><span class="whitespace" start="74" style="color: #b58900"> </span><span class="variable" start="75" select="quick" style="color: #d33682">$css-inline</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:text</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">disable-output-escaping</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">'</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">'</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">&amp;lt;!DOCTYPE html&gt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">html</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">head</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">title</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">XMLSpectrum output</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">title</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-inline</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">no</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">style</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">type</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">text/css</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="11" select="quick" style="color: #cb4b16">f:get-css</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="11" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">style</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">head</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">body</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">div</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">pre</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spectrum</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-inline</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">yes</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">style</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="19" select="quick" style="color: #cb4b16">f:inline-css-main</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="19" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> Call to imported functions returns sequence of span elements
                 with class attribute values used to colorise with CSS
            </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$all-spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">pre</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">div</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">body</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">html</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tname" style="color: #dc322f">main</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">sourceuri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$sourcepath</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> if windows OS, convert path to URI </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">corrected-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="28" select="quick" style="color: #cb4b16">replace</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="9" select="quick" style="color: #d33682">$sourceuri</span><span class="op" start="19" style="color: #b58900">,</span><span class="op" style="color: #b58900">'</span><span class="literal" start="20" style="color: #93a1a1">\\</span><span class="op" style="color: #b58900">'</span><span class="op" start="24" style="color: #b58900">,</span><span class="op" style="color: #b58900">'</span><span class="literal" start="25" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="28" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">is-xml</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="29" select="quick" style="color: #cb4b16">doc-available</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="15" select="quick" style="color: #d33682">$corrected-uri</span><span class="parenthesis" start="29" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-element</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="12" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$is-xml</span><span class="parenthesis" start="12" style="color: #268bd2">)</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="op" start="14" style="color: #b58900">then</span><span class="whitespace" start="18" style="color: #b58900"> </span><span class="function" start="19" pair-end="37" select="quick" style="color: #cb4b16">doc</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="23" select="quick" style="color: #d33682">$corrected-uri</span><span class="parenthesis" start="37" style="color: #268bd2">)</span><span class="step" start="38" style="color: #b58900">/</span><span class="qname" start="39" select="quick" style="color: #6c71c4">*</span><span class="whitespace" start="40" style="color: #b58900"> </span><span class="op" start="41" style="color: #b58900">else</span><span class="whitespace" start="45" style="color: #b58900"> </span><span class="parenthesis" start="46" pair-end="47" select="quick" style="color: #268bd2">(</span><span class="parenthesis" start="47" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-qname</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="12" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$is-xml</span><span class="parenthesis" start="12" style="color: #268bd2">)</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="op" start="14" style="color: #b58900">then</span><span class="whitespace" start="18" style="color: #b58900"> </span><span class="function" start="19" pair-end="42" select="quick" style="color: #cb4b16">node-name</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="29" select="quick" style="color: #d33682">$root-element</span><span class="parenthesis" start="42" style="color: #268bd2">)</span><span class="whitespace" start="43" style="color: #b58900"> </span><span class="op" start="44" style="color: #b58900">else</span><span class="whitespace" start="48" style="color: #b58900"> </span><span class="parenthesis" start="49" pair-end="50" select="quick" style="color: #268bd2">(</span><span class="parenthesis" start="50" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:QName?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="32" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$document-type-prefix</span><span class="whitespace" start="26" style="color: #b58900"> </span><span class="op" start="27" style="color: #b58900">ne</span><span class="whitespace" start="29" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="30" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="32" style="color: #268bd2">)</span><span class="whitespace" start="33" style="color: #b58900"> </span><span class="op" start="34" style="color: #b58900">then</span><span class="whitespace" start="38" style="color: #b58900">
                                             </span><span class="variable" start="39" select="quick" style="color: #d33682">$document-type-prefix</span><span class="whitespace" start="60" style="color: #b58900">
                                             </span><span class="op" start="61" style="color: #b58900">else</span><span class="whitespace" start="65" style="color: #b58900"> </span><span class="if" start="66" style="color: #b58900">if</span><span class="whitespace" start="68" style="color: #b58900"> </span><span class="parenthesis" start="69" pair-end="77" select="quick" style="color: #268bd2">(</span><span class="variable" start="70" select="quick" style="color: #d33682">$is-xml</span><span class="parenthesis" start="77" style="color: #268bd2">)</span><span class="whitespace" start="78" style="color: #b58900"> 
                                             </span><span class="op" start="80" style="color: #b58900">then</span><span class="whitespace" start="84" style="color: #b58900"> </span><span class="parenthesis" start="85" pair-end="125" select="quick" style="color: #268bd2">(</span><span class="parenthesis" start="86" pair-end="121" select="quick" style="color: #268bd2">(</span><span class="function" start="87" pair-end="116" select="quick" style="color: #cb4b16">prefix-from-QName</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="105" select="quick" style="color: #d33682">$root-qname</span><span class="parenthesis" start="116" style="color: #268bd2">)</span><span class="op" start="117" style="color: #b58900">,</span><span class="whitespace" start="118" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="119" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="121" style="color: #268bd2">)</span><span class="filter" start="122" pair-end="124" select="quick" style="color: #268bd2">[</span><span class="numeric" start="123" style="color: #2aa198">1</span><span class="filter" start="124" style="color: #268bd2">]</span><span class="parenthesis" start="125" style="color: #268bd2">)</span><span class="whitespace" start="126" style="color: #b58900"> 
                                             </span><span class="op" start="128" style="color: #b58900">else</span><span class="whitespace" start="132" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="133" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-namespace</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="12" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$is-xml</span><span class="parenthesis" start="12" style="color: #268bd2">)</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="op" start="14" style="color: #b58900">then</span><span class="whitespace" start="18" style="color: #b58900"> </span><span class="function" start="19" pair-end="55" select="quick" style="color: #cb4b16">namespace-uri-from-QName</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="44" select="quick" style="color: #d33682">$root-qname</span><span class="parenthesis" start="55" style="color: #268bd2">)</span><span class="whitespace" start="56" style="color: #b58900"> </span><span class="op" start="57" style="color: #b58900">else</span><span class="whitespace" start="61" style="color: #b58900"> </span><span class="parenthesis" start="62" pair-end="63" select="quick" style="color: #268bd2">(</span><span class="parenthesis" start="63" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                  </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="25" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$document-type</span><span class="whitespace" start="19" style="color: #b58900"> </span><span class="op" start="20" style="color: #b58900">ne</span><span class="whitespace" start="22" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="23" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="25" style="color: #268bd2">)</span><span class="whitespace" start="26" style="color: #b58900"> </span><span class="op" start="27" style="color: #b58900">then</span><span class="whitespace" start="31" style="color: #b58900">
                          </span><span class="variable" start="32" select="quick" style="color: #d33682">$document-type</span><span class="whitespace" start="46" style="color: #b58900">
                          </span><span class="op" start="47" style="color: #b58900">else</span><span class="whitespace" start="51" style="color: #b58900"> </span><span class="if" start="52" style="color: #b58900">if</span><span class="whitespace" start="54" style="color: #b58900"> </span><span class="parenthesis" start="55" pair-end="63" select="quick" style="color: #268bd2">(</span><span class="variable" start="56" select="quick" style="color: #d33682">$is-xml</span><span class="parenthesis" start="63" style="color: #268bd2">)</span><span class="whitespace" start="64" style="color: #b58900"> </span><span class="op" start="65" style="color: #b58900">then</span><span class="whitespace" start="69" style="color: #b58900">
                          </span><span class="function" start="70" pair-end="106" select="quick" style="color: #cb4b16">f:doctype-from-xmlns</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="91" select="quick" style="color: #d33682">$root-namespace</span><span class="parenthesis" start="106" style="color: #268bd2">)</span><span class="whitespace" start="107" style="color: #b58900">
                          </span><span class="op" start="108" style="color: #b58900">else</span><span class="whitespace" start="112" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="113" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">is-xsl</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doctype</span><span class="whitespace" start="9" style="color: #b58900"> </span><span class="op" start="10" style="color: #b58900">eq</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="13" style="color: #93a1a1">xslt</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$is-xsl</span><span class="whitespace" start="8" style="color: #b58900"> </span><span class="op" start="9" style="color: #b58900">and</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="variable" start="13" select="quick" style="color: #d33682">$do-link</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">all-files</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                      </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="68" select="quick" style="color: #cb4b16">f:get-all-files</span><span class="parenthesis" style="color: #268bd2">(</span><span class="function" start="17" pair-end="62" select="quick" style="color: #cb4b16">resolve-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="29" select="quick" style="color: #d33682">$corrected-uri</span><span class="op" start="43" style="color: #b58900">,</span><span class="whitespace" start="44" style="color: #b58900"> </span><span class="function" start="45" pair-end="61" select="quick" style="color: #cb4b16">static-base-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="61" style="color: #268bd2">)</span><span class="parenthesis" start="62" style="color: #268bd2">)</span><span class="op" start="63" style="color: #b58900">,</span><span class="whitespace" start="64" style="color: #b58900"> </span><span class="parenthesis" start="65" pair-end="66" select="quick" style="color: #268bd2">(</span><span class="parenthesis" start="66" style="color: #268bd2">)</span><span class="whitespace" start="67" style="color: #b58900"> </span><span class="parenthesis" start="68" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">get-common-root</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">all-files</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$all-files</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="numeric" start="1" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">common-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="parenthesis" start="1" pair-end="2" select="quick" style="color: #268bd2">(</span><span class="parenthesis" start="2" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">joined-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="28" select="quick" style="color: #cb4b16">string-join</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="13" select="quick" style="color: #d33682">$root-path</span><span class="op" start="23" style="color: #b58900">,</span><span class="whitespace" start="24" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="25" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="28" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="27" select="quick" style="color: #cb4b16">string-length</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="15" select="quick" style="color: #d33682">$joined-path</span><span class="parenthesis" start="27" style="color: #268bd2">)</span><span class="whitespace" start="28" style="color: #b58900"> </span><span class="op" start="29" style="color: #b58900">+</span><span class="whitespace" start="30" style="color: #b58900"> </span><span class="numeric" start="31" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">globals</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$all-files</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">file</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">path</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">{</span><span class="function" start="1" pair-end="30" select="quick" style="color: #cb4b16">substring</span><span class="parenthesis" style="color: #268bd2">(</span><span class="context" start="11" style="color: #2aa198">.</span><span class="op" start="12" style="color: #b58900">,</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="variable" start="14" select="quick" style="color: #d33682">$root-length</span><span class="whitespace" start="26" style="color: #b58900"> </span><span class="op" start="27" style="color: #b58900">+</span><span class="whitespace" start="28" style="color: #b58900"> </span><span class="numeric" start="29" style="color: #2aa198">1</span><span class="parenthesis" start="30" style="color: #268bd2">)</span><span class="op" style="color: #b58900">}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
                </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">uri</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="context" start="1" style="color: #2aa198">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">uri</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
                </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="16" select="quick" style="color: #cb4b16">f:get-globals</span><span class="parenthesis" style="color: #268bd2">(</span><span class="context" start="15" style="color: #2aa198">.</span><span class="parenthesis" start="16" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">file</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">globals</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$globals</span><span class="step" start="9" style="color: #b58900">/</span><span class="qname" start="10" select="quick" style="color: #6c71c4">file</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:message</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">tokenizing</span><span class="op" style="color: #b58900">'</span><span class="op" start="13" style="color: #b58900">,</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="axis" start="15" style="color: #2aa198">@</span><span class="qname" start="16" select="quick" style="color: #6c71c4">path</span><span class="op" start="20" style="color: #b58900">,</span><span class="whitespace" start="21" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="22" style="color: #93a1a1">...</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">full-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="36" select="quick" style="color: #268bd2">(</span><span class="function" start="5" pair-end="35" select="quick" style="color: #cb4b16">not</span><span class="parenthesis" style="color: #268bd2">(</span><span class="function" start="9" pair-end="34" select="quick" style="color: #cb4b16">starts-with</span><span class="parenthesis" style="color: #268bd2">(</span><span class="qname" start="21" select="quick" style="color: #6c71c4">uri</span><span class="op" start="24" style="color: #b58900">,</span><span class="whitespace" start="25" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="26" style="color: #93a1a1">file:/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="34" style="color: #268bd2">)</span><span class="parenthesis" start="35" style="color: #268bd2">)</span><span class="parenthesis" start="36" style="color: #268bd2">)</span><span class="whitespace" start="37" style="color: #b58900"> </span><span class="op" start="38" style="color: #b58900">then</span><span class="whitespace" start="42" style="color: #b58900">
                                                    </span><span class="function" start="47" pair-end="67" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="op" style="color: #b58900">'</span><span class="literal" start="54" style="color: #93a1a1">file:/</span><span class="op" style="color: #b58900">'</span><span class="op" start="62" style="color: #b58900">,</span><span class="whitespace" start="63" style="color: #b58900"> </span><span class="qname" start="64" select="quick" style="color: #6c71c4">uri</span><span class="parenthesis" start="67" style="color: #268bd2">)</span><span class="whitespace" start="68" style="color: #b58900">
                                                </span><span class="op" start="69" style="color: #b58900">else</span><span class="whitespace" start="73" style="color: #b58900"> </span><span class="qname" start="74" select="quick" style="color: #6c71c4">uri</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">all-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">get-result-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">input-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$full-uri</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xml</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$is-xml</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="qname" start="1" select="quick" style="color: #6c71c4">doc-prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:message</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">processing</span><span class="op" style="color: #b58900">'</span><span class="op" start="13" style="color: #b58900">,</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="function" start="15" pair-end="31" select="quick" style="color: #cb4b16">count</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="21" select="quick" style="color: #d33682">$all-spans</span><span class="parenthesis" start="31" style="color: #268bd2">)</span><span class="op" start="32" style="color: #b58900">,</span><span class="whitespace" start="33" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="34" style="color: #93a1a1">tokens for</span><span class="op" style="color: #b58900">'</span><span class="op" start="46" style="color: #b58900">,</span><span class="whitespace" start="47" style="color: #b58900"> </span><span class="axis" start="48" style="color: #2aa198">@</span><span class="qname" start="49" select="quick" style="color: #6c71c4">path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">ancestor-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="27" select="quick" style="color: #cb4b16">count</span><span class="parenthesis" style="color: #268bd2">(</span><span class="function" start="7" pair-end="26" select="quick" style="color: #cb4b16">tokenize</span><span class="parenthesis" style="color: #268bd2">(</span><span class="axis" start="16" style="color: #2aa198">@</span><span class="qname" start="17" select="quick" style="color: #6c71c4">path</span><span class="op" start="21" style="color: #b58900">,</span><span class="whitespace" start="22" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="23" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="26" style="color: #268bd2">)</span><span class="parenthesis" start="27" style="color: #268bd2">)</span><span class="whitespace" start="28" style="color: #b58900"> </span><span class="op" start="29" style="color: #b58900">-</span><span class="whitespace" start="30" style="color: #b58900"> </span><span class="numeric" start="31" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">ancestor-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="33" select="quick" style="color: #cb4b16">f:ancestor-path</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="17" select="quick" style="color: #d33682">$ancestor-length</span><span class="parenthesis" start="33" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="23" select="quick" style="color: #cb4b16">f:get-xmlns</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="13" select="quick" style="color: #d33682">$all-spans</span><span class="parenthesis" start="23" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> note: removed tunel on spans param as this caused 32% performance degrade </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">wrap-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$all-spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="numeric" start="1" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">path-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$ancestor-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">css-link</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="21" select="quick" style="color: #cb4b16">f:get-css-link</span><span class="parenthesis" style="color: #268bd2">(</span><span class="axis" start="16" style="color: #2aa198">@</span><span class="qname" start="17" select="quick" style="color: #6c71c4">path</span><span class="parenthesis" start="21" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">output-html-doc</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">result-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">filename</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="axis" start="1" style="color: #2aa198">@</span><span class="qname" start="2" select="quick" style="color: #6c71c4">path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-link</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-link</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">html-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$do-output-path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">css-link</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="27" select="quick" style="color: #cb4b16">f:get-css-link</span><span class="parenthesis" style="color: #268bd2">(</span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">rootlevel</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="27" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">create-toc</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$do-output-path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-link</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-link</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">output-method</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$output-method</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-css-inline</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-inline</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">yes</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      
      
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">result-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">get-result-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">input-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$corrected-uri</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xml</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$is-xml</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$root-prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">file-only</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="31" select="quick" style="color: #cb4b16">f:file-from-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="17" select="quick" style="color: #d33682">$corrected-uri</span><span class="parenthesis" start="31" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">output-html-doc</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">result-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$result-spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">filename</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$file-only</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-link</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                          </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="20" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$css-path</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="op" start="15" style="color: #b58900">eq</span><span class="whitespace" start="17" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="18" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="20" style="color: #268bd2">)</span><span class="whitespace" start="21" style="color: #b58900"> </span><span class="op" start="22" style="color: #b58900">then</span><span class="whitespace" start="26" style="color: #b58900"> 
                                  </span><span class="variable" start="28" select="quick" style="color: #d33682">$css-name</span><span class="whitespace" start="37" style="color: #b58900">
                                  </span><span class="op" start="38" style="color: #b58900">else</span><span class="whitespace" start="42" style="color: #b58900"> </span><span class="variable" start="43" select="quick" style="color: #d33682">$css-path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">html-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$do-output-path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-path</span><span class="whitespace" start="10" style="color: #b58900"> </span><span class="op" start="11" style="color: #b58900">eq</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="14" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="whitespace" start="16" style="color: #b58900"> </span><span class="op" start="17" style="color: #b58900">and</span><span class="whitespace" start="20" style="color: #b58900"> </span><span class="variable" start="21" select="quick" style="color: #d33682">$output-method</span><span class="whitespace" start="35" style="color: #b58900"> </span><span class="op" start="36" style="color: #b58900">ne</span><span class="whitespace" start="38" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="39" style="color: #93a1a1">xml</span><span class="op" style="color: #b58900">'</span><span class="whitespace" start="44" style="color: #b58900"> </span><span class="op" start="45" style="color: #b58900">and</span><span class="whitespace" start="48" style="color: #b58900"> </span><span class="variable" start="49" select="quick" style="color: #d33682">$css-inline</span><span class="whitespace" start="60" style="color: #b58900"> </span><span class="op" start="61" style="color: #b58900">eq</span><span class="whitespace" start="63" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="64" style="color: #93a1a1">no</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:result-document</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">href</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">{</span><span class="function" start="1" pair-end="34" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="8" select="quick" style="color: #d33682">$do-output-path</span><span class="op" start="23" style="color: #b58900">,</span><span class="whitespace" start="24" style="color: #b58900"> </span><span class="variable" start="25" select="quick" style="color: #d33682">$css-name</span><span class="parenthesis" start="34" style="color: #268bd2">)</span><span class="op" style="color: #b58900">}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">method</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">text</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">indent</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">no</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="11" select="quick" style="color: #cb4b16">f:get-css</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="11" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:result-document</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="fname" style="color: #dc322f">f:get-css-link</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="20" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$css-path</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="op" start="15" style="color: #b58900">eq</span><span class="whitespace" start="17" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="18" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="20" style="color: #268bd2">)</span><span class="whitespace" start="21" style="color: #b58900"> </span><span class="op" start="22" style="color: #b58900">then</span><span class="whitespace" start="26" style="color: #b58900">
                              </span><span class="function" start="31" pair-end="109" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="whitespace" start="38" style="color: #b58900">
                                  </span><span class="function" start="47" pair-end="93" select="quick" style="color: #cb4b16">f:ancestor-path</span><span class="parenthesis" style="color: #268bd2">(</span><span class="function" start="63" pair-end="88" select="quick" style="color: #cb4b16">count</span><span class="parenthesis" style="color: #268bd2">(</span><span class="function" start="69" pair-end="87" select="quick" style="color: #cb4b16">tokenize</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="78" select="quick" style="color: #d33682">$path</span><span class="op" start="83" style="color: #b58900">,</span><span class="op" style="color: #b58900">'</span><span class="literal" start="84" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="87" style="color: #268bd2">)</span><span class="parenthesis" start="88" style="color: #268bd2">)</span><span class="whitespace" start="89" style="color: #b58900"> </span><span class="op" start="90" style="color: #b58900">-</span><span class="whitespace" start="91" style="color: #b58900"> </span><span class="numeric" start="92" style="color: #2aa198">1</span><span class="parenthesis" start="93" style="color: #268bd2">)</span><span class="op" start="94" style="color: #b58900">,</span><span class="whitespace" start="95" style="color: #b58900">
                              </span><span class="variable" start="100" select="quick" style="color: #d33682">$css-name</span><span class="parenthesis" start="109" style="color: #268bd2">)</span><span class="whitespace" start="110" style="color: #b58900">
                          </span><span class="op" start="111" style="color: #b58900">else</span><span class="whitespace" start="115" style="color: #b58900"> </span><span class="variable" start="116" select="quick" style="color: #d33682">$css-path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="fname" style="color: #dc322f">f:ancestor-path</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">levels</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="17" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$levels</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="numeric" start="16" style="color: #2aa198">0</span><span class="parenthesis" start="17" style="color: #268bd2">)</span><span class="whitespace" start="18" style="color: #b58900"> </span><span class="op" start="19" style="color: #b58900">then</span><span class="whitespace" start="23" style="color: #b58900"> 
                          </span><span class="op" style="color: #b58900">'</span><span class="literal" start="25" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="whitespace" start="27" style="color: #b58900">
                          </span><span class="op" start="28" style="color: #b58900">else</span><span class="whitespace" start="32" style="color: #b58900">
                          </span><span class="function" start="33" pair-end="125" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="whitespace" start="40" style="color: #b58900">
                              </span><span class="function" start="45" pair-end="118" select="quick" style="color: #cb4b16">string-join</span><span class="parenthesis" style="color: #268bd2">(</span><span class="whitespace" start="57" style="color: #b58900">
                                  </span><span class="higher" start="66" style="color: #b58900">for</span><span class="whitespace" start="69" style="color: #b58900"> </span><span id="rng-$n" class="variable" start="70" select="quick" style="color: #d33682">$n</span><span class="whitespace" start="72" style="color: #b58900"> </span><span class="op" start="73" style="color: #b58900">in</span><span class="whitespace" start="75" style="color: #b58900"> </span><span class="numeric" start="76" style="color: #2aa198">1</span><span class="whitespace" start="77" style="color: #b58900"> </span><span class="op" start="78" style="color: #b58900">to</span><span class="whitespace" start="80" style="color: #b58900"> </span><span class="variable" start="81" select="quick" style="color: #d33682">$levels</span><span class="whitespace" start="88" style="color: #b58900"> </span><span class="op" start="89" style="color: #b58900">return</span><span class="whitespace" start="95" style="color: #b58900">
                                  </span><span class="op" style="color: #b58900">'</span><span class="literal" start="104" style="color: #93a1a1">..</span><span class="op" style="color: #b58900">'</span><span class="whitespace" start="108" style="color: #b58900">
                              </span><span class="op" start="113" style="color: #b58900">,</span><span class="whitespace" start="114" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="115" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="118" style="color: #268bd2">)</span><span class="whitespace" start="119" style="color: #b58900">
                          </span><span class="op" start="120" style="color: #b58900">,</span><span class="whitespace" start="121" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="122" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="125" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="fname" style="color: #dc322f">f:path-to-uri</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="30" select="quick" style="color: #cb4b16">matches</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="9" select="quick" style="color: #d33682">$path</span><span class="op" start="14" style="color: #b58900">,</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">^[A-Za-z]:.*</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="30" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="23" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="op" style="color: #b58900">'</span><span class="literal" start="8" style="color: #93a1a1">file:/</span><span class="op" style="color: #b58900">'</span><span class="op" start="16" style="color: #b58900">,</span><span class="whitespace" start="17" style="color: #b58900"> </span><span class="variable" start="18" select="quick" style="color: #d33682">$path</span><span class="parenthesis" start="23" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="23" select="quick" style="color: #cb4b16">starts-with</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="13" select="quick" style="color: #d33682">$path</span><span class="op" start="18" style="color: #b58900">,</span><span class="whitespace" start="19" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="20" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="23" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="24" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="op" style="color: #b58900">'</span><span class="literal" start="8" style="color: #93a1a1">file://</span><span class="op" style="color: #b58900">'</span><span class="op" start="17" style="color: #b58900">,</span><span class="whitespace" start="18" style="color: #b58900"> </span><span class="variable" start="19" select="quick" style="color: #d33682">$path</span><span class="parenthesis" start="24" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tname" style="color: #dc322f">wrap-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">path-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$spans</span><span class="filter" start="7" pair-end="14" select="quick" style="color: #268bd2">[</span><span class="variable" start="8" select="quick" style="color: #d33682">$index</span><span class="filter" start="14" style="color: #268bd2">]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$index</span><span class="whitespace" start="7" style="color: #b58900"> </span><span class="op" start="8" style="color: #b58900">mod</span><span class="whitespace" start="11" style="color: #b58900"> </span><span class="numeric" start="12" style="color: #2aa198">500</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" start="16" style="color: #b58900">eq</span><span class="whitespace" start="18" style="color: #b58900"> </span><span class="numeric" start="19" style="color: #2aa198">0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:message</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">token: </span><span class="op" style="color: #b58900">'</span><span class="op" start="10" style="color: #b58900">,</span><span class="whitespace" start="11" style="color: #b58900"> </span><span class="variable" start="12" select="quick" style="color: #d33682">$index</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="12" select="quick" style="color: #cb4b16">empty</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="7" select="quick" style="color: #d33682">$span</span><span class="parenthesis" start="12" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$span</span><span class="step" start="6" style="color: #b58900">/</span><span class="axis" start="7" style="color: #2aa198">@</span><span class="qname" start="8" select="quick" style="color: #6c71c4">class</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="op" start="14" style="color: #b58900">eq</span><span class="whitespace" start="16" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="17" style="color: #93a1a1">es</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">span-children</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">wrap-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$index</span><span class="whitespace" start="7" style="color: #b58900"> </span><span class="op" start="8" style="color: #b58900">+</span><span class="whitespace" start="9" style="color: #b58900"> </span><span class="numeric" start="10" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ww</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">id</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">w</span><span class="op" style="color: #b58900">{</span><span class="variable" start="1" select="quick" style="color: #d33682">$index</span><span class="op" style="color: #b58900">}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$span</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$span-children</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">prev-index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                      </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="53" select="quick" style="color: #cb4b16">xs:integer</span><span class="parenthesis" style="color: #268bd2">(</span><span class="function" start="12" pair-end="52" select="quick" style="color: #cb4b16">substring</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="22" select="quick" style="color: #d33682">$span-children</span><span class="filter" start="36" pair-end="43" select="quick" style="color: #268bd2">[</span><span class="function" start="37" pair-end="42" select="quick" style="color: #cb4b16">last</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="42" style="color: #268bd2">)</span><span class="filter" start="43" style="color: #268bd2">]</span><span class="step" start="44" style="color: #b58900">/</span><span class="axis" start="45" style="color: #2aa198">@</span><span class="qname" start="46" select="quick" style="color: #6c71c4">id</span><span class="op" start="48" style="color: #b58900">,</span><span class="whitespace" start="49" style="color: #b58900"> </span><span class="numeric" start="50" style="color: #2aa198">3</span><span class="whitespace" start="51" style="color: #b58900">
                              </span><span class="parenthesis" start="52" style="color: #268bd2">)</span><span class="parenthesis" start="53" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">wrap-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$prev-index</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">+</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="numeric" start="15" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$span</span><span class="step" start="6" style="color: #b58900">/</span><span class="axis" start="7" style="color: #2aa198">@</span><span class="qname" start="8" select="quick" style="color: #6c71c4">class</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="op" start="14" style="color: #b58900">=</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="parenthesis" start="16" pair-end="27" select="quick" style="color: #268bd2">(</span><span class="op" style="color: #b58900">'</span><span class="literal" start="17" style="color: #93a1a1">sc</span><span class="op" style="color: #b58900">'</span><span class="op" start="21" style="color: #b58900">,</span><span class="whitespace" start="22" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="23" style="color: #93a1a1">ec</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="27" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">id</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">wx</span><span class="op" style="color: #b58900">{</span><span class="variable" start="1" select="quick" style="color: #d33682">$index</span><span class="op" style="color: #b58900">}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$span</span><span class="step" start="6" style="color: #b58900">/</span><span class="axis" start="7" style="color: #2aa198">@</span><span class="qname" start="8" select="quick" style="color: #6c71c4">*</span><span class="op" start="9" style="color: #b58900">|</span><span class="variable" start="10" select="quick" style="color: #d33682">$span</span><span class="step" start="15" style="color: #b58900">/</span><span class="node" start="16" pair-end="21" select="quick" style="color: #268bd2">node</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="21" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:apply-templates</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">markup</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">wrap-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$index</span><span class="whitespace" start="7" style="color: #b58900"> </span><span class="op" start="8" style="color: #b58900">+</span><span class="whitespace" start="9" style="color: #b58900"> </span><span class="numeric" start="10" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tname" style="color: #dc322f">get-common-root</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">all-files</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">common-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">current-file</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="32" select="quick" style="color: #cb4b16">tokenize</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="10" select="quick" style="color: #d33682">$all-files</span><span class="filter" start="20" pair-end="27" select="quick" style="color: #268bd2">[</span><span class="variable" start="21" select="quick" style="color: #d33682">$index</span><span class="filter" start="27" style="color: #268bd2">]</span><span class="op" start="28" style="color: #b58900">,</span><span class="op" style="color: #b58900">'</span><span class="literal" start="29" style="color: #93a1a1">/</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="32" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">min-file</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                  </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="16" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$index</span><span class="whitespace" start="11" style="color: #b58900"> </span><span class="op" start="12" style="color: #b58900">eq</span><span class="whitespace" start="14" style="color: #b58900"> </span><span class="numeric" start="15" style="color: #2aa198">1</span><span class="parenthesis" start="16" style="color: #268bd2">)</span><span class="whitespace" start="17" style="color: #b58900"> </span><span class="op" start="18" style="color: #b58900">then</span><span class="whitespace" start="22" style="color: #b58900">
                              </span><span class="variable" start="27" select="quick" style="color: #d33682">$current-file</span><span class="whitespace" start="40" style="color: #b58900">
                          </span><span class="op" start="41" style="color: #b58900">else</span><span class="whitespace" start="45" style="color: #b58900"> </span><span class="parenthesis" start="46" pair-end="93" select="quick" style="color: #268bd2">(</span><span class="function" start="47" pair-end="92" select="quick" style="color: #cb4b16">f:min-common-item</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="65" select="quick" style="color: #d33682">$common-path</span><span class="op" start="77" style="color: #b58900">,</span><span class="whitespace" start="78" style="color: #b58900"> </span><span class="variable" start="79" select="quick" style="color: #d33682">$current-file</span><span class="parenthesis" start="92" style="color: #268bd2">)</span><span class="parenthesis" start="93" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$index</span><span class="whitespace" start="7" style="color: #b58900"> </span><span class="op" start="8" style="color: #b58900">lt</span><span class="whitespace" start="10" style="color: #b58900"> </span><span class="function" start="11" pair-end="27" select="quick" style="color: #cb4b16">count</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="17" select="quick" style="color: #d33682">$all-files</span><span class="parenthesis" start="27" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tcall" style="color: #6c71c4">get-common-root</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$index</span><span class="whitespace" start="7" style="color: #b58900"> </span><span class="op" start="8" style="color: #b58900">+</span><span class="whitespace" start="9" style="color: #b58900"> </span><span class="numeric" start="10" style="color: #2aa198">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">common-path</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$min-file</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$min-file</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="fname" style="color: #dc322f">f:min-common-item</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">min</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">new</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="numeric" start="1" style="color: #2aa198">1</span><span class="whitespace" start="2" style="color: #b58900"> </span><span class="op" start="3" style="color: #b58900">to</span><span class="whitespace" start="5" style="color: #b58900"> </span><span class="function" start="6" pair-end="16" select="quick" style="color: #cb4b16">count</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="12" select="quick" style="color: #d33682">$min</span><span class="parenthesis" start="16" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">x</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="13" select="quick" style="color: #cb4b16">xs:integer</span><span class="parenthesis" style="color: #268bd2">(</span><span class="context" start="12" style="color: #2aa198">.</span><span class="parenthesis" start="13" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$min</span><span class="filter" start="5" pair-end="8" select="quick" style="color: #268bd2">[</span><span class="variable" start="6" select="quick" style="color: #d33682">$x</span><span class="filter" start="8" style="color: #268bd2">]</span><span class="whitespace" start="9" style="color: #b58900"> </span><span class="op" start="10" style="color: #b58900">eq</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="variable" start="13" select="quick" style="color: #d33682">$new</span><span class="filter" start="17" pair-end="20" select="quick" style="color: #268bd2">[</span><span class="variable" start="18" select="quick" style="color: #d33682">$x</span><span class="filter" start="20" style="color: #268bd2">]</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$min</span><span class="filter" start="5" pair-end="8" select="quick" style="color: #268bd2">[</span><span class="variable" start="6" select="quick" style="color: #d33682">$x</span><span class="filter" start="8" style="color: #268bd2">]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="fname" style="color: #dc322f">f:get-all-files</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">new-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">uri-list</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">add-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                  </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="higher" start="1" style="color: #b58900">for</span><span class="whitespace" start="4" style="color: #b58900"> </span><span id="rng-$file" class="variable" start="5" select="quick" style="color: #d33682">$file</span><span class="whitespace" start="10" style="color: #b58900"> </span><span class="op" start="11" style="color: #b58900">in</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="variable" start="14" select="quick" style="color: #d33682">$new-uri</span><span class="whitespace" start="22" style="color: #b58900"> </span><span class="op" start="23" style="color: #b58900">return</span><span class="whitespace" start="29" style="color: #b58900">
                          </span><span class="if" start="30" style="color: #b58900">if</span><span class="whitespace" start="32" style="color: #b58900"> </span><span class="parenthesis" start="33" pair-end="53" select="quick" style="color: #268bd2">(</span><span class="variable" start="34" select="quick" style="color: #d33682">$file</span><span class="whitespace" start="39" style="color: #b58900"> </span><span class="op" start="40" style="color: #b58900">=</span><span class="whitespace" start="41" style="color: #b58900"> </span><span class="parenthesis" start="42" pair-end="52" select="quick" style="color: #268bd2">(</span><span class="variable" start="43" select="quick" style="color: #d33682">$uri-list</span><span class="parenthesis" start="52" style="color: #268bd2">)</span><span class="parenthesis" start="53" style="color: #268bd2">)</span><span class="whitespace" start="54" style="color: #b58900"> </span><span class="op" start="55" style="color: #b58900">then</span><span class="whitespace" start="59" style="color: #b58900"> </span><span class="parenthesis" start="60" pair-end="61" select="quick" style="color: #268bd2">(</span><span class="parenthesis" start="61" style="color: #268bd2">)</span><span class="whitespace" start="62" style="color: #b58900"> </span><span class="op" start="63" style="color: #b58900">else</span><span class="whitespace" start="67" style="color: #b58900"> </span><span class="variable" start="68" select="quick" style="color: #d33682">$file</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">new-externals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$add-uri</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">doc</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="6" select="quick" style="color: #cb4b16">doc</span><span class="parenthesis" style="color: #268bd2">(</span><span class="context" start="5" style="color: #2aa198">.</span><span class="parenthesis" start="6" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doc</span><span class="step" start="5" style="color: #b58900">/</span><span class="qname" start="6" select="quick" style="color: #6c71c4">*</span><span class="step" start="7" style="color: #b58900">/</span><span class="qname" start="8" select="quick" style="color: #6c71c4">xsl:import</span><span class="step" start="18" style="color: #b58900">/</span><span class="axis" start="19" style="color: #2aa198">@</span><span class="qname" start="20" select="quick" style="color: #6c71c4">href</span><span class="op" start="24" style="color: #b58900">|</span><span class="variable" start="25" select="quick" style="color: #d33682">$doc</span><span class="step" start="29" style="color: #b58900">/</span><span class="qname" start="30" select="quick" style="color: #6c71c4">*</span><span class="step" start="31" style="color: #b58900">/</span><span class="qname" start="32" select="quick" style="color: #6c71c4">xsl:include</span><span class="step" start="43" style="color: #b58900">/</span><span class="axis" start="44" style="color: #2aa198">@</span><span class="qname" start="45" select="quick" style="color: #6c71c4">href</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="30" select="quick" style="color: #cb4b16">resolve-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="context" start="13" style="color: #2aa198">.</span><span class="op" start="14" style="color: #b58900">,</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="function" start="16" pair-end="29" select="quick" style="color: #cb4b16">base-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="25" select="quick" style="color: #d33682">$doc</span><span class="parenthesis" start="29" style="color: #268bd2">)</span><span class="parenthesis" start="30" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">concat-sequence</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="parenthesis" start="1" pair-end="21" select="quick" style="color: #268bd2">(</span><span class="variable" start="2" select="quick" style="color: #d33682">$uri-list</span><span class="op" start="11" style="color: #b58900">,</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="variable" start="13" select="quick" style="color: #d33682">$add-uri</span><span class="parenthesis" start="21" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="22" select="quick" style="color: #cb4b16">exists</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="8" select="quick" style="color: #d33682">$new-externals</span><span class="parenthesis" start="22" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="49" select="quick" style="color: #cb4b16">f:get-all-files</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="17" select="quick" style="color: #d33682">$new-externals</span><span class="op" start="31" style="color: #b58900">,</span><span class="whitespace" start="32" style="color: #b58900"> </span><span class="variable" start="33" select="quick" style="color: #d33682">$concat-sequence</span><span class="parenthesis" start="49" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$concat-sequence</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
  sample globals elements:
  &lt;doc-prefix&gt;xsl&lt;/doc-prefix&gt;
  &lt;function name="do-something" ns="internal"/&gt;
  &lt;function name="somethin-else" ns="internal"/&gt;
  &lt;template name="output-days" ns=""/&gt;
  &lt;variable name="my-global" ns=""/&gt;
  </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="fname" style="color: #dc322f">f:get-globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">file-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">doc</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="14" select="quick" style="color: #cb4b16">doc</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$file-uri</span><span class="parenthesis" start="14" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">doc-prefix</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="36" select="quick" style="color: #cb4b16">prefix-from-QName</span><span class="parenthesis" style="color: #268bd2">(</span><span class="function" start="19" pair-end="35" select="quick" style="color: #cb4b16">node-name</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="29" select="quick" style="color: #d33682">$doc</span><span class="step" start="33" style="color: #b58900">/</span><span class="qname" start="34" select="quick" style="color: #6c71c4">*</span><span class="parenthesis" start="35" style="color: #268bd2">)</span><span class="parenthesis" start="36" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">doc-prefix</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">templates</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:apply-templates</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doc</span><span class="step" start="5" style="color: #b58900">/</span><span class="qname" start="6" select="quick" style="color: #6c71c4">*</span><span class="step" start="7" style="color: #b58900">/</span><span class="qname" start="8" select="quick" style="color: #6c71c4">xsl:template</span><span class="filter" start="20" pair-end="26" select="quick" style="color: #268bd2">[</span><span class="axis" start="21" style="color: #2aa198">@</span><span class="qname" start="22" select="quick" style="color: #6c71c4">name</span><span class="filter" start="26" style="color: #268bd2">]</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">globals</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">templates</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">functions</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:apply-templates</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doc</span><span class="step" start="5" style="color: #b58900">/</span><span class="qname" start="6" select="quick" style="color: #6c71c4">*</span><span class="step" start="7" style="color: #b58900">/</span><span class="qname" start="8" select="quick" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">globals</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">functions</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">variables</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:apply-templates</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$doc</span><span class="step" start="5" style="color: #b58900">/</span><span class="qname" start="6" select="quick" style="color: #6c71c4">*</span><span class="step" start="7" style="color: #b58900">/</span><span class="parenthesis" start="8" pair-end="31" select="quick" style="color: #268bd2">(</span><span class="qname" start="9" select="quick" style="color: #6c71c4">xsl:variable</span><span class="op" start="21" style="color: #b58900">|</span><span class="qname" start="22" select="quick" style="color: #6c71c4">xsl:param</span><span class="parenthesis" start="31" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">globals</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">variables</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="qname" start="1" select="quick" style="color: #6c71c4">xsl:template</span><span class="op" start="13" style="color: #b58900">|</span><span class="qname" start="14" select="quick" style="color: #6c71c4">xsl:function</span><span class="op" start="26" style="color: #b58900">|</span><span class="qname" start="27" select="quick" style="color: #6c71c4">xsl:variable</span><span class="op" start="39" style="color: #b58900">|</span><span class="qname" start="40" select="quick" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">globals</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">after-colon</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="27" select="quick" style="color: #cb4b16">substring-after</span><span class="parenthesis" style="color: #268bd2">(</span><span class="axis" start="17" style="color: #2aa198">@</span><span class="qname" start="18" select="quick" style="color: #6c71c4">name</span><span class="op" start="22" style="color: #b58900">,</span><span class="whitespace" start="23" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="24" style="color: #93a1a1">:</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="27" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">local</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="23" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$after-colon</span><span class="whitespace" start="17" style="color: #b58900"> </span><span class="op" start="18" style="color: #b58900">eq</span><span class="whitespace" start="20" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="21" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="23" style="color: #268bd2">)</span><span class="whitespace" start="24" style="color: #b58900"> </span><span class="op" start="25" style="color: #b58900">then</span><span class="whitespace" start="29" style="color: #b58900"> </span><span class="axis" start="30" style="color: #2aa198">@</span><span class="qname" start="31" select="quick" style="color: #6c71c4">name</span><span class="whitespace" start="35" style="color: #b58900"> </span><span class="op" start="36" style="color: #b58900">else</span><span class="whitespace" start="40" style="color: #b58900"> </span><span class="variable" start="41" select="quick" style="color: #d33682">$after-colon</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="28" select="quick" style="color: #cb4b16">substring-before</span><span class="parenthesis" style="color: #268bd2">(</span><span class="axis" start="18" style="color: #2aa198">@</span><span class="qname" start="19" select="quick" style="color: #6c71c4">name</span><span class="op" start="23" style="color: #b58900">,</span><span class="whitespace" start="24" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="25" style="color: #93a1a1">:</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="28" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
    &lt;item name="{$local}" ns="{namespace-uri-for-prefix($prefix, .)}"/&gt;
    </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">clark-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                  </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="18" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$prefix</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1"></span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="18" style="color: #268bd2">)</span><span class="whitespace" start="19" style="color: #b58900"> </span><span class="op" start="20" style="color: #b58900">then</span><span class="whitespace" start="24" style="color: #b58900">
                          </span><span class="variable" start="25" select="quick" style="color: #d33682">$local</span><span class="whitespace" start="31" style="color: #b58900">
                          </span><span class="op" start="32" style="color: #b58900">else</span><span class="whitespace" start="36" style="color: #b58900"> </span><span class="function" start="37" pair-end="98" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="op" style="color: #b58900">'</span><span class="literal" start="44" style="color: #93a1a1">{</span><span class="op" style="color: #b58900">'</span><span class="op" start="47" style="color: #b58900">,</span><span class="whitespace" start="48" style="color: #b58900">
                          </span><span class="function" start="49" pair-end="84" select="quick" style="color: #cb4b16">namespace-uri-for-prefix</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="74" select="quick" style="color: #d33682">$prefix</span><span class="op" start="81" style="color: #b58900">,</span><span class="whitespace" start="82" style="color: #b58900"> </span><span class="context" start="83" style="color: #2aa198">.</span><span class="parenthesis" start="84" style="color: #268bd2">)</span><span class="op" start="85" style="color: #b58900">,</span><span class="whitespace" start="86" style="color: #b58900">
                          </span><span class="op" style="color: #b58900">'</span><span class="literal" start="87" style="color: #93a1a1">}</span><span class="op" style="color: #b58900">'</span><span class="op" start="90" style="color: #b58900">,</span><span class="whitespace" start="91" style="color: #b58900"> </span><span class="variable" start="92" select="quick" style="color: #d33682">$local</span><span class="parenthesis" start="98" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">item</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$clark-name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">item</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tname" style="color: #dc322f">output-html-doc</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">result-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">filename</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">css-link</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">html-path</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">file-only</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="26" select="quick" style="color: #cb4b16">f:file-from-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="17" select="quick" style="color: #d33682">$filename</span><span class="parenthesis" start="26" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">href-1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="29" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="8" select="quick" style="color: #d33682">$html-path</span><span class="op" start="18" style="color: #b58900">,</span><span class="whitespace" start="19" style="color: #b58900"> </span><span class="variable" start="20" select="quick" style="color: #d33682">$filename</span><span class="parenthesis" start="29" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">href</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="28" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$output-method</span><span class="whitespace" start="19" style="color: #b58900"> </span><span class="op" start="20" style="color: #b58900">eq</span><span class="whitespace" start="22" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="23" style="color: #93a1a1">xml</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="28" style="color: #268bd2">)</span><span class="whitespace" start="29" style="color: #b58900">
                                      </span><span class="op" start="30" style="color: #b58900">then</span><span class="whitespace" start="34" style="color: #b58900"> </span><span class="variable" start="35" select="quick" style="color: #d33682">$href-1</span><span class="whitespace" start="42" style="color: #b58900">
                                      </span><span class="op" start="43" style="color: #b58900">else</span><span class="whitespace" start="47" style="color: #b58900">
                                      </span><span class="function" start="48" pair-end="82" select="quick" style="color: #cb4b16">concat</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="55" select="quick" style="color: #d33682">$href-1</span><span class="op" start="62" style="color: #b58900">,</span><span class="op" style="color: #b58900">'</span><span class="literal" start="63" style="color: #93a1a1">.</span><span class="op" style="color: #b58900">'</span><span class="op" start="66" style="color: #b58900">,</span><span class="whitespace" start="67" style="color: #b58900"> </span><span class="variable" start="68" select="quick" style="color: #d33682">$output-method</span><span class="parenthesis" start="82" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:message</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">writing: </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$href</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:result-document</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">href</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">{</span><span class="variable" start="1" select="quick" style="color: #d33682">$href</span><span class="op" style="color: #b58900">}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                         </span><span class="atn" style="color: #2aa198">method</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">{</span><span class="variable" start="1" select="quick" style="color: #d33682">$output-method</span><span class="op" style="color: #b58900">}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">indent</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">no</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$output-method</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" start="16" style="color: #b58900">eq</span><span class="whitespace" start="18" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="19" style="color: #93a1a1">html</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:text</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">disable-output-escaping</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">'</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">'</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">&amp;lt;!DOCTYPE html&gt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      
      </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">html</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">head</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">title</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$file-only</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">title</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-inline</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">no</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">link</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">rel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">stylesheet</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">type</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">text/css</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">href</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">{</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-link</span><span class="op" style="color: #b58900">}</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">head</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">body</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">div</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
            </span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">pre</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spectrum</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$css-inline</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="op" start="13" style="color: #b58900">eq</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">yes</span><span class="op" style="color: #b58900">'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
                </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">style</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="19" select="quick" style="color: #cb4b16">f:inline-css-main</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="19" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
              </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
              </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> Call to imported functions returns sequence of span elements
                   with class attribute values used to colorise with CSS
              </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
              </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$result-spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
            </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">pre</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
          </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">div</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">body</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">html</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:result-document</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="fname" style="color: #dc322f">f:file-from-uri</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">uri</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="22" select="quick" style="color: #cb4b16">tokenize</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="10" select="quick" style="color: #d33682">$uri</span><span class="op" start="14" style="color: #b58900">,</span><span class="whitespace" start="15" style="color: #b58900"> </span><span class="op" style="color: #b58900">'</span><span class="literal" start="16" style="color: #93a1a1">/|\\</span><span class="op" style="color: #b58900">'</span><span class="parenthesis" start="22" style="color: #268bd2">)</span><span class="filter" start="23" pair-end="30" select="quick" style="color: #268bd2">[</span><span class="function" start="24" pair-end="29" select="quick" style="color: #cb4b16">last</span><span class="parenthesis" style="color: #268bd2">(</span><span class="parenthesis" start="29" style="color: #268bd2">)</span><span class="filter" start="30" style="color: #268bd2">]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
  </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="tname" style="color: #dc322f">get-result-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">input-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">is-xml</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">fixed-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="25" select="quick" style="color: #cb4b16">f:path-to-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="15" select="quick" style="color: #d33682">$input-uri</span><span class="parenthesis" start="25" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:message</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="op" style="color: #b58900">'</span><span class="literal" start="1" style="color: #93a1a1">input-uri</span><span class="op" style="color: #b58900">'</span><span class="op" start="12" style="color: #b58900">,</span><span class="whitespace" start="13" style="color: #b58900"> </span><span class="variable" start="14" select="quick" style="color: #d33682">$fixed-uri</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">file-content</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="25" select="quick" style="color: #cb4b16">unparsed-text</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="15" select="quick" style="color: #d33682">$fixed-uri</span><span class="parenthesis" start="25" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">file-only</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="27" select="quick" style="color: #cb4b16">f:file-from-uri</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="17" select="quick" style="color: #d33682">$input-uri</span><span class="parenthesis" start="27" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
    
    </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$is-xml</span><span class="whitespace" start="8" style="color: #b58900"> </span><span class="op" start="9" style="color: #b58900">and</span><span class="whitespace" start="12" style="color: #b58900"> </span><span class="variable" start="13" select="quick" style="color: #d33682">$indent-size</span><span class="whitespace" start="25" style="color: #b58900"> </span><span class="op" start="26" style="color: #b58900">lt</span><span class="whitespace" start="28" style="color: #b58900"> </span><span class="numeric" start="29" style="color: #2aa198">0</span><span class="whitespace" start="30" style="color: #b58900"> </span><span class="op" start="31" style="color: #b58900">and</span><span class="whitespace" start="34" style="color: #b58900"> </span><span class="function" start="35" pair-end="47" select="quick" style="color: #cb4b16">not</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="39" select="quick" style="color: #d33682">$do-trim</span><span class="parenthesis" start="47" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> for case where XPath is embedded in XML text </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="47" select="quick" style="color: #cb4b16">f:render</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="10" select="quick" style="color: #d33682">$file-content</span><span class="op" start="23" style="color: #b58900">,</span><span class="whitespace" start="24" style="color: #b58900"> </span><span class="variable" start="25" select="quick" style="color: #d33682">$doctype</span><span class="op" start="33" style="color: #b58900">,</span><span class="whitespace" start="34" style="color: #b58900"> </span><span class="variable" start="35" select="quick" style="color: #d33682">$root-prefix</span><span class="parenthesis" start="47" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="variable" start="1" select="quick" style="color: #d33682">$is-xml</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> for case where XPath is embedded in XML text and indentation required </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="47" select="quick" style="color: #cb4b16">f:render</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="10" select="quick" style="color: #d33682">$file-content</span><span class="op" start="23" style="color: #b58900">,</span><span class="whitespace" start="24" style="color: #b58900"> </span><span class="variable" start="25" select="quick" style="color: #d33682">$doctype</span><span class="op" start="33" style="color: #b58900">,</span><span class="whitespace" start="34" style="color: #b58900"> </span><span class="variable" start="35" select="quick" style="color: #d33682">$root-prefix</span><span class="parenthesis" start="47" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="vname" style="color: #d33682">real-indent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="if" start="1" style="color: #b58900">if</span><span class="whitespace" start="3" style="color: #b58900"> </span><span class="parenthesis" start="4" pair-end="22" select="quick" style="color: #268bd2">(</span><span class="variable" start="5" select="quick" style="color: #d33682">$indent-size</span><span class="whitespace" start="17" style="color: #b58900"> </span><span class="op" start="18" style="color: #b58900">lt</span><span class="whitespace" start="20" style="color: #b58900"> </span><span class="numeric" start="21" style="color: #2aa198">0</span><span class="parenthesis" start="22" style="color: #268bd2">)</span><span class="whitespace" start="23" style="color: #b58900"> </span><span class="op" start="24" style="color: #b58900">then</span><span class="whitespace" start="28" style="color: #b58900"> </span><span class="numeric" start="29" style="color: #2aa198">0</span><span class="whitespace" start="30" style="color: #b58900"> </span><span class="op" start="31" style="color: #b58900">else</span><span class="whitespace" start="35" style="color: #b58900"> </span><span class="variable" start="36" select="quick" style="color: #d33682">$indent-size</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
                      </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="40" select="quick" style="color: #cb4b16">f:indent</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="10" select="quick" style="color: #d33682">$spans</span><span class="op" start="16" style="color: #b58900">,</span><span class="whitespace" start="17" style="color: #b58900"> </span><span class="variable" start="18" select="quick" style="color: #d33682">$real-indent</span><span class="op" start="30" style="color: #b58900">,</span><span class="whitespace" start="31" style="color: #b58900"> </span><span class="variable" start="32" select="quick" style="color: #d33682">$do-trim</span><span class="parenthesis" start="40" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
      </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
        </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> for case where XPath is standalone </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
        </span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="function" start="1" pair-end="28" select="quick" style="color: #cb4b16">loc:showXPath</span><span class="parenthesis" style="color: #268bd2">(</span><span class="variable" start="15" select="quick" style="color: #d33682">$file-content</span><span class="parenthesis" start="28" style="color: #268bd2">)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
      </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
    </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  </span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
  
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xsl:stylesheet</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span></pre></div></body></html>