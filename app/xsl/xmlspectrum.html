<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>XMLSpectrum output</title></head><body><div><pre class="spectrum" style="&#xA;    margin:0px;&#xA;    font-family:'Source Code Pro', monospace;&#xA;    font-size: 0.8em;&#xA;    white-space: pre-wrap;&#xA;    display: block;&#xA;    border: none thin;&#xA;    border-color: #405075;&#xA;    background-color:#002b36;&#xA;    padding: 2px;&#xA;    margin-bottom:5px;&#xA;"><span class="z" style="color: #586e75">&lt;?</span><span class="pi" style="color: #2aa198">xml version="1.0" encoding="utf-8"</span><span class="z" style="color: #586e75">?&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
XMLSpectrum by Phil Fearon Qutoric Limited 2012 (c)
http://qutoric.com
License: Apache 2.0 http://www.apache.org/licenses/LICENSE-2.0.html

Purpose: Syntax highlighter for XPath (text), XML, XSLT and XSD 1.1 file formats

Interface Functions:
====================
f:render(xml-content, is-xml, root-prefix)
loc:showXPath(text-content)
f:get-css(color-theme)
f:indent(spans, char-width)
f:link(spans, paths, location)

Interface Templates:
====================
&lt;xsl:template match="span" mode="markup"&gt;

Global Variables (for overriding)
=================================
w3c-xpath-functions-uri: location of resource proxy
font-name:               abbreviated font name [std|scp] default
                         is std for standard monospace - override
                         with 'scp' for 'Souce Code Pro'
                         font-family

</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:stylesheet</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">version</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">2.0</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">xmlns:xsl</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">http://www.w3.org/1999/XSL/Transform</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">xmlns:xs</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">http://www.w3.org/2001/XMLSchema</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">xmlns:loc</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">com.qutoric.sketchpath.functions</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">xmlns:css</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-defs.com</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">exclude-result-prefixes</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc f xs css c</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">xmlns</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900"></span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">xmlns:c</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">http://xmlspectrum.colors.org</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
    </span><span class="atn" style="color: #2aa198">xmlns:f</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">internal</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-theme</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'dark'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">force-newline</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'no'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">insert-newlines</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$force-newline eq 'yes'</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">max-newline-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">80</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">resolved-theme</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($color-theme eq 'light') then 'solarized-light'
else if ($color-theme eq 'dark') then 'solarized-dark'
else $color-theme</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> override these variables </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">w3c-xpath-functions-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'http://www.w3.org/TR/xpath-functions/'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">font-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'std'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">theme-doc-uri</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'data/color-themes.xml'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-inline</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'no'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-doc</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doc(resolve-uri($theme-doc-uri, static-base-uri()))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-theme-data</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(c:theme)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$css-doc/c:themes/c:theme[@name eq f:get-theme($resolved-theme)]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-modes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(colors)*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-inline-colors($color-theme-data)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> override if xml document type is not included here </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xsd-names</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">document-types</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">document-type</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xslt</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">ns</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">http://www.w3.org/1999/XSL/Transform</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">ns</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">document-type</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">document-type</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xsd</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">ns</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">http://www.w3.org/2001/XMLSchema</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">ns</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xpath-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">assert</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">test</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">alternative</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">test</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">field</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">xpath</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">selector</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">xpath</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xpath-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">highlight-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">attribute</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">highlight-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">document-type</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">document-type</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">schematron</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">ns</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">http://purl.oclc.org/dsdl/schematron</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">ns</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">ns</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">http://www.ascc.net/xml/schematron</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">ns</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xpath-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">assert</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">test</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">key</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">path</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">report</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">test</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">rule</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">context</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">value-of</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xpath-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">highlight-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pattern</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">key</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">highlight-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">document-type</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">document-type</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">deltaxml</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">ns</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">http://www.deltaxml.com/ns/well-formed-delta-v1</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">ns</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xpath-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">deltaV2</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xpath-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">highlight-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pattern</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">key</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">highlight-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">document-type</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">document-type</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xproc</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">ns</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">http://www.w3.org/ns/xproc</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">ns</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xpath-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">add-attribute</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> note: XProc spec states attribute-value has type xs:string
           but the value may be an XPath expression so it can
           do no harm to colorise as such </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">attribute-value</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">delete</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">filter</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">hash</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">input</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">insert</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">iteration-source</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">label-elements</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">label</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">make-absolute-uris</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">namespaces</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">element</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">option</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">rename</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">replace</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">set-attributes</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-replace</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">replace</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">unwrap</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">uuid</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">variable</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">viewport</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">when</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">test</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">with-option</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">with-param</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">select</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">wrap</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">www-form-urlencode</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">att</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">match</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">att</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xpath-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">highlight-names</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">option</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">variable</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">highlight-names</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">document-type</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">document-types</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:doctype-from-xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">($xsd-names/document-type[ns = $xmlns]/@name, '')[1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:xsd-xpath-names</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$xsd-names/document-type[@name eq $doctype]/xpath-names</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:xsd-highlight-names</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$xsd-names/document-type[@name eq $doctype]/highlight-names/*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
signature:
    f:render(xml-content, is-xml, root-prefix)

description:
    Converts the xml content string to a sequence of span elements. with each
    containing a class attribute used for coloring with CSS. 

params:
    xml-content: string containing well-balanced XML extract - namespace and prefix
                 declarations not required
    is-xsl:      boolean specifying whether coloring is for XSLT, if this is false
                 then XSD 1.1 coloring scheme is used instead
    root-prefix: string prefix used for elements requiring special coloring for XSLT
                 or XSD 1.1 - often 'xsl' and 'xs' respectively
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:render</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xmlText</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix-a</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($root-prefix-a eq '') 
then ''
else concat($root-prefix-a, ':')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens-a</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($xmlText, '&amp;lt;')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:message</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">rendering </span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat(string(count($tokens-a)),' ')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$doctype</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"> tokens ...</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (normalize-space($tokens-a[1]) eq '') then subsequence($tokens-a, 2) else $tokens-a</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:iterateTokens(0, $tokens,1,'n',0, 0, $doctype, $root-prefix)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$css-inline eq 'no'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:style-spans($spans)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> 
signature:
    f:indent(spans, char-width)

description
    
    Adds space characters for indentation to spans from XML-text processed with f:render. 
    XML contents is indented in the conventional way, multi-line attribute names and values
    are aligned vertically

parameters:
    spans:          Sequence of 'span' element nodes created by f:render
    char-width:     integer: Number of characters for each indent level
    auto-trim:      boolean: Trims any leading whitespace before indentation


 </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:indent</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">char-width</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">auto-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indentSpans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">0</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">margin</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char-width</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">an-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">0</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">av-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">0</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">multi-line</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">false()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">auto-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$auto-trim</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">mixed-level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">0</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indentSpans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">margin</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">an-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">av-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">multi-line</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">auto-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">mixed-level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span/@class</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nextClass</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans[$index + 1]/@class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prevClass</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans[$index - 1]/@class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($class eq 'scx') then $level + 1
else if ($class eq 'ez') then $level - 1
else $level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">mixed-level2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($mixed-level eq 0) then 0
else if ($class eq 'scx') then $mixed-level + 1
else if ($class eq 'ez') then $mixed-level - 1
else $mixed-level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">outdent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($index lt count($spans)) then
$spans[$index + 1]/@class eq 'ez'
else false()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exists($span)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indentOutput</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:indentTextSpan(
$span, $level, $margin, $an-offset, $av-offset, $outdent,
$nextClass, $prevClass, $multi-line, $auto-trim, $mixed-level2
)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$indentOutput/span</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index lt count($spans)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indentSpans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$level2</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">margin</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$margin</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">an-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$indentOutput/an-offset</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">av-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$indentOutput/av-offset</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">multi-line</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$indentOutput/multi-line</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">auto-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$auto-trim</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">mixed-level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer($indentOutput/mixed-level)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:clark-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring-before($name, ':')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prefix-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($prefix eq '') then 1
else string-length($prefix) + 2</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">local-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($name, $prefix-length)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($prefix eq '') then
$local-name
else
concat('{',
$xmlns/ns[@prefix eq $prefix]/@uri,
'}',
$local-name)
</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:gen-id</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type-prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">clark-name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">char</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($type-prefix,1,1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat($char, '?',$clark-name)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> 
description
    XSLT Template
    Adds ids and hrefs to span elements for global-variables, named-templates and functions

parameters:
    xmlns:          declared prefixes/namespaces on root-element for current document
    globals:        clark-notation names for all globally declared items that may be
                    referenced.
 </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">markup</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">globals</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">path-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ref-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (@class eq 'variable') then
substring(., 2)
else .</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">clark-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:clark-name($xmlns, $ref-name)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">id</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:gen-id(@class, $clark-name)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@class = ('fname', 'tname', 'vname')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">id</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$id</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$ref-name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:copy</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@class = 'enxsl'
and (ends-with(., 'stylesheet')
 or  ends-with(., 'transform')
  )</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">a</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">solar</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">href</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{concat($path-length, 'index.html')}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">id</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$id</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$ref-name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:copy</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">a</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@class = ('variable', 'href','tcall','function')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">global-refs</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (@class eq 'variable') then
    $globals/file/variables
else if (@class eq 'tcall') then
    $globals/file/templates
else if (@class eq 'function') then
    $globals/file/functions
else ()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">resolved-ref</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (exists($global-refs)) then
    ($global-refs/item[string(.) eq $clark-name])[1]/../parent::file/@path
else ()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">href</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (@class eq 'href') then
    concat(., '.html')
else if (@class eq 'function' and not(contains(., ':'))) then
    concat($w3c-xpath-functions-uri, '#', concat('func-', .))
else if (exists($resolved-ref)) then
    concat(
    $path-length,
    $resolved-ref,
    '.html', '#', $id)
else ()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exists($href)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">a</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">href</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$href}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">solar</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$css-inline ne 'no'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">style</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'text-decoration:none'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">a</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-xmlns</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">p-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">p</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">get-root-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
 </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">p</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">xmlns</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$p-spans/span[@class eq 'atn'][starts-with(., 'xmlns')]</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">att-value</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">get-next-class</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">count(preceding-sibling::*)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'av'</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"> 
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">ns</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">prefix</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{substring-after(., ':')}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">uri</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{./following-sibling::*[position() lt 5][@class eq 'av'][1]}</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">xmlns</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">get-root-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1 lt count($spans)
and $span/@class ne 'scx'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">get-root-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">get-next-class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()?</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span/@class eq $class</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1 lt count($spans)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">get-root-spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:indentTextSpan</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">margin</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">an-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">av-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">outdent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nextClass</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prevClass</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">multi-line</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">auto-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">mixed-level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span/@class</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-mixed</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$mixed-level gt 0
or (
    $class eq 'txt' and $nextClass = ('es','esx') and string-length($span) gt 0
)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">new-mixed-level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($mixed-level eq 0 and $is-mixed) then
1 else $mixed-level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">line-parts</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$insert-newlines</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> check to see if newline must be inserted after text content (even if empty) </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$class eq 'z' and $nextClass eq 'atn' and $level eq 0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">tt</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">nl</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$class eq 'txt'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">tt</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">tt</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> must somehow avoid inserting newlines within mixed content
     but string-length($span) eq 0 will not be good test </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> ez = '&lt;/' starg of a close tag: &lt;/close&gt; 
        ec = '&gt;' at end of a close tag: &lt;/close&gt;
        example &lt;open&gt;this day&lt;/open&gt; </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> if next tag is open tag (es/esx) and it is preceded by text-content
     don't add a new line, eg &lt;p&gt;my name&lt;p&gt; </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$is-mixed</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> add new line after text-content if:
     1. next tag is not a close tag
     2. next tag *is* a close tag and prev tag was a close tag also
      </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$nextClass ne 'ez'
or $prevClass eq 'ec'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">nl</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$prevClass eq 'ec'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:message</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'ec', string($span)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:message</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">tt</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">tt</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:analyze-string</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">regex</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">(\r?)\n.*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">r-length</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-length(regex-group(1))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">nl</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">text</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring(., 2 + $r-length)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($auto-trim)
then f:left-trim($text)
else $text</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">nl</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:non-matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">tt</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">tt</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:non-matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:analyze-string</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">firstLine</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$line-parts[1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indented-lines</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">for $a in $line-parts[name(.) eq 'nl'] return
string($a)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">flat-part</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$line-parts[name(.) eq 'tt']</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> should be max of 1 </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">flat-line</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($flat-part) then $flat-part else ''</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">



</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> constant indent when first attribute is on a new line </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">compact</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">4</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">lineOffset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (exists($firstLine))
    then string-length($firstLine)
else 0</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">an-outOffset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($class = ('en','enxsl'))
    then $lineOffset + 1
else if ($prevClass = ('en','enxsl'))
    then
if (exists($indented-lines)) then 
    $compact
    else $an-offset + $lineOffset
else $an-offset</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">av-outOffset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($prevClass = ('en','enxsl'))
    then 0
else if ($class eq 'atn' and $multi-line)
    then $lineOffset 
else if ($prevClass eq 'atneq' or $class = ('atneq','atn','vname','av')
    or ($class eq 'z' and $nextClass = ('atneq','atn','vname','av'))
or ($class eq 'z' and $prevClass = ('vname','av')))
    then $av-offset + $lineOffset
else $av-offset</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($prevClass = ('en','enxsl'))
    then $compact
else if ($nextClass eq 'atn') 
    then $an-outOffset
else if ($nextClass = 'av' or $class eq 'whitespace')
    then $an-outOffset + $av-outOffset
else 0</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">indent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:createIndent(($level * $margin) + $offset)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">last-level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($outdent) then $level - 1 else $level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">last-indent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:createIndent(($last-level * $margin) + $offset)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">line-count</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">count($indented-lines)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">span-text</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (exists($indented-lines))
then string-join(
($flat-line,
for $num in 1 to $line-count - 1 return
concat('&amp;#10;', $indent, $indented-lines[$num]),
concat('&amp;#10;', $last-indent, $indented-lines[$line-count]) 
),
'')
else if ($multi-line and $offset gt 0) then
concat($indent, string($line-parts[1]))
else string($line-parts[1])</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">output</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span/@*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$span-text</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">an-offset</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$an-outOffset</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">an-offset</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">av-offset</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$av-outOffset</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">av-offset</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">multi-line</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exists($indented-lines)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">multi-line</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">mixed-level</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$new-mixed-level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">mixed-level</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">output</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:left-trim</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">text</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">replace($text, '^\s+', '')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:createIndent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">padCount</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$padCount ge 0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-join(for $i in 1 to $padCount 
return ' ','')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
XSLT function signature: 
    f:get-css()

description:

    Generates a CSS file used to colorise span elements generates by the previous 2 functions
    The colors generated depend on the theme specified with the color-theme
    parameter. The color theme uses the 'Solarized' color points specified at: http://ethanschoonover.com/solarized

params:
    color-theme: xs:string - name of color theme to use 

</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-theme</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">input-theme</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($input-theme eq 'light') then 'solarized-light'
else if ($input-theme eq 'dark') then 'solarized-dark'
else $input-theme</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-css</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:apply-templates</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$css-doc/c:themes/css:boiler-plate</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:prefixed-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string+</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$name</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat($prefix, .)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-xsd-element-names</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:xsd-xpath-names($doctype)/element</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat($prefix, @name)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:copy</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-xsd-attribute-names</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:xsd-xpath-names($doctype)/attribute</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat($prefix, @name)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:copy</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-xsd-fnames</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:xsd-highlight-names($doctype)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{concat($prefix, @name)}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">attribute</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{@attribute}</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:is-xsd-fname</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">attribute</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">fnames</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-xsd-fnames($prefix, $doctype)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exists($fnames[@name = $element and @attribute = $attribute])</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:inline-css-main</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-text</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:apply-templates</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$css-doc/c:themes/css:boiler-plate/css:main</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-join($css-text, '')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:inline-css-toc</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-text</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:apply-templates</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$css-doc/c:themes/css:boiler-plate/css:toc</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-join($css-text, '')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css:font</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($font-name eq 'scp') then @scp else ''</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css:map</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@element</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$color-theme-data/c:color</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-value</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@value</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-selectors</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(c:color)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$color-theme-data/../c:color-map/c:color[@name eq $color]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css-prop</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">($color-selectors/@property, 'color')[1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">selectors</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">normalize-space($color-selectors)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">selector-tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($selectors, '\s')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string+</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">qselector-tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">for $s in $selector-tokens return
concat($element, '.', $s)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">selector-string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-join($qselector-tokens, ', ')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat(
$selector-string,
' {',
$css-prop,
': #',
$color-value,
'; }'
)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
Sample output:
&lt;colors&gt;
&lt;color name="yellow" value="b58900" property="background-color"&gt;
&lt;class&gt;yellow&lt;/class&gt;
&lt;class&gt;op&lt;/class&gt;
&lt;class&gt;type-op&lt;/class&gt;
&lt;/color&gt;
...
&lt;/colors&gt;

</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-inline-colors</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(colors)+</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">theme</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(c:theme)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-map</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$theme/../c:color-map</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(c:color-map)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">colors</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$theme/c:color</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">color</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-key</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(c:color)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$color-map/c:color[@name eq $color-key]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$color/@property</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">property</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$color/@property</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize(normalize-space($color), '\s+')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">class</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">class</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">color</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">colors</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css:color</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">css</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat('#', $color-theme-data/c:color[@name eq $color]/@value)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:getTagType</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">t</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">t1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($t,1,1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">t2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($t,2,1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$t1 eq '?'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'pi','?'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$t1 eq '!' and $t2 eq '-'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'cm','!--'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$t1 eq '!' and $t2 eq '['</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'cd','![CDATA['</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$t1 eq '!'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'dt','!'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$t1 eq '/'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'cl','/'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> open tag (may be  self-closing) </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'tg',''</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:expected-offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">in</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($in eq '?&amp;gt;') then 2
else if ($in eq '--&amp;gt;') then 3
else if ($in eq ']]&gt;') then 9
else 1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:iterateTokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">counter</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">expected</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">beganAt</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xsl</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$doctype eq 'xslt'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xsd</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($is-xsl)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens[$index]</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prevToken</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens[$index + 1]</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nextToken</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens[$index - 1]</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">awaiting</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$expected ne 'n'</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;trace&gt;
token: &lt;xsl:value-of select="$token"/&gt;
expected: &lt;xsl:value-of select="$expected"/&gt;
index: &lt;xsl:value-of select="$index"/&gt;
&lt;/trace&gt;

</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">expectedOutput</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">  looking to close an open tag </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> consider: &lt;!DOCTYPE person [&lt;!ELEMENT ... ]&gt; as well as reference only </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">beforeFind</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring-before($token, $expected)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">found</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (string-length($beforeFind) gt 0)
then true() 
else starts-with($beforeFind, $expected)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$found</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:expected-offset($expected)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">begin-token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens[$beganAt]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">z</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat('&amp;lt;',substring($begin-token, 1, $offset))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">part-token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($begin-token, $offset + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:getTagType($tokens[$beganAt])[1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> 
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-join(
($part-token,
for $x in $beganAt + 1 to ($index -1) return
concat('&amp;lt;', $tokens[$x]),
'&amp;lt;',$beforeFind)
, '')
</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">z</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$expected</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">txt</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
id="{js:getStackIndex()}"&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($token, string-length($beforeFind) + string-length($expected) + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">char1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($token,1,1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-element-start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($awaiting) and not($char1 = ('?','!','/'))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-root-element</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$counter eq 0 and $is-element-start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> if root-prefix not initially supplied, get this from the first element name </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">new-root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($is-root-element)
then if ($root-prefix eq '')
    then
        for $x in tokenize($token, '\s+')[1] return 
        for $s in substring-before($x, ':') return
            if ($s eq '') then '' else concat($s, ':')
    else $root-prefix
else $root-prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> return 2 strings if required close found - that befoe and that after (even if empty string)
 if no required close found - just return the required close</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">parseStrings</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($awaiting)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">requiredClose</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">char2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($token,2,1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char1 eq '?'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">?&amp;gt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char1 eq '!' and $char2 eq '-'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">--&amp;gt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char1 eq '!' and $char2 eq '['</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">]]&amp;gt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"> </span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> assume cdata: &lt;![CDATA[]]&gt; </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char1 eq '!'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (contains($token,'[')) then ']&gt;' else '&gt;'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">&amp;gt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">beforeClose</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring-before($token, $requiredClose)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-length($token) eq 0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;x/&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($is-element-start)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> cdata, dtd, pi, comment, or close-tag </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">foundClose</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (string-length($beforeClose) gt 0)
then true() 
else starts-with($beforeClose, $requiredClose)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$foundClose</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tagType</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:getTagType($token)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string+</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tagStart</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tagType[2]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isElementClose</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char1 eq '/'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{if ($isElementClose) then 'ez' else 'z'}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat('&amp;lt;',$tagStart)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tagContent</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($beforeClose, string-length($tagStart) + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">with-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">starts-with($tagContent, $root-prefix)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isElementClose</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{if ($is-xsl and $with-prefix)
then 'clxsl'
else if ($is-xsd
         and ($tagContent = f:get-xsd-fnames($root-prefix, $doctype)/@name
         or not($with-prefix))) 
then 'clxsl'
else 'cl'}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tagContent</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$tagType[1]}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tagContent</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{if ($isElementClose) then 'ec' else 'z'}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isElementClose</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;xsl:attribute name="id" select="js:stackPop()"/&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$requiredClose</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">txt</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isElementClose</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;xsl:attribute name="id" select="js:getStackIndex()"/&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($token, string-length($beforeClose) + string-length($requiredClose) + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">required</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$requiredClose</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">required</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">parts</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:analyze-string</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">regex</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">&amp;quot;.*?&amp;quot;|'.*?'|[^'&amp;quot;]+|['&amp;quot;]</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">flags</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">s</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:non-matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:non-matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:analyze-string</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:getAttributes($token, 0, $parts, 1, $doctype, $new-root-prefix, '')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> must be an open tag, so check for attributes </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newLevel</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">0</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newCounter</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($is-element-start)
then $counter + 1 else $counter</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">stillAwaiting</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting and empty($expectedOutput)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not(name($parseStrings[1]) eq 'required')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$parseStrings</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$expectedOutput</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newExpected</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($index eq 1) then
'n'
else if ($stillAwaiting)
then $expected
else if (count($parseStrings) eq 1)
then $parseStrings
else 'n'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newBeganAt</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($stillAwaiting) then $beganAt else $index</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index le count($tokens)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:iterateTokens($newCounter, $tokens, $index + 1,
$newExpected, $newBeganAt, $newLevel, $doctype, $new-root-prefix)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:getAttributes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">item()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">attToken</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">offset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">parts</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ename</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xsl</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$doctype eq 'xslt'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xsd</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($is-xsl)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">part1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$parts[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">part2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$parts[$index + 1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">elementName</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($ename eq '') then
tokenize($part1, '&gt;|\s+|/')[1]
else $ename</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">with-prefix</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">starts-with($elementName, $root-prefix)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xsl-element</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$is-xsl and $with-prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index eq 1</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">es</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">&amp;lt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{if ($is-xsl-element)
then 'enxsl'
else if ($is-xsl and not($with-prefix))
then 'en'
else if ($is-xsd and not($with-prefix))
then 'enxsl'
else if ($is-xsd and $elementName = f:get-xsd-fnames($root-prefix, $doctype)/@name) then 'enxsl' 
else 'en'}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
id="{js:stackPush($elementName)}"&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$elementName</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pre-close</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring-before($part1, '&gt;')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"> 

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isFinalPart</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 2 gt count($parts)
or string-length($pre-close) gt 0
or starts-with($part1,'&gt;')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isFinalPart</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">  use sc class value to mark end of self-closed element </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isSelfClosed</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ends-with($pre-close,'/')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{if ($isSelfClosed) then 'sc' else 'scx'}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isSelfClosed</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;xsl:attribute name="id" select="js:stackPop()"/&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($isSelfClosed) then '/' else ''</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">&amp;gt;</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">txt</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isSelfClosed</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;xsl:attribute name="id" select="js:getStackIndex()"/&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($attToken, string-length($pre-close) + $offset + 2)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exists($part2)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> attribute must exist and name occurs before value, so get this first </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">left</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($index eq 1)
then substring($part1, string-length($elementName) + 1)
else $part1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pre</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring-before($left,'=')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;xsl:variable name="tokens" select="tokenize($pre, '\s+')"/&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:splitAttributeName($pre)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">attSpans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (matches(.,'\S')) 
then 'atn'
else 'z'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$class}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">att-name</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$attSpans[@class eq 'atn']</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xsd-xpath-elements</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-xsd-element-names($root-prefix, $doctype)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xsd-xpath-attributes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-xsd-attribute-names($root-prefix, $doctype)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$attSpans</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isXPath</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($is-xsl-element)
then $att-name = ('select','test', 'match')

else if (exists($xsd-xpath-attributes)) then

($is-xsd and exists( 
$xsd-xpath-attributes[@name = $att-name])) 

else

($is-xsd and exists( 
$xsd-xpath-elements[@name = $elementName and ./att = $att-name])) 
</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> for coloring attribute values that are referenced from XPath </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">metaXPathName</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-av-class($is-xsl-element, $doctype, $is-xsd, 
               $elementName, $att-name, $root-prefix)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">atneq</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($left,string-length($pre) + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">sl</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-length($part2)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:double</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">z</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($part2,1,1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">attValue</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($part2, 2, $sl - 2)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isXPath</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:showXPath($attValue)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$is-xsl</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:processAVT($attValue, $metaXPathName)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$metaXPathName}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$attValue</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">z</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($part2, $sl)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newOffset</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-length($part1) + string-length($part2) + $offset</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($isFinalPart)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:getAttributes($attToken, $newOffset, $parts, $index + 2, $doctype, $root-prefix, $elementName)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:get-av-class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xsl-element</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">doctype</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-xsd</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">elementName</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">att-name</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">root-prefix</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($is-xsl-element) then
if ($elementName = f:prefixed-name($root-prefix, ('variable', 'param'))
    and $att-name eq 'name') then 'vname'
else if ($elementName = f:prefixed-name($root-prefix, ('import', 'include'))
    and $att-name eq 'href') then 'href'
else if ($elementName = f:prefixed-name($root-prefix, ('call-template'))
    and $att-name eq 'name') then 'tcall'
else if ($elementName = f:prefixed-name($root-prefix, 'function') 
    and $att-name eq 'name') then 'fname'
else if ($elementName = f:prefixed-name($root-prefix, 'template') 
    and $att-name eq 'name') then 'tname'
else 'av'

else if ($is-xsd 
         and f:is-xsd-fname($root-prefix, $doctype, $elementName, $att-name))
then 'fname' else 'av'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:unescape-p</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">text</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">t1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">replace($text, '&amp;#x0300;', '{{')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">replace($t1, '&amp;#x0301;', '}}')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:processAVT</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">attText</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">regex1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'\{.*?\}'</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">regex2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">part</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">t1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">replace($attText, '\{\{', '&amp;#x0300;')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">t2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">replace($t1, '\}\}', '&amp;#x0301;')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> flags:s = match . to any char including \n </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:analyze-string</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$t2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">regex</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$regex1}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">flags</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">s</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">p</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:unescape-p(substring(., 2, string-length(.) - 2))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">op</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">{</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:showXPath($p)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">op</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">}</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:non-matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">p</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:unescape-p(.)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$class}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$p</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:non-matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:analyze-string</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:splitAttributeName</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">text</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:analyze-string</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">regex</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">(\S+)|(\s+)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$text</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:analyze-string</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> ///////////////////////// xpath-colorer /////////////////////////////////////////////// </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ops</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">', / = &amp;lt; &amp;gt; + - * ? | != &amp;lt;= &amp;gt;= &amp;lt;&amp;lt; &amp;gt;&amp;gt; // := ! || { }'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">aOps</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'or and eq ne lt le gt ge is to div idiv mod union intersect except in return satisfies then else as map'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">hOps</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'for some every let'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nodes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'attribute comment document-node namespace-node element node processing-instruction text'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">types</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'empty-sequence function item node schema-attribute schema-element type'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ambiguousOps</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($aOps,'\s+')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">simpleOps</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($ops,'\s+')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nodeTests</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($nodes,'\s+')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">typeTests</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($types,'\s+')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">higherOps</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($hOps,'\s+')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">bgColor</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'black'</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">


</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
signature:
    loc:showXPath(text-content)

description:

    Converts the xpath content string to a sequence of span elements. with each
    containing a class attribute used for coloring with CSS. 

params:
   text-content: string containing a single XPath expression
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:showXPath</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">chunk</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">chars</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:stringToCharSequence($chunk)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">blocks</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createBlocks($chars, false(), 1, '', 0, 0)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pbPairs</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createPairs($blocks[name() = 'block' and @type = ('[',']','(',')')])</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">omitPairs</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">($blocks[name() = ('literal','comment')])</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:getTokens($chunk, $omitPairs, $pbPairs)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$css-inline eq 'no'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">plain</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">para</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">plain</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">para</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:style-spans($spans)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">f:style-spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">spans</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">node()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$spans</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-key</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@class</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-mode1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(color)?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$color-modes/color[class = $color-key]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> use the yellow color mode if none defined for class </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">color-mode2</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element(color)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (exists($color-mode1))
then $color-mode1
else $color-modes/color[@name = 'yellow']</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">property</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($color-mode2/@property)
then $color-mode2/@property
else 'color'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:copy-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">style</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat($property, ': #', $color-mode2/@value)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:copy</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> //////////////////////////////////////////////////////////////////////////////////////////////// </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> 
 Sample output:
&lt;block position="3" type="["/&gt;
&lt;literal type="'" start="54" end="61"/&gt;
&lt;comment start="65" end="69"/&gt;
&lt;comment start="76"/&gt; // if not closed
 </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> diagnostic formatting function - not used </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:pad</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">padStringIn</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">fixedWidth</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">padString</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">replace($padStringIn, '\n','\\n')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">stringLength</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-length($padString)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">padChar</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($fixedWidth gt 20) then '.' else ' '</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">padCount</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$fixedWidth - $stringLength</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$padCount ge 0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat($padString, string-join(for $i in 1 to $padCount 
return $padChar,''))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$padCount lt 0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat($padString, '&amp;#10;',' ', string-join(for $i in 1 to $fixedWidth 
return $padChar,''))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">plain</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">para</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">total</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">count($para)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">1 to $total</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">.</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$para[$index]</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isJoined</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-length(@value) gt 1 and ends-with(@value, '(')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isLiteral</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (empty(@type)) then false() else @type eq 'literal'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">literalQuote</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring(@value, 1, 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isLiteral</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">op</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$literalQuote</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@type eq 'variable' and $index + 2 lt $total</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$para[$index + 1]/@type eq 'whitespace' and $para[$index + 2]/@value eq 'in'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">id</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat('rng-',@value)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">className</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exists(@type)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (@type eq 'literal' and
matches(@value ,'select[\s\p{Zs}]*=[\s\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]'))
then 'select'
else @type</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">p</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$para[$index - 1] </span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($p/@type eq 'literal' and
matches($p/@value ,'name[\s\p{Zs}]*=[\s\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]'))
then 'external'
else 'qname'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$className</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$className eq 'external'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">id</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">concat('ext-',@value)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">(@value = ('(','[') or @type eq 'function') and not(@pair-end)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">style</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'color: pink;'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@pair-end</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pair-end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@pair-end</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not(@type) or 
(@type = ('function','filter','parenthesis','variable','node')) and (not(@value = (')',']'))) or
(@value eq '*' and $para[$index - 1]/@class eq 'axis')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">select</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'quick'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;xsl:choose&gt;
&lt;xsl:when test="@type = ('literal','comment')"&gt;
&lt;xsl:analyze-string 
select="if ($isLiteral) then substring(@value, 2, string-length(@value) - 2)
else @value" regex="\n"&gt;
&lt;xsl:matching-substring&gt;
&lt;br&gt;&lt;/br&gt;
&lt;/xsl:matching-substring&gt;
&lt;xsl:non-matching-substring&gt;
&lt;xsl:value-of select="."/&gt;
&lt;/xsl:non-matching-substring&gt;
&lt;/xsl:analyze-string&gt;
&lt;/xsl:when&gt;
&lt;xsl:otherwise&gt;
&lt;xsl:value-of select="if ($isJoined) then substring(@value, 1, string-length(@value) - 1) else @value"/&gt;
&lt;/xsl:otherwise&gt;
&lt;/xsl:choose&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@type = ('literal','comment')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($isLiteral) then substring(@value, 2, string-length(@value) - 2)
else @value</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($isJoined) then substring(@value, 1, string-length(@value) - 1) else @value</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isJoined</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">parenthesis</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">(</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isLiteral</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">class</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">op</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$literalQuote</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">plainLine</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">span</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">class</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@type</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">revChars</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">reverse(string-to-codepoints(@value))</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">lastLF</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">count($revChars) + 1 - index-of($revChars, 10)[1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring(@value, $lastLF + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">span</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">match</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">mode</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">dev</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">p</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="clxsl" style="color: #268bd2">p</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:stringToCharSequence</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">for $i in 1 to string-length($string)
return substring($string, $i, 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createPairs</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">brackets</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nested</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">getNesting</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">positions</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$brackets</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">0</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">  pair up start and end elements </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ends</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$nested[@end]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:for-each</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$nested[@start]</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">@level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pair</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">($ends[@level = $level])[number(@end) &gt; $start][1]</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{name(.)}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pair</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pair/@end</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:for-each</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">getNesting</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">positions</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">tunnel</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">yes</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pos</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$positions[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isOpen</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pos/@type = ('(','[', '(:')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isBracket</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pos/@type = ('(',')')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isComment</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pos/@type = ('(:',':)')</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">blockType</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if($isBracket) then 'bracket'
else if($isComment) then 'comment'
else 'predicate'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newLevel</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if($isOpen) then
$level + 1 else $level - 1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">empty($pos)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isOpen</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$blockType}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pos/@position</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$newLevel</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$blockType}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pos/@position</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1 &gt; count($positions)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:call-template</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">getNesting</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$newLevel</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:with-param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:call-template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:template</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createBlocks</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">chars</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">skip</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">awaiting</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">charCount</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">count($chars)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">char</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$chars[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nChar</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$chars[$index + 1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pChar</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$chars[$index - 1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newLevel</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting = ':)'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if($char = '(' and $nChar = ':') then $level + 1
else if ($char = ')' and $pChar = ':' and $level gt 0) then $level -1
else $level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nowAwaiting</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting=''</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if($char = ('&amp;apos;&amp;apos;','&amp;quot;'))
then $char 
else if ($char = '(' and $nChar = ':') then ':)' 
else ''</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char = $awaiting</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">''</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting = ':)' and $char = ')' and $pChar = ':' and $level = 0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">''</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">nowSkip</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$skip</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">false()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char = $awaiting and $nChar = $char</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">true()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">false()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting = '' and $nowAwaiting = ''</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char = ('[',']','(',')')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="enxsl" style="color: #268bd2">block</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">position</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$index}</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">type</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{$char}</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isFound</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($awaiting = $nowAwaiting) and not($skip or $nowSkip)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newStart</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($isFound) then $index else $start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting ne '' and $isFound</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{if ($awaiting = ':)') then 'comment' else 'literal'}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting ne ':)'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$char</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index eq $charCount</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting ne '' and not($isFound)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">{if ($awaiting = ':)') then 'comment' else 'literal'}</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting ne ':)'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$awaiting</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createBlocks($chars, $nowSkip, $index + 1, $nowAwaiting, $newStart, $newLevel)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> top-level call - marks up tokens with their type </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:getTokens</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">chunk</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">omitPairs</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pbPairs</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createTokens($chunk, $omitPairs, 1, 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:rationalizeTokens($tokens, 1, false(), $pbPairs, false(), false())</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:rationalizeTokens</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">prevIsClosed</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pbPairs</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">typeExpected</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">quantifierExpected</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> when closed, a probable operator is a QName instead </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens[$index]</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()?</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isQuantifier</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$quantifierExpected and $token/@value = ('?','*','+')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">is-wildcard</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($isQuantifier) and not($prevIsClosed) and $token/@value eq '*'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">currentIsClosed</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$is-wildcard or $isQuantifier or not($token/@type) or ($token/@value = (')',']', '}') or ($token/@type = ('literal','numeric','variable', 'context')))</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@end</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">value</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@value</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@type = 'probableOp'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$prevIsClosed</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'op'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$is-wildcard</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900">
&lt;xsl:attribute name="type" select="'any'"/&gt;
</span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@type = ('function','if', 'node') or $token/@value = ('(','[')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pair</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pbPairs[@start = $token/@end]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$typeExpected and $token/@type = ('node', 'function')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'node-type'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@type</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not(empty($pair))</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pair/@end</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">pair-end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pair/@end</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">level</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$pair/@level</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$typeExpected</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($token/@type) then $token/@type else 'type-name'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isQuantifier</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'quantifier'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@type</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@type</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ignorable</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@type = ('whitespace', 'comment')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isNewClosed</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$ignorable</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$prevIsClosed</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token/@type = 'probableOp'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not($prevIsClosed)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$currentIsClosed</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">newTypeExpected</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($ignorable) then $typeExpected
else ($token/@type = 'type-op') or ($token/@value eq 'as')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1 le count($tokens)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">qExpected</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$typeExpected or $token/@value = ')'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496"> 


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:rationalizeTokens($tokens, $index + 1, $isNewClosed,
$pbPairs, $newTypeExpected, $qExpected)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">


</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createTokens</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">excludes</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exclude</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$excludes[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (empty($exclude)) then ()
else if ($exclude/@end) then 
$exclude/@end cast as xs:integer + 1
else ()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exStart</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (empty($exclude)) then ()
else $exclude/@start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">part</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">empty($exclude) and $index = 1</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">exists($exStart) and $exStart ge $start</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($string, $start, $exStart - $start)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($string, $start, string-length($string) + 1 - $start)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string-length($part) gt 0</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:rawTokens($part)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> The XSLT that generates the tokens </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:processTokens($tokens, $start, 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not(empty($exclude))</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$exclude/@start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$exclude/@end</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$exclude/@end</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">stringEnd</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if ($exclude/@end) then $exclude/@end else string-length($string)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">value</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">substring($string, $exclude/@start, $stringEnd + 1 - $exclude/@start)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:attribute</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">name($exclude)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> iterate 1 pos beyond end of excludes length </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">not(empty($excludes)) and not(empty($end)) and $index le count($excludes)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:createTokens($string, $excludes, $end, $index + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:processTokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">element()*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$tokens[$index]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$start + string-length($token)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:element</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">token</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">start</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$start</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">end</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$end - 1</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">value</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isSimpleOps</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token = $simpleOps</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isSimpleOps</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if($token = ('/','//')) then 'step' else 'op'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">isDoubleToken</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:boolean</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isSimpleOps</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">false()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">splitToken</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($token, '[\s\p{Zs}]+')</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if (count($splitToken) ne 2) then false()
else if ($splitToken[1] eq 'instance' and $splitToken[2] eq 'of') 
then true()
else if ($splitToken[1] = ('cast','castable','treat') and $splitToken[2] eq 'as')
then true() else false()</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isDoubleToken</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'type-op'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">functionType</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isSimpleOps or $isDoubleToken or string-length($token) = 1 or not(ends-with($token,'('))</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:variable</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">fnName</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokenize($token, '[\s\p{Zs}]+|\(')[1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$fnName = 'if'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">if</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">some $n in $nodeTests satisfies $n = $fnName</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">node</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">some $x in $typeTests satisfies $x = $fnName</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">type</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:text</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">function</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:text</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:variable</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">starts-with($token, 'Q{')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'bracedq'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$isSimpleOps or $isDoubleToken</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$functionType ne ''</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$functionType</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">ends-with($token, '::') or $token eq '@'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'axis'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">matches($token,'[\s\p{Zs}]+')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'whitespace'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token = ('.','..')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'context'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token = ('(',')')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'parenthesis'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token = ('[',']')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'filter'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">number($token) = number($token)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'numeric'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token = $ambiguousOps</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'probableOp'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token = $higherOps</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">starts-with(loc:nextNonWhite($tokens, $index), '$')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'higher'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$token eq 'if'</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:nextNonWhite($tokens, $index) eq '('</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'if'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">starts-with($token, '$')</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:attribute</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">type</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">'variable'</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:element</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:if</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$index + 1 le count($tokens)</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:sequence</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:processTokens($tokens, $end, $index + 1)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:if</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:nextNonWhite</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string?</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">tokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">index</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:integer</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:choose</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:when</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">test</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">true()</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="z" style="color: #586e75">&lt;!--</span><span class="cm" style="color: #859900"> test="$index + 2 lt count($tokens)"&gt;  </span><span class="z" style="color: #586e75">--&gt;</span><span class="txt" style="color: #839496"> 
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">if(replace($tokens[$index + 1],'[\s\p{Zs}]+','') eq '')
then $tokens[$index + 2] else $tokens[$index + 1]</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:when</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:otherwise</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496"></span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:otherwise</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:choose</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:function</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">loc:rawTokens</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string*</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:param</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">name</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">chunk</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">as</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">xs:string</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:analyze-string</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">regex</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">(((-)?\d+)(\.)?(\d+([eE][\+\-]?)?\d*)?)|(\?)|(Q\{{[^\{{\}}]*\}})|(instance[\s\p{{Zs}}]+of)|(cast[\s\p{{Zs}}]+as)|(:=)|(\|\|)|(castable[\s\p{{Zs}}]+as)|(treat[\s\p{{Zs}}]+as)|((\$[\s\p{{Zs}}]*)?[\i\*][\p{{L}}\p{{Nd}}\.\-]*(:[\p{{L}}\p{{Nd}}\.\-\*]*)?(::)?:?(#\d+)?)(\()?|(\.\.)|((-)?\d?\.\d*)|-|([&amp;lt;&amp;gt;!]=)|(&amp;gt;&amp;gt;|&amp;lt;&amp;lt;)|(//)|([\s\p{{Zs}}]+)|(\C)</span><span class="z" style="color: #586e75">"</span><span class="z" style="color: #586e75">
</span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">$chunk</span><span class="z" style="color: #586e75">"</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:matching-substring</span><span class="scx" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="es" style="color: #586e75">&lt;</span><span class="en" style="color: #6c71c4">xsl:value-of</span><span class="z" style="color: #586e75"> </span><span class="atn" style="color: #2aa198">select</span><span class="atneq" style="color: #586e75">=</span><span class="z" style="color: #586e75">"</span><span class="av" style="color: #859900">string(.)</span><span class="z" style="color: #586e75">"</span><span class="sc" style="color: #586e75">/&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:matching-substring</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:analyze-string</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:function</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">

</span><span class="ez" style="color: #586e75">&lt;/</span><span class="cl" style="color: #6c71c4">xsl:stylesheet</span><span class="ec" style="color: #586e75">&gt;</span><span class="txt" style="color: #839496">
</span></pre></div></body></html>