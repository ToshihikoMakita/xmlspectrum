<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>highlight-file.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></link></head><body><div><pre class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm">
A frontend for XMLSpectrum by Phil Fearon Qutoric Limited 2012 (c)

http://qutoric.com
License: Apache 2.0 http://www.apache.org/licenses/LICENSE-2.0.html

Purpose: Syntax highlighter for XPath (text), XML, XSLT and XSD 1.1 file formats

Description:

A sample XSLT stylesheet that exploits xmlspectrum.xsl

Takes the input file specified in the sourcepath XSLT parameter and generates an
HTML output file ( plus also include/import files if link-names=yes ) and a CSS file.

The input file may be 1 of 5 types:

1. XSLT (upto 3.0)
2. XSD 1.0 or 1.1
3. Generic XML
4. XPath or XQuery (upto 3.0)

Note that this file interface is a simple wrapper for xmlspectrum.xsl. This front-end
will auto-detect whether the file is XSLT, XSD or XQuery/XPath based on well-formedness and
namespaces. If you're converting XML samples that are not well-formed or contained within
other XML you can code your own interface XSLT.

Usage:

initial-template: 'main'
source-xml: (not used)
key xsl parameters:
    sourcepath:  path or URI for source file
    color-theme: name of color-theme - default is 'solarized dark'
    link-names:  (yes|no) [Default:'no']
                 processes all linked xsl files and adds hrefs
                 for variables, functions, parameters and named templates
    css-path:    (path for output CSS)
    output-path: path in which to create html files - default is 'output/'
    output-method: [html|xml] default:html - for xml, no css file is created
    [other params] - see xsl:param below

Sample transform using Saxon-HE/Java on command-line (unbroken line):

java -cp "C:\Users\pgf\Saxon\saxon9he.jar" net.sf.saxon.Transform -t -it:main
-xsl:xsl/highlight-file.xsl sourcepath=../samples/xpathcolorer-x.xsl

</span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w9"><span class="es">&lt;</span><a class="solar" href="index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.sketchpath.functions</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:css</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-defs.com</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xqf</span><span class="atneq">=</span><span class="z">"</span><span class="av">urn:xq.internal-function</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">loc f xs css xqf</span><span class="z">"</span><span class="z">
                </span><span class="atn">xpath-default-namespace</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">internal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  
  </span><span class="ww" id="w73"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html" class="solar"><span class="href">xmlspectrum.xsl</span></a><span class="z">"</span><span id="wx81" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w83"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="make-toc.xsl.html" class="solar"><span class="href">make-toc.xsl</span></a><span class="z">"</span><span id="wx91" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w93"><span class="es">&lt;</span><span class="enxsl">xsl:output</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">html</span><span class="z">"</span><span id="wx107" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w109"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?sourcepath">sourcepath</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx131" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm">  by default - rely on original indentation </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w137"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?indent">indent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">-1</span><span class="op">'</span><span class="z">"</span><span id="wx159" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w161"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?color-theme">color-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">dark</span><span class="op">'</span><span class="z">"</span><span id="wx177" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w179"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?css-path">css-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx195" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w197"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx213" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w215"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?link-names">link-names</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx231" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w233"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?output-path">output-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output/</span><span class="op">'</span><span class="z">"</span><span id="wx249" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w251"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?format-mixed-content">format-mixed-content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx267" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> set value to 'scp' for source-code-pro font </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w273"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?font-name">font-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">scp</span><span class="op">'</span><span class="z">"</span><span id="wx289" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> 
       can be html, xml, xhtml or text
       set value to 'xml' or 'xhtml' for use in XProc step 
  </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w295"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?output-method">output-method</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">html</span><span class="op">'</span><span class="z">"</span><span id="wx311" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> set value to 'yes' to embed css inline with element </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w317"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?css-inline">css-inline</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx333" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> identifies xslt/schematron/xproc etc - not required if root namespace can be used </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w339"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?document-type">document-type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx355" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w357"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?document-type-prefix">document-type-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx373" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> 
  w3c-xpath-functions-uri is use to add hyperlinks to built-in
  xpath functions when 'link-names' = 'yes'
  set uri to a proxy server storing the W3C resource to avoid
  excessive calls to the W3C server
   </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w379"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?w3c-xpath-functions-uri">w3c-xpath-functions-uri</span><span class="z">"</span><span class="z">
             </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">http://www.w3.org/TR/xpath-functions/</span><span class="op">'</span><span class="z">"</span><span id="wx395" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w397"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-trim">do-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?auto-trim" class="solar"><span class="variable">$auto-trim</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span id="wx418" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w420"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-link">do-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?link-names" class="solar"><span class="variable">$link-names</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span id="wx441" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w443"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent-size">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?indent" class="solar"><span class="variable">$indent</span></a><span class="parenthesis">)</span><span class="z">"</span><span id="wx460" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w462"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-name">css-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">theme.css</span><span class="op">'</span><span class="z">"</span><span id="wx478" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w480"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-output-path">do-output-path</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$c</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#f?{internal}path-to-uri" class="solar"><span class="function">f:path-to-uri</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?output-path" class="solar"><span class="variable">$output-path</span></a><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
                        </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="variable">$c</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="variable">$c</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">\</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                        </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$c</span><span class="whitespace">
                        </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$c</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                        </span><span class="z">"</span><span id="wx551" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> limited functionality on this template.
       use only if file is known to be well-formed, otherwise use 'main' template </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w557"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="step">/</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
    </span><span class="ww" id="w568"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-qname">root-qname</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function">node-name</span></a><span class="parenthesis">(</span><span class="op">*</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName</span><span class="z">"</span><span id="wx591" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w593"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function">prefix-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx621" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w623"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-namespace">root-namespace</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-from-QName" class="solar"><span class="function">namespace-uri-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx640" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w642"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="doctype-functions.xsl.html#f?{internal}doctype-from-xmlns" class="solar"><span class="function">f:doctype-from-xmlns</span></a><span class="parenthesis">(</span><span class="op">*</span><span class="step">/</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function">namespace-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx688" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w690"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-spans">all-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w706"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w716"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function">base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx732" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w734"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx756" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w758"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx778" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w780"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx800" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w802"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> 
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace">
                                </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx835" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx839" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx843" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w845"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w849"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">processing</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$all-spans</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tokens for</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function">base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">css-inline:</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="z">"</span><span id="wx885" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx889" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w891"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">------------------------------------------------</span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx897" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w899"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">auto-trim: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?auto-trim" class="solar"><span class="variable">$auto-trim</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> indent: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?indent" class="solar"><span class="variable">$indent</span></a><span class="z">"</span><span id="wx921" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w923"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output-path: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-path" class="solar"><span class="variable">$output-path</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> doctype: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> root-prefix: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx954" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w956"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">html</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w973"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="z"> </span><span class="atn">disable-output-escaping</span><span class="atneq">=</span><span class="z">'</span><span class="av">yes</span><span class="z">'</span><span class="scx">&gt;</span><span class="txt">&amp;lt;!DOCTYPE html&gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx985" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx989" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w991"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w995"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">text</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1012"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function">base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">.text</span><span class="op">'</span><span class="parenthesis">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">text</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1041"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-spans</span><span class="z">"</span><span id="wx1049" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx1053" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1057" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1059"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1063"><span class="es">&lt;</span><span class="en">html</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1067"><span class="es">&lt;</span><span class="en">head</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1071"><span class="es">&lt;</span><span class="en">title</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1075"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">XMLSpectrum output</span><span class="op">'</span><span class="z">"</span><span id="wx1085" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">title</span><span id="wx1089" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1091"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1108"><span class="es">&lt;</span><span class="en">style</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">text/css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1118"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-css" class="solar"><span class="function">f:get-css</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1128" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">style</span><span id="wx1132" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1136" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1138"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?font-name" class="solar"><span class="variable">$font-name</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">scp</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1166"><span class="es">&lt;</span><span class="en">style</span><span class="scx">&gt;</span><span class="txt">
              @import url(http://fonts.googleapis.com/css?family=Source+Code+Pro);</span><span class="ez">&lt;/</span><span class="cl">style</span><span id="wx1172" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1176" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">head</span><span id="wx1180" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1182"><span class="es">&lt;</span><span class="en">body</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1186"><span class="es">&lt;</span><span class="en">div</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1190"><span class="es">&lt;</span><span class="en">pre</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">spectrum</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w1200"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w1217"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}inline-css-main" class="solar"><span class="function">f:inline-css-main</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1233" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1237" class="ec">&gt;</span></span><span class="txt">
                </span><span class="z">&lt;!--</span><span class="cm"> Call to imported functions returns sequence of span elements
                     with class attribute values used to colorise with CSS
                </span><span class="z">--&gt;</span><span class="txt">
                </span><span class="ww" id="w1243"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-spans</span><span class="z">"</span><span id="wx1251" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="cl">pre</span><span id="wx1255" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx1259" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">body</span><span id="wx1263" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">html</span><span id="wx1267" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1271" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1275" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1279" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1281"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?main">main</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1291"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?sourceuri">sourceuri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#p?sourcepath" class="solar"><span class="variable">$sourcepath</span></a><span class="z">"</span><span id="wx1305" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> if windows OS, convert path to URI </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w1311"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?corrected-uri1">corrected-uri1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$sourceuri</span><span class="op">,</span><span class="op">'</span><span class="literal">\\</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1338" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1340"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?uri-tokens">uri-tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri1</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx1369" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1371"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?filename">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$uri-tokens</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="z">"</span><span id="wx1390" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1392"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?encoded-filename">encoded-filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-encode-for-uri" class="solar"><span class="function">encode-for-uri</span></a><span class="parenthesis">(</span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1409" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1411"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?directory">directory</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri1</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1444" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1446"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?corrected-uri">corrected-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$directory</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$encoded-filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1466" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w1468"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xml">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-doc-available" class="solar"><span class="function">doc-available</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">xquery</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">xpath</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1512" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1514"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-element">root-element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function">doc</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="parenthesis">)</span><span class="step">/</span><span class="op">*</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1546" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1548"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-qname">root-qname</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function">node-name</span></a><span class="parenthesis">(</span><span class="variable">$root-element</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName?</span><span class="z">"</span><span id="wx1584" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1586"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> 
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#p?document-type-prefix" class="solar"><span class="variable">$document-type-prefix</span></a><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> 
                          </span><span class="op">then</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function">prefix-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="parenthesis">)</span><span class="whitespace"> 
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx1650" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1652"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-namespace">root-namespace</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-from-QName" class="solar"><span class="function">namespace-uri-from-QName</span></a><span class="parenthesis">(</span><span class="variable">$root-qname</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1682" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1684"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="highlight-file.xsl.html#p?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="doctype-functions.xsl.html#f?{internal}doctype-from-xmlns" class="solar"><span class="function">f:doctype-from-xmlns</span></a><span class="parenthesis">(</span><span class="variable">$root-namespace</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx1741" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1743"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$doctype</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">xslt</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">xsl</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1777" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1779"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?sourcepath" class="solar"><span class="variable">$sourcepath</span></a><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">?</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1807"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">auto-trim: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?auto-trim" class="solar"><span class="variable">$auto-trim</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> indent: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?indent" class="solar"><span class="variable">$indent</span></a><span class="z">"</span><span id="wx1829" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1831"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output-path: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-path" class="solar"><span class="variable">$output-path</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> document-type: </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> root-prefix: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx1862" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1866" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1868"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?params">params</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w1878"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">color-theme ................. [ solarized-dark | tomorrow-night | github | ... ]
indent ...................... [ number ] (-1 to 10)
force-newline ............... [ yes | no ]
auto-trim ....................[ yes | no ]
css-path .....................{ for style link uri }
inline-css ...................[ yes | no ]
link-names ...................[ yes | no ]
document-type ................[ xslt | xsd | xquery | ... ]
document-type-prefix .........e.g. xsl | xsd
format-mixed-content .........[ yes | no ]
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx1884" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1888" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1890"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?top-params">top-params</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w1900"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">
sourcepath .................. { local file path}
output-path ................. { directory path }
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx1906" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1910" class="ec">&gt;</span></span><span class="txt">  
    
    </span><span class="ww" id="w1912"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1916"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?sourcepath" class="solar"><span class="variable">$sourcepath</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1933"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$top-params</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$params</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1947" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1951" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1953"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?sourcepath" class="solar"><span class="variable">$sourcepath</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">?</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1970"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$params</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1987" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1991" class="ec">&gt;</span></span><span class="txt">  
      </span><span class="ww" id="w1993"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xsl</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?do-link" class="solar"><span class="variable">$do-link</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
        </span><span class="ww" id="w2007"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-files">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function">f:get-all-files</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-resolve-uri" class="solar"><span class="function">resolve-uri</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-static-base-uri" class="solar"><span class="function">static-base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2043" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2045"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-path">root-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2061"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-common-root" class="solar"><span class="tcall">get-common-root</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2071"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2091" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2093"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span id="wx2107" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2109"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2124" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2128" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2132" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2134"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?joined-path">joined-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="variable">$root-path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2157" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2159"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-length">root-length</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$joined-path</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx2180" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2182"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2198"><span class="es">&lt;</span><span class="en">globals</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2202"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-files</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2212"><span class="es">&lt;</span><span class="en">file</span><span class="z"> </span><span class="atn">path</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-length</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w2234"><span class="es">&lt;</span><span class="en">uri</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w2238"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span id="wx2246" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">uri</span><span id="wx2250" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w2252"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-globals" class="solar"><span class="function">f:get-globals</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2263" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="cl">file</span><span id="wx2267" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2271" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">globals</span><span id="wx2275" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2279" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2281"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">------------------------------------------------</span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx2287" class="ec">&gt;</span></span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">
        &lt;xsl:message select="$globals"/&gt;
        </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w2293"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$globals</span><span class="step">/</span><span class="qname">file</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
          </span><span class="ww" id="w2305"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w2309"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">tokenizing</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="axis">@</span><span class="qname">path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">...</span><span class="op">'</span><span class="z">"</span><span id="wx2329" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx2333" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2335"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?full-uri">full-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><span class="qname">uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">file:/</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                                                    </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">file:/</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="qname">uri</span><span class="parenthesis">)</span><span class="whitespace">
                                                </span><span class="op">else</span><span class="whitespace"> </span><span class="qname">uri</span><span class="z">"</span><span id="wx2382" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2384"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-spans">all-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2400"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2410"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$full-uri</span><span class="z">"</span><span id="wx2424" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2426"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2446" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2448"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2468" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2470"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2490" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2492"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname">doc-prefix</span><span class="z">"</span><span id="wx2506" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2510" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2514" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2516"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2520"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">processing</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$all-spans</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tokens for</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="axis">@</span><span class="qname">path</span><span class="z">"</span><span id="wx2546" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx2550" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2552"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ancestor-length">ancestor-length</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2589" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2591"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ancestor-path">ancestor-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}ancestor-path" class="solar"><span class="function">f:ancestor-path</span></a><span class="parenthesis">(</span><span class="variable">$ancestor-length</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2608" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2610"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}get-xmlns" class="solar"><span class="function">f:get-xmlns</span></a><span class="parenthesis">(</span><span class="variable">$all-spans</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2633" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm">
          &lt;xsl:message select="$xmlns"/&gt;
          </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm"> note: removed tunel on spans param as this caused 32% performance degrade </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="ww" id="w2643"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2659"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2669"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$all-spans</span><span class="z">"</span><span id="wx2689" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2691"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$globals</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx2717" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2719"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx2745" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2747"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2767" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2769"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">path-length</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$ancestor-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2795" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2799" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2803" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2805"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-link">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-css-link" class="solar"><span class="function">f:get-css-link</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">path</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2823" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2825"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?output-html-doc" class="solar"><span class="tcall">output-html-doc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2835"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx2849" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2851"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis">@</span><span class="qname">path</span><span class="z">"</span><span id="wx2866" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2868"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$css-link</span><span class="z">"</span><span id="wx2882" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2884"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="z">"</span><span id="wx2898" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2902" class="ec">&gt;</span></span><span class="txt">
          
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2906" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2908"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-link">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#f?{internal}get-css-link" class="solar"><span class="function">f:get-css-link</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">rootlevel</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2928" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2930"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="make-toc.xsl.html#t?create-toc" class="solar"><span class="tcall">create-toc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2940"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2966" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2968"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="z">"</span><span id="wx2982" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2984"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$css-link</span><span class="z">"</span><span id="wx2998" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3000"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">output-method</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="z">"</span><span id="wx3014" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3016"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-css-inline</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span id="wx3043" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3047" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3051" class="ec">&gt;</span></span><span class="txt">
      
      
      </span><span class="ww" id="w3053"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3057"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result-spans">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3073"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3083"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$corrected-uri</span><span class="z">"</span><span id="wx3097" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3099"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3119" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3121"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx3141" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3143"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3163" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3165"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$root-prefix</span><span class="z">"</span><span id="wx3179" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3183" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3187" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3189"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3205"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3209"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-link" class="solar"><span class="variable">$do-link</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3219"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w3229"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$result-spans</span><span class="z">"</span><span id="wx3249" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w3251"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3271" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3275" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3279" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3281"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3285"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$result-spans</span><span class="z">"</span><span id="wx3293" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3297" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3301" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3305" class="ec">&gt;</span></span><span class="txt">
        
        
        </span><span class="ww" id="w3307"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable">$corrected-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3324" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3326"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?output-html-doc" class="solar"><span class="tcall">output-html-doc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3336"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx3350" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3352"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$file-only</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$file-only</span><span class="whitespace">
                                                  </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xms-output</span><span class="op">'</span><span class="z">"</span><span id="wx3388" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3390"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
                                  </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable">$css-name</span></a><span class="whitespace">
                                  </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="z">"</span><span id="wx3423" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3425"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="z">"</span><span id="wx3439" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3443" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3447" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3451" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3453"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xml</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3492"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?do-output-path" class="solar"><span class="variable">$do-output-path</span></a><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable">$css-name</span></a><span class="parenthesis">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">text</span><span class="z">"</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3522"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-css" class="solar"><span class="function">f:get-css</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3532" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx3536" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3540" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3544" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3546"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-css-link">f:get-css-link</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3556"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?path">path</span><span class="z">"</span><span id="wx3564" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3566"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                              </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="whitespace">
                                  </span><a href="highlight-file.xsl.html#f?{internal}ancestor-path" class="solar"><span class="function">f:ancestor-path</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$path</span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace">
                              </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable">$css-name</span></a><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-path" class="solar"><span class="variable">$css-path</span></a><span class="z">"</span><span id="wx3618" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3622" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3624"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}ancestor-path">f:ancestor-path</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3634"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?levels">levels</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3648" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3650"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$levels</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
                          </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="whitespace">
                              </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="whitespace">
                                  </span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$n</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><span class="variable">$levels</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
                                  </span><span class="op">'</span><span class="literal">..</span><span class="op">'</span><span class="open"></span><span class="whitespace">
                              </span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3716" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3720" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3722"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}path-to-uri">f:path-to-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3732"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?path">path</span><span class="z">"</span><span id="wx3740" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3742"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3746"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function">matches</span></a><span class="parenthesis">(</span><span class="variable">$path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">^[A-Za-z]:.*</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3765"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">file:/</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$path</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3782" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3786" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3788"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><span class="variable">$path</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3807"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">file://</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$path</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3824" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3828" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3830"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3834"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$path</span><span class="z">"</span><span id="wx3842" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3846" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3850" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3854" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3856"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?wrap-spans">wrap-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3866"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx3880" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3882"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3902" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3904"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3924" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3926"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3940" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3942"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?path-length">path-length</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx3962" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3964"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx3981" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3983"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">mod</span><span class="whitespace"> </span><span class="numeric">1500</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4001"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4005"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">token: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="z">"</span><span id="wx4018" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx4022" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4026" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4028"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4032"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$span</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4043" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4045"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">es</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4065"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-children">span-children</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4081"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4091"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4105" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w4107"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4125" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4129" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4133" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4135"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">ww</span><span class="z">"</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">w</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4154"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx4162" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4164"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span-children</span><span class="z">"</span><span id="wx4172" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4176" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w4178"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev-index">prev-index</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$span-children</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">id</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">3</span><span class="whitespace">
                              </span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4210" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w4212"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4222"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4236" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4238"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$prev-index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4256" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4260" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4264" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4266"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">sc</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ec</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4294"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">wx</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4307"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="op">*</span><span class="op">|</span><span class="variable">$span</span><span class="step">/</span><span class="node-type">node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4324" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4328" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4332" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4334"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        
        </span><span class="ww" id="w4338"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">markup</span><span class="z">"</span><span id="wx4352" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4354"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4364"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4378" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4380"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4398" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4402" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4406" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4410" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4414" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4416"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?wrap-spans-only">wrap-spans-only</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4426"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx4440" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4442"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4456" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4458"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx4475" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4477"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">mod</span><span class="whitespace"> </span><span class="numeric">1500</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4495"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4499"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">token: </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="z">"</span><span id="wx4512" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx4516" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4520" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4522"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4526"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$span</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4537" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4539"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">es</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4559"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-children">span-children</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4575"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4585"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4599" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w4601"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4619" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4623" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4627" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4629"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">ww</span><span class="z">"</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">w</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4648"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx4656" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4658"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span-children</span><span class="z">"</span><span id="wx4666" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4670" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w4672"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev-index">prev-index</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$span-children</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">id</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">3</span><span class="whitespace">
                              </span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4704" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w4706"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4716"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4730" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4732"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$prev-index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4750" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4754" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4758" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4760"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">sc</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ec</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4788"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">wx</span><span class="op">{</span><span class="variable">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4801"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="op">*</span><span class="op">|</span><span class="variable">$span</span><span class="step">/</span><span class="node-type">node</span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4818" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4822" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4826" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4828"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4832"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx4840" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4842"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans-only" class="solar"><span class="tcall">wrap-spans-only</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4852"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span id="wx4866" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4868"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx4886" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4890" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4894" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4898" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4902" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="ww" id="w4904"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-common-root">get-common-root</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4920"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?all-files">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx4940" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4942"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4956" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4958"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?common-path">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx4972" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4974"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?current-file">current-file</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$all-files</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4999" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5001"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?min-file">min-file</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                              </span><span class="variable">$current-file</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#f?{internal}min-common-item" class="solar"><span class="function">f:min-common-item</span></a><span class="parenthesis">(</span><span class="variable">$common-path</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$current-file</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5045" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5047"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5051"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$all-files</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5068"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-common-root" class="solar"><span class="tcall">get-common-root</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5078"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx5096" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5098"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min-file</span><span class="z">"</span><span id="wx5112" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5116" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5120" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5122"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5126"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min-file</span><span class="z">"</span><span id="wx5134" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5138" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5142" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5146" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5148"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}min-common-item">f:min-common-item</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5164"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?min">min</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5178" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5180"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?new">new</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5194" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w5196"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$min</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5213"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?x">x</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5236" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5238"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min</span><span class="filter">[</span><span class="variable">$x</span><span class="filter">]</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="variable">$new</span><span class="filter">[</span><span class="variable">$x</span><span class="filter">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5258"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$min</span><span class="filter">[</span><span class="variable">$x</span><span class="filter">]</span><span class="z">"</span><span id="wx5269" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5273" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5277" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5281" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5283"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-all-files">f:get-all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5299"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?new-uri">new-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5313" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5315"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri-list">uri-list</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5329" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5331"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?uri-parts">uri-parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$new-uri</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="op">,</span><span class="op">'</span><span class="literal">/|\\</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5362" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5364"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?first-uri">first-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> 
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="whitespace">
                          </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function">subsequence</span></a><span class="parenthesis">(</span><span class="variable">$uri-parts</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$uri-parts</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="op">,</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">,</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="z">"</span><span id="wx5418" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5420"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function">f:get-all-files</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$new-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$uri-list</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5437" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5441" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5443"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-all-files">f:get-all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5459"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?first-uri">first-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5473" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5475"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?new-uri">new-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5489" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5491"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri-list">uri-list</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5505" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5507"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?add-uri">add-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$file</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="variable">$new-uri</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
                          </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$file</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$uri-list</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#f?{internal}fix-uri" class="solar"><span class="function">f:fix-uri</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$file</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5562" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5564"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-externals">new-externals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5580"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$add-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5590"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?has-protocol">has-protocol</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function">contains</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5618" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5620"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="parenthesis">(</span><span class="variable">$has-protocol</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function">contains</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="op">'</span><span class="literal">plugin:</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$has-protocol</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5654"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doc">doc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function">doc</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5671" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5673"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:import</span><span class="step">/</span><span class="axis">@</span><span class="qname">href</span><span class="op">|</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:include</span><span class="step">/</span><span class="axis">@</span><span class="qname">href</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5699"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-resolve-uri" class="solar"><span class="function">resolve-uri</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function">base-uri</span></a><span class="parenthesis">(</span><span class="variable">$doc</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5716" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5720" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5724" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5728" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx5732" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5734"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?concat-sequence">concat-sequence</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="variable">$uri-list</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$add-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5753" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5755"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5759"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$new-externals</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5772"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function">f:get-all-files</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$new-externals</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$concat-sequence</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5789" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5793" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5795"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5799"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$concat-sequence</span><span class="z">"</span><span id="wx5807" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5811" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5815" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5819" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5821"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}fix-uri">f:fix-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5837"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?first-uri">first-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5851" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5853"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri">uri</span><span class="z">"</span><span id="wx5861" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5863"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function">contains</span></a><span class="parenthesis">(</span><span class="variable">$uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">plugin:</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$first-uri</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function">substring-after</span></a><span class="parenthesis">(</span><span class="variable">$uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$uri</span><span class="z">"</span><span id="wx5906" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5910" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm">
  sample globals elements:
  &lt;doc-prefix&gt;xsl&lt;/doc-prefix&gt;
  &lt;function name="do-something" ns="internal"/&gt;
  &lt;function name="somethin-else" ns="internal"/&gt;
  &lt;template name="output-days" ns=""/&gt;
  &lt;variable name="my-global" ns=""/&gt;
  </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w5916"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-globals">f:get-globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5932"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?file-uri">file-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5946" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5948"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doc">doc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function">doc</span></a><span class="parenthesis">(</span><span class="variable">$file-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5965" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5967"><span class="es">&lt;</span><span class="en">doc-prefix</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5971"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function">prefix-from-QName</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function">node-name</span></a><span class="parenthesis">(</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5987" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">doc-prefix</span><span id="wx5991" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5993"><span class="es">&lt;</span><span class="en">templates</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5997"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:template</span><span class="filter">[</span><span class="axis">@</span><span class="qname">name</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx6019" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">templates</span><span id="wx6023" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6025"><span class="es">&lt;</span><span class="en">functions</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6029"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="qname">xsl:function</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx6047" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">functions</span><span id="wx6051" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6053"><span class="es">&lt;</span><span class="en">variables</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6057"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="parenthesis">(</span><span class="qname">xsl:variable</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx6077" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">variables</span><span id="wx6081" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6083"><span class="es">&lt;</span><span class="en">params</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6087"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$doc</span><span class="step">/</span><span class="op">*</span><span class="step">/</span><span class="parenthesis">(</span><span class="qname">xsl:param</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx6107" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">params</span><span id="wx6111" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6115" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6117"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname">xsl:template</span><span class="op">|</span><span class="qname">xsl:function</span><span class="op">|</span><span class="qname">xsl:variable</span><span class="op">|</span><span class="qname">xsl:param</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6139"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?after-colon">after-colon</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function">substring-after</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">name</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6163" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6165"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?local">local</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$after-colon</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="axis">@</span><span class="qname">name</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$after-colon</span><span class="z">"</span><span id="wx6199" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6201"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function">substring-before</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">name</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6225" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;item name="{$local}" ns="{namespace-uri-for-prefix($prefix, .)}"/&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w6231"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prefix</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><span class="variable">$local</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">{</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-for-prefix" class="solar"><span class="function">namespace-uri-for-prefix</span></a><span class="parenthesis">(</span><span class="variable">$prefix</span><span class="op">,</span><span class="whitespace"> </span><span class="context">.</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace">
                          </span><span class="op">'</span><span class="literal">}</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$local</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6288" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6290"><span class="es">&lt;</span><span class="en">item</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6294"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$clark-name</span><span class="z">"</span><span id="wx6302" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">item</span><span id="wx6306" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6310" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6312"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?output-html-doc">output-html-doc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6322"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?result-spans">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx6336" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6338"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?filename">filename</span><span class="z">"</span><span id="wx6346" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6348"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?css-link">css-link</span><span class="z">"</span><span id="wx6356" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6358"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?html-path">html-path</span><span class="z">"</span><span id="wx6366" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6368"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6385" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6387"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href-1">href-1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$html-path</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$filename</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6407" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6409"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href">href</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xml</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
                                      </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$href-1</span><span class="whitespace">
                                      </span><span class="op">else</span><span class="whitespace">
                                      </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$href-1</span><span class="op">,</span><span class="op">'</span><span class="literal">.</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="parenthesis">)</span><span class="z">"</span><span id="wx6453" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6455"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">writing: </span><span class="ww" id="w6459"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$href</span><span class="z">"</span><span id="wx6467" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx6471" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6473"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">file: </span><span class="ww" id="w6477"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$filename</span><span class="z">"</span><span id="wx6485" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx6489" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6491"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable">$href</span><span class="op">}</span><span class="z">"</span><span class="z">
                         </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
      </span><span class="ww" id="w6517"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">html</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6534"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="z"> </span><span class="atn">disable-output-escaping</span><span class="atneq">=</span><span class="z">'</span><span class="av">yes</span><span class="z">'</span><span class="scx">&gt;</span><span class="txt">&amp;lt;!DOCTYPE html&gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx6546" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6550" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6552"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">output-method</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="z">"</span><span id="wx6565" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6567"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6571"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?output-method" class="solar"><span class="variable">$output-method</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">text</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6588"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$result-spans</span><span class="z">"</span><span id="wx6596" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6600" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w6602"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6606"><span class="es">&lt;</span><span class="en">html</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6610"><span class="es">&lt;</span><span class="en">head</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w6614"><span class="es">&lt;</span><span class="en">title</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6618"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$file-only</span><span class="z">"</span><span id="wx6626" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">title</span><span id="wx6630" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w6632"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w6649"><span class="es">&lt;</span><span class="en">link</span><span class="z"> </span><span class="atn">rel</span><span class="atneq">=</span><span class="z">"</span><span class="av">stylesheet</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">text/css</span><span class="z">"</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable">$css-link</span><span class="op">}</span><span class="z">"</span><span id="wx6671" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6675" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w6677"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?font-name" class="solar"><span class="variable">$font-name</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">scp</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w6705"><span class="es">&lt;</span><span class="en">style</span><span class="scx">&gt;</span><span class="txt">
                @import url(http://fonts.googleapis.com/css?family=Source+Code+Pro);</span><span class="ez">&lt;/</span><span class="cl">style</span><span id="wx6711" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6715" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">head</span><span id="wx6719" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w6721"><span class="es">&lt;</span><span class="en">body</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w6725"><span class="es">&lt;</span><span class="en">div</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w6729"><span class="es">&lt;</span><span class="en">pre</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">spectrum</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w6739"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w6756"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}inline-css-main" class="solar"><span class="function">f:inline-css-main</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6772" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6776" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="z">&lt;!--</span><span class="cm"> Call to imported functions returns sequence of span elements
                       with class attribute values used to colorise with CSS
                  </span><span class="z">--&gt;</span><span class="txt">
                  </span><span class="ww" id="w6782"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                                        </span><a href="xslt-formatting-functions.xsl.html#f?{internal}add-nbsp" class="solar"><span class="function">f:add-nbsp</span></a><span class="parenthesis">(</span><span class="variable">$result-spans</span><span class="parenthesis">)</span><span class="whitespace">
                                        </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$result-spans</span><span class="z">"</span><span id="wx6812" class="sc">/&gt;</span></span><span class="txt">
                  
                </span><span class="ez">&lt;/</span><span class="cl">pre</span><span id="wx6816" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx6820" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">body</span><span id="wx6824" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">html</span><span id="wx6828" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6832" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6836" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx6840" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6844" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6846"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}file-from-uri">f:file-from-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6856"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?uri">uri</span><span class="z">"</span><span id="wx6864" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6866"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$uri</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">/|\\</span><span class="op">'</span><span class="parenthesis">)</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function">last</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="filter">]</span><span class="z">"</span><span id="wx6888" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6892" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6894"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-result-spans">get-result-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6904"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?input-uri">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6918" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6920"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?is-xml">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx6934" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6936"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6950" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6952"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?indent-size">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6966" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6968"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6982" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6984"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xml-new">is-xml-new</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> 
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$is-xml</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace">
                          </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$doctype</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">xpath</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xquery</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7055" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7057"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fixed-uri">fixed-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}path-to-uri" class="solar"><span class="function">f:path-to-uri</span></a><span class="parenthesis">(</span><span class="variable">$input-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7074" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7076"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w7080"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">input-uri</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$fixed-uri</span><span class="z">"</span><span id="wx7093" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx7097" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7099"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-content">file-content</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text-available" class="solar"><span class="function">unparsed-text-available</span></a><span class="parenthesis">(</span><span class="variable">$fixed-uri</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
                                                              </span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text" class="solar"><span class="function">unparsed-text</span></a><span class="parenthesis">(</span><span class="variable">$fixed-uri</span><span class="parenthesis">)</span><span class="whitespace">
                                                              </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7137" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7139"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pre-file-only">pre-file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable">$input-uri</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7156" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7158"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$pre-file-only</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$pre-file-only</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xms-output</span><span class="op">'</span><span class="z">"</span><span id="wx7194" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7196"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7200"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$file-content</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
           </span><span class="ww" id="w7213"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">XMLSpectrum: file not found </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7225" class="ec">&gt;</span></span><span class="txt">
           </span><span class="ww" id="w7227"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">function</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w7237"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">
&amp;#160;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx7243" class="ec">&gt;</span></span><span class="txt"></span><span class="ww" id="w7245"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$fixed-uri</span><span class="z">"</span><span id="wx7253" class="sc">/&gt;</span></span><span class="txt"></span><span class="ww" id="w7255"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">
&amp;#160;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx7261" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7265" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7269" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7271"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml-new</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?do-trim" class="solar"><span class="variable">$do-trim</span></a><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is embedded in XML text </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w7300"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}render" class="solar"><span class="function">f:render</span></a><span class="parenthesis">(</span><span class="variable">$file-content</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7317" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7321" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7323"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-xml-new</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is embedded in XML text and indentation required </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w7337"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}render" class="solar"><span class="function">f:render</span></a><span class="parenthesis">(</span><span class="variable">$file-content</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$doctype</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$root-prefix</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7360" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7362"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?real-indent">real-indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable">$indent-size</span></a><span class="z">"</span><span class="z">
                      </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7398" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7400"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}indent" class="solar"><span class="function">f:indent</span></a><span class="parenthesis">(</span><span class="variable">$spans</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$real-indent</span><span class="op">,</span><span class="whitespace"> </span><a href="highlight-file.xsl.html#v?do-trim" class="solar"><span class="variable">$do-trim</span></a><span class="parenthesis">)</span><span class="z">"</span><span id="wx7417" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7421" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7423"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is standalone </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">        &lt;xsl:sequence select="loc:showXPath($file-content)"/&gt;</span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w7435"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xptokens">xptokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xq-spectrum.xsl.html#f?{urn:xq.internal-function}show-xquery" class="solar"><span class="function">xqf:show-xquery</span></a><span class="parenthesis">(</span><span class="variable">$file-content</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7458" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7460"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#p?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="xmlspectrum.xsl.html#f?{internal}style-spans" class="solar"><span class="function">f:style-spans</span></a><span class="parenthesis">(</span><span class="variable">$xptokens</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$xptokens</span><span class="z">"</span><span id="wx7490" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7494" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7498" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7502" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx7506" class="ec">&gt;</span></span><span class="txt">
</span></pre></div></body></html>