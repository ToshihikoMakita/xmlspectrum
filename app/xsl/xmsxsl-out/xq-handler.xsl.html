<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>xq-handler.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></link></head><body><div><pre class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="UTF-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="ww" id="w5"><span class="es">&lt;</span><a class="solar" href="index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xpath-default-namespace</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.xq.functions</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">loc xs</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w51"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ops">ops</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">, / = &amp;lt; &amp;gt; + - * ? | != &amp;lt;= &amp;gt;= &amp;lt;&amp;lt; &amp;gt;&amp;gt; // := ! || { } ; ~ : # =&gt;</span><span class="op">'</span><span class="z">"</span><span id="wx67" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w69"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?aOps">aOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">or and eq ne lt le gt ge is to div idiv mod union intersect except in return satisfies then else as map where start previous next when end at</span><span class="op">'</span><span class="z">"</span><span id="wx85" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w87"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?hOps">hOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">for some every let</span><span class="op">'</span><span class="z">"</span><span id="wx103" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w105"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">attribute comment document-node namespace-node element node processing-instruction text</span><span class="op">'</span><span class="z">"</span><span id="wx121" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w123"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?types">types</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">empty-sequence function item document node schema-attribute schema-element type</span><span class="op">'</span><span class="z">"</span><span id="wx139" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w141"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?possOps">possOps</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">case</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">default</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx169" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w171"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ambiguousOps">ambiguousOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><a href="xq-handler.xsl.html#v?aOps" class="solar"><span class="variable">$aOps</span></a><span class="op">,</span><span class="op">'</span><span class="literal">\s+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx198" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w200"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?simpleOps">simpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><a href="xq-handler.xsl.html#v?ops" class="solar"><span class="variable">$ops</span></a><span class="op">,</span><span class="op">'</span><span class="literal">\s+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx227" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w229"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodeTests">nodeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><a href="xq-handler.xsl.html#v?nodes" class="solar"><span class="variable">$nodes</span></a><span class="op">,</span><span class="op">'</span><span class="literal">\s+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx256" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w258"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?typeTests">typeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><a href="xq-handler.xsl.html#v?types" class="solar"><span class="variable">$types</span></a><span class="op">,</span><span class="op">'</span><span class="literal">\s+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx285" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w287"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?higherOps">higherOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><a href="xq-handler.xsl.html#v?hOps" class="solar"><span class="variable">$hOps</span></a><span class="op">,</span><span class="op">'</span><span class="literal">\s+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx314" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w316"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?bgColor">bgColor</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">black</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx338" class="sc">/&gt;</span></span><span class="txt">    
  
  </span><span class="ww" id="w340"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.xq.functions}pad">loc:pad</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w356"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?padStringIn">padStringIn</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx370" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w372"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?fixedWidth">fixedWidth</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx386" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w388"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padString">padString</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$padStringIn</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">\n</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">\\n</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx420" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w422"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stringLength">stringLength</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$padString</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx445" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w447"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padChar">padChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$fixedWidth</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">20</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">.</span><span class="op">'</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> </span><span class="op">'</span><span class="z">"</span><span id="wx481" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w483"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padCount">padCount</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$fixedWidth</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="variable">$stringLength</span><span class="z">"</span><span id="wx507" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w509"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$padCount</span><span class="whitespace"> </span><span class="op">ge</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w523"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$padString</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$i</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><span class="variable">$padCount</span><span class="whitespace"> 
                            </span><span class="op">return</span><span class="whitespace"> </span><span class="variable">$padChar</span><span class="op">,</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx558" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx562" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w564"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$padCount</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w578"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$padString</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;#10;</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal"> </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$i</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><span class="variable">$fixedWidth</span><span class="whitespace"> 
                            </span><span class="op">return</span><span class="whitespace"> </span><span class="variable">$padChar</span><span class="op">,</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx622" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx626" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx630" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="z">&lt;!--</span><span class="cm"> top-level call - marks up tokens with their type </span><span class="z">--&gt;</span><span class="txt">  
  </span><span class="ww" id="w636"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.xq.functions}createXqTokens">loc:createXqTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w652"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?part">part</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx666" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w668"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?preceding-is-closed">preceding-is-closed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx682" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w684"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$part</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w701"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?rawTokens">rawTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xq-handler.xsl.html#f?{com.qutoric.xq.functions}rawTokens" class="solar"><span class="function">loc:rawTokens</span></a><span class="parenthesis">(</span><span class="variable">$part</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx724" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="z">&lt;!--</span><span class="cm"> The XSLT that generates the tokens </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="ww" id="w730"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?processedTokens">processedTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xq-handler.xsl.html#f?{com.qutoric.xq.functions}processXqTokens" class="solar"><span class="function">loc:processXqTokens</span></a><span class="parenthesis">(</span><span class="variable">$rawTokens</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx763" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w765"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xq-handler.xsl.html#f?{com.qutoric.xq.functions}rationalizeTokens" class="solar"><span class="function">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable">$processedTokens</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$preceding-is-closed</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx796" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm">          &lt;span class="test" closed="{string($preceding-is-closed)}"&gt;&lt;xsl:value-of select="$part"/&gt;&lt;/span&gt;</span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx804" class="ec">&gt;</span></span><span class="txt">    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx808" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w810"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.xq.functions}rationalizeTokens">loc:rationalizeTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w820"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx834" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w836"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx850" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w852"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?prevIsClosed">prevIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx866" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w868"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?typeExpected">typeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx882" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w884"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?quantifierExpected">quantifierExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx898" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w900"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?result">result</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx914" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> when closed, a probable operator is a QName instead </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w920"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$tokens</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx943" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w945"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?n1Token">n1Token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$tokens</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx972" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w974"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?n2Token">n2Token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$tokens</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">2</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx1001" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1003"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isQuantifier">isQuantifier</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$quantifierExpected</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">?</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">*</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1040" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1042"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-wildcard">is-wildcard</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$isQuantifier</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$prevIsClosed</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">*</span><span class="op">'</span><span class="z">"</span><span id="wx1085" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1087"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?currentIsClosed">currentIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-wildcard</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$isQuantifier</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">)</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">]</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">}</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">literal</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">numeric</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">context</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1177" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1179"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?empty-type">empty-type</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1205" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1207"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?empty-next-type">empty-next-type</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1233" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1235"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?next-type">next-type</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="z">"</span><span id="wx1258" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1260"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token-value">token-value</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="z">"</span><span id="wx1283" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1285"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?next-token-value">next-token-value</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="z">"</span><span id="wx1308" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1310"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token-type">token-type</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1349" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1351"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?whitespace-follows">whitespace-follows</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$n1Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$n1Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">whitespace</span><span class="op">'</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1397" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1399"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?precedes-variable">precedes-variable</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$next-type</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="z">"</span><span id="wx1436" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1438"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1448"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1452"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm"> precedes-variable check should not be required, but some code samples may be incomplete </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="ww" id="w1472"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prevIsClosed</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$precedes-variable</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">qname</span><span class="op">'</span><span class="z">"</span><span id="wx1500" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1504" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1506"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">element</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">attribute</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">document</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">text</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">namespace</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                        </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$empty-next-type</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">{</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1574"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="z">"</span><span id="wx1584" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1588" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1590"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">#</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$token-type</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">pragma</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1622"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="z">"</span><span id="wx1632" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1636" class="ec">&gt;</span></span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> discover functions with whitespace separating function-name and '(' char </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w1642"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">(</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1669"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">switch</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">typeswitch</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">case</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">new-fn</span><span class="op">'</span><span class="z">"</span><span id="wx1709" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1713" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1715"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">try</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">ordered</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">unordered</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                        </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> 
                        </span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$n1Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">{</span><span class="op">'</span><span class="whitespace"> 
                        </span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">{</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1786"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="z">"</span><span id="wx1796" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1800" class="ec">&gt;</span></span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for following - assume that missing n2Token means that next token is a 'literal' token </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w1806"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-empty" class="solar"><span class="function">empty</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">case</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">collation</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">module</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1848"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">case</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="z">"</span><span id="wx1878" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1882" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1884"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">catch</span><span class="op">'</span><span class="whitespace">
                        </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$empty-next-type</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">*</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1934"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="z">"</span><span id="wx1944" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1948" class="ec">&gt;</span></span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> note that case for 'where' and 'start' is exceptional - should not happen but does in incomplete w3c samples </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w1954"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">count</span><span class="op">'</span><span class="whitespace">
                        </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$precedes-variable</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1978"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="z">"</span><span id="wx1988" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1992" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1994"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">default</span><span class="op">'</span><span class="whitespace">
                        </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">return</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2038"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="z">"</span><span id="wx2048" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2052" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2054"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">case</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2074"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> 
                                </span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$empty-next-type</span><span class="whitespace"> 
                                </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$next-type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">node</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">node-type</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">type-name</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">numeric</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">(</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                                </span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">qname</span><span class="op">'</span><span class="z">"</span><span id="wx2157" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2161" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2163"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">ascending</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">descending</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                        </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">return</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">where</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">count</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2223"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="z">"</span><span id="wx2233" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2237" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2239"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-wildcard</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2249"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">op</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx2255" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2259" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2261"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-type</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">switch(</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">typeswitch(</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2293"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-value</span><span class="z">"</span><span id="wx2301" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2305" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2307"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">if</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">node</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">(</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">[</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2353"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2357"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$typeExpected</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">node</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2384"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">node-type</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx2390" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2394" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2396"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2400"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-type</span><span class="z">"</span><span id="wx2408" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2412" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2416" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2420" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2422"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$typeExpected</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2432"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token-type</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$token-type</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">type-name</span><span class="op">'</span><span class="z">"</span><span id="wx2454" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2458" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2460"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$isQuantifier</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2470"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">quantifier</span><span class="op">'</span><span class="z">"</span><span id="wx2480" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2484" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2486"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-type</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2496"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-type</span><span class="z">"</span><span id="wx2504" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2508" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2510"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2514"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$empty-type</span><span class="whitespace">  </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$n2Token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$empty-next-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$next-token-value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><a href="xq-handler.xsl.html#v?possOps" class="solar"><span class="variable">$possOps</span></a><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                                </span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="whitespace"> 
                                </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">external</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$n1Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">;</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">:=</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$n2Token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">;</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">:=</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="whitespace">
                                </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$empty-type</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace">  </span><span class="variable">$whitespace-follows</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$next-type</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="whitespace">
                                </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">qname</span><span class="op">'</span><span class="z">"</span><span id="wx2670" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2674" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2678" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2682" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2684"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result1">result1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()+</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2700"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?splitif">splitif</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token-type</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">if</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">if(</span><span class="op">'</span><span class="z">"</span><span id="wx2736" class="sc">/&gt;</span></span><span class="txt">   
      </span><span class="ww" id="w2738"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">typeswitch(</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">switch(</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
                   </span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="whitespace">
                   </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">new-fn</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="whitespace">
                   </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$class</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2796"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">type</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">node-type</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">typeswitch(</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">switch(</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$splitif</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
                              </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$token-value</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$token-value</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$token-value</span><span class="z">"</span><span id="wx2862" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2866" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2868"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$splitif</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">type</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">node-type</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">typeswitch(</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">switch(</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2908"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">parenthesis</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">(</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2920" class="ec">&gt;</span></span><span class="txt">          
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2924" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2928" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2930"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ignorable">ignorable</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">whitespace</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">comment</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2966" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2968"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isNewClosed">isNewClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2984"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2988"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$ignorable</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2998"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$prevIsClosed</span><span class="z">"</span><span id="wx3006" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3010" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3012"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3031"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$prevIsClosed</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3042" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3046" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3048"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3052"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$currentIsClosed</span><span class="z">"</span><span id="wx3060" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3064" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3068" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3072" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3074"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newTypeExpected">newTypeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$ignorable</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$typeExpected</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">type</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">type-op</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">as</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3132" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3134"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3138"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">le</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$tokens</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3159"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?qExpected">qExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$typeExpected</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$token</span><span class="step">/</span><span class="axis">@</span><span class="qname">value</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">)</span><span class="op">'</span><span class="z">"</span><span id="wx3192" class="sc">/&gt;</span></span><span class="txt"> 
        
        
        </span><span class="ww" id="w3194"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xq-handler.xsl.html#f?{com.qutoric.xq.functions}rationalizeTokens" class="solar"><span class="function">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable">$tokens</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$isNewClosed</span><span class="op">,</span><span class="whitespace">
                              </span><span class="variable">$newTypeExpected</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$qExpected</span><span class="op">,</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$result</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$result1</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3229" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3233" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3235"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3239"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><span class="variable">$isNewClosed</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm">&lt;span class="open"/&gt;</span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3258" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3260"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="variable">$result</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$result1</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3273" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3277" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3281" class="ec">&gt;</span></span><span class="txt">
    
        
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3285" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3287"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.xq.functions}processXqTokens">loc:processXqTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3303"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx3317" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3319"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3333" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3335"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3349" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3351"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?result">result</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3365" class="sc">/&gt;</span></span><span class="txt">  
    
    </span><span class="ww" id="w3367"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$tokens</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx3390" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3392"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$start</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3419" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3421"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result1">result1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">       
      </span><span class="ww" id="w3437"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3447"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$start</span><span class="z">"</span><span id="wx3461" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3463"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$end</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx3481" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3483"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="z">"</span><span id="wx3497" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3499"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isSimpleOps">isSimpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><a href="xq-handler.xsl.html#v?simpleOps" class="solar"><span class="variable">$simpleOps</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3523" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3525"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3535"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="parenthesis">(</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">/</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">//</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">step</span><span class="op">'</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="z">"</span><span id="wx3576" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3580" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3582"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isDoubleToken">isDoubleToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3598"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3602"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3612"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3622" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3626" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3628"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3632"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?splitToken">splitToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">[\s\p{Zs}]+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3660" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3662"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tk1">tk1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$splitToken</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx3679" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3681"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tk2">tk2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$splitToken</span><span class="filter">[</span><span class="numeric">2</span><span class="filter">]</span><span class="z">"</span><span id="wx3698" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3700"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tkCount">tkCount</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$splitToken</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3723" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3725"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$tkCount</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="numeric">2</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$tk1</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">instance</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$tk2</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">of</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> 
                          </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$tk1</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">cast</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">castable</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">treat</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$tk2</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">as</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                          </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3823" class="sc">/&gt;</span></span><span class="txt">
              
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3827" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3831" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3835" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3837"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$isDoubleToken</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3847"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">type-op</span><span class="op">'</span><span class="z">"</span><span id="wx3863" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3867" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3869"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?functionType">functionType</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3885"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3889"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$isSimpleOps</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$isDoubleToken</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="op">'</span><span class="literal">(</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3928"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx3934" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3938" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3940"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3944"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fnName">fnName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function">tokenize</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">[\s\p{Zs}]+|\(</span><span class="op">'</span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx3975" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3977"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w3981"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$fnName</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w3997"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">if</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4003" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4007" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w4009"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher">some</span><span class="whitespace"> </span><span class="variable">$n</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><a href="xq-handler.xsl.html#v?nodeTests" class="solar"><span class="variable">$nodeTests</span></a><span class="whitespace"> </span><span class="op">satisfies</span><span class="whitespace"> </span><span class="variable">$n</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="variable">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4033"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">node-type</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4039" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4043" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w4045"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher">some</span><span class="whitespace"> </span><span class="variable">$x</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><a href="xq-handler.xsl.html#v?typeTests" class="solar"><span class="variable">$typeTests</span></a><span class="whitespace"> </span><span class="op">satisfies</span><span class="whitespace"> </span><span class="variable">$x</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="variable">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4069"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">type</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4075" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4079" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w4081"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4085"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">function</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4091" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4095" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4099" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4103" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4107" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4111" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4113"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4117"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">Q{</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4135"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">bracedq</span><span class="op">'</span><span class="z">"</span><span id="wx4151" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4155" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4157"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$isSimpleOps</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$isDoubleToken</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4173" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4175"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$functionType</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4191"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$functionType</span><span class="z">"</span><span id="wx4205" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4209" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4211"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">::</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">@</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4239"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">axis</span><span class="op">'</span><span class="z">"</span><span id="wx4255" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4259" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4261"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function">matches</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">#\s+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4279"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">pragma</span><span class="op">'</span><span class="z">"</span><span id="wx4295" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4299" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4301"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function">matches</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="op">'</span><span class="literal">[\s\p{Zs}]+</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4318"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">whitespace</span><span class="op">'</span><span class="z">"</span><span id="wx4334" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4338" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4340"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">.</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">..</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4362"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">context</span><span class="op">'</span><span class="z">"</span><span id="wx4378" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4382" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4384"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">(</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">)</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4406"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">parenthesis</span><span class="op">'</span><span class="z">"</span><span id="wx4422" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4426" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4428"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">[</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal">]</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4450"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">filter</span><span class="op">'</span><span class="z">"</span><span id="wx4466" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4470" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4472"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function">number</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function">number</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4492"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">numeric</span><span class="op">'</span><span class="z">"</span><span id="wx4508" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4512" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4514"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><a href="xq-handler.xsl.html#v?ambiguousOps" class="solar"><span class="variable">$ambiguousOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4528"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">probableOp</span><span class="op">'</span><span class="z">"</span><span id="wx4544" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4548" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4550"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><a href="xq-handler.xsl.html#v?higherOps" class="solar"><span class="variable">$higherOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4564"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><a href="xq-handler.xsl.html#f?{com.qutoric.xq.functions}nextNonWhite" class="solar"><span class="function">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable">$tokens</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">$</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w4588"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">higher</span><span class="op">'</span><span class="z">"</span><span id="wx4604" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4608" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4612" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4614"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$token</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4630"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="xq-handler.xsl.html#f?{com.qutoric.xq.functions}nextNonWhite" class="solar"><span class="function">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable">$tokens</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">(</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w4652"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">if</span><span class="op">'</span><span class="z">"</span><span id="wx4668" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4672" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4676" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4678"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><span class="variable">$token</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">$</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4696"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="z">"</span><span id="wx4712" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4716" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4720" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx4724" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4728" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4730"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4734"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">le</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$tokens</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4755"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xq-handler.xsl.html#f?{com.qutoric.xq.functions}processXqTokens" class="solar"><span class="function">loc:processXqTokens</span></a><span class="parenthesis">(</span><span class="variable">$tokens</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$end</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$result</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$result1</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4784" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4788" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4790"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4794"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="variable">$result</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$result1</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4807" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4811" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4815" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4819" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4821"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.xq.functions}nextNonWhite">loc:nextNonWhite</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4837"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx4851" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4853"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4867" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4869"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4873"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="z">&lt;!--</span><span class="cm"> test="$index + 2 lt count($tokens)"&gt;  </span><span class="z">--&gt;</span><span class="txt"> 
        </span><span class="ww" id="w4889"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$tokens</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="filter">]</span><span class="op">,</span><span class="op">'</span><span class="literal">[\s\p{Zs}]+</span><span class="op">'</span><span class="op">,</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
                              </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$tokens</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">2</span><span class="filter">]</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$tokens</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx4946" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4950" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4952"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4958" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4962" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4966" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4968"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.xq.functions}rawTokens">loc:rawTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4984"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?chunk">chunk</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx4998" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5000"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z">
        </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(((-)?\d+)(\.)?(\d+([eE][\+\-]?)?\d*)?)|(\?)|(Q\{{[^\{{\}}]*\}})|(only(\s)+end)|((declare|define)(\s)+(default(\s)+)?(function|variable|namespace|element)((\s)+namespace)?)|(declare(\s)+context(\s)+item(\s)+as)|(import\s+schema)|(instance[\s\p{{Zs}}]+of)|(allowing(\s)+empty(\s)+(in|at))|(for(\s)+(tumbling|sliding)(\s)+window)|(cast[\s\p{{Zs}}]+as)|(:=)|(\|\|)|((((stable(\s)+)?order)|group)[\s\p{{Zs}}]+by)|(castable[\s\p{{Zs}}]+as)|(treat[\s\p{{Zs}}]+as)|(([\$#][\s\p{{Zs}}]*)?[\i\*][\p{{L}}\p{{Nd}}\.\-_]*(:[\p{{L}}\p{{Nd}}\.\-\*_]*)?(::)?:?(#\d+)?)(\()?|(\.\.)|((-)?\d?\.\d*)|-|([&amp;lt;&amp;gt;!]=)|(&amp;gt;&amp;gt;|&amp;lt;&amp;lt;)|(//)|([\s\p{{Zs}}]+)|(\C)</span><span class="z">"</span><span class="z">
        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$chunk</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5016"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5020"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function">string</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5031" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx5035" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx5039" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5043" class="ec">&gt;</span></span><span class="txt">
  
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx5047" class="ec">&gt;</span></span><span class="txt">
</span></pre></div></body></html>