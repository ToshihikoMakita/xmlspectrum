<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>xslt-formatting-functions.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></link></head><body><div><pre class="spectrum"><span class="ww" id="w1"><span class="es">&lt;</span><a class="solar" href="index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.sketchpath.functions</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns:css</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-defs.com</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns:dt</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://qutoric.com.xmlspectrum.document-types</span><span class="z">"</span><span class="z">
</span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">loc f xs css c dt</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns:c</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://xmlspectrum.colors.org</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
</span><span class="atn">xpath-default-namespace</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
</span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">internal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> 
signature:
    f:indent(spans, char-width)

description
    
    Adds space characters for indentation to spans from XML-text processed with f:render. 
    XML contents is indented in the conventional way, multi-line attribute names and values
    are aligned vertically

parameters:
    spans:          Sequence of 'span' element nodes created by f:render
    char-width:     integer: Number of characters for each indent level
    auto-trim:      boolean: Trims any leading whitespace before indentation


 </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w75"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}indent">f:indent</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w85"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx99" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w101"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?char-width">char-width</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx115" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w117"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx131" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w133"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#t?indentSpans" class="solar"><span class="tcall">indentSpans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w143"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx169" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w171"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span id="wx191" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w193"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx213" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w215"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$char-width</span><span class="z">"</span><span id="wx235" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w237"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx257" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w259"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx279" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w281"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx303" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w305"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$auto-trim</span><span class="z">"</span><span id="wx325" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w327"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">mixed-level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx347" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w349"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">preserved</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx369" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w371"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nl-attribute</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx393" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx397" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx401" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w403"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}indent">f:indent</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w413"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx427" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w429"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?char-width">char-width</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx443" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w445"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx459" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w461"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?nest-level">nest-level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx475" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w477"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#t?indentSpans" class="solar"><span class="tcall">indentSpans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w487"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx513" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w515"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span id="wx535" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w537"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$nest-level</span><span class="z">"</span><span id="wx557" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w559"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$char-width</span><span class="z">"</span><span id="wx579" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w581"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx601" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w603"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx623" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w625"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx647" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w649"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$auto-trim</span><span class="z">"</span><span id="wx669" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w671"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">mixed-level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx691" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w693"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">preserved</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">0</span><span class="z">"</span><span id="wx713" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w715"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nl-attribute</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx737" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx741" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx745" class="ec">&gt;</span></span><span class="txt">


</span><span class="ww" id="w747"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?indentSpans">indentSpans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w757"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx777" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w779"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx793" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w795"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx809" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w811"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?margin">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx825" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w827"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?an-offset">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx841" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w843"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?av-offset">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx857" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w859"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?multi-line">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx873" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w875"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx889" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w891"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?mixed-level">mixed-level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx905" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w907"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?preserved">preserved</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx921" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w923"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?nl-attribute">nl-attribute</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx937" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w939"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx956" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w958"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="z">"</span><span id="wx975" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w977"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nextClass">nextClass</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx1007" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1009"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevClass">prevClass</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx1039" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w1041"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level2">level2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">scx</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$level</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ez</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$level</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$level</span><span class="z">"</span><span id="wx1101" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1103"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?mixed-level2">mixed-level2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$mixed-level</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">scx</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$mixed-level</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ez</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$mixed-level</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$mixed-level</span><span class="z">"</span><span id="wx1179" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w1181"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?outdent">outdent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$spans</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ez</span><span class="op">'</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1239" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w1241"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$span</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">

</span><span class="ww" id="w1254"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indentOutput">indentOutput</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}indentTextSpan" class="solar"><span class="function">f:indentTextSpan</span></a><span class="parenthesis">(</span><span class="whitespace">
</span><span class="variable">$span</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$level</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$margin</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$an-offset</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$av-offset</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$outdent</span><span class="op">,</span><span class="whitespace">
</span><span class="variable">$nextClass</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$prevClass</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$multi-line</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$auto-trim</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$mixed-level2</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$preserved</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$nl-attribute</span><span class="whitespace">
</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1309" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w1311"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$indentOutput</span><span class="step">/</span><span class="qname">span</span><span class="z">"</span><span id="wx1321" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1323"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$spans</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w1340"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#t?indentSpans" class="solar"><span class="tcall">indentSpans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w1350"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx1374" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1376"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$level2</span><span class="z">"</span><span id="wx1396" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1398"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$margin</span><span class="z">"</span><span id="wx1418" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1420"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$indentOutput</span><span class="step">/</span><span class="qname">an-offset</span><span class="z">"</span><span id="wx1442" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1444"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$indentOutput</span><span class="step">/</span><span class="qname">av-offset</span><span class="z">"</span><span id="wx1466" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1468"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$indentOutput</span><span class="step">/</span><span class="qname">multi-line</span><span class="z">"</span><span id="wx1490" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1492"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$auto-trim</span><span class="z">"</span><span id="wx1512" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1514"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">mixed-level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><span class="variable">$indentOutput</span><span class="step">/</span><span class="qname">mixed-level</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1539" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1541"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">preserved</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function">xs:integer</span><span class="parenthesis">(</span><span class="variable">$indentOutput</span><span class="step">/</span><span class="qname">preserved</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1566" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1568"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nl-attribute</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="parenthesis">(</span><span class="variable">$indentOutput</span><span class="step">/</span><span class="qname">nl-attribute</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1599" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1603" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1607" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1611" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1615" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w1617"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}clark-name">f:clark-name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w1633"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx1647" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1649"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?name">name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1663" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w1665"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function">substring-before</span></a><span class="parenthesis">(</span><span class="variable">$name</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1688" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1690"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix-length">prefix-length</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prefix</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$prefix</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">2</span><span class="z">"</span><span id="wx1730" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w1732"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?local-name">local-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$name</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$prefix-length</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1758" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1760"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prefix</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><span class="variable">$local-name</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">{</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace">
</span><span class="variable">$xmlns</span><span class="step">/</span><span class="qname">ns</span><span class="filter">[</span><span class="axis">@</span><span class="qname">prefix</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="variable">$prefix</span><span class="filter">]</span><span class="step">/</span><span class="axis">@</span><span class="qname">uri</span><span class="op">,</span><span class="whitespace">
</span><span class="op">'</span><span class="literal">}</span><span class="op">'</span><span class="op">,</span><span class="whitespace">
</span><span class="variable">$local-name</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="z">"</span><span id="wx1819" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1823" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w1825"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}gen-id">f:gen-id</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w1841"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?type-prefix">type-prefix</span><span class="z">"</span><span id="wx1849" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1851"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?clark-name">clark-name</span><span class="z">"</span><span id="wx1859" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1861"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char">char</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$type-prefix</span><span class="op">,</span><span class="numeric">1</span><span class="op">,</span><span class="numeric">1</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1882" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1884"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$char</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">?</span><span class="op">'</span><span class="op">,</span><span class="variable">$clark-name</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx1903" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1907" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> 
description
    XSLT Template
    Adds ids and hrefs to span elements for global-variables, named-templates and functions

parameters:
    xmlns:          declared prefixes/namespaces on root-element for current document
    globals:        clark-notation names for all globally declared items that may be
                    referenced.
 </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w1913"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname">span</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">markup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w1929"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1949" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1951"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1971" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w1973"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?path-length">path-length</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1993" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w1995"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ref-name">ref-name</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">2</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="context">.</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2041" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2043"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}clark-name" class="solar"><span class="function">f:clark-name</span></a><span class="parenthesis">(</span><span class="variable">$xmlns</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$ref-name</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2069" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2071"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?id">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}gen-id" class="solar"><span class="function">f:gen-id</span></a><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$clark-name</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2092" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w2094"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2098"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">fname</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tname</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">vname</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">pname</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2135"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2139"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis">@</span><span class="op">*</span><span class="z">"</span><span id="wx2148" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2150"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$id</span><span class="z">"</span><span id="wx2164" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2166"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$ref-name</span><span class="z">"</span><span id="wx2174" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx2178" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2182" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w2184"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">enxsl</span><span class="op">'</span><span class="open"></span><span class="whitespace">
</span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">stylesheet</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
 </span><span class="op">or</span><span class="whitespace">  </span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function">ends-with</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">transform</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
  </span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2231"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">solar</span><span class="z">"</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$path-length</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">index.html</span><span class="op">'</span><span class="parenthesis">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2258"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2262"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis">@</span><span class="op">*</span><span class="z">"</span><span id="wx2271" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2273"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$id</span><span class="z">"</span><span id="wx2287" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2289"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$ref-name</span><span class="z">"</span><span id="wx2297" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx2301" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">a</span><span id="wx2305" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2309" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w2311"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">href</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">tcall</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">

</span><span class="ww" id="w2347"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?global-refs">global-refs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><span class="variable">$globals</span><span class="step">/</span><span class="qname">file</span><span class="step">/</span><span class="parenthesis">(</span><span class="qname">variables</span><span class="op">|</span><span class="qname">params</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tcall</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><span class="variable">$globals</span><span class="step">/</span><span class="qname">file</span><span class="step">/</span><span class="qname">templates</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><span class="variable">$globals</span><span class="step">/</span><span class="qname">file</span><span class="step">/</span><span class="qname">functions</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2444" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2446"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?found-item">found-item</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><span class="variable">$global-refs</span><span class="step">/</span><span class="qname">item</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function">string</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="variable">$clark-name</span><span class="filter">]</span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx2483" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2485"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?item-is-param">item-is-param</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$found-item</span><span class="step">/</span><span class="axis">parent::</span><span class="qname">params</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2511" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2513"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?resolved-ref">resolved-ref</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$found-item</span><span class="step">/</span><span class="context">..</span><span class="step">/</span><span class="axis">parent::</span><span class="qname">file</span><span class="step">/</span><span class="axis">@</span><span class="qname">path</span><span class="z">"</span><span id="wx2541" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2543"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href-id">href-id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">variable</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$item-is-param</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">p</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$id</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">2</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$id</span><span class="z">"</span><span id="wx2596" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w2598"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href">href</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">href</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">.html</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">function</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function">contains</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?w3c-xpath-functions-uri" class="solar"><span class="variable">$w3c-xpath-functions-uri</span></a><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">#</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">func-</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="context">.</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$resolved-ref</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="whitespace">
    </span><span class="variable">$path-length</span><span class="op">,</span><span class="whitespace">
    </span><span class="variable">$resolved-ref</span><span class="op">,</span><span class="whitespace">
    </span><span class="op">'</span><span class="literal">.html</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">#</span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$href-id</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx2742" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2744"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2748"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$href</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2761"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable">$href</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">solar</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2779"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="xmlspectrum.xsl.html#v?css-inline" class="solar"><span class="variable">$css-inline</span></a><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2796"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">text-decoration:none</span><span class="op">'</span><span class="z">"</span><span id="wx2812" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2816" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w2818"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span id="wx2826" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">a</span><span id="wx2830" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2834" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w2836"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2840"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span id="wx2848" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2852" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2856" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2860" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w2862"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2866"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span id="wx2874" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2878" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2882" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2886" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w2888"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-xmlns">f:get-xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2904"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx2918" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2920"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p-spans">p-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2936"><span class="es">&lt;</span><span class="en">p</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2940"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2950"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
 </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2976" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w2978"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">1</span><span class="z">"</span><span id="wx2998" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3002" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">p</span><span id="wx3006" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3010" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w3012"><span class="es">&lt;</span><span class="en">xmlns</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3016"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$p-spans</span><span class="step">/</span><span class="qname">span</span><span class="filter">[</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="open"></span><span class="filter">]</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function">starts-with</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">xmlns</span><span class="op">'</span><span class="parenthesis">)</span><span class="filter">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3051"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?att-value">att-value</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3061"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#t?get-next-class" class="solar"><span class="tcall">get-next-class</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3071"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3091" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3093"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="axis">preceding-sibling::</span><span class="op">*</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3117" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3119"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">av</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3147" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3151" class="ec">&gt;</span></span><span class="txt"> 
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3155" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w3157"><span class="es">&lt;</span><span class="en">ns</span><span class="z"> </span><span class="atn">prefix</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function">substring-after</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">:</span><span class="op">'</span><span class="parenthesis">)</span><span class="op">}</span><span class="z">"</span><span class="z">
</span><span class="atn">uri</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="open"></span><span class="context">.</span><span class="step">/</span><span class="axis">following-sibling::</span><span class="op">*</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function">position</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="numeric">5</span><span class="filter">]</span><span class="filter">[</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">av</span><span class="op">'</span><span class="filter">]</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="op">}</span><span class="z">"</span><span id="wx3210" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx3214" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">xmlns</span><span id="wx3218" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3222" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w3224"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-root-spans">get-root-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3234"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3254" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3256"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3270" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3272"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx3289" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w3291"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$spans</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">scx</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3326"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx3334" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3336"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3346"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx3364" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3368" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3372" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3376" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w3378"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-next-class">get-next-class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3394"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3414" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3416"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3430" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3432"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3452" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3454"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span id="wx3471" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w3473"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3477"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="variable">$class</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3494"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx3502" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3506" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w3508"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$spans</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3529"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3539"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="z">"</span><span id="wx3557" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3561" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3565" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3569" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3573" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w3575"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}indentTextSpan">f:indentTextSpan</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w3591"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx3605" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3607"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3621" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3623"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?margin">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3637" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3639"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?an-offset">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3653" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3655"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?av-offset">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3669" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3671"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?outdent">outdent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3685" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3687"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?nextClass">nextClass</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx3701" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3703"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?prevClass">prevClass</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx3717" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3719"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?multi-line">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3733" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3735"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3749" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3751"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?mixed-level">mixed-level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3765" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3767"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?preserved">preserved</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3781" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w3783"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?nl-attribute">nl-attribute</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3797" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w3799"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="qname">class</span><span class="z">"</span><span id="wx3816" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w3818"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-preserved">all-preserved</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$nl-attribute</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><span class="parenthesis">(</span><span class="variable">$preserved</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$av-offset</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
</span><span class="parenthesis">(</span><span class="variable">$preserved</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$an-offset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$av-offset</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3866" class="sc">/&gt;</span></span><span class="txt">



</span><span class="ww" id="w3868"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-mixed">is-mixed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$mixed-level</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function">not</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?ignore-mc" class="solar"><span class="variable">$ignore-mc</span></a><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="whitespace">
    </span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">txt</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">es</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">esx</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$span</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace">
</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx3943" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w3945"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-mixed-level">new-mixed-level</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$mixed-level</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$is-mixed</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$mixed-level</span><span class="z">"</span><span class="z">
</span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3985" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w3987"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line-parts">line-parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4003"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4007"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#v?insert-newlines" class="solar"><span class="variable">$insert-newlines</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4017"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm"> check to see if newline must be inserted after text content (even if empty) </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w4025"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">z</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="open"></span><span class="whitespace"> 
</span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$level</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><a href="xmlspectrum.xsl.html#v?document-type" class="solar"><span class="variable">$document-type</span></a><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">mergexml</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$level</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4082"><span class="es">&lt;</span><span class="en">tt</span><span id="wx4084" class="sc">/&gt;</span></span><span class="txt"></span><span class="ww" id="w4086"><span class="es">&lt;</span><span class="en">nl</span><span id="wx4088" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4092" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4094"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">txt</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4111"><span class="es">&lt;</span><span class="en">tt</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4115"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx4123" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">tt</span><span id="wx4127" class="ec">&gt;</span></span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm"> must somehow avoid inserting newlines within mixed content
     but string-length($span) eq 0 will not be good test </span><span class="z">--&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm"> ez = '&lt;/' starg of a close tag: &lt;/close&gt; 
        ec = '&gt;' at end of a close tag: &lt;/close&gt;
        example &lt;open&gt;this day&lt;/open&gt; </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w4137"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm"> if next tag is open tag (es/esx) and it is preceded by text-content
     don't add a new line, eg &lt;p&gt;my name&lt;p&gt; </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w4145"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$is-mixed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4157" class="ec">&gt;</span></span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm"> add new line after text-content if:
     1. next tag is not a close tag
     2. next tag *is* a close tag and prev tag was a close tag also
      </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w4163"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ez</span><span class="op">'</span><span class="open"></span><span class="whitespace">
</span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$prevClass</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">ec</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4191"><span class="es">&lt;</span><span class="en">nl</span><span id="wx4193" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4197" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4201" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4205" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4207"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4211"><span class="es">&lt;</span><span class="en">tt</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4215"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span id="wx4223" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">tt</span><span id="wx4227" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4231" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4235" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4239" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4241"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4245"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(\r?)\n.*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4261"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4265"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?r-length">r-length</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-regex-group" class="solar"><span class="function">regex-group</span></a><span class="parenthesis">(</span><span class="numeric">1</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4291" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w4293"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">2</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$r-length</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx4323" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w4325"><span class="es">&lt;</span><span class="en">nl</span><span class="scx">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> Only trim minimum necessary from attribute values </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w4333"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$text</span><span class="z">"</span><span id="wx4341" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">nl</span><span id="wx4345" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx4349" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4351"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4355"><span class="es">&lt;</span><span class="en">tt</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4359"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span id="wx4367" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">tt</span><span id="wx4371" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx4375" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx4379" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4383" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4387" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4391" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w4393"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?firstLine">firstLine</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$line-parts</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx4416" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w4418"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nl-elements">nl-elements</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$line-parts</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function">name</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">nl</span><span class="op">'</span><span class="filter">]</span><span class="z">"</span><span id="wx4451" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w4453"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indented-lines">indented-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4469"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$nl-elements</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$auto-trim</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">whitespace</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">av</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
        </span><a href="xslt-formatting-functions.xsl.html#f?{internal}autotrim" class="solar"><span class="function">f:autotrim</span></a><span class="parenthesis">(</span><span class="variable">$nl-elements</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$all-preserved</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">txt</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">cd</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">ne</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">op</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
        </span><a href="xslt-formatting-functions.xsl.html#f?{internal}autotrim-txt" class="solar"><span class="function">f:autotrim-txt</span></a><span class="parenthesis">(</span><span class="variable">$nl-elements</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">cm</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">pi</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
        </span><a href="xslt-formatting-functions.xsl.html#f?{internal}autotrim-comment" class="solar"><span class="function">f:autotrim-comment</span></a><span class="parenthesis">(</span><span class="variable">$nl-elements</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace">
        </span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$trim</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="variable">$nl-elements</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace"> </span><a href="xslt-formatting-functions.xsl.html#f?{internal}left-trim" class="solar"><span class="function">f:left-trim</span></a><span class="parenthesis">(</span><span class="variable">$trim</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
    </span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$a</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="variable">$nl-elements</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function">string</span></a><span class="parenthesis">(</span><span class="variable">$a</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx4635" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4639" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w4641"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?trim-width">trim-width</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer?</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$nl-elements</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$auto-trim</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$nl-elements</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$indented-lines</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
    </span><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="z">"</span><span id="wx4695" class="sc">/&gt;</span></span><span class="txt">


</span><span class="ww" id="w4697"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?flat-part">flat-part</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="variable">$line-parts</span><span class="filter">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function">name</span></a><span class="parenthesis">(</span><span class="context">.</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">tt</span><span class="op">'</span><span class="filter">]</span><span class="z">"</span><span id="wx4730" class="sc">/&gt;</span></span><span class="txt">


</span><span class="z">&lt;!--</span><span class="cm"> should be max of 1 </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w4736"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?flat-line">flat-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$flat-part</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$flat-part</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="z">"</span><span id="wx4771" class="sc">/&gt;</span></span><span class="txt">



</span><span class="z">&lt;!--</span><span class="cm"> constant indent when first attribute is on a new line </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w4777"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?compact">compact</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric">4</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4797" class="sc">/&gt;</span></span><span class="txt">


</span><span class="ww" id="w4799"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?lineOffset">lineOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$firstLine</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$firstLine</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span id="wx4837" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w4839"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?an-outOffset">an-outOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">en</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">enxsl</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$lineOffset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prevClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">en</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">enxsl</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace">
</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$indented-lines</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> 
    </span><span class="variable">$compact</span><span class="whitespace">
    </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$an-offset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$lineOffset</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$an-offset</span><span class="z">"</span><span id="wx4934" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w4936"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?av-outOffset">av-outOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prevClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">en</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">enxsl</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><span class="numeric">0</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$multi-line</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$lineOffset</span><span class="whitespace"> 
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prevClass</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">atneq</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">or</span><span class="whitespace"> </span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">atneq</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">vname</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">av</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">pname</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">z</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">atneq</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">vname</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">av</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">pname</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">z</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$prevClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">vname</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">av</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">pname</span><span class="op">'</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$av-offset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$lineOffset</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$av-offset</span><span class="z">"</span><span id="wx5143" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w5145"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?offset">offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$prevClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">en</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">enxsl</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$compact</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="whitespace"> 
    </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$an-outOffset</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">whitespace</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">comment</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$an-outOffset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$av-outOffset</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">av</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$an-offset</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$av-offset</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span id="wx5264" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w5266"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent">indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}createIndent" class="solar"><span class="function">f:createIndent</span></a><span class="parenthesis">(</span><span class="parenthesis">(</span><span class="variable">$level</span><span class="whitespace"> </span><span class="op">*</span><span class="whitespace"> </span><span class="variable">$margin</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$offset</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5293" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w5295"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?last-level">last-level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$outdent</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$level</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5331" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w5333"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?last-indent">last-indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}createIndent" class="solar"><span class="function">f:createIndent</span></a><span class="parenthesis">(</span><span class="parenthesis">(</span><span class="variable">$last-level</span><span class="whitespace"> </span><span class="op">*</span><span class="whitespace"> </span><span class="variable">$margin</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="variable">$offset</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5360" class="sc">/&gt;</span></span><span class="txt">


</span><span class="ww" id="w5362"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line-count">line-count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$indented-lines</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5385" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w5387"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-preserved">new-preserved</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$trim-width</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="op">and</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="whitespace">
        </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">txt</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">es</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">esx</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
        </span><span class="op">or</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">z</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
    </span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><span class="variable">$trim-width</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$preserved</span><span class="z">"</span><span id="wx5482" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w5484"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-nl-attribute">new-nl-attribute</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">txt</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">=</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="op">'</span><span class="literal">es</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal">esx</span><span class="op">'</span><span class="open"></span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function">false</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$class</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">z</span><span class="op">'</span><span class="open"></span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$nextClass</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">atn</span><span class="op">'</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$line-count</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function">true</span></a><span class="parenthesis">(</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
</span><span class="variable">$nl-attribute</span><span class="z">"</span><span id="wx5583" class="sc">/&gt;</span></span><span class="txt">


</span><span class="ww" id="w5585"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-text">span-text</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$indented-lines</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">then</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="whitespace">
</span><span class="parenthesis">(</span><span class="variable">$flat-line</span><span class="op">,</span><span class="whitespace">
</span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$num</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><span class="variable">$line-count</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">return</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">&amp;#10;</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$indent</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$indented-lines</span><span class="filter">[</span><span class="variable">$num</span><span class="filter">]</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">&amp;#10;</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$last-indent</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$indented-lines</span><span class="filter">[</span><span class="variable">$line-count</span><span class="filter">]</span><span class="parenthesis">)</span><span class="whitespace"> 
</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace">
</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$multi-line</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$offset</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="variable">$indent</span><span class="op">,</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function">string</span></a><span class="parenthesis">(</span><span class="variable">$line-parts</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="parenthesis">)</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function">string</span></a><span class="parenthesis">(</span><span class="variable">$line-parts</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5725" class="sc">/&gt;</span></span><span class="txt">


</span><span class="z">&lt;!--</span><span class="cm">
&lt;xsl:variable name="span-text" select="if (exists($indented-lines)) then
concat($span-text-1, ' ', $an-outOffset, ' ', $av-outOffset)
else $span-text-1"/&gt;

</span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w5731"><span class="es">&lt;</span><span class="en">output</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5735"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5739"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span</span><span class="step">/</span><span class="axis">@</span><span class="op">*</span><span class="z">"</span><span id="wx5750" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w5752"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$span-text</span><span class="z">"</span><span id="wx5760" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx5764" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w5766"><span class="es">&lt;</span><span class="en">an-offset</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5770"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$an-outOffset</span><span class="z">"</span><span id="wx5778" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">an-offset</span><span id="wx5782" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w5784"><span class="es">&lt;</span><span class="en">av-offset</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5788"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$av-outOffset</span><span class="z">"</span><span id="wx5796" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">av-offset</span><span id="wx5800" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w5802"><span class="es">&lt;</span><span class="en">multi-line</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5806"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function">exists</span></a><span class="parenthesis">(</span><span class="variable">$indented-lines</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx5817" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">multi-line</span><span id="wx5821" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w5823"><span class="es">&lt;</span><span class="en">mixed-level</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5827"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$new-mixed-level</span><span class="z">"</span><span id="wx5835" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">mixed-level</span><span id="wx5839" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w5841"><span class="es">&lt;</span><span class="en">preserved</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5845"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$new-preserved</span><span class="z">"</span><span id="wx5853" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">preserved</span><span id="wx5857" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w5859"><span class="es">&lt;</span><span class="en">nl-attribute</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5863"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$new-nl-attribute</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><span class="op">'</span><span class="literal">yes</span><span class="op">'</span><span class="open"></span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
    </span><span class="op">'</span><span class="literal">no</span><span class="op">'</span><span class="z">"</span><span id="wx5889" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">nl-attribute</span><span id="wx5893" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="cl">output</span><span id="wx5897" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5901" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> add nbsp for wordpress etc </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w5907"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}add-nbsp">f:add-nbsp</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5917"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx5931" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w5933"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5943"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5947"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis">@</span><span class="op">*</span><span class="z">"</span><span id="wx5956" class="sc">/&gt;</span></span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm">
&lt;xsl:variable name="f-nl" select="replace(.,'\n', '&amp;#160;&amp;#10;')"/&gt;
&lt;xsl:value-of select="replace($f-nl, ' ', '&amp;#160;')"/&gt;
</span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w5962"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\s</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5978"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5982"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w5986"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><span class="context">.</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;#10;</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6003"><span class="es">&lt;</span><span class="en">br</span><span id="wx6005" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6009" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w6011"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6015"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal">&amp;#160;</span><span class="op">'</span><span class="z">"</span><span id="wx6025" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6029" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6033" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx6037" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w6039"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6043"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context">.</span><span class="z">"</span><span id="wx6051" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx6055" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx6059" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx6063" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx6067" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6071" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> add nbsp for wordpress etc </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w6077"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}space-fix">f:space-fix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6093"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?text">text</span><span class="z">"</span><span id="wx6101" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6103"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?f-nl">f-nl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="op">,</span><span class="op">'</span><span class="literal">\n</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;#160;&amp;#10;</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6131" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6133"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$f-nl</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">&amp;#160;</span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6156" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6160" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6162"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}autotrim">f:autotrim</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6172"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?newline-elements">newline-elements</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx6186" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6188"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6202" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6204"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?preserve-size">preserve-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6218" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6220"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$newline-elements</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx6243" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6245"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?trimmed-text">trimmed-text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}left-trim" class="solar"><span class="function">f:left-trim</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6268" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6270"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?trim-size">trim-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$trimmed-text</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx6308" class="sc">/&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm">
&lt;xsl:sequence select="concat('[', $preserve-size, ' ', $trim-size, ']')"/&gt;
</span><span class="z">--&gt;</span><span class="txt">
</span><span class="ww" id="w6314"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$trim-size</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
    </span><span class="variable">$trimmed-text</span><span class="whitespace">
</span><span class="z">"</span><span id="wx6349" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6351"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$newline-elements</span><span class="parenthesis">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6368"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}autotrim" class="solar"><span class="function">f:autotrim</span></a><span class="parenthesis">(</span><span class="variable">$newline-elements</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6389" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6393" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6397" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6399"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}autotrim-txt">f:autotrim-txt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6409"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?newline-elements">newline-elements</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx6423" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6425"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6439" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6441"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?preserve-size">preserve-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6455" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6457"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$newline-elements</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx6480" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6482"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?trimmed-text">trimmed-text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}left-trim" class="solar"><span class="function">f:left-trim</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6505" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6507"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?trim-size">trim-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$trimmed-text</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx6545" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w6547"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result">result</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$trim-size</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
</span><span class="variable">$trimmed-text</span><span class="whitespace">
</span><span class="z">"</span><span id="wx6596" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6598"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?count">count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$newline-elements</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6621" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6623"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-trim-size">new-trim-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$trim-size</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6659" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6661"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6665"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="variable">$count</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6679"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}right-trim" class="solar"><span class="function">f:right-trim</span></a><span class="parenthesis">(</span><span class="variable">$result</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6690" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6694" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w6696"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">lt</span><span class="whitespace"> </span><span class="variable">$count</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6710"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$result</span><span class="z">"</span><span id="wx6718" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6720"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}autotrim-txt" class="solar"><span class="function">f:autotrim-txt</span></a><span class="parenthesis">(</span><span class="variable">$newline-elements</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$new-trim-size</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6741" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6745" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6749" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6753" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6755"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}autotrim-comment">f:autotrim-comment</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6765"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?newline-elements">newline-elements</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx6779" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6781"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6795" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6797"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?preserve-size">preserve-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6811" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6813"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$newline-elements</span><span class="filter">[</span><span class="variable">$index</span><span class="filter">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx6836" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6838"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?trimmed-text">trimmed-text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}left-trim" class="solar"><span class="function">f:left-trim</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6861" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6863"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?trim-size">trim-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">-</span><span class="whitespace"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function">string-length</span></a><span class="parenthesis">(</span><span class="variable">$trimmed-text</span><span class="parenthesis">)</span><span class="op">,</span><span class="whitespace"> </span><span class="numeric">0</span><span class="parenthesis">)</span><span class="filter">[</span><span class="numeric">1</span><span class="filter">]</span><span class="z">"</span><span id="wx6901" class="sc">/&gt;</span></span><span class="txt">

</span><span class="ww" id="w6903"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result-a">result-a</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$trim-size</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="whitespace"> </span><span class="op">and</span><span class="whitespace"> </span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">gt</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace">
</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function">substring</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace">
</span><span class="op">else</span><span class="whitespace">
</span><span class="variable">$trimmed-text</span><span class="whitespace">
</span><span class="z">"</span><span id="wx6952" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6954"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result">result</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal">     </span><span class="op">'</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$result-a</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx6977" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w6979"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?count">count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function">count</span></a><span class="parenthesis">(</span><span class="variable">$newline-elements</span><span class="parenthesis">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7002" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w7004"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-trim-size">new-trim-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if">if</span><span class="whitespace"> </span><span class="parenthesis">(</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="numeric">1</span><span class="parenthesis">)</span><span class="whitespace"> </span><span class="op">then</span><span class="whitespace"> </span><span class="variable">$trim-size</span><span class="whitespace"> </span><span class="op">else</span><span class="whitespace"> </span><span class="variable">$preserve-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7040" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w7042"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">

</span><span class="ww" id="w7046"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">eq</span><span class="whitespace"> </span><span class="variable">$count</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w7060"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}right-trim" class="solar"><span class="function">f:right-trim</span></a><span class="parenthesis">(</span><span class="variable">$result</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7071" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7075" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w7077"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">le</span><span class="whitespace"> </span><span class="variable">$count</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w7091"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$result</span><span class="z">"</span><span id="wx7099" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w7101"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt-formatting-functions.xsl.html#f?{internal}autotrim-comment" class="solar"><span class="function">f:autotrim-comment</span></a><span class="parenthesis">(</span><span class="variable">$newline-elements</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$index</span><span class="whitespace"> </span><span class="op">+</span><span class="whitespace"> </span><span class="numeric">1</span><span class="op">,</span><span class="whitespace"> </span><span class="variable">$new-trim-size</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7122" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7126" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7130" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7134" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w7136"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}left-trim">f:left-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w7152"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?text">text</span><span class="z">"</span><span id="wx7160" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w7162"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">^\s+</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7185" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7189" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w7191"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}right-trim">f:right-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w7207"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?text">text</span><span class="z">"</span><span id="wx7215" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w7217"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function">replace</span></a><span class="parenthesis">(</span><span class="variable">$text</span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal">\s+$</span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7240" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7244" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w7246"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}createIndent">f:createIndent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w7262"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="pname" id="p?padCount">padCount</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7276" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ww" id="w7278"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable">$padCount</span><span class="whitespace"> </span><span class="op">ge</span><span class="whitespace"> </span><span class="numeric">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w7292"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="open"></span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function">string-join</span></a><span class="parenthesis">(</span><span class="higher">for</span><span class="whitespace"> </span><span class="variable">$i</span><span class="whitespace"> </span><span class="op">in</span><span class="whitespace"> </span><span class="numeric">1</span><span class="whitespace"> </span><span class="op">to</span><span class="whitespace"> </span><span class="variable">$padCount</span><span class="whitespace"> 
</span><span class="op">return</span><span class="whitespace"> </span><span class="op">'</span><span class="literal"> </span><span class="op">'</span><span class="open"></span><span class="op">,</span><span class="op">'</span><span class="literal"></span><span class="op">'</span><span class="parenthesis">)</span><span class="z">"</span><span id="wx7325" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7329" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7333" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx7337" class="ec">&gt;</span></span><span class="txt">
</span></pre></div></body></html>