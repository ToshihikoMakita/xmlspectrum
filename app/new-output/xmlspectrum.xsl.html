<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>xmlspectrum.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></head><body><div><p class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm">
XMLSpectrum by Phil Fearon Qutoric Limited 2012 (c)
http://qutoric.com
License: Apache 2.0 http://www.apache.org/licenses/LICENSE-2.0.html

Purpose: Syntax highlighter for XPath (text), XML, XSLT and XSD 1.1 file formats

Interface Functions:
====================
f:render(xml-content, is-xml, root-prefix)
loc:showXPath(text-content)
f:get-css(is-light-theme)
f:indent(spans, char-width)
f:link(spans, paths, location)

Interface Templates:
====================
&lt;xsl:template match="span" mode="markup"&gt;

Global Variables (for overriding)
=================================
w3c-xpath-functions-uri: location of resource proxy
font-name:               abbreviated font name [std|scp] default
                         is std for standard monospace - override
                         with 'scp' for 'Souce Code Pro'
                         font-family

</span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w9"><span class="es">&lt;</span><a class="solar" href="index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.sketchpath.functions</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:css</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-defs.com</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">loc f xs css</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">internal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> import xsl just for self-testing </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w64"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="dummy.xsl.html" class="solar"><span class="href">dummy.xsl</span></a><span class="z">"</span><span id="wx72" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w74"><span class="es">&lt;</span><span class="enxsl">xsl:include</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="sub/dummy2.xsl.html" class="solar"><span class="href">sub/dummy2.xsl</span></a><span class="z">"</span><span id="wx82" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> override these variables </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w88"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?w3c-xpath-functions-uri">w3c-xpath-functions-uri</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">http://www.w3.org/TR/xpath-functions/</span><span class="op">'</span><span class="z">"</span><span id="wx104" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w106"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?font-name">font-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">std</span><span class="op">'</span><span class="z">"</span><span id="wx122" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> override if xml document type is not included here </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w128"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xsd-names">xsd-names</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w144"><span class="es">&lt;</span><span class="en">document-types</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w148"><span class="es">&lt;</span><span class="en">document-type</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xslt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w158"><span class="es">&lt;</span><span class="en">ns</span><span class="scx">&gt;</span><span class="txt">http://www.w3.org/1999/XSL/Transform</span><span class="ez">&lt;/</span><span class="cl">ns</span><span id="wx164" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">document-type</span><span id="wx168" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w170"><span class="es">&lt;</span><span class="en">document-type</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xsd</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w180"><span class="es">&lt;</span><span class="en">ns</span><span class="scx">&gt;</span><span class="txt">http://www.w3.org/2001/XMLSchema</span><span class="ez">&lt;/</span><span class="cl">ns</span><span id="wx186" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w188"><span class="es">&lt;</span><span class="en">xpath-names</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w192"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">assert</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w202"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">test</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx208" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx212" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w214"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">field</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w224"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">xpath</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx230" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx234" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w236"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">selector</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w246"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">xpath</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx252" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx256" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">xpath-names</span><span id="wx260" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w262"><span class="es">&lt;</span><span class="en">highlight-names</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w266"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">element</span><span class="z">"</span><span class="z"> </span><span class="atn">attribute</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span id="wx280" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w282"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="z"> </span><span class="atn">attribute</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span id="wx296" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">highlight-names</span><span id="wx300" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">document-type</span><span id="wx304" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w306"><span class="es">&lt;</span><span class="en">document-type</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">schematron</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w316"><span class="es">&lt;</span><span class="en">ns</span><span class="scx">&gt;</span><span class="txt">http://purl.oclc.org/dsdl/schematron</span><span class="ez">&lt;/</span><span class="cl">ns</span><span id="wx322" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w324"><span class="es">&lt;</span><span class="en">ns</span><span class="scx">&gt;</span><span class="txt">http://www.ascc.net/xml/schematron</span><span class="ez">&lt;/</span><span class="cl">ns</span><span id="wx330" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w332"><span class="es">&lt;</span><span class="en">xpath-names</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w336"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">assert</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w346"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">test</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx352" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx356" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w358"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">key</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w368"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">path</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx374" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx378" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w380"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">report</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w390"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">test</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx396" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx400" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w402"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">rule</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w412"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">context</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx418" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx422" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w424"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value-of</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w434"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx440" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx444" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">xpath-names</span><span id="wx448" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w450"><span class="es">&lt;</span><span class="en">highlight-names</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w454"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pattern</span><span class="z">"</span><span class="z"> </span><span class="atn">attribute</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span id="wx468" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w470"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">key</span><span class="z">"</span><span class="z"> </span><span class="atn">attribute</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span id="wx484" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">highlight-names</span><span id="wx488" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">document-type</span><span id="wx492" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w494"><span class="es">&lt;</span><span class="en">document-type</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xproc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w504"><span class="es">&lt;</span><span class="en">ns</span><span class="scx">&gt;</span><span class="txt">http://www.w3.org/ns/xproc</span><span class="ez">&lt;/</span><span class="cl">ns</span><span id="wx510" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w512"><span class="es">&lt;</span><span class="en">xpath-names</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w516"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">add-attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w526"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx532" class="ec">&gt;</span></span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm"> note: XProc spec states attribute-value has type xs:string
                       but the value may be an XPath expression so it can
                       do no harm to colorise as such </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="ww" id="w538"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">attribute-value</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx544" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx548" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w550"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">delete</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w560"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx566" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx570" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w572"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filter</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w582"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx588" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx592" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w594"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">hash</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w604"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx610" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx614" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w616"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w626"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx632" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx636" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w638"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">insert</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w648"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx654" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx658" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w660"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">iteration-source</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w670"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx676" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx680" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w682"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">label-elements</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w692"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">label</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx698" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w700"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx706" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx710" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w712"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">make-absolute-uris</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w722"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx728" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx732" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w734"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">namespaces</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w744"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">element</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx750" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx754" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w756"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">option</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w766"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx772" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx776" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w778"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">rename</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w788"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx794" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx798" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w800"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">replace</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w810"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx816" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx820" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w822"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">set-attributes</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w832"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx838" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx842" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w844"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">string-replace</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w854"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx860" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w862"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">replace</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx868" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx872" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w874"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w884"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx890" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx894" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w896"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">uuid</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w906"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx912" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx916" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w918"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">variable</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w928"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx934" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx938" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w940"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">viewport</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w950"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx956" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx960" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w962"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">when</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w972"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">test</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx978" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx982" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w984"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">with-option</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w994"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx1000" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx1004" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1006"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">with-param</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1016"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">select</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx1022" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx1026" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1028"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">wrap</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1038"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx1044" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx1048" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1050"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">www-form-urlencode</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1060"><span class="es">&lt;</span><span class="en">att</span><span class="scx">&gt;</span><span class="txt">match</span><span class="ez">&lt;/</span><span class="cl">att</span><span id="wx1066" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx1070" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">xpath-names</span><span id="wx1074" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1076"><span class="es">&lt;</span><span class="en">highlight-names</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1080"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">option</span><span class="z">"</span><span class="z"> </span><span class="atn">attribute</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span id="wx1094" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1096"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">variable</span><span class="z">"</span><span class="z"> </span><span class="atn">attribute</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span id="wx1110" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">highlight-names</span><span id="wx1114" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">document-type</span><span id="wx1118" class="ec">&gt;</span></span><span class="txt">
      
    </span><span class="ez">&lt;/</span><span class="cl">document-types</span><span id="wx1122" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1126" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1128"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}doctype-from-xmlns">f:doctype-from-xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1144"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1158" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1160"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="49" select="quick">(</span><a href="xmlspectrum.xsl.html#v?xsd-names" class="solar"><span class="variable" start="2" select="quick">$xsd-names</span></a><span class="step" start="12">/</span><span class="qname" start="13" select="quick">document-type</span><span class="filter" start="26" pair-end="38" select="quick">[</span><span class="qname" start="27" select="quick">ns</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$xmlns</span><span class="filter" start="38">]</span><span class="step" start="39">/</span><span class="axis" start="40">@</span><span class="qname" start="41" select="quick">name</span><span class="op" start="45">,</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47"></span><span class="op">'</span><span class="parenthesis" start="49">)</span><span class="filter" start="50" pair-end="52" select="quick">[</span><span class="numeric" start="51">1</span><span class="filter" start="52">]</span><span class="z">"</span><span id="wx1190" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1194" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1196"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}xsd-xpath-names">f:xsd-xpath-names</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1212"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1226" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1228"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#v?xsd-names" class="solar"><span class="variable" start="1" select="quick">$xsd-names</span></a><span class="step" start="11">/</span><span class="qname" start="12" select="quick">document-type</span><span class="filter" start="25" pair-end="43" select="quick">[</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">name</span><span class="whitespace" start="31"> </span><span class="op" start="32">eq</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$doctype</span><span class="filter" start="43">]</span><span class="step" start="44">/</span><span class="qname" start="45" select="quick">xpath-names</span><span class="step" start="56">/</span><span class="qname" start="57" select="quick">*</span><span class="z">"</span><span id="wx1250" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1254" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1256"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}xsd-highlight-names">f:xsd-highlight-names</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1272"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1286" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1288"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#v?xsd-names" class="solar"><span class="variable" start="1" select="quick">$xsd-names</span></a><span class="step" start="11">/</span><span class="qname" start="12" select="quick">document-type</span><span class="filter" start="25" pair-end="43" select="quick">[</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">name</span><span class="whitespace" start="31"> </span><span class="op" start="32">eq</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$doctype</span><span class="filter" start="43">]</span><span class="step" start="44">/</span><span class="qname" start="45" select="quick">highlight-names</span><span class="step" start="60">/</span><span class="qname" start="61" select="quick">*</span><span class="z">"</span><span id="wx1310" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1314" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="z">&lt;!--</span><span class="cm">
  signature:
      f:render(xml-content, is-xml, root-prefix)
  
  description:
      Converts the xml content string to a sequence of span elements. with each
      containing a class attribute used for coloring with CSS. 
  
  params:
      xml-content: string containing well-balanced XML extract - namespace and prefix
                   declarations not required
      is-xsl:      boolean specifying whether coloring is for XSLT, if this is false
                   then XSD 1.1 coloring scheme is used instead
      root-prefix: string prefix used for elements requiring special coloring for XSLT
                   or XSD 1.1 - often 'xsl' and 'xs' respectively
  </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w1320"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}render">f:render</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1330"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlText">xmlText</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1344" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1346"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1360" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1362"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix-a">root-prefix-a</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1376" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1378"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><span class="variable" start="5" select="quick">$root-prefix-a</span><span class="whitespace" start="19"> </span><span class="op" start="20">eq</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23"></span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> 
                          </span><span class="op" start="28">then</span><span class="whitespace" start="32"> </span><span class="op">'</span><span class="literal" start="33"></span><span class="op">'</span><span class="whitespace" start="35">
                          </span><span class="op" start="36">else</span><span class="whitespace" start="40"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="41" pair-end="67" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="48" select="quick">$root-prefix-a</span><span class="op" start="62">,</span><span class="whitespace" start="63"> </span><span class="op">'</span><span class="literal" start="64">:</span><span class="op">'</span><span class="parenthesis" start="67">)</span><span class="z">"</span><span id="wx1426" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1428"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens-a">tokens-a</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="26" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$xmlText</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">&amp;lt;</span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx1456" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1458"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1462"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">rendering </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx1468" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1470"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="36" select="quick">concat</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="8" pair-end="31" select="quick">string</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="30" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens-a</span><span class="parenthesis" start="30">)</span><span class="parenthesis" start="31">)</span><span class="op" start="32">,</span><span class="op">'</span><span class="literal" start="33"> </span><span class="op">'</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx1491" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1493"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$doctype</span><span class="z">"</span><span id="wx1501" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1503"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"> tokens ...</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx1509" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx1513" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1515"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="40" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="5" pair-end="33" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens-a</span><span class="filter" start="30" pair-end="32" select="quick">[</span><span class="numeric" start="31">1</span><span class="filter" start="32">]</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"></span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="whitespace" start="41"> </span><span class="op" start="42">then</span><span class="whitespace" start="46"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function" start="47" pair-end="71" select="quick">subsequence</span></a><span class="parenthesis">(</span><span class="variable" start="59" select="quick">$tokens-a</span><span class="op" start="68">,</span><span class="whitespace" start="69"> </span><span class="numeric" start="70">2</span><span class="parenthesis" start="71">)</span><span class="whitespace" start="72"> </span><span class="op" start="73">else</span><span class="whitespace" start="77"> </span><span class="variable" start="78" select="quick">$tokens-a</span><span class="z">"</span><span id="wx1559" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1561"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}iterateTokens" class="solar"><span class="function" start="1" pair-end="62" select="quick">f:iterateTokens</span></a><span class="parenthesis">(</span><span class="numeric" start="17">0</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$tokens</span><span class="op" start="27">,</span><span class="numeric" start="28">1</span><span class="op" start="29">,</span><span class="op">'</span><span class="literal" start="30">n</span><span class="op">'</span><span class="op" start="33">,</span><span class="numeric" start="34">0</span><span class="op" start="35">,</span><span class="whitespace" start="36"> </span><span class="numeric" start="37">0</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$doctype</span><span class="op" start="48">,</span><span class="whitespace" start="49"> </span><span class="variable" start="50" select="quick">$root-prefix</span><span class="parenthesis" start="62">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx1604" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1606"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="z">"</span><span id="wx1614" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1618" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> 
  signature:
      f:indent(spans, char-width)
  
  description
      
      Adds space characters for indentation to spans from XML-text processed with f:render. 
      XML contents is indented in the conventional way, multi-line attribute names and values
      are aligned vertically
  
  parameters:
      spans:          Sequence of 'span' element nodes created by f:render
      char-width:     integer: Number of characters for each indent level
      auto-trim:      boolean: Trims any leading whitespace before indentation
  
  
   </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w1624"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}indent">f:indent</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1634"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx1648" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1650"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char-width">char-width</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1664" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1666"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx1680" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1682"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?indentSpans" class="solar"><span class="tcall">indentSpans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1692"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1718" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1720"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx1740" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1742"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx1762" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1764"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char-width</span><span class="z">"</span><span id="wx1784" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1786"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx1806" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1808"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx1828" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1830"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx1852" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1854"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="1" select="quick">$auto-trim</span></a><span class="z">"</span><span id="wx1874" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1878" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1882" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1884"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?indentSpans">indentSpans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1894"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1914" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1916"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1930" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1932"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1946" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1948"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?margin">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1962" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1964"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?an-offset">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1978" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1980"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?av-offset">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1994" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1996"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?multi-line">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2010" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2012"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2026" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2028"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx2045" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2047"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="z">"</span><span id="wx2064" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2066"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nextClass">nextClass</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">+</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="step" start="19">/</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx2096" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2098"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevClass">prevClass</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">-</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="step" start="19">/</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx2128" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2130"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level2">level2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">scx</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$level</span><span class="whitespace" start="33"> </span><span class="op" start="34">+</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">1</span><span class="whitespace" start="37">
                                        </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><span class="if" start="43">if</span><span class="whitespace" start="45"> </span><span class="parenthesis" start="46" pair-end="61" select="quick">(</span><span class="variable" start="47" select="quick">$class</span><span class="whitespace" start="53"> </span><span class="op" start="54">eq</span><span class="whitespace" start="56"> </span><span class="op">'</span><span class="literal" start="57">ez</span><span class="op">'</span><span class="parenthesis" start="61">)</span><span class="whitespace" start="62"> </span><span class="op" start="63">then</span><span class="whitespace" start="67"> </span><span class="variable" start="68" select="quick">$level</span><span class="whitespace" start="74"> </span><span class="op" start="75">-</span><span class="whitespace" start="76"> </span><span class="numeric" start="77">1</span><span class="whitespace" start="78">
                                        </span><span class="op" start="79">else</span><span class="whitespace" start="83"> </span><span class="variable" start="84" select="quick">$level</span><span class="z">"</span><span id="wx2188" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2190"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?outdent">outdent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><span class="variable" start="5" select="quick">$index</span><span class="whitespace" start="11"> </span><span class="op" start="12">lt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$spans</span><span class="parenthesis" start="27">)</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29"> </span><span class="op" start="30">then</span><span class="whitespace" start="34">
                          </span><span class="variable" start="35" select="quick">$spans</span><span class="filter" start="41" pair-end="52" select="quick">[</span><span class="variable" start="42" select="quick">$index</span><span class="whitespace" start="48"> </span><span class="op" start="49">+</span><span class="whitespace" start="50"> </span><span class="numeric" start="51">1</span><span class="filter" start="52">]</span><span class="step" start="53">/</span><span class="axis" start="54">@</span><span class="qname" start="55" select="quick">class</span><span class="whitespace" start="60"> </span><span class="op" start="61">eq</span><span class="whitespace" start="63"> </span><span class="op">'</span><span class="literal" start="64">ez</span><span class="op">'</span><span class="whitespace" start="68">
                          </span><span class="op" start="69">else</span><span class="whitespace" start="73"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="74" pair-end="80" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="80">)</span><span class="z">"</span><span id="wx2247" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2249"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$span</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
      </span><span class="ww" id="w2262"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indentOutput">indentOutput</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}indentTextSpan" class="solar"><span class="function" start="1" pair-end="125" select="quick">f:indentTextSpan</span></a><span class="parenthesis">(</span><span class="whitespace" start="18">
                                                </span><span class="variable" start="19" select="quick">$span</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$level</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$margin</span><span class="op" start="41">,</span><span class="whitespace" start="42"> </span><span class="variable" start="43" select="quick">$an-offset</span><span class="op" start="53">,</span><span class="whitespace" start="54"> </span><span class="variable" start="55" select="quick">$av-offset</span><span class="op" start="65">,</span><span class="whitespace" start="66"> </span><span class="variable" start="67" select="quick">$outdent</span><span class="op" start="75">,</span><span class="whitespace" start="76">
                                                </span><span class="variable" start="77" select="quick">$nextClass</span><span class="op" start="87">,</span><span class="whitespace" start="88"> </span><span class="variable" start="89" select="quick">$prevClass</span><span class="op" start="99">,</span><span class="whitespace" start="100"> </span><span class="variable" start="101" select="quick">$multi-line</span><span class="op" start="112">,</span><span class="whitespace" start="113"> </span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="114" select="quick">$auto-trim</span></a><span class="whitespace" start="124">
                                                </span><span class="parenthesis" start="125">)</span><span class="z">"</span><span id="wx2308" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w2310"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">span</span><span class="z">"</span><span id="wx2320" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2322"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">lt</span><span class="whitespace" start="10"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="11" pair-end="23" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$spans</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2339"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?indentSpans" class="solar"><span class="tcall">indentSpans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2349"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx2373" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2375"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level2</span><span class="z">"</span><span id="wx2395" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2397"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$margin</span><span class="z">"</span><span id="wx2417" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2419"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">an-offset</span><span class="z">"</span><span id="wx2441" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2443"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">av-offset</span><span class="z">"</span><span id="wx2465" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2467"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">multi-line</span><span class="z">"</span><span id="wx2489" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2491"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="1" select="quick">$auto-trim</span></a><span class="z">"</span><span id="wx2511" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2515" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2519" class="ec">&gt;</span></span><span class="txt">
      
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2523" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2527" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w2529"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}clark-name">f:clark-name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2545"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx2559" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2561"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?name">name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2575" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2577"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="28" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$name</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">:</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx2599" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2601"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix-length">prefix-length</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$prefix</span><span class="whitespace" start="12"> </span><span class="op" start="13">eq</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">1</span><span class="whitespace" start="26">
                          </span><span class="op" start="27">else</span><span class="whitespace" start="31"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="32" pair-end="53" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="46" select="quick">$prefix</span><span class="parenthesis" start="53">)</span><span class="whitespace" start="54"> </span><span class="op" start="55">+</span><span class="whitespace" start="56"> </span><span class="numeric" start="57">2</span><span class="z">"</span><span id="wx2640" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2642"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?local-name">local-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="32" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$name</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$prefix-length</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2668" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2670"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$prefix</span><span class="whitespace" start="12"> </span><span class="op" start="13">eq</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24">
                </span><span class="variable" start="25" select="quick">$local-name</span><span class="whitespace" start="36">
                </span><span class="op" start="37">else</span><span class="whitespace" start="41">
                </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="42" pair-end="106" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="49">{</span><span class="op">'</span><span class="op" start="52">,</span><span class="whitespace" start="53">
                </span><span class="variable" start="54" select="quick">$xmlns</span><span class="step" start="60">/</span><span class="qname" start="61" select="quick">ns</span><span class="filter" start="63" pair-end="82" select="quick">[</span><span class="axis" start="64">@</span><span class="qname" start="65" select="quick">prefix</span><span class="whitespace" start="71"> </span><span class="op" start="72">eq</span><span class="whitespace" start="74"> </span><span class="variable" start="75" select="quick">$prefix</span><span class="filter" start="82">]</span><span class="step" start="83">/</span><span class="axis" start="84">@</span><span class="qname" start="85" select="quick">uri</span><span class="op" start="88">,</span><span class="whitespace" start="89">
                </span><span class="op">'</span><span class="literal" start="90">}</span><span class="op">'</span><span class="op" start="93">,</span><span class="whitespace" start="94">
                </span><span class="variable" start="95" select="quick">$local-name</span><span class="parenthesis" start="106">)</span><span class="whitespace" start="107">
                </span><span class="z">"</span><span id="wx2726" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx2730" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w2732"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}gen-id">f:gen-id</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2748"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?type-prefix">type-prefix</span><span class="z">"</span><span id="wx2756" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2758"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span id="wx2766" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2768"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char">char</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="27" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$type-prefix</span><span class="op" start="23">,</span><span class="numeric" start="24">1</span><span class="op" start="25">,</span><span class="numeric" start="26">1</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx2789" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2791"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="30" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$char</span><span class="op" start="13">,</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">?</span><span class="op">'</span><span class="op" start="18">,</span><span class="variable" start="19" select="quick">$clark-name</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx2809" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx2813" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> 
  description
      XSLT Template
      Adds ids and hrefs to span elements for global-variables, named-templates and functions
  
  parameters:
      xmlns:          declared prefixes/namespaces on root-element for current document
      globals:        clark-notation names for all globally declared items that may be
                      referenced.
   </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w2819"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">span</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">markup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2835"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2855" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2857"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2877" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2879"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?path-length">path-length</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2899" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2901"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ref-name">ref-name</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">variable</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="32" pair-end="46" select="quick">substring</span></a><span class="parenthesis">(</span><span class="context" start="42">.</span><span class="op" start="43">,</span><span class="whitespace" start="44"> </span><span class="numeric" start="45">2</span><span class="parenthesis" start="46">)</span><span class="whitespace" start="47">
                          </span><span class="op" start="48">else</span><span class="whitespace" start="52"> </span><span class="context" start="53">.</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2946" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2948"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}clark-name" class="solar"><span class="function" start="1" pair-end="31" select="quick">f:clark-name</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$xmlns</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$ref-name</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2974" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2976"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?id">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}gen-id" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:gen-id</span></a><span class="parenthesis">(</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">class</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$clark-name</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx2997" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2999"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3003"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">class</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="36" select="quick">(</span><span class="op">'</span><span class="literal" start="11">fname</span><span class="op">'</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">tname</span><span class="op">'</span><span class="op" start="27">,</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">vname</span><span class="op">'</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3032"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3036"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx3045" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3047"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$id</span><span class="z">"</span><span id="wx3061" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3063"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ref-name</span><span class="z">"</span><span id="wx3071" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx3075" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3079" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3081"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">class</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">enxsl</span><span class="op">'</span><span class="whitespace" start="17">
                      </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="parenthesis" start="22" pair-end="83" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="23" pair-end="48" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="context" start="33">.</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="op">'</span><span class="literal" start="36">stylesheet</span><span class="op">'</span><span class="parenthesis" start="48">)</span><span class="whitespace" start="49">
                       </span><span class="op" start="51">or</span><span class="whitespace" start="53">  </span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="55" pair-end="79" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="context" start="65">.</span><span class="op" start="66">,</span><span class="whitespace" start="67"> </span><span class="op">'</span><span class="literal" start="68">transform</span><span class="op">'</span><span class="parenthesis" start="79">)</span><span class="whitespace" start="80">
                        </span><span class="parenthesis" start="83">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3125"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">solar</span><span class="z">"</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="34" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$path-length</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">index.html</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3151"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3155"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx3164" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3166"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$id</span><span class="z">"</span><span id="wx3180" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3182"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ref-name</span><span class="z">"</span><span id="wx3190" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx3194" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">a</span><span id="wx3198" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3202" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3204"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">class</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="48" select="quick">(</span><span class="op">'</span><span class="literal" start="11">variable</span><span class="op">'</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">href</span><span class="op">'</span><span class="op" start="29">,</span><span class="op">'</span><span class="literal" start="30">tcall</span><span class="op">'</span><span class="op" start="37">,</span><span class="op">'</span><span class="literal" start="38">function</span><span class="op">'</span><span class="parenthesis" start="48">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
        </span><span class="ww" id="w3236"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?global-refs">global-refs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">variable</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31">
                                  </span><span class="variable" start="36" select="quick">$globals</span><span class="step" start="44">/</span><span class="qname" start="45" select="quick">file</span><span class="step" start="49">/</span><span class="qname" start="50" select="quick">variables</span><span class="whitespace" start="59">
                              </span><span class="op" start="60">else</span><span class="whitespace" start="64"> </span><span class="if" start="65">if</span><span class="whitespace" start="67"> </span><span class="parenthesis" start="68" pair-end="86" select="quick">(</span><span class="axis" start="69">@</span><span class="qname" start="70" select="quick">class</span><span class="whitespace" start="75"> </span><span class="op" start="76">eq</span><span class="whitespace" start="78"> </span><span class="op">'</span><span class="literal" start="79">tcall</span><span class="op">'</span><span class="parenthesis" start="86">)</span><span class="whitespace" start="87"> </span><span class="op" start="88">then</span><span class="whitespace" start="92">
                                  </span><span class="variable" start="97" select="quick">$globals</span><span class="step" start="105">/</span><span class="qname" start="106" select="quick">file</span><span class="step" start="110">/</span><span class="qname" start="111" select="quick">templates</span><span class="whitespace" start="120">
                              </span><span class="op" start="121">else</span><span class="whitespace" start="125"> </span><span class="if" start="126">if</span><span class="whitespace" start="128"> </span><span class="parenthesis" start="129" pair-end="150" select="quick">(</span><span class="axis" start="130">@</span><span class="qname" start="131" select="quick">class</span><span class="whitespace" start="136"> </span><span class="op" start="137">eq</span><span class="whitespace" start="139"> </span><span class="op">'</span><span class="literal" start="140">function</span><span class="op">'</span><span class="parenthesis" start="150">)</span><span class="whitespace" start="151"> </span><span class="op" start="152">then</span><span class="whitespace" start="156">
                                  </span><span class="variable" start="161" select="quick">$globals</span><span class="step" start="169">/</span><span class="qname" start="170" select="quick">file</span><span class="step" start="174">/</span><span class="qname" start="175" select="quick">functions</span><span class="whitespace" start="184">
                              </span><span class="op" start="185">else</span><span class="whitespace" start="189"> </span><span class="parenthesis" start="190" pair-end="191" select="quick">(</span><span class="parenthesis" start="191">)</span><span class="z">"</span><span id="wx3326" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3328"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?resolved-ref">resolved-ref</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="24" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$global-refs</span><span class="parenthesis" start="24">)</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31">
                                  </span><span class="parenthesis" start="36" pair-end="80" select="quick">(</span><span class="variable" start="37" select="quick">$global-refs</span><span class="step" start="49">/</span><span class="qname" start="50" select="quick">item</span><span class="filter" start="54" pair-end="79" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="55" pair-end="63" select="quick">string</span></a><span class="parenthesis">(</span><span class="context" start="62">.</span><span class="parenthesis" start="63">)</span><span class="whitespace" start="64"> </span><span class="op" start="65">eq</span><span class="whitespace" start="67"> </span><span class="variable" start="68" select="quick">$clark-name</span><span class="filter" start="79">]</span><span class="parenthesis" start="80">)</span><span class="filter" start="81" pair-end="83" select="quick">[</span><span class="numeric" start="82">1</span><span class="filter" start="83">]</span><span class="step" start="84">/</span><span class="context" start="85">..</span><span class="step" start="87">/</span><span class="axis" start="88">parent::</span><span class="qname" start="96" select="quick">file</span><span class="step" start="100">/</span><span class="axis" start="101">@</span><span class="qname" start="102" select="quick">path</span><span class="whitespace" start="106">
                              </span><span class="op" start="107">else</span><span class="whitespace" start="111"> </span><span class="parenthesis" start="112" pair-end="113" select="quick">(</span><span class="parenthesis" start="113">)</span><span class="z">"</span><span id="wx3389" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3391"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href">href</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">href</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27">
                                  </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="32" pair-end="49" select="quick">concat</span></a><span class="parenthesis">(</span><span class="context" start="39">.</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">.html</span><span class="op">'</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50">
                              </span><span class="op" start="51">else</span><span class="whitespace" start="55"> </span><span class="if" start="56">if</span><span class="whitespace" start="58"> </span><span class="parenthesis" start="59" pair-end="106" select="quick">(</span><span class="axis" start="60">@</span><span class="qname" start="61" select="quick">class</span><span class="whitespace" start="66"> </span><span class="op" start="67">eq</span><span class="whitespace" start="69"> </span><span class="op">'</span><span class="literal" start="70">function</span><span class="op">'</span><span class="whitespace" start="80"> </span><span class="op" start="81">and</span><span class="whitespace" start="84"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="85" pair-end="105" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="89" pair-end="104" select="quick">contains</span></a><span class="parenthesis">(</span><span class="context" start="98">.</span><span class="op" start="99">,</span><span class="whitespace" start="100"> </span><span class="op">'</span><span class="literal" start="101">:</span><span class="op">'</span><span class="parenthesis" start="104">)</span><span class="parenthesis" start="105">)</span><span class="parenthesis" start="106">)</span><span class="whitespace" start="107"> </span><span class="op" start="108">then</span><span class="whitespace" start="112">
                                  </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="117" pair-end="173" select="quick">concat</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?w3c-xpath-functions-uri" class="solar"><span class="variable" start="124" select="quick">$w3c-xpath-functions-uri</span></a><span class="op" start="148">,</span><span class="whitespace" start="149"> </span><span class="op">'</span><span class="literal" start="150">#</span><span class="op">'</span><span class="op" start="153">,</span><span class="whitespace" start="154"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="155" pair-end="172" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="162">func-</span><span class="op">'</span><span class="op" start="169">,</span><span class="whitespace" start="170"> </span><span class="context" start="171">.</span><span class="parenthesis" start="172">)</span><span class="parenthesis" start="173">)</span><span class="whitespace" start="174">
                              </span><span class="op" start="175">else</span><span class="whitespace" start="179"> </span><span class="if" start="180">if</span><span class="whitespace" start="182"> </span><span class="parenthesis" start="183" pair-end="205" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="184" pair-end="204" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="191" select="quick">$resolved-ref</span><span class="parenthesis" start="204">)</span><span class="parenthesis" start="205">)</span><span class="whitespace" start="206"> </span><span class="op" start="207">then</span><span class="whitespace" start="211">
                                  </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="216" pair-end="282" select="quick">concat</span></a><span class="parenthesis">(</span><span class="whitespace" start="223">
                                  </span><span class="variable" start="228" select="quick">$path-length</span><span class="op" start="240">,</span><span class="whitespace" start="241">
                                  </span><span class="variable" start="246" select="quick">$resolved-ref</span><span class="op" start="259">,</span><span class="whitespace" start="260">
                                  </span><span class="op">'</span><span class="literal" start="265">.html</span><span class="op">'</span><span class="op" start="272">,</span><span class="whitespace" start="273"> </span><span class="op">'</span><span class="literal" start="274">#</span><span class="op">'</span><span class="op" start="277">,</span><span class="whitespace" start="278"> </span><span class="variable" start="279" select="quick">$id</span><span class="parenthesis" start="282">)</span><span class="whitespace" start="283">
                              </span><span class="op" start="284">else</span><span class="whitespace" start="288"> </span><span class="parenthesis" start="289" pair-end="290" select="quick">(</span><span class="parenthesis" start="290">)</span><span class="z">"</span><span id="wx3527" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3529"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3533"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$href</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3546"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$href</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">solar</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3564"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3572" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">a</span><span id="wx3576" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3580" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3582"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3586"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3594" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3598" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3602" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3606" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3608"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3612"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3620" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3624" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3628" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3632" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3634"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-xmlns">f:get-xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3650"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3664" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3666"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p-spans">p-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3682"><span class="es">&lt;</span><span class="en">p</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3686"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3696"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                           </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3722" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3724"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx3744" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3748" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">p</span><span id="wx3752" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3756" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3758"><span class="es">&lt;</span><span class="en">xmlns</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3762"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$p-spans</span><span class="step" start="9">/</span><span class="qname" start="10" select="quick">span</span><span class="filter" start="14" pair-end="30" select="quick">[</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">class</span><span class="whitespace" start="21"> </span><span class="op" start="22">eq</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">atn</span><span class="op">'</span><span class="filter" start="30">]</span><span class="filter" start="31" pair-end="55" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="32" pair-end="54" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="context" start="44">.</span><span class="op" start="45">,</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47">xmlns</span><span class="op">'</span><span class="parenthesis" start="54">)</span><span class="filter" start="55">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3795"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?att-value">att-value</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3805"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-next-class" class="solar"><span class="tcall">get-next-class</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3815"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3835" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3837"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="axis" start="7">preceding-sibling::</span><span class="qname" start="26" select="quick">*</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx3861" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3863"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">av</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx3891" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3895" class="ec">&gt;</span></span><span class="txt"> 
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3899" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3901"><span class="es">&lt;</span><span class="en">ns</span><span class="z"> </span><span class="atn">prefix</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function" start="1" pair-end="23" select="quick">substring-after</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">:</span><span class="op">'</span><span class="parenthesis" start="23">)</span><span class="op">}</span><span class="z">"</span><span class="z">
            </span><span class="atn">uri</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="context" start="1">.</span><span class="step" start="2">/</span><span class="axis" start="3">following-sibling::</span><span class="qname" start="22" select="quick">*</span><span class="filter" start="23" pair-end="39" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="24" pair-end="33" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">lt</span><span class="whitespace" start="37"> </span><span class="numeric" start="38">5</span><span class="filter" start="39">]</span><span class="filter" start="40" pair-end="55" select="quick">[</span><span class="axis" start="41">@</span><span class="qname" start="42" select="quick">class</span><span class="whitespace" start="47"> </span><span class="op" start="48">eq</span><span class="whitespace" start="50"> </span><span class="op">'</span><span class="literal" start="51">av</span><span class="op">'</span><span class="filter" start="55">]</span><span class="filter" start="56" pair-end="58" select="quick">[</span><span class="numeric" start="57">1</span><span class="filter" start="58">]</span><span class="op">}</span><span class="z">"</span><span id="wx3952" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx3956" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">xmlns</span><span id="wx3960" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3964" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3966"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-root-spans">get-root-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3976"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3996" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3998"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4012" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4014"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx4031" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4033"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">lt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$spans</span><span class="parenthesis" start="27">)</span><span class="whitespace" start="28">
                  </span><span class="op" start="29">and</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$span</span><span class="step" start="38">/</span><span class="axis" start="39">@</span><span class="qname" start="40" select="quick">class</span><span class="whitespace" start="45"> </span><span class="op" start="46">ne</span><span class="whitespace" start="48"> </span><span class="op">'</span><span class="literal" start="49">scx</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4067"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span id="wx4075" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4077"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4087"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx4105" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4109" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4113" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4117" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4119"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-next-class">get-next-class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4135"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx4155" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4157"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4171" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4173"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx4193" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4195"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx4212" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4214"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4218"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="whitespace" start="13"> </span><span class="op" start="14">eq</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$class</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4235"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span id="wx4243" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4247" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4249"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">lt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$spans</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4270"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4280"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx4298" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4302" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4306" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4310" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4314" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4316"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}indentTextSpan">f:indentTextSpan</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4332"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx4346" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4348"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4362" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4364"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?margin">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4378" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4380"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?an-offset">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4394" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4396"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?av-offset">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4410" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4412"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?outdent">outdent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4426" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4428"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nextClass">nextClass</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx4442" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4444"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevClass">prevClass</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx4458" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4460"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?multi-line">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4474" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4476"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4490" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4492"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="z">"</span><span id="wx4509" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4511"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line-parts">line-parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4527"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(\r?)\n.*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4543"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4547"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?r-length">r-length</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="29" select="quick">string-length</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-regex-group" class="solar"><span class="function" start="15" pair-end="28" select="quick">regex-group</span></a><span class="parenthesis">(</span><span class="numeric" start="27">1</span><span class="parenthesis" start="28">)</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx4573" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4575"><span class="es">&lt;</span><span class="en">nl</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4579"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="27" select="quick">substring</span></a><span class="parenthesis">(</span><span class="context" start="11">.</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">2</span><span class="whitespace" start="15"> </span><span class="op" start="16">+</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$r-length</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx4609" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w4611"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="5" select="quick">$auto-trim</span></a><span class="parenthesis" start="15">)</span><span class="whitespace" start="16">
                                  </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><a href="xmlspectrum.xsl.html#f?{internal}left-trim" class="solar"><span class="function" start="22" pair-end="39" select="quick">f:left-trim</span></a><span class="parenthesis">(</span><span class="variable" start="34" select="quick">$text</span><span class="parenthesis" start="39">)</span><span class="whitespace" start="40">
                                  </span><span class="op" start="41">else</span><span class="whitespace" start="45"> </span><span class="variable" start="46" select="quick">$text</span><span class="z">"</span><span id="wx4634" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">nl</span><span id="wx4638" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx4642" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4644"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4648"><span class="es">&lt;</span><span class="en">tt</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4652"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx4660" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">tt</span><span id="wx4664" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx4668" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx4672" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4676" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4678"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?firstLine">firstLine</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$line-parts</span><span class="filter" start="12" pair-end="14" select="quick">[</span><span class="numeric" start="13">1</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx4701" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4703"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indented-lines">indented-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4719"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$a" class="variable" start="5" select="quick">$a</span><span class="whitespace" start="7"> </span><span class="op" start="8">in</span><span class="whitespace" start="10"> </span><span class="variable" start="11" select="quick">$line-parts</span><span class="filter" start="22" pair-end="38" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="23" pair-end="29" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="28">.</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">eq</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">nl</span><span class="op">'</span><span class="filter" start="38">]</span><span class="whitespace" start="39"> </span><span class="op" start="40">return</span><span class="whitespace" start="46">
                            </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="47" pair-end="56" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="54" select="quick">$a</span><span class="parenthesis" start="56">)</span><span class="z">"</span><span id="wx4752" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4756" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4758"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?flat-part">flat-part</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$line-parts</span><span class="filter" start="12" pair-end="28" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="13" pair-end="19" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="18">.</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">eq</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">tt</span><span class="op">'</span><span class="filter" start="28">]</span><span class="z">"</span><span id="wx4790" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="z">&lt;!--</span><span class="cm"> should be max of 1 </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w4796"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?flat-line">flat-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><span class="variable" start="5" select="quick">$flat-part</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$flat-part</span><span class="whitespace" start="32"> </span><span class="op" start="33">else</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"></span><span class="op">'</span><span class="z">"</span><span id="wx4830" class="sc">/&gt;</span></span><span class="txt">
    
    
    
    </span><span class="z">&lt;!--</span><span class="cm"> constant indent when first attribute is on a new line </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w4836"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?compact">compact</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">4</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4856" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w4858"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?lineOffset">lineOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="23" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="22" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$firstLine</span><span class="parenthesis" start="22">)</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24">
                              </span><span class="op" start="29">then</span><span class="whitespace" start="33"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="34" pair-end="58" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="48" select="quick">$firstLine</span><span class="parenthesis" start="58">)</span><span class="whitespace" start="59">
                          </span><span class="op" start="60">else</span><span class="whitespace" start="64"> </span><span class="numeric" start="65">0</span><span class="z">"</span><span id="wx4896" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4898"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?an-outOffset">an-outOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><span class="variable" start="5" select="quick">$class</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="27" select="quick">(</span><span class="op">'</span><span class="literal" start="15">en</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">enxsl</span><span class="op">'</span><span class="parenthesis" start="27">)</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                              </span><span class="op" start="34">then</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$lineOffset</span><span class="whitespace" start="50"> </span><span class="op" start="51">+</span><span class="whitespace" start="52"> </span><span class="numeric" start="53">1</span><span class="whitespace" start="54">
                          </span><span class="op" start="55">else</span><span class="whitespace" start="59"> </span><span class="if" start="60">if</span><span class="whitespace" start="62"> </span><span class="parenthesis" start="63" pair-end="91" select="quick">(</span><span class="variable" start="64" select="quick">$prevClass</span><span class="whitespace" start="74"> </span><span class="op" start="75">=</span><span class="whitespace" start="76"> </span><span class="parenthesis" start="77" pair-end="90" select="quick">(</span><span class="op">'</span><span class="literal" start="78">en</span><span class="op">'</span><span class="op" start="82">,</span><span class="op">'</span><span class="literal" start="83">enxsl</span><span class="op">'</span><span class="parenthesis" start="90">)</span><span class="parenthesis" start="91">)</span><span class="whitespace" start="92">
                              </span><span class="op" start="97">then</span><span class="whitespace" start="101">
                          </span><span class="if" start="102">if</span><span class="whitespace" start="104"> </span><span class="parenthesis" start="105" pair-end="129" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="106" pair-end="128" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="113" select="quick">$indented-lines</span><span class="parenthesis" start="128">)</span><span class="parenthesis" start="129">)</span><span class="whitespace" start="130"> </span><span class="op" start="131">then</span><span class="whitespace" start="135"> 
                              </span><span class="variable" start="141" select="quick">$compact</span><span class="whitespace" start="149">
                              </span><span class="op" start="154">else</span><span class="whitespace" start="158"> </span><span class="variable" start="159" select="quick">$an-offset</span><span class="whitespace" start="169"> </span><span class="op" start="170">+</span><span class="whitespace" start="171"> </span><span class="variable" start="172" select="quick">$lineOffset</span><span class="whitespace" start="183">
                          </span><span class="op" start="184">else</span><span class="whitespace" start="188"> </span><span class="variable" start="189" select="quick">$an-offset</span><span class="z">"</span><span id="wx4989" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4991"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?av-outOffset">av-outOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="32" select="quick">(</span><span class="variable" start="5" select="quick">$prevClass</span><span class="whitespace" start="15"> </span><span class="op" start="16">=</span><span class="whitespace" start="17"> </span><span class="parenthesis" start="18" pair-end="31" select="quick">(</span><span class="op">'</span><span class="literal" start="19">en</span><span class="op">'</span><span class="op" start="23">,</span><span class="op">'</span><span class="literal" start="24">enxsl</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="parenthesis" start="32">)</span><span class="whitespace" start="33">
                              </span><span class="op" start="38">then</span><span class="whitespace" start="42"> </span><span class="numeric" start="43">0</span><span class="whitespace" start="44">
                          </span><span class="op" start="45">else</span><span class="whitespace" start="49"> </span><span class="if" start="50">if</span><span class="whitespace" start="52"> </span><span class="parenthesis" start="53" pair-end="85" select="quick">(</span><span class="variable" start="54" select="quick">$class</span><span class="whitespace" start="60"> </span><span class="op" start="61">eq</span><span class="whitespace" start="63"> </span><span class="op">'</span><span class="literal" start="64">atn</span><span class="op">'</span><span class="whitespace" start="69"> </span><span class="op" start="70">and</span><span class="whitespace" start="73"> </span><span class="variable" start="74" select="quick">$multi-line</span><span class="parenthesis" start="85">)</span><span class="whitespace" start="86">
                              </span><span class="op" start="91">then</span><span class="whitespace" start="95"> </span><span class="variable" start="96" select="quick">$lineOffset</span><span class="whitespace" start="107"> 
                          </span><span class="op" start="109">else</span><span class="whitespace" start="113"> </span><span class="if" start="114">if</span><span class="whitespace" start="116"> </span><span class="parenthesis" start="117" pair-end="300" select="quick">(</span><span class="variable" start="118" select="quick">$prevClass</span><span class="whitespace" start="128"> </span><span class="op" start="129">eq</span><span class="whitespace" start="131"> </span><span class="op">'</span><span class="literal" start="132">atneq</span><span class="op">'</span><span class="whitespace" start="139"> </span><span class="op" start="140">or</span><span class="whitespace" start="142"> </span><span class="variable" start="143" select="quick">$class</span><span class="whitespace" start="149"> </span><span class="op" start="150">=</span><span class="whitespace" start="151"> </span><span class="parenthesis" start="152" pair-end="179" select="quick">(</span><span class="op">'</span><span class="literal" start="153">atneq</span><span class="op">'</span><span class="op" start="160">,</span><span class="op">'</span><span class="literal" start="161">atn</span><span class="op">'</span><span class="op" start="166">,</span><span class="op">'</span><span class="literal" start="167">vname</span><span class="op">'</span><span class="op" start="174">,</span><span class="op">'</span><span class="literal" start="175">av</span><span class="op">'</span><span class="parenthesis" start="179">)</span><span class="whitespace" start="180">
                              </span><span class="op" start="185">or</span><span class="whitespace" start="187"> </span><span class="parenthesis" start="188" pair-end="248" select="quick">(</span><span class="variable" start="189" select="quick">$class</span><span class="whitespace" start="195"> </span><span class="op" start="196">eq</span><span class="whitespace" start="198"> </span><span class="op">'</span><span class="literal" start="199">z</span><span class="op">'</span><span class="whitespace" start="202"> </span><span class="op" start="203">and</span><span class="whitespace" start="206"> </span><span class="variable" start="207" select="quick">$nextClass</span><span class="whitespace" start="217"> </span><span class="op" start="218">=</span><span class="whitespace" start="219"> </span><span class="parenthesis" start="220" pair-end="247" select="quick">(</span><span class="op">'</span><span class="literal" start="221">atneq</span><span class="op">'</span><span class="op" start="228">,</span><span class="op">'</span><span class="literal" start="229">atn</span><span class="op">'</span><span class="op" start="234">,</span><span class="op">'</span><span class="literal" start="235">vname</span><span class="op">'</span><span class="op" start="242">,</span><span class="op">'</span><span class="literal" start="243">av</span><span class="op">'</span><span class="parenthesis" start="247">)</span><span class="parenthesis" start="248">)</span><span class="whitespace" start="249">
                          </span><span class="op" start="250">or</span><span class="whitespace" start="252"> </span><span class="parenthesis" start="253" pair-end="299" select="quick">(</span><span class="variable" start="254" select="quick">$class</span><span class="whitespace" start="260"> </span><span class="op" start="261">eq</span><span class="whitespace" start="263"> </span><span class="op">'</span><span class="literal" start="264">z</span><span class="op">'</span><span class="whitespace" start="267"> </span><span class="op" start="268">and</span><span class="whitespace" start="271"> </span><span class="variable" start="272" select="quick">$prevClass</span><span class="whitespace" start="282"> </span><span class="op" start="283">=</span><span class="whitespace" start="284"> </span><span class="parenthesis" start="285" pair-end="298" select="quick">(</span><span class="op">'</span><span class="literal" start="286">vname</span><span class="op">'</span><span class="op" start="293">,</span><span class="op">'</span><span class="literal" start="294">av</span><span class="op">'</span><span class="parenthesis" start="298">)</span><span class="parenthesis" start="299">)</span><span class="parenthesis" start="300">)</span><span class="whitespace" start="301">
                              </span><span class="op" start="306">then</span><span class="whitespace" start="310"> </span><span class="variable" start="311" select="quick">$av-offset</span><span class="whitespace" start="321"> </span><span class="op" start="322">+</span><span class="whitespace" start="323"> </span><span class="variable" start="324" select="quick">$lineOffset</span><span class="whitespace" start="335">
                          </span><span class="op" start="336">else</span><span class="whitespace" start="340"> </span><span class="variable" start="341" select="quick">$av-offset</span><span class="z">"</span><span id="wx5167" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5169"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?offset">offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="32" select="quick">(</span><span class="variable" start="5" select="quick">$prevClass</span><span class="whitespace" start="15"> </span><span class="op" start="16">=</span><span class="whitespace" start="17"> </span><span class="parenthesis" start="18" pair-end="31" select="quick">(</span><span class="op">'</span><span class="literal" start="19">en</span><span class="op">'</span><span class="op" start="23">,</span><span class="op">'</span><span class="literal" start="24">enxsl</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="parenthesis" start="32">)</span><span class="whitespace" start="33">
                              </span><span class="op" start="38">then</span><span class="whitespace" start="42"> </span><span class="variable" start="43" select="quick">$compact</span><span class="whitespace" start="51">
                          </span><span class="op" start="52">else</span><span class="whitespace" start="56"> </span><span class="if" start="57">if</span><span class="whitespace" start="59"> </span><span class="parenthesis" start="60" pair-end="80" select="quick">(</span><span class="variable" start="61" select="quick">$nextClass</span><span class="whitespace" start="71"> </span><span class="op" start="72">eq</span><span class="whitespace" start="74"> </span><span class="op">'</span><span class="literal" start="75">atn</span><span class="op">'</span><span class="parenthesis" start="80">)</span><span class="whitespace" start="81"> 
                              </span><span class="op" start="87">then</span><span class="whitespace" start="91"> </span><span class="variable" start="92" select="quick">$an-outOffset</span><span class="whitespace" start="105">
                          </span><span class="op" start="106">else</span><span class="whitespace" start="110"> </span><span class="if" start="111">if</span><span class="whitespace" start="113"> </span><span class="parenthesis" start="114" pair-end="158" select="quick">(</span><span class="variable" start="115" select="quick">$nextClass</span><span class="whitespace" start="125"> </span><span class="op" start="126">=</span><span class="whitespace" start="127"> </span><span class="op">'</span><span class="literal" start="128">av</span><span class="op">'</span><span class="whitespace" start="132"> </span><span class="op" start="133">or</span><span class="whitespace" start="135"> </span><span class="variable" start="136" select="quick">$class</span><span class="whitespace" start="142"> </span><span class="op" start="143">eq</span><span class="whitespace" start="145"> </span><span class="op">'</span><span class="literal" start="146">whitespace</span><span class="op">'</span><span class="parenthesis" start="158">)</span><span class="whitespace" start="159">
                              </span><span class="op" start="164">then</span><span class="whitespace" start="168"> </span><span class="variable" start="169" select="quick">$an-outOffset</span><span class="whitespace" start="182"> </span><span class="op" start="183">+</span><span class="whitespace" start="184"> </span><span class="variable" start="185" select="quick">$av-outOffset</span><span class="whitespace" start="198">
                          </span><span class="op" start="199">else</span><span class="whitespace" start="203"> </span><span class="numeric" start="204">0</span><span class="z">"</span><span id="wx5263" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5265"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent">indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}createIndent" class="solar"><span class="function" start="1" pair-end="44" select="quick">f:createIndent</span></a><span class="parenthesis">(</span><span class="parenthesis" start="16" pair-end="33" select="quick">(</span><span class="variable" start="17" select="quick">$level</span><span class="whitespace" start="23"> </span><span class="op" start="24">*</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$margin</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">+</span><span class="whitespace" start="36"> </span><span class="variable" start="37" select="quick">$offset</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span id="wx5292" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5294"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?last-level">last-level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="13" select="quick">(</span><span class="variable" start="5" select="quick">$outdent</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">then</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$level</span><span class="whitespace" start="26"> </span><span class="op" start="27">-</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="whitespace" start="30"> </span><span class="op" start="31">else</span><span class="whitespace" start="35"> </span><span class="variable" start="36" select="quick">$level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5330" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5332"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?last-indent">last-indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}createIndent" class="solar"><span class="function" start="1" pair-end="49" select="quick">f:createIndent</span></a><span class="parenthesis">(</span><span class="parenthesis" start="16" pair-end="38" select="quick">(</span><span class="variable" start="17" select="quick">$last-level</span><span class="whitespace" start="28"> </span><span class="op" start="29">*</span><span class="whitespace" start="30"> </span><span class="variable" start="31" select="quick">$margin</span><span class="parenthesis" start="38">)</span><span class="whitespace" start="39"> </span><span class="op" start="40">+</span><span class="whitespace" start="41"> </span><span class="variable" start="42" select="quick">$offset</span><span class="parenthesis" start="49">)</span><span class="z">"</span><span id="wx5359" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w5361"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line-count">line-count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="22" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$indented-lines</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5384" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5386"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-text">span-text</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="27" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$indented-lines</span><span class="parenthesis" start="27">)</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                          </span><span class="op" start="30">then</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="35" pair-end="216" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="whitespace" start="47">
                          </span><span class="parenthesis" start="48" pair-end="211" select="quick">(</span><span class="variable" start="49" select="quick">$flat-line</span><span class="op" start="59">,</span><span class="whitespace" start="60">
                          </span><span class="higher" start="61">for</span><span class="whitespace" start="64"> </span><span id="rng-$num" class="variable" start="65" select="quick">$num</span><span class="whitespace" start="69"> </span><span class="op" start="70">in</span><span class="whitespace" start="72"> </span><span class="numeric" start="73">1</span><span class="whitespace" start="74"> </span><span class="op" start="75">to</span><span class="whitespace" start="77"> </span><span class="variable" start="78" select="quick">$line-count</span><span class="whitespace" start="89"> </span><span class="op" start="90">-</span><span class="whitespace" start="91"> </span><span class="numeric" start="92">1</span><span class="whitespace" start="93"> </span><span class="op" start="94">return</span><span class="whitespace" start="100">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="101" pair-end="147" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="108">&amp;#10;</span><span class="op">'</span><span class="op" start="115">,</span><span class="whitespace" start="116"> </span><a href="highlight-file.xsl.html#v?indent" class="solar"><span class="variable" start="117" select="quick">$indent</span></a><span class="op" start="124">,</span><span class="whitespace" start="125"> </span><span class="variable" start="126" select="quick">$indented-lines</span><span class="filter" start="141" pair-end="146" select="quick">[</span><span class="variable" start="142" select="quick">$num</span><span class="filter" start="146">]</span><span class="parenthesis" start="147">)</span><span class="op" start="148">,</span><span class="whitespace" start="149">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="150" pair-end="208" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="157">&amp;#10;</span><span class="op">'</span><span class="op" start="164">,</span><span class="whitespace" start="165"> </span><span class="variable" start="166" select="quick">$last-indent</span><span class="op" start="178">,</span><span class="whitespace" start="179"> </span><span class="variable" start="180" select="quick">$indented-lines</span><span class="filter" start="195" pair-end="207" select="quick">[</span><span class="variable" start="196" select="quick">$line-count</span><span class="filter" start="207">]</span><span class="parenthesis" start="208">)</span><span class="whitespace" start="209"> 
                          </span><span class="parenthesis" start="211">)</span><span class="op" start="212">,</span><span class="whitespace" start="213">
                          </span><span class="op">'</span><span class="literal" start="214"></span><span class="op">'</span><span class="parenthesis" start="216">)</span><span class="whitespace" start="217">
                          </span><span class="op" start="218">else</span><span class="whitespace" start="222"> </span><span class="if" start="223">if</span><span class="whitespace" start="225"> </span><span class="parenthesis" start="226" pair-end="255" select="quick">(</span><span class="variable" start="227" select="quick">$multi-line</span><span class="whitespace" start="238"> </span><span class="op" start="239">and</span><span class="whitespace" start="242"> </span><span class="variable" start="243" select="quick">$offset</span><span class="whitespace" start="250"> </span><span class="op" start="251">gt</span><span class="whitespace" start="253"> </span><span class="numeric" start="254">0</span><span class="parenthesis" start="255">)</span><span class="whitespace" start="256"> </span><span class="op" start="257">then</span><span class="whitespace" start="261">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="262" pair-end="300" select="quick">concat</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?indent" class="solar"><span class="variable" start="269" select="quick">$indent</span></a><span class="op" start="276">,</span><span class="whitespace" start="277"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="278" pair-end="299" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="285" select="quick">$line-parts</span><span class="filter" start="296" pair-end="298" select="quick">[</span><span class="numeric" start="297">1</span><span class="filter" start="298">]</span><span class="parenthesis" start="299">)</span><span class="parenthesis" start="300">)</span><span class="whitespace" start="301">
                          </span><span class="op" start="302">else</span><span class="whitespace" start="306"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="307" pair-end="328" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="314" select="quick">$line-parts</span><span class="filter" start="325" pair-end="327" select="quick">[</span><span class="numeric" start="326">1</span><span class="filter" start="327">]</span><span class="parenthesis" start="328">)</span><span class="z">"</span><span id="wx5523" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5525"><span class="es">&lt;</span><span class="en">output</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5529"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5533"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">*</span><span class="z">"</span><span id="wx5544" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5546"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span-text</span><span class="z">"</span><span id="wx5554" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx5558" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5560"><span class="es">&lt;</span><span class="en">an-offset</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5564"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$an-outOffset</span><span class="z">"</span><span id="wx5572" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">an-offset</span><span id="wx5576" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5578"><span class="es">&lt;</span><span class="en">av-offset</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5582"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$av-outOffset</span><span class="z">"</span><span id="wx5590" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">av-offset</span><span id="wx5594" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5596"><span class="es">&lt;</span><span class="en">multi-line</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5600"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="23" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$indented-lines</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx5611" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">multi-line</span><span id="wx5615" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">output</span><span id="wx5619" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5623" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5625"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}left-trim">f:left-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5641"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span id="wx5649" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5651"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="26" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$text</span><span class="op" start="14">,</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">^\s+</span><span class="op">'</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24"></span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx5672" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5676" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5678"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}createIndent">f:createIndent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5694"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padCount">padCount</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5708" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5710"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">ge</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5724"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="1" pair-end="52" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="13">for</span><span class="whitespace" start="16"> </span><span id="rng-$i" class="variable" start="17" select="quick">$i</span><span class="whitespace" start="19"> </span><span class="op" start="20">in</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">1</span><span class="whitespace" start="24"> </span><span class="op" start="25">to</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$padCount</span><span class="whitespace" start="37"> 
                            </span><span class="op" start="39">return</span><span class="whitespace" start="45"> </span><span class="op">'</span><span class="literal" start="46"> </span><span class="op">'</span><span class="op" start="49">,</span><span class="op">'</span><span class="literal" start="50"></span><span class="op">'</span><span class="parenthesis" start="52">)</span><span class="z">"</span><span id="wx5755" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5759" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5763" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm">
  XSLT function signature: 
      f:get-css(is-light-theme)
  
  description:
  
      Generates a CSS file used to colorise span elements generates by the previous 2 functions
      The colors generated depend on whether a light or dark them is specified with the is-light-theme
      parameter. The color theme uses the 'Solarized' color points specified at: http://ethanschoonover.com/solarized
  
  params:
      is-light-theme: boolean indicating whether to generate colors for a light or dark background. 
  
  </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w5769"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-css">f:get-css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5779"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-light-theme">is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx5793" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5795"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-document" class="solar"><span class="function" start="1" pair-end="12" select="quick">document</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="10"></span><span class="op">'</span><span class="parenthesis" start="12">)</span><span class="step" start="13">/</span><span class="qname" start="14" select="quick">xsl:stylesheet</span><span class="step" start="28">/</span><span class="qname" start="29" select="quick">css:theme</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5820"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx5840" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx5844" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5848" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5850"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}prefixed-name">f:prefixed-name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5866"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5880" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5882"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?name">name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string+</span><span class="z">"</span><span id="wx5896" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5898"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$name</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5908"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="18" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$prefix</span><span class="op" start="15">,</span><span class="whitespace" start="16"> </span><span class="context" start="17">.</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span id="wx5922" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5926" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5930" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5932"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-xsd-names">f:get-xsd-names</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5948"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5962" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5964"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5978" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5980"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}xsd-xpath-names" class="solar"><span class="function" start="1" pair-end="27" select="quick">f:xsd-xpath-names</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$doctype</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5993"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="22" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$prefix</span><span class="op" start="15">,</span><span class="whitespace" start="16"> </span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">name</span><span class="parenthesis" start="22">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6012"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span id="wx6020" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">element</span><span id="wx6024" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx6028" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6032" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6034"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-xsd-fnames">f:get-xsd-fnames</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6050"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6064" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6066"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6080" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6082"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}xsd-highlight-names" class="solar"><span class="function" start="1" pair-end="31" select="quick">f:xsd-highlight-names</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$doctype</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6095"><span class="es">&lt;</span><span class="en">element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="22" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$prefix</span><span class="op" start="15">,</span><span class="whitespace" start="16"> </span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">name</span><span class="parenthesis" start="22">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">attribute</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">attribute</span><span class="op">}</span><span class="z">"</span><span id="wx6121" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx6125" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6129" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="ww" id="w6131"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}is-xsd-fname">f:is-xsd-fname</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6147"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span id="wx6155" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6157"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span id="wx6165" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6167"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?element">element</span><span class="z">"</span><span id="wx6175" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6177"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attribute">attribute</span><span class="z">"</span><span id="wx6185" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6187"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fnames">fnames</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-fnames" class="solar"><span class="function" start="1" pair-end="35" select="quick">f:get-xsd-fnames</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$prefix</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$doctype</span><span class="parenthesis" start="35">)</span><span class="z">"</span><span id="wx6213" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6215"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="61" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$fnames</span><span class="filter" start="15" pair-end="60" select="quick">[</span><span class="axis" start="16">@</span><span class="qname" start="17" select="quick">name</span><span class="whitespace" start="21"> </span><span class="op" start="22">=</span><span class="whitespace" start="23"> </span><span class="variable" start="24" select="quick">$element</span><span class="whitespace" start="32"> </span><span class="op" start="33">and</span><span class="whitespace" start="36"> </span><span class="axis" start="37">@</span><span class="qname" start="38" select="quick">attribute</span><span class="whitespace" start="47"> </span><span class="op" start="48">=</span><span class="whitespace" start="49"> </span><span class="variable" start="50" select="quick">$attribute</span><span class="filter" start="60">]</span><span class="parenthesis" start="61">)</span><span class="z">"</span><span id="wx6243" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6247" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="ww" id="w6249"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">css:font</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6265"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="24" select="quick">(</span><a href="highlight-file.xsl.html#v?font-name" class="solar"><span class="variable" start="5" select="quick">$font-name</span></a><span class="whitespace" start="15"> </span><span class="op" start="16">eq</span><span class="whitespace" start="18"> </span><span class="op">'</span><span class="literal" start="19">scp</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="whitespace" start="25"> </span><span class="op" start="26">then</span><span class="whitespace" start="30"> </span><span class="axis" start="31">@</span><span class="qname" start="32" select="quick">scp</span><span class="whitespace" start="35"> </span><span class="op" start="36">else</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41"></span><span class="op">'</span><span class="z">"</span><span id="wx6294" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6298" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6300"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">css:background</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6316"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-light-theme">is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx6336" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6338"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-light-theme</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="axis" start="27">@</span><span class="qname" start="28" select="quick">light</span><span class="whitespace" start="33"> </span><span class="op" start="34">else</span><span class="whitespace" start="38"> </span><span class="axis" start="39">@</span><span class="qname" start="40" select="quick">dark</span><span class="z">"</span><span id="wx6360" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6364" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="ww" id="w6366"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}getTagType">f:getTagType</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6376"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx6390" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6392"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t">t</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="z">"</span><span id="wx6406" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6408"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t1">t1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="17" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$t</span><span class="op" start="13">,</span><span class="numeric" start="14">1</span><span class="op" start="15">,</span><span class="numeric" start="16">1</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span id="wx6429" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6431"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t2">t2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="17" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$t</span><span class="op" start="13">,</span><span class="numeric" start="14">2</span><span class="op" start="15">,</span><span class="numeric" start="16">1</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span id="wx6452" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6454"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6458"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">?</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6474"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">pi</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">?</span><span class="op">'</span><span class="z">"</span><span id="wx6488" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6492" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6494"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">!</span><span class="op">'</span><span class="whitespace" start="11"> </span><span class="op" start="12">and</span><span class="whitespace" start="15"> </span><span class="variable" start="16" select="quick">$t2</span><span class="whitespace" start="19"> </span><span class="op" start="20">eq</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">-</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6520"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">cm</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">!--</span><span class="op">'</span><span class="z">"</span><span id="wx6534" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6538" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6540"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">!</span><span class="op">'</span><span class="whitespace" start="11"> </span><span class="op" start="12">and</span><span class="whitespace" start="15"> </span><span class="variable" start="16" select="quick">$t2</span><span class="whitespace" start="19"> </span><span class="op" start="20">eq</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">[</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6566"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">cd</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">![CDATA[</span><span class="op">'</span><span class="z">"</span><span id="wx6580" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6584" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6586"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">!</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6602"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">dt</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">!</span><span class="op">'</span><span class="z">"</span><span id="wx6616" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6620" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6622"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">/</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6638"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">cl</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">/</span><span class="op">'</span><span class="z">"</span><span id="wx6652" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6656" class="ec">&gt;</span></span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> open tag (may be  self-closing) </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="ww" id="w6662"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w6666"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">tg</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6"></span><span class="op">'</span><span class="z">"</span><span id="wx6680" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6684" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6688" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6692" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6694"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}expected-offset">f:expected-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6710"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?in">in</span><span class="z">"</span><span id="wx6718" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6720"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="19" select="quick">(</span><span class="variable" start="5" select="quick">$in</span><span class="whitespace" start="8"> </span><span class="op" start="9">eq</span><span class="whitespace" start="11"> </span><span class="op">'</span><span class="literal" start="12">?&amp;gt;</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">then</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">2</span><span class="whitespace" start="27">
                          </span><span class="op" start="28">else</span><span class="whitespace" start="32"> </span><span class="if" start="33">if</span><span class="whitespace" start="35"> </span><span class="parenthesis" start="36" pair-end="52" select="quick">(</span><span class="variable" start="37" select="quick">$in</span><span class="whitespace" start="40"> </span><span class="op" start="41">eq</span><span class="whitespace" start="43"> </span><span class="op">'</span><span class="literal" start="44">--&amp;gt;</span><span class="op">'</span><span class="parenthesis" start="52">)</span><span class="whitespace" start="53"> </span><span class="op" start="54">then</span><span class="whitespace" start="58"> </span><span class="numeric" start="59">3</span><span class="whitespace" start="60">
                          </span><span class="op" start="61">else</span><span class="whitespace" start="65"> </span><span class="if" start="66">if</span><span class="whitespace" start="68"> </span><span class="parenthesis" start="69" pair-end="82" select="quick">(</span><span class="variable" start="70" select="quick">$in</span><span class="whitespace" start="73"> </span><span class="op" start="74">eq</span><span class="whitespace" start="76"> </span><span class="op">'</span><span class="literal" start="77">]]&gt;</span><span class="op">'</span><span class="parenthesis" start="82">)</span><span class="whitespace" start="83"> </span><span class="op" start="84">then</span><span class="whitespace" start="88"> </span><span class="numeric" start="89">9</span><span class="whitespace" start="90">
                          </span><span class="op" start="91">else</span><span class="whitespace" start="95"> </span><span class="numeric" start="96">1</span><span class="z">"</span><span id="wx6782" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx6786" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6788"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}iterateTokens">f:iterateTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6804"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?counter">counter</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6818" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6820"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx6834" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6836"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6850" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6852"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?expected">expected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6866" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6868"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?beganAt">beganAt</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6882" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6884"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx6898" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6900"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6914" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6916"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6930" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6932"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$doctype</span><span class="whitespace" start="9"> </span><span class="op" start="10">eq</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">xslt</span><span class="op">'</span><span class="z">"</span><span id="wx6958" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6960"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsd">is-xsd</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$is-xsl</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx6983" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6985"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx7008" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7010"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevToken">prevToken</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="19" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="whitespace" start="15"> </span><span class="op" start="16">+</span><span class="whitespace" start="17"> </span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx7037" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7039"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nextToken">nextToken</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="19" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="whitespace" start="15"> </span><span class="op" start="16">-</span><span class="whitespace" start="17"> </span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx7066" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7068"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?awaiting">awaiting</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expected</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">n</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx7094" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;trace&gt;
    token: &lt;xsl:value-of select="$token"/&gt;
    expected: &lt;xsl:value-of select="$expected"/&gt;
    index: &lt;xsl:value-of select="$index"/&gt;
    &lt;/trace&gt;
    
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w7100"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?expectedOutput">expectedOutput</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7116"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">  looking to close an open tag </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> consider: &lt;!DOCTYPE person [&lt;!ELEMENT ... ]&gt; as well as reference only </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w7134"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?beforeFind">beforeFind</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="35" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$token</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$expected</span><span class="parenthesis" start="35">)</span><span class="z">"</span><span id="wx7154" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7156"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?found">found</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="36" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="5" pair-end="30" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$beforeFind</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">gt</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">0</span><span class="parenthesis" start="36">)</span><span class="whitespace" start="37">
                              </span><span class="op" start="38">then</span><span class="whitespace" start="42"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="43" pair-end="48" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="48">)</span><span class="whitespace" start="49"> 
                              </span><span class="op" start="51">else</span><span class="whitespace" start="55"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="56" pair-end="90" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="68" select="quick">$beforeFind</span><span class="op" start="79">,</span><span class="whitespace" start="80"> </span><span class="variable" start="81" select="quick">$expected</span><span class="parenthesis" start="90">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx7203" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7205"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$found</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7215"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?offset">offset</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}expected-offset" class="solar"><span class="function" start="1" pair-end="28" select="quick">f:expected-offset</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$expected</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7238" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7240"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?begin-token">begin-token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="17" select="quick">[</span><span class="variable" start="9" select="quick">$beganAt</span><span class="filter" start="17">]</span><span class="z">"</span><span id="wx7257" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7259"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7269"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="50" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">&amp;lt;</span><span class="op">'</span><span class="op" start="14">,</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="15" pair-end="49" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$begin-token</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="numeric" start="39">1</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="variable" start="42" select="quick">$offset</span><span class="parenthesis" start="49">)</span><span class="parenthesis" start="50">)</span><span class="z">"</span><span id="wx7293" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7297" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7299"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part-token">part-token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="36" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$begin-token</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$offset</span><span class="whitespace" start="32"> </span><span class="op" start="33">+</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">1</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx7323" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7325"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7329"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getTagType" class="solar"><span class="function" start="1" pair-end="31" select="quick">f:getTagType</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$tokens</span><span class="filter" start="21" pair-end="30" select="quick">[</span><span class="variable" start="22" select="quick">$beganAt</span><span class="filter" start="30">]</span><span class="parenthesis" start="31">)</span><span class="filter" start="32" pair-end="34" select="quick">[</span><span class="numeric" start="33">1</span><span class="filter" start="34">]</span><span class="z">"</span><span id="wx7352" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w7354"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> 
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="1" pair-end="126" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="whitespace" start="13">
                        </span><span class="parenthesis" start="14" pair-end="120" select="quick">(</span><span class="variable" start="15" select="quick">$part-token</span><span class="op" start="26">,</span><span class="whitespace" start="27">
                        </span><span class="higher" start="28">for</span><span class="whitespace" start="31"> </span><span id="rng-$x" class="variable" start="32" select="quick">$x</span><span class="whitespace" start="34"> </span><span class="op" start="35">in</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$beganAt</span><span class="whitespace" start="46"> </span><span class="op" start="47">+</span><span class="whitespace" start="48"> </span><span class="numeric" start="49">1</span><span class="whitespace" start="50"> </span><span class="op" start="51">to</span><span class="whitespace" start="53"> </span><span class="parenthesis" start="54" pair-end="64" select="quick">(</span><span class="variable" start="55" select="quick">$index</span><span class="whitespace" start="61"> </span><span class="numeric" start="62">-1</span><span class="parenthesis" start="64">)</span><span class="whitespace" start="65"> </span><span class="op" start="66">return</span><span class="whitespace" start="72">
                        </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="73" pair-end="99" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="80">&amp;lt;</span><span class="op">'</span><span class="op" start="86">,</span><span class="whitespace" start="87"> </span><span class="variable" start="88" select="quick">$tokens</span><span class="filter" start="95" pair-end="98" select="quick">[</span><span class="variable" start="96" select="quick">$x</span><span class="filter" start="98">]</span><span class="parenthesis" start="99">)</span><span class="op" start="100">,</span><span class="whitespace" start="101">
                        </span><span class="op">'</span><span class="literal" start="102">&amp;lt;</span><span class="op">'</span><span class="op" start="108">,</span><span class="variable" start="109" select="quick">$beforeFind</span><span class="parenthesis" start="120">)</span><span class="whitespace" start="121">
                        </span><span class="op" start="122">,</span><span class="whitespace" start="123"> </span><span class="op">'</span><span class="literal" start="124"></span><span class="op">'</span><span class="parenthesis" start="126">)</span><span class="whitespace" start="127">
                        </span><span class="z">"</span><span id="wx7418" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7422" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7424"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w7434"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expected</span><span class="z">"</span><span id="wx7442" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7446" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7448"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">txt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm">
            id="{js:getStackIndex()}"&gt;
            </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="ww" id="w7462"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="76" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="19" pair-end="44" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$beforeFind</span><span class="parenthesis" start="44">)</span><span class="whitespace" start="45"> </span><span class="op" start="46">+</span><span class="whitespace" start="47"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="48" pair-end="71" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="62" select="quick">$expected</span><span class="parenthesis" start="71">)</span><span class="whitespace" start="72"> </span><span class="op" start="73">+</span><span class="whitespace" start="74"> </span><span class="numeric" start="75">1</span><span class="parenthesis" start="76">)</span><span class="z">"</span><span id="wx7490" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7494" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7498" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7502" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx7506" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w7508"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char1">char1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="21" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="numeric" start="18">1</span><span class="op" start="19">,</span><span class="numeric" start="20">1</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx7535" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7537"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-element-start">is-element-start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="14" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="20" pair-end="46" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="24" select="quick">$char1</span><span class="whitespace" start="30"> </span><span class="op" start="31">=</span><span class="whitespace" start="32"> </span><span class="parenthesis" start="33" pair-end="45" select="quick">(</span><span class="op">'</span><span class="literal" start="34">?</span><span class="op">'</span><span class="op" start="37">,</span><span class="op">'</span><span class="literal" start="38">!</span><span class="op">'</span><span class="op" start="41">,</span><span class="op">'</span><span class="literal" start="42">/</span><span class="op">'</span><span class="parenthesis" start="45">)</span><span class="parenthesis" start="46">)</span><span class="z">"</span><span id="wx7583" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7585"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-root-element">is-root-element</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$counter</span><span class="whitespace" start="9"> </span><span class="op" start="10">eq</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">0</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$is-element-start</span><span class="z">"</span><span id="wx7613" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> if root-prefix not initially supplied, get this from the first element name </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w7619"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-root-prefix">new-root-prefix</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$is-root-element</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22">
                          </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="if" start="28">if</span><span class="whitespace" start="30"> </span><span class="parenthesis" start="31" pair-end="50" select="quick">(</span><span class="variable" start="32" select="quick">$root-prefix</span><span class="whitespace" start="44"> </span><span class="op" start="45">eq</span><span class="whitespace" start="47"> </span><span class="op">'</span><span class="literal" start="48"></span><span class="op">'</span><span class="parenthesis" start="50">)</span><span class="whitespace" start="51">
                              </span><span class="op" start="56">then</span><span class="whitespace" start="60">
                                  </span><span class="higher" start="69">for</span><span class="whitespace" start="72"> </span><span id="rng-$x" class="variable" start="73" select="quick">$x</span><span class="whitespace" start="75"> </span><span class="op" start="76">in</span><span class="whitespace" start="78"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="79" pair-end="101" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="88" select="quick">$token</span><span class="op" start="94">,</span><span class="whitespace" start="95"> </span><span class="op">'</span><span class="literal" start="96">\s+</span><span class="op">'</span><span class="parenthesis" start="101">)</span><span class="filter" start="102" pair-end="104" select="quick">[</span><span class="numeric" start="103">1</span><span class="filter" start="104">]</span><span class="whitespace" start="105"> </span><span class="op" start="106">return</span><span class="whitespace" start="112"> 
                                  </span><span class="higher" start="122">for</span><span class="whitespace" start="125"> </span><span id="rng-$s" class="variable" start="126" select="quick">$s</span><span class="whitespace" start="128"> </span><span class="op" start="129">in</span><span class="whitespace" start="131"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="132" pair-end="156" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="149" select="quick">$x</span><span class="op" start="151">,</span><span class="whitespace" start="152"> </span><span class="op">'</span><span class="literal" start="153">:</span><span class="op">'</span><span class="parenthesis" start="156">)</span><span class="whitespace" start="157"> </span><span class="op" start="158">return</span><span class="whitespace" start="164">
                                      </span><span class="if" start="177">if</span><span class="whitespace" start="179"> </span><span class="parenthesis" start="180" pair-end="189" select="quick">(</span><span class="variable" start="181" select="quick">$s</span><span class="whitespace" start="183"> </span><span class="op" start="184">eq</span><span class="whitespace" start="186"> </span><span class="op">'</span><span class="literal" start="187"></span><span class="op">'</span><span class="parenthesis" start="189">)</span><span class="whitespace" start="190"> </span><span class="op" start="191">then</span><span class="whitespace" start="195"> </span><span class="op">'</span><span class="literal" start="196"></span><span class="op">'</span><span class="whitespace" start="198"> </span><span class="op" start="199">else</span><span class="whitespace" start="203"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="204" pair-end="218" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="211" select="quick">$s</span><span class="op" start="213">,</span><span class="whitespace" start="214"> </span><span class="op">'</span><span class="literal" start="215">:</span><span class="op">'</span><span class="parenthesis" start="218">)</span><span class="whitespace" start="219">
                              </span><span class="op" start="224">else</span><span class="whitespace" start="228"> </span><span class="variable" start="229" select="quick">$root-prefix</span><span class="whitespace" start="241">
                          </span><span class="op" start="242">else</span><span class="whitespace" start="246"> </span><span class="variable" start="247" select="quick">$root-prefix</span><span class="z">"</span><span id="wx7730" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="z">&lt;!--</span><span class="cm"> return 2 strings if required close found - that befoe and that after (even if empty string)
     if no required close found - just return the required close</span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w7736"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parseStrings">parseStrings</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7752"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="14" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w7765"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?requiredClose">requiredClose</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7781"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char2">char2</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="21" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="numeric" start="18">2</span><span class="op" start="19">,</span><span class="numeric" start="20">1</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx7808" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7810"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7814"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">?</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">?&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7832" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w7834"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">!</span><span class="op">'</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$char2</span><span class="whitespace" start="25"> </span><span class="op" start="26">eq</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">-</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">--&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7862" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w7864"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">!</span><span class="op">'</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$char2</span><span class="whitespace" start="25"> </span><span class="op" start="26">eq</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">[</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">]]&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7892" class="ec">&gt;</span></span><span class="txt"> </span><span class="z">&lt;!--</span><span class="cm"> assume cdata: &lt;![CDATA[]]&gt; </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="ww" id="w7898"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">!</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w7914"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="5" pair-end="24" select="quick">contains</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$token</span><span class="op" start="20">,</span><span class="op">'</span><span class="literal" start="21">[</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31"> </span><span class="op">'</span><span class="literal" start="32">]&gt;</span><span class="op">'</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">&gt;</span><span class="op">'</span><span class="z">"</span><span id="wx7945" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7949" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w7951"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7957" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7961" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx7965" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w7967"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?beforeClose">beforeClose</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="40" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$token</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$requiredClose</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx7993" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w7995"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7999"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$token</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">eq</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm">
            &lt;x/&gt;
            </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8022" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w8024"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="22" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$is-element-start</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm"> cdata, dtd, pi, comment, or close-tag </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="ww" id="w8041"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?foundClose">foundClose</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="37" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="5" pair-end="31" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$beforeClose</span><span class="parenthesis" start="31">)</span><span class="whitespace" start="32"> </span><span class="op" start="33">gt</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">0</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">
                                  </span><span class="op" start="39">then</span><span class="whitespace" start="43"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="44" pair-end="49" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50"> 
                                  </span><span class="op" start="52">else</span><span class="whitespace" start="56"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="57" pair-end="97" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="69" select="quick">$beforeClose</span><span class="op" start="81">,</span><span class="whitespace" start="82"> </span><span class="variable" start="83" select="quick">$requiredClose</span><span class="parenthesis" start="97">)</span><span class="z">"</span><span class="z">
                          </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx8088" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w8090"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w8094"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$foundClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w8104"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tagType">tagType</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getTagType" class="solar"><span class="function" start="1" pair-end="20" select="quick">f:getTagType</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$token</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string+</span><span class="z">"</span><span id="wx8127" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8129"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tagStart">tagStart</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tagType</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">2</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx8146" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8148"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isElementClose">isElementClose</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">/</span><span class="op">'</span><span class="z">"</span><span id="wx8168" class="sc">/&gt;</span></span><span class="txt">
                
                </span><span class="ww" id="w8170"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$isElementClose</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">ez</span><span class="op">'</span><span class="whitespace" start="31"> </span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><span class="op">'</span><span class="literal" start="37">z</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w8198"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="24" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">&amp;lt;</span><span class="op">'</span><span class="op" start="14">,</span><span class="variable" start="15" select="quick">$tagStart</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx8213" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8217" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8219"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tagContent">tagContent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="53" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$beforeClose</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="25" pair-end="48" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$tagStart</span><span class="parenthesis" start="48">)</span><span class="whitespace" start="49"> </span><span class="op" start="50">+</span><span class="whitespace" start="51"> </span><span class="numeric" start="52">1</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx8246" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8248"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?with-prefix">with-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="38" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$tagContent</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$root-prefix</span><span class="parenthesis" start="38">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx8274" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8276"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w8280"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isElementClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w8290"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="29" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl</span><span class="whitespace" start="12"> </span><span class="op" start="13">and</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$with-prefix</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30">
                                 </span><span class="op" start="31">then</span><span class="whitespace" start="35"> </span><span class="op">'</span><span class="literal" start="36">clxsl</span><span class="op">'</span><span class="whitespace" start="43">
                                 </span><span class="op" start="44">else</span><span class="whitespace" start="48"> </span><span class="if" start="49">if</span><span class="whitespace" start="51"> </span><span class="parenthesis" start="52" pair-end="166" select="quick">(</span><span class="variable" start="53" select="quick">$is-xsd</span><span class="whitespace" start="60">
                                          </span><span class="op" start="70">and</span><span class="whitespace" start="73"> </span><span class="parenthesis" start="74" pair-end="165" select="quick">(</span><span class="variable" start="75" select="quick">$tagContent</span><span class="whitespace" start="86"> </span><span class="op" start="87">=</span><span class="whitespace" start="88"> </span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-fnames" class="solar"><span class="function" start="89" pair-end="128" select="quick">f:get-xsd-fnames</span></a><span class="parenthesis">(</span><span class="variable" start="106" select="quick">$root-prefix</span><span class="op" start="118">,</span><span class="whitespace" start="119"> </span><span class="variable" start="120" select="quick">$doctype</span><span class="parenthesis" start="128">)</span><span class="step" start="129">/</span><span class="axis" start="130">@</span><span class="qname" start="131" select="quick">name</span><span class="whitespace" start="135">
                                          </span><span class="op" start="145">or</span><span class="whitespace" start="147"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="148" pair-end="164" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="152" select="quick">$with-prefix</span><span class="parenthesis" start="164">)</span><span class="parenthesis" start="165">)</span><span class="parenthesis" start="166">)</span><span class="whitespace" start="167"> 
                                 </span><span class="op" start="169">then</span><span class="whitespace" start="173"> </span><span class="op">'</span><span class="literal" start="174">clxsl</span><span class="op">'</span><span class="whitespace" start="181">
                                 </span><span class="op" start="182">else</span><span class="whitespace" start="186"> </span><span class="op">'</span><span class="literal" start="187">cl</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                      </span><span class="ww" id="w8362"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tagContent</span><span class="z">"</span><span id="wx8370" class="sc">/&gt;</span></span><span class="txt">
                    </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8374" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8378" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w8380"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w8384"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$tagType</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                      </span><span class="ww" id="w8399"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tagContent</span><span class="z">"</span><span id="wx8407" class="sc">/&gt;</span></span><span class="txt">
                    </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8411" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx8415" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx8419" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8421"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$isElementClose</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">ec</span><span class="op">'</span><span class="whitespace" start="31"> </span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><span class="op">'</span><span class="literal" start="37">z</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w8449"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isElementClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="z">&lt;!--</span><span class="cm">
                    &lt;xsl:attribute name="id" select="js:stackPop()"/&gt;
                    </span><span class="z">--&gt;</span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8465" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w8467"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$requiredClose</span><span class="z">"</span><span id="wx8475" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8479" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8481"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">txt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w8491"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isElementClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="z">&lt;!--</span><span class="cm">
                    &lt;xsl:attribute name="id" select="js:getStackIndex()"/&gt;
                    </span><span class="z">--&gt;</span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8507" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w8509"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="82" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="19" pair-end="45" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$beforeClose</span><span class="parenthesis" start="45">)</span><span class="whitespace" start="46"> </span><span class="op" start="47">+</span><span class="whitespace" start="48"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="49" pair-end="77" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="63" select="quick">$requiredClose</span><span class="parenthesis" start="77">)</span><span class="whitespace" start="78"> </span><span class="op" start="79">+</span><span class="whitespace" start="80"> </span><span class="numeric" start="81">1</span><span class="parenthesis" start="82">)</span><span class="z">"</span><span id="wx8537" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8541" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8545" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w8547"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w8551"><span class="es">&lt;</span><span class="en">required</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w8555"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$requiredClose</span><span class="z">"</span><span id="wx8563" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="cl">required</span><span id="wx8567" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx8571" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx8575" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8579" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w8581"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            
            </span><span class="ww" id="w8585"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parts">parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w8601"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">&amp;quot;.*?&amp;quot;|'.*?'|[^'&amp;quot;]+|['&amp;quot;]</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="z">"</span><span class="z"> </span><span class="atn">flags</span><span class="atneq">=</span><span class="z">"</span><span class="av">s</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w8623"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w8627"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx8635" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx8639" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w8641"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w8645"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx8653" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx8657" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx8661" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx8665" class="ec">&gt;</span></span><span class="txt">
            
            </span><span class="ww" id="w8667"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getAttributes" class="solar"><span class="function" start="1" pair-end="69" select="quick">f:getAttributes</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$token</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">0</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$parts</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">1</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$doctype</span><span class="op" start="47">,</span><span class="whitespace" start="48"> </span><span class="variable" start="49" select="quick">$new-root-prefix</span><span class="op" start="65">,</span><span class="whitespace" start="66"> </span><span class="op">'</span><span class="literal" start="67"></span><span class="op">'</span><span class="parenthesis" start="69">)</span><span class="z">"</span><span id="wx8698" class="sc">/&gt;</span></span><span class="txt">
            
            </span><span class="z">&lt;!--</span><span class="cm"> must be an open tag, so check for attributes </span><span class="z">--&gt;</span><span class="txt">
            
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx8706" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx8710" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8714" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx8718" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8720"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx8740" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w8742"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newCounter">newCounter</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="22" select="quick">(</span><span class="variable" start="5" select="quick">$is-element-start</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23">
                                            </span><span class="op" start="24">then</span><span class="whitespace" start="28"> </span><span class="variable" start="29" select="quick">$counter</span><span class="whitespace" start="37"> </span><span class="op" start="38">+</span><span class="whitespace" start="39"> </span><span class="numeric" start="40">1</span><span class="whitespace" start="41"> </span><span class="op" start="42">else</span><span class="whitespace" start="46"> </span><span class="variable" start="47" select="quick">$counter</span><span class="z">"</span><span id="wx8772" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8774"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stillAwaiting">stillAwaiting</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">and</span><span class="whitespace" start="14"> </span><span class="type" start="15">empty</span><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$expectedOutput</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx8801" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8803"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="41" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="5" pair-end="26" select="quick">name</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$parseStrings</span><span class="filter" start="23" pair-end="25" select="quick">[</span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="parenthesis" start="26">)</span><span class="whitespace" start="27"> </span><span class="op" start="28">eq</span><span class="whitespace" start="30"> </span><span class="op">'</span><span class="literal" start="31">required</span><span class="op">'</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w8828"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parseStrings</span><span class="z">"</span><span id="wx8836" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8840" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8842"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expectedOutput</span><span class="z">"</span><span id="wx8850" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w8852"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newExpected">newExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="16" select="quick">(</span><span class="variable" start="5" select="quick">$index</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">then</span><span class="whitespace" start="22">
                          </span><span class="op">'</span><span class="literal" start="23">n</span><span class="op">'</span><span class="whitespace" start="26">
                          </span><span class="op" start="27">else</span><span class="whitespace" start="31"> </span><span class="if" start="32">if</span><span class="whitespace" start="34"> </span><span class="parenthesis" start="35" pair-end="50" select="quick">(</span><span class="variable" start="36" select="quick">$stillAwaiting</span><span class="parenthesis" start="50">)</span><span class="whitespace" start="51">
                          </span><span class="op" start="52">then</span><span class="whitespace" start="56"> </span><span class="variable" start="57" select="quick">$expected</span><span class="whitespace" start="66">
                          </span><span class="op" start="67">else</span><span class="whitespace" start="71"> </span><span class="if" start="72">if</span><span class="whitespace" start="74"> </span><span class="parenthesis" start="75" pair-end="101" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="76" pair-end="95" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="82" select="quick">$parseStrings</span><span class="parenthesis" start="95">)</span><span class="whitespace" start="96"> </span><span class="op" start="97">eq</span><span class="whitespace" start="99"> </span><span class="numeric" start="100">1</span><span class="parenthesis" start="101">)</span><span class="whitespace" start="102">
                          </span><span class="op" start="103">then</span><span class="whitespace" start="107"> </span><span class="variable" start="108" select="quick">$parseStrings</span><span class="whitespace" start="121">
                          </span><span class="op" start="122">else</span><span class="whitespace" start="126"> </span><span class="op">'</span><span class="literal" start="127">n</span><span class="op">'</span><span class="z">"</span><span id="wx8923" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8925"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newBeganAt">newBeganAt</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="19" select="quick">(</span><span class="variable" start="5" select="quick">$stillAwaiting</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">then</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$beganAt</span><span class="whitespace" start="34"> </span><span class="op" start="35">else</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$index</span><span class="z">"</span><span id="wx8957" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8959"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">le</span><span class="whitespace" start="10"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="11" pair-end="24" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$tokens</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w8976"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}iterateTokens" class="solar"><span class="function" start="1" pair-end="115" select="quick">f:iterateTokens</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$newCounter</span><span class="op" start="28">,</span><span class="whitespace" start="29"> </span><span class="variable" start="30" select="quick">$tokens</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$index</span><span class="whitespace" start="45"> </span><span class="op" start="46">+</span><span class="whitespace" start="47"> </span><span class="numeric" start="48">1</span><span class="op" start="49">,</span><span class="whitespace" start="50">
                            </span><span class="variable" start="51" select="quick">$newExpected</span><span class="op" start="63">,</span><span class="whitespace" start="64"> </span><span class="variable" start="65" select="quick">$newBeganAt</span><span class="op" start="76">,</span><span class="whitespace" start="77"> </span><span class="variable" start="78" select="quick">$newLevel</span><span class="op" start="87">,</span><span class="whitespace" start="88"> </span><span class="variable" start="89" select="quick">$doctype</span><span class="op" start="97">,</span><span class="whitespace" start="98"> </span><span class="variable" start="99" select="quick">$new-root-prefix</span><span class="parenthesis" start="115">)</span><span class="z">"</span><span id="wx9012" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx9016" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx9020" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w9022"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}getAttributes">f:getAttributes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">item()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w9038"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attToken">attToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9052" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9054"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?offset">offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx9068" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9070"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parts">parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx9084" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9086"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx9100" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9102"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9116" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9118"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9132" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9134"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ename">ename</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9148" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9150"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$doctype</span><span class="whitespace" start="9"> </span><span class="op" start="10">eq</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">xslt</span><span class="op">'</span><span class="z">"</span><span id="wx9176" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9178"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsd">is-xsd</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$is-xsl</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx9201" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w9203"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part1">part1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parts</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx9226" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9228"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part2">part2</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parts</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">+</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx9255" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w9257"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?elementName">elementName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="17" select="quick">(</span><span class="variable" start="5" select="quick">$ename</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15"></span><span class="op">'</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">then</span><span class="whitespace" start="23">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="24" pair-end="50" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$part1</span><span class="op" start="39">,</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41">&gt;|\s+|/</span><span class="op">'</span><span class="parenthesis" start="50">)</span><span class="filter" start="51" pair-end="53" select="quick">[</span><span class="numeric" start="52">1</span><span class="filter" start="53">]</span><span class="whitespace" start="54">
                          </span><span class="op" start="55">else</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$ename</span><span class="z">"</span><span id="wx9306" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w9308"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?with-prefix">with-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="39" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$elementName</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$root-prefix</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx9328" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w9330"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl-element">is-xsl-element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xsl</span><span class="whitespace" start="8"> </span><span class="op" start="9">and</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$with-prefix</span><span class="z">"</span><span id="wx9348" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w9350"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="numeric" start="11">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w9364"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">es</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&amp;lt;</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9376" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w9378"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl-element</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21">
                   </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">enxsl</span><span class="op">'</span><span class="whitespace" start="34">
                   </span><span class="op" start="35">else</span><span class="whitespace" start="39"> </span><span class="if" start="40">if</span><span class="whitespace" start="42"> </span><span class="parenthesis" start="43" pair-end="73" select="quick">(</span><span class="variable" start="44" select="quick">$is-xsl</span><span class="whitespace" start="51"> </span><span class="op" start="52">and</span><span class="whitespace" start="55"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="56" pair-end="72" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="60" select="quick">$with-prefix</span><span class="parenthesis" start="72">)</span><span class="parenthesis" start="73">)</span><span class="whitespace" start="74">
                   </span><span class="op" start="75">then</span><span class="whitespace" start="79"> </span><span class="op">'</span><span class="literal" start="80">en</span><span class="op">'</span><span class="whitespace" start="84">
                   </span><span class="op" start="85">else</span><span class="whitespace" start="89"> </span><span class="if" start="90">if</span><span class="whitespace" start="92"> </span><span class="parenthesis" start="93" pair-end="123" select="quick">(</span><span class="variable" start="94" select="quick">$is-xsd</span><span class="whitespace" start="101"> </span><span class="op" start="102">and</span><span class="whitespace" start="105"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="106" pair-end="122" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="110" select="quick">$with-prefix</span><span class="parenthesis" start="122">)</span><span class="parenthesis" start="123">)</span><span class="whitespace" start="124">
                   </span><span class="op" start="125">then</span><span class="whitespace" start="129"> </span><span class="op">'</span><span class="literal" start="130">enxsl</span><span class="op">'</span><span class="whitespace" start="137">
                   </span><span class="op" start="138">else</span><span class="whitespace" start="142"> </span><span class="if" start="143">if</span><span class="whitespace" start="145"> </span><span class="parenthesis" start="146" pair-end="220" select="quick">(</span><span class="variable" start="147" select="quick">$is-xsd</span><span class="whitespace" start="154"> </span><span class="op" start="155">and</span><span class="whitespace" start="158"> </span><span class="variable" start="159" select="quick">$elementName</span><span class="whitespace" start="171"> </span><span class="op" start="172">=</span><span class="whitespace" start="173"> </span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-fnames" class="solar"><span class="function" start="174" pair-end="213" select="quick">f:get-xsd-fnames</span></a><span class="parenthesis">(</span><span class="variable" start="191" select="quick">$root-prefix</span><span class="op" start="203">,</span><span class="whitespace" start="204"> </span><span class="variable" start="205" select="quick">$doctype</span><span class="parenthesis" start="213">)</span><span class="step" start="214">/</span><span class="axis" start="215">@</span><span class="qname" start="216" select="quick">name</span><span class="parenthesis" start="220">)</span><span class="whitespace" start="221"> </span><span class="op" start="222">then</span><span class="whitespace" start="226"> </span><span class="op">'</span><span class="literal" start="227">enxsl</span><span class="op">'</span><span class="whitespace" start="234"> 
                   </span><span class="op" start="236">else</span><span class="whitespace" start="240"> </span><span class="op">'</span><span class="literal" start="241">en</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">
        id="{js:stackPush($elementName)}"&gt;
        </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w9483"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$elementName</span><span class="z">"</span><span id="wx9491" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9495" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx9499" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w9501"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pre-close">pre-close</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="29" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$part1</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="op">'</span><span class="literal" start="26">&gt;</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx9523" class="sc">/&gt;</span></span><span class="txt"> 
    
    </span><span class="ww" id="w9525"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isFinalPart">isFinalPart</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">2</span><span class="whitespace" start="11"> </span><span class="op" start="12">gt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$parts</span><span class="parenthesis" start="27">)</span><span class="whitespace" start="28">
                                             </span><span class="op" start="29">or</span><span class="whitespace" start="31"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="32" pair-end="56" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="46" select="quick">$pre-close</span><span class="parenthesis" start="56">)</span><span class="whitespace" start="57"> </span><span class="op" start="58">gt</span><span class="whitespace" start="60"> </span><span class="numeric" start="61">0</span><span class="whitespace" start="62">
                                             </span><span class="op" start="63">or</span><span class="whitespace" start="65"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="66" pair-end="88" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="78" select="quick">$part1</span><span class="op" start="84">,</span><span class="op">'</span><span class="literal" start="85">&gt;</span><span class="op">'</span><span class="parenthesis" start="88">)</span><span class="z">"</span><span class="z">
                  </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx9578" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w9580"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w9584"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isFinalPart</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">  use sc class value to mark end of self-closed element </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w9598"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isSelfClosed">isSelfClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="1" pair-end="25" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$pre-close</span><span class="op" start="21">,</span><span class="op">'</span><span class="literal" start="22">/</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx9625" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w9627"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$isSelfClosed</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">sc</span><span class="op">'</span><span class="whitespace" start="29"> </span><span class="op" start="30">else</span><span class="whitespace" start="34"> </span><span class="op">'</span><span class="literal" start="35">scx</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w9655"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSelfClosed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm">
            &lt;xsl:attribute name="id" select="js:stackPop()"/&gt;
            </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx9671" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w9673"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$isSelfClosed</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">/</span><span class="op">'</span><span class="whitespace" start="28"> </span><span class="op" start="29">else</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34"></span><span class="op">'</span><span class="z">"</span><span id="wx9697" class="sc">/&gt;</span></span><span class="txt">&amp;gt;</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9701" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w9703"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">txt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w9713"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSelfClosed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm">
            &lt;xsl:attribute name="id" select="js:getStackIndex()"/&gt;
            </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx9729" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w9731"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="61" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$attToken</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="22" pair-end="46" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="36" select="quick">$pre-close</span><span class="parenthesis" start="46">)</span><span class="whitespace" start="47"> </span><span class="op" start="48">+</span><span class="whitespace" start="49"> </span><span class="variable" start="50" select="quick">$offset</span><span class="whitespace" start="57"> </span><span class="op" start="58">+</span><span class="whitespace" start="59"> </span><span class="numeric" start="60">2</span><span class="parenthesis" start="61">)</span><span class="z">"</span><span id="wx9756" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9760" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx9764" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w9766"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="14" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$part2</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> attribute must exist and name occurs before value, so get this first </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w9783"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?left">left</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="16" select="quick">(</span><span class="variable" start="5" select="quick">$index</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17">
                              </span><span class="op" start="18">then</span><span class="whitespace" start="22"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="23" pair-end="72" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$part1</span><span class="op" start="39">,</span><span class="whitespace" start="40"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="41" pair-end="67" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="55" select="quick">$elementName</span><span class="parenthesis" start="67">)</span><span class="whitespace" start="68"> </span><span class="op" start="69">+</span><span class="whitespace" start="70"> </span><span class="numeric" start="71">1</span><span class="parenthesis" start="72">)</span><span class="whitespace" start="73">
                              </span><span class="op" start="74">else</span><span class="whitespace" start="78"> </span><span class="variable" start="79" select="quick">$part1</span><span class="z">"</span><span id="wx9832" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w9834"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pre">pre</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="27" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$left</span><span class="op" start="23">,</span><span class="op">'</span><span class="literal" start="24">=</span><span class="op">'</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx9855" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm">
        &lt;xsl:variable name="tokens" select="tokenize($pre, '\s+')"/&gt;
        </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w9861"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}splitAttributeName" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:splitAttributeName</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$pre</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx9878" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w9880"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attSpans">attSpans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w9896"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w9906"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="5" pair-end="19" select="quick">matches</span></a><span class="parenthesis">(</span><span class="context" start="13">.</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">\S</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> 
                                  </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">atn</span><span class="op">'</span><span class="whitespace" start="33">
                                  </span><span class="op" start="34">else</span><span class="whitespace" start="38"> </span><span class="op">'</span><span class="literal" start="39">z</span><span class="op">'</span><span class="z">"</span><span id="wx9943" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w9945"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$class</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w9957"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx9965" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9969" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx9973" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx9977" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w9979"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?att-name">att-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$attSpans</span><span class="filter" start="10" pair-end="26" select="quick">[</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">class</span><span class="whitespace" start="17"> </span><span class="op" start="18">eq</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">atn</span><span class="op">'</span><span class="filter" start="26">]</span><span class="z">"</span><span id="wx10003" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w10005"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xsd-xpath-elements">xsd-xpath-elements</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-names" class="solar"><span class="function" start="1" pair-end="39" select="quick">f:get-xsd-names</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$root-prefix</span><span class="op" start="29">,</span><span class="whitespace" start="30"> </span><span class="variable" start="31" select="quick">$doctype</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx10031" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w10033"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$attSpans</span><span class="z">"</span><span id="wx10041" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w10043"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isXPath">isXPath</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl-element</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21">
                              </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$att-name</span><span class="whitespace" start="36"> </span><span class="op" start="37">=</span><span class="whitespace" start="38"> </span><span class="parenthesis" start="39" pair-end="64" select="quick">(</span><span class="op">'</span><span class="literal" start="40">select</span><span class="op">'</span><span class="op" start="48">,</span><span class="op">'</span><span class="literal" start="49">test</span><span class="op">'</span><span class="op" start="55">,</span><span class="whitespace" start="56"> </span><span class="op">'</span><span class="literal" start="57">match</span><span class="op">'</span><span class="parenthesis" start="64">)</span><span class="whitespace" start="65">
                              </span><span class="op" start="66">else</span><span class="whitespace" start="70">
                              
                              </span><span class="parenthesis" start="72" pair-end="158" select="quick">(</span><span class="variable" start="73" select="quick">$is-xsd</span><span class="whitespace" start="80"> </span><span class="op" start="81">and</span><span class="whitespace" start="84"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="85" pair-end="157" select="quick">exists</span></a><span class="parenthesis">(</span><span class="whitespace" start="92"> 
                              </span><span class="variable" start="94" select="quick">$xsd-xpath-elements</span><span class="filter" start="113" pair-end="156" select="quick">[</span><span class="axis" start="114">@</span><span class="qname" start="115" select="quick">name</span><span class="whitespace" start="119"> </span><span class="op" start="120">=</span><span class="whitespace" start="121"> </span><span class="variable" start="122" select="quick">$elementName</span><span class="whitespace" start="134"> </span><span class="op" start="135">and</span><span class="whitespace" start="138"> </span><span class="context" start="139">.</span><span class="step" start="140">/</span><span class="qname" start="141" select="quick">att</span><span class="whitespace" start="144"> </span><span class="op" start="145">=</span><span class="whitespace" start="146"> </span><span class="variable" start="147" select="quick">$att-name</span><span class="filter" start="156">]</span><span class="parenthesis" start="157">)</span><span class="parenthesis" start="158">)</span><span class="whitespace" start="159"> 
                              </span><span class="z">"</span><span id="wx10121" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="z">&lt;!--</span><span class="cm"> for coloring attribute values that are referenced from XPath </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w10127"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?metaXPathName">metaXPathName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-av-class" class="solar"><span class="function" start="1" pair-end="105" select="quick">f:get-av-class</span></a><span class="parenthesis">(</span><span class="variable" start="16" select="quick">$is-xsl-element</span><span class="op" start="31">,</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$doctype</span><span class="op" start="41">,</span><span class="whitespace" start="42"> </span><span class="variable" start="43" select="quick">$is-xsd</span><span class="op" start="50">,</span><span class="whitespace" start="51"> 
                                             </span><span class="variable" start="68" select="quick">$elementName</span><span class="op" start="80">,</span><span class="whitespace" start="81"> </span><span class="variable" start="82" select="quick">$att-name</span><span class="op" start="91">,</span><span class="whitespace" start="92"> </span><span class="variable" start="93" select="quick">$root-prefix</span><span class="parenthesis" start="105">)</span><span class="z">"</span><span id="wx10165" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w10167"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">atneq</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w10177"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="40" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$left</span><span class="op" start="16">,</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="17" pair-end="35" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="31" select="quick">$pre</span><span class="parenthesis" start="35">)</span><span class="whitespace" start="36"> </span><span class="op" start="37">+</span><span class="whitespace" start="38"> </span><span class="numeric" start="39">1</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span id="wx10197" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx10201" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w10203"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?sl">sl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part2</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:double</span><span class="z">"</span><span id="wx10226" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w10228"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w10238"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="21" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$part2</span><span class="op" start="17">,</span><span class="numeric" start="18">1</span><span class="op" start="19">,</span><span class="numeric" start="20">1</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx10253" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx10257" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w10259"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attValue">attValue</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="29" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$part2</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">2</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$sl</span><span class="whitespace" start="25"> </span><span class="op" start="26">-</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">2</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx10286" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w10288"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w10292"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isXPath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w10302"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}showXPath" class="solar"><span class="function" start="1" pair-end="24" select="quick">loc:showXPath</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$attValue</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx10313" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx10317" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w10319"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xsl</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w10329"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}processAVT" class="solar"><span class="function" start="1" pair-end="39" select="quick">f:processAVT</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$attValue</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$metaXPathName</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx10343" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx10347" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w10349"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w10353"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$metaXPathName</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w10365"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$attValue</span><span class="z">"</span><span id="wx10373" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx10377" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx10381" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx10385" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w10387"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w10397"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="22" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$part2</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$sl</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span id="wx10411" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx10415" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx10419" class="ec">&gt;</span></span><span class="txt">
      
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx10423" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w10425"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newOffset">newOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part1</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">+</span><span class="whitespace" start="24"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="25" pair-end="45" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$part2</span><span class="parenthesis" start="45">)</span><span class="whitespace" start="46"> </span><span class="op" start="47">+</span><span class="whitespace" start="48"> </span><span class="variable" start="49" select="quick">$offset</span><span class="z">"</span><span id="wx10453" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w10455"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="17" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$isFinalPart</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w10468"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getAttributes" class="solar"><span class="function" start="1" pair-end="96" select="quick">f:getAttributes</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$attToken</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$newOffset</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$parts</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$index</span><span class="whitespace" start="54"> </span><span class="op" start="55">+</span><span class="whitespace" start="56"> </span><span class="numeric" start="57">2</span><span class="op" start="58">,</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$doctype</span><span class="op" start="68">,</span><span class="whitespace" start="69"> </span><span class="variable" start="70" select="quick">$root-prefix</span><span class="op" start="82">,</span><span class="whitespace" start="83"> </span><span class="variable" start="84" select="quick">$elementName</span><span class="parenthesis" start="96">)</span><span class="z">"</span><span id="wx10501" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx10505" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx10509" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w10511"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-av-class">f:get-av-class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w10527"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl-element">is-xsl-element</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx10541" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10543"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doctype">doctype</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx10557" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10559"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsd">is-xsd</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx10573" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10575"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?elementName">elementName</span><span class="z">"</span><span id="wx10583" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10585"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?att-name">att-name</span><span class="z">"</span><span id="wx10593" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10595"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span id="wx10603" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10605"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl-element</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26">
                </span><span class="if" start="27">if</span><span class="whitespace" start="29"> </span><span class="parenthesis" start="30" pair-end="126" select="quick">(</span><span class="variable" start="31" select="quick">$elementName</span><span class="whitespace" start="43"> </span><span class="op" start="44">=</span><span class="whitespace" start="45"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="46" pair-end="97" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="62" select="quick">$root-prefix</span><span class="op" start="74">,</span><span class="whitespace" start="75"> </span><span class="parenthesis" start="76" pair-end="96" select="quick">(</span><span class="op">'</span><span class="literal" start="77">variable</span><span class="op">'</span><span class="op" start="87">,</span><span class="whitespace" start="88"> </span><span class="op">'</span><span class="literal" start="89">param</span><span class="op">'</span><span class="parenthesis" start="96">)</span><span class="parenthesis" start="97">)</span><span class="whitespace" start="98">
                    </span><span class="op" start="103">and</span><span class="whitespace" start="106"> </span><span class="variable" start="107" select="quick">$att-name</span><span class="whitespace" start="116"> </span><span class="op" start="117">eq</span><span class="whitespace" start="119"> </span><span class="op">'</span><span class="literal" start="120">name</span><span class="op">'</span><span class="parenthesis" start="126">)</span><span class="whitespace" start="127"> </span><span class="op" start="128">then</span><span class="whitespace" start="132"> </span><span class="op">'</span><span class="literal" start="133">vname</span><span class="op">'</span><span class="whitespace" start="140">
                </span><span class="op" start="141">else</span><span class="whitespace" start="145"> </span><span class="if" start="146">if</span><span class="whitespace" start="148"> </span><span class="parenthesis" start="149" pair-end="245" select="quick">(</span><span class="variable" start="150" select="quick">$elementName</span><span class="whitespace" start="162"> </span><span class="op" start="163">=</span><span class="whitespace" start="164"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="165" pair-end="216" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="181" select="quick">$root-prefix</span><span class="op" start="193">,</span><span class="whitespace" start="194"> </span><span class="parenthesis" start="195" pair-end="215" select="quick">(</span><span class="op">'</span><span class="literal" start="196">import</span><span class="op">'</span><span class="op" start="204">,</span><span class="whitespace" start="205"> </span><span class="op">'</span><span class="literal" start="206">include</span><span class="op">'</span><span class="parenthesis" start="215">)</span><span class="parenthesis" start="216">)</span><span class="whitespace" start="217">
                    </span><span class="op" start="222">and</span><span class="whitespace" start="225"> </span><span class="variable" start="226" select="quick">$att-name</span><span class="whitespace" start="235"> </span><span class="op" start="236">eq</span><span class="whitespace" start="238"> </span><span class="op">'</span><span class="literal" start="239">href</span><span class="op">'</span><span class="parenthesis" start="245">)</span><span class="whitespace" start="246"> </span><span class="op" start="247">then</span><span class="whitespace" start="251"> </span><span class="op">'</span><span class="literal" start="252">href</span><span class="op">'</span><span class="whitespace" start="258">
                </span><span class="op" start="259">else</span><span class="whitespace" start="263"> </span><span class="if" start="264">if</span><span class="whitespace" start="266"> </span><span class="parenthesis" start="267" pair-end="359" select="quick">(</span><span class="variable" start="268" select="quick">$elementName</span><span class="whitespace" start="280"> </span><span class="op" start="281">=</span><span class="whitespace" start="282"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="283" pair-end="330" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="299" select="quick">$root-prefix</span><span class="op" start="311">,</span><span class="whitespace" start="312"> </span><span class="parenthesis" start="313" pair-end="329" select="quick">(</span><span class="op">'</span><span class="literal" start="314">call-template</span><span class="op">'</span><span class="parenthesis" start="329">)</span><span class="parenthesis" start="330">)</span><span class="whitespace" start="331">
                    </span><span class="op" start="336">and</span><span class="whitespace" start="339"> </span><span class="variable" start="340" select="quick">$att-name</span><span class="whitespace" start="349"> </span><span class="op" start="350">eq</span><span class="whitespace" start="352"> </span><span class="op">'</span><span class="literal" start="353">name</span><span class="op">'</span><span class="parenthesis" start="359">)</span><span class="whitespace" start="360"> </span><span class="op" start="361">then</span><span class="whitespace" start="365"> </span><span class="op">'</span><span class="literal" start="366">tcall</span><span class="op">'</span><span class="whitespace" start="373">
                </span><span class="op" start="374">else</span><span class="whitespace" start="378"> </span><span class="if" start="379">if</span><span class="whitespace" start="381"> </span><span class="parenthesis" start="382" pair-end="468" select="quick">(</span><span class="variable" start="383" select="quick">$elementName</span><span class="whitespace" start="395"> </span><span class="op" start="396">=</span><span class="whitespace" start="397"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="398" pair-end="438" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="414" select="quick">$root-prefix</span><span class="op" start="426">,</span><span class="whitespace" start="427"> </span><span class="op">'</span><span class="literal" start="428">function</span><span class="op">'</span><span class="parenthesis" start="438">)</span><span class="whitespace" start="439"> 
                    </span><span class="op" start="445">and</span><span class="whitespace" start="448"> </span><span class="variable" start="449" select="quick">$att-name</span><span class="whitespace" start="458"> </span><span class="op" start="459">eq</span><span class="whitespace" start="461"> </span><span class="op">'</span><span class="literal" start="462">name</span><span class="op">'</span><span class="parenthesis" start="468">)</span><span class="whitespace" start="469"> </span><span class="op" start="470">then</span><span class="whitespace" start="474"> </span><span class="op">'</span><span class="literal" start="475">fname</span><span class="op">'</span><span class="whitespace" start="482">
                </span><span class="op" start="483">else</span><span class="whitespace" start="487"> </span><span class="if" start="488">if</span><span class="whitespace" start="490"> </span><span class="parenthesis" start="491" pair-end="577" select="quick">(</span><span class="variable" start="492" select="quick">$elementName</span><span class="whitespace" start="504"> </span><span class="op" start="505">=</span><span class="whitespace" start="506"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="507" pair-end="547" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="523" select="quick">$root-prefix</span><span class="op" start="535">,</span><span class="whitespace" start="536"> </span><span class="op">'</span><span class="literal" start="537">template</span><span class="op">'</span><span class="parenthesis" start="547">)</span><span class="whitespace" start="548"> 
                    </span><span class="op" start="554">and</span><span class="whitespace" start="557"> </span><span class="variable" start="558" select="quick">$att-name</span><span class="whitespace" start="567"> </span><span class="op" start="568">eq</span><span class="whitespace" start="570"> </span><span class="op">'</span><span class="literal" start="571">name</span><span class="op">'</span><span class="parenthesis" start="577">)</span><span class="whitespace" start="578"> </span><span class="op" start="579">then</span><span class="whitespace" start="583"> </span><span class="op">'</span><span class="literal" start="584">tname</span><span class="op">'</span><span class="whitespace" start="591">
                </span><span class="op" start="592">else</span><span class="whitespace" start="596"> </span><span class="op">'</span><span class="literal" start="597">av</span><span class="op">'</span><span class="whitespace" start="601">
                
                </span><span class="op" start="603">else</span><span class="whitespace" start="607"> </span><span class="if" start="608">if</span><span class="whitespace" start="610"> </span><span class="parenthesis" start="611" pair-end="697" select="quick">(</span><span class="variable" start="612" select="quick">$is-xsd</span><span class="whitespace" start="619"> 
                         </span><span class="op" start="630">and</span><span class="whitespace" start="633"> </span><a href="xmlspectrum.xsl.html#f?{internal}is-xsd-fname" class="solar"><span class="function" start="634" pair-end="696" select="quick">f:is-xsd-fname</span></a><span class="parenthesis">(</span><span class="variable" start="649" select="quick">$root-prefix</span><span class="op" start="661">,</span><span class="whitespace" start="662"> </span><span class="variable" start="663" select="quick">$doctype</span><span class="op" start="671">,</span><span class="whitespace" start="672"> </span><span class="variable" start="673" select="quick">$elementName</span><span class="op" start="685">,</span><span class="whitespace" start="686"> </span><span class="variable" start="687" select="quick">$att-name</span><span class="parenthesis" start="696">)</span><span class="parenthesis" start="697">)</span><span class="whitespace" start="698">
                </span><span class="op" start="699">then</span><span class="whitespace" start="703"> </span><span class="op">'</span><span class="literal" start="704">fname</span><span class="op">'</span><span class="whitespace" start="711"> </span><span class="op" start="712">else</span><span class="whitespace" start="716"> </span><span class="op">'</span><span class="literal" start="717">av</span><span class="op">'</span><span class="z">"</span><span id="wx10855" class="sc">/&gt;</span></span><span class="txt">
    
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx10859" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w10861"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}unescape-p">f:unescape-p</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w10871"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span id="wx10879" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10881"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t1">t1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="32" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$text</span><span class="op" start="14">,</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">&amp;#x0300;</span><span class="op">'</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">{{</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx10908" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10910"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="30" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$t1</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">&amp;#x0301;</span><span class="op">'</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="op">'</span><span class="literal" start="26">}}</span><span class="op">'</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx10931" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx10935" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w10937"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}processAVT">f:processAVT</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w10947"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attText">attText</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx10961" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10963"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx10977" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w10979"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?regex1">regex1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">\{.*?\}</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx11001" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w11003"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?regex2">regex2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">part</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx11023" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w11025"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t1">t1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="37" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$attText</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="op">'</span><span class="literal" start="19">\{\{</span><span class="op">'</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">&amp;#x0300;</span><span class="op">'</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span id="wx11052" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w11054"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t2">t2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="32" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$t1</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">\}\}</span><span class="op">'</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">&amp;#x0301;</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx11081" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> flags:s = match . to any char including \n </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w11087"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t2</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$regex1</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">flags</span><span class="atneq">=</span><span class="z">"</span><span class="av">s</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
      </span><span class="ww" id="w11111"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w11115"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p">p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}unescape-p" class="solar"><span class="function" start="1" pair-end="51" select="quick">f:unescape-p</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="14" pair-end="50" select="quick">substring</span></a><span class="parenthesis">(</span><span class="context" start="24">.</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="numeric" start="27">2</span><span class="op" start="28">,</span><span class="whitespace" start="29"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="30" pair-end="45" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="context" start="44">.</span><span class="parenthesis" start="45">)</span><span class="whitespace" start="46"> </span><span class="op" start="47">-</span><span class="whitespace" start="48"> </span><span class="numeric" start="49">2</span><span class="parenthesis" start="50">)</span><span class="parenthesis" start="51">)</span><span class="z">"</span><span id="wx11148" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w11150"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w11160"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">{</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx11166" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx11170" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w11172"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}showXPath" class="solar"><span class="function" start="1" pair-end="17" select="quick">loc:showXPath</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$p</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span id="wx11183" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w11185"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w11195"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">}</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx11201" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx11205" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx11209" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w11211"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w11215"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p">p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}unescape-p" class="solar"><span class="function" start="1" pair-end="15" select="quick">f:unescape-p</span></a><span class="parenthesis">(</span><span class="context" start="14">.</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span id="wx11232" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w11234"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$class</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w11246"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$p</span><span class="z">"</span><span id="wx11254" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx11258" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx11262" class="ec">&gt;</span></span><span class="txt">
      
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx11266" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx11270" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w11272"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}splitAttributeName">f:splitAttributeName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w11282"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span id="wx11290" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w11292"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(\S+)|(\s+)</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$text</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w11308"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w11312"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx11320" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx11324" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx11328" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx11332" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> css dark-theme: background color #002b36 = base 03 
   light-theme #fdf6e3 = base 3</span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w11338"><span class="es">&lt;</span><span class="en">css:theme</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w11342"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">@import url(http://fonts.googleapis.com/css?family=Source+Code+Pro);</span><span class="z">"</span><span id="wx11350" class="sc">/&gt;</span></span><span class="txt">
    p.spectrum, pre.spectrum {
        margin:0px;
        font-family: </span><span class="ww" id="w11352"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">'Source Code Pro', </span><span class="z">"</span><span id="wx11360" class="sc">/&gt;</span></span><span class="txt">monospace;
        </span><span class="ww" id="w11362"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">font-size: 0.8em;</span><span class="z">"</span><span id="wx11370" class="sc">/&gt;</span></span><span class="txt">
        white-space: pre-wrap;
        display: block;
        border: none thin;
        border-color: #405075;
        background-color:</span><span class="ww" id="w11372"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#002b36</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#white</span><span class="z">"</span><span id="wx11386" class="sc">/&gt;</span></span><span class="txt">;
    padding: 2px;
    margin-bottom:5px;
    }
    
    div.spectrum-toc {
        font-family: </span><span class="ww" id="w11388"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">'Source Code Pro', </span><span class="z">"</span><span id="wx11396" class="sc">/&gt;</span></span><span class="txt">monospace;
        </span><span class="ww" id="w11398"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">font-size: 0.8em;</span><span class="z">"</span><span id="wx11406" class="sc">/&gt;</span></span><span class="txt">
        display: block;
        border: none thin;
        border-color: #405075;
        background-color: </span><span class="ww" id="w11408"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#002b36</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#white</span><span class="z">"</span><span id="wx11422" class="sc">/&gt;</span></span><span class="txt">;
        padding: 2px;
    }
    
    ul.base1, ul.spectrum-toc {
        color:</span><span class="ww" id="w11424"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#93a1a1</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#586e75</span><span class="z">"</span><span id="wx11438" class="sc">/&gt;</span></span><span class="txt">;
    }
    
    .spectrum span {
        white-space: pre-wrap;
    }
    /*
    chosen theme background: </span><span class="ww" id="w11440"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">dark</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">light</span><span class="z">"</span><span id="wx11454" class="sc">/&gt;</span></span><span class="txt">;
    
    $base03:    #002b36; //background
    $base02:    #073642; //highlighted-background
    $base01:    #586e75;
    $base00:    #657b83;
    $base0:     #839496;
    $base1:     #93a1a1;
    $base2:     #eee8d5; //highlighted-background
    $base3:     #fdf6e3; //background
    $yellow:    #b58900;
    $orange:    #cb4b16;
    $red:       #dc322f;
    $magenta:   #d33682;
    $violet:    #6c71c4;
    $blue:      #268bd2;
    $cyan:      #2aa198;
    $green:     #859900;
    */
    
    /* solorized colors */
    span.base03 {
    color: #002b36;
    }
    span.base02 {
    color: #073642;
    }
    
    /* hover-effect [start] */
    span.base03, span.ww:not(:hover), span.txt:not(:hover), span.cm:not(:hover), span.pi:not(:hover)  {
    background-color: </span><span class="ww" id="w11456"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#002b36</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">white</span><span class="z">"</span><span id="wx11470" class="sc">/&gt;</span></span><span class="txt">;
    }
    span.ww {
    background-color: </span><span class="ww" id="w11472"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#00202e</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#fdf6e3</span><span class="z">"</span><span id="wx11486" class="sc">/&gt;</span></span><span class="txt">;
    }
    /* hover-effect [end] */
    
    span.base01, span.eq-equ, span.z, span.sc, span.scx, span.ec, span.es, span.ez, span.atneq {
    color: </span><span class="ww" id="w11488"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#586e75</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#93a1a1</span><span class="z">"</span><span id="wx11502" class="sc">/&gt;</span></span><span class="txt">;
    }
    span.base00 {
    color: #657b83;
    }
    span.base0, span.txt, span.cd {
    color: #839496;
    }
    span.base1, span.literal {
    color:</span><span class="ww" id="w11504"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#93a1a1</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#586e75</span><span class="z">"</span><span id="wx11518" class="sc">/&gt;</span></span><span class="txt">;
    }
    span.base2 {
        color: #eee8d5;
    }
    span.base3 {
        color: #fdf6e3;
    }
    span.yellow, span.op, span.type-op, span.if, span.higher, span.step {
        color: #b58900;
    }
    span.orange, span.function {
        color: #cb4b16;
    }
    span.red, span.fname, span.tname {
        color: #dc322f;
    }
    span.magenta, span.vname, span.variable, span.external {
        color: #d33682;
    }
    span.violet, span.qname, span.type-name, span.unclosed, span.en, span.cl, span.href, span.tcall {
        color: #6c71c4;
    }
    span.blue, span.enxsl, span.clxsl, span.enx, 
    span.filter, span.parenthesis, span.node{
        color: #268bd2;
    }
    span.cyan, span.atn, span.numeric, span.pi, span.dt, span.axis, span.context, span.bracedq {
        color: #2aa198;
    }
    span.green, span.cm, span.comment, span.av, span.type, span.node-type {
        color: #859900;
    }
    a.solar {
        text-decoration:none;
    }
  </span><span class="ez">&lt;/</span><span class="cl">css:theme</span><span id="wx11522" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> xpath-colorer </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w11528"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ops">ops</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">, / = &amp;lt; &amp;gt; + - * ? | != &amp;lt;= &amp;gt;= &amp;lt;&amp;lt; &amp;gt;&amp;gt; // := ! || { }</span><span class="op">'</span><span class="z">"</span><span id="wx11544" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11546"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?aOps">aOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">or and eq ne lt le gt ge is to div idiv mod union intersect except in return satisfies then else as</span><span class="op">'</span><span class="z">"</span><span id="wx11562" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11564"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?hOps">hOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">for some every let</span><span class="op">'</span><span class="z">"</span><span id="wx11580" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11582"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">attribute comment document-node namespace-node element node processing-instruction text</span><span class="op">'</span><span class="z">"</span><span id="wx11598" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11600"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?types">types</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">empty empty-sequence function item node schema-attribute schema-element type</span><span class="op">'</span><span class="z">"</span><span id="wx11616" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w11618"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ambiguousOps">ambiguousOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="21" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?aOps" class="solar"><span class="variable" start="10" select="quick">$aOps</span></a><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">\s+</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx11645" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11647"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?simpleOps">simpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="20" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?ops" class="solar"><span class="variable" start="10" select="quick">$ops</span></a><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">\s+</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx11674" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11676"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodeTests">nodeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="22" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?nodes" class="solar"><span class="variable" start="10" select="quick">$nodes</span></a><span class="op" start="16">,</span><span class="op">'</span><span class="literal" start="17">\s+</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx11703" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11705"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?typeTests">typeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="22" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?types" class="solar"><span class="variable" start="10" select="quick">$types</span></a><span class="op" start="16">,</span><span class="op">'</span><span class="literal" start="17">\s+</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx11732" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11734"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?higherOps">higherOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="21" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?hOps" class="solar"><span class="variable" start="10" select="quick">$hOps</span></a><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">\s+</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx11761" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w11763"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?bgColor">bgColor</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">black</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx11785" class="sc">/&gt;</span></span><span class="txt">
  
  
  </span><span class="z">&lt;!--</span><span class="cm">
  signature:
      loc:showXPath(text-content)
  
  description:
  
      Converts the xpath content string to a sequence of span elements. with each
      containing a class attribute used for coloring with CSS. 
  
  params:
     text-content: string containing a single XPath expression
  </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w11791"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}showXPath">loc:showXPath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w11801"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span id="wx11809" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w11811"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chars">chars</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}stringToCharSequence" class="solar"><span class="function" start="1" pair-end="32" select="quick">loc:stringToCharSequence</span></a><span class="parenthesis">(</span><span class="variable" start="26" select="quick">$chunk</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx11834" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w11836"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?blocks">blocks</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w11852"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createBlocks" class="solar"><span class="function" start="1" pair-end="46" select="quick">loc:createBlocks</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chars</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="26" pair-end="32" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="32">)</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">1</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"></span><span class="op">'</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="numeric" start="42">0</span><span class="op" start="43">,</span><span class="whitespace" start="44"> </span><span class="numeric" start="45">0</span><span class="parenthesis" start="46">)</span><span class="z">"</span><span id="wx11882" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx11886" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w11888"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createPairs" class="solar"><span class="function" start="1" pair-end="72" select="quick">loc:createPairs</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$blocks</span><span class="filter" start="24" pair-end="71" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="25" pair-end="30" select="quick">name</span></a><span class="parenthesis">(</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">=</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">block</span><span class="op">'</span><span class="whitespace" start="41"> </span><span class="op" start="42">and</span><span class="whitespace" start="45"> </span><span class="axis" start="46">@</span><span class="qname" start="47" select="quick">type</span><span class="whitespace" start="51"> </span><span class="op" start="52">=</span><span class="whitespace" start="53"> </span><span class="parenthesis" start="54" pair-end="70" select="quick">(</span><span class="op">'</span><span class="literal" start="55">[</span><span class="op">'</span><span class="op" start="58">,</span><span class="op">'</span><span class="literal" start="59">]</span><span class="op">'</span><span class="op" start="62">,</span><span class="op">'</span><span class="literal" start="63">(</span><span class="op">'</span><span class="op" start="66">,</span><span class="op">'</span><span class="literal" start="67">)</span><span class="op">'</span><span class="parenthesis" start="70">)</span><span class="filter" start="71">]</span><span class="parenthesis" start="72">)</span><span class="z">"</span><span id="wx11947" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w11949"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?omitPairs">omitPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="41" select="quick">(</span><span class="variable" start="2" select="quick">$blocks</span><span class="filter" start="9" pair-end="40" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="10" pair-end="15" select="quick">name</span></a><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">=</span><span class="whitespace" start="18"> </span><span class="parenthesis" start="19" pair-end="39" select="quick">(</span><span class="op">'</span><span class="literal" start="20">literal</span><span class="op">'</span><span class="op" start="29">,</span><span class="op">'</span><span class="literal" start="30">comment</span><span class="op">'</span><span class="parenthesis" start="39">)</span><span class="filter" start="40">]</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span id="wx11988" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w11990"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w12006"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}getTokens" class="solar"><span class="function" start="1" pair-end="43" select="quick">loc:getTokens</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$chunk</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$omitPairs</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$pbPairs</span><span class="parenthesis" start="43">)</span><span class="z">"</span><span id="wx12023" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx12027" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w12029"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?plain" class="solar"><span class="tcall">plain</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w12039"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">para</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="z">"</span><span id="wx12053" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx12057" class="ec">&gt;</span></span><span class="txt">
    
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx12061" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="z">&lt;!--</span><span class="cm"> //////////////////////////////////////////////////////////////////////////////////////////////// </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> 
   Sample output:
  &lt;block position="3" type="["/&gt;
  &lt;literal type="'" start="54" end="61"/&gt;
  &lt;comment start="65" end="69"/&gt;
  &lt;comment start="76"/&gt; // if not closed
   </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> diagnostic formatting function - not used </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w12075"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}pad">loc:pad</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w12091"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padStringIn">padStringIn</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx12105" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12107"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fixedWidth">fixedWidth</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12121" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12123"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padString">padString</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="33" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$padStringIn</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">\n</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">\\n</span><span class="op">'</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span id="wx12155" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12157"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stringLength">stringLength</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="25" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$padString</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span id="wx12180" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12182"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padChar">padChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="22" select="quick">(</span><span class="variable" start="5" select="quick">$fixedWidth</span><span class="whitespace" start="16"> </span><span class="op" start="17">gt</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">20</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">then</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">.</span><span class="op">'</span><span class="whitespace" start="32"> </span><span class="op" start="33">else</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"> </span><span class="op">'</span><span class="z">"</span><span id="wx12216" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12218"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padCount">padCount</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$fixedWidth</span><span class="whitespace" start="12"> </span><span class="op" start="13">-</span><span class="whitespace" start="14"> </span><span class="variable" start="15" select="quick">$stringLength</span><span class="z">"</span><span id="wx12242" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12244"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">ge</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w12258"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="77" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$padString</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="20" pair-end="76" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="32">for</span><span class="whitespace" start="35"> </span><span id="rng-$i" class="variable" start="36" select="quick">$i</span><span class="whitespace" start="38"> </span><span class="op" start="39">in</span><span class="whitespace" start="41"> </span><span class="numeric" start="42">1</span><span class="whitespace" start="43"> </span><span class="op" start="44">to</span><span class="whitespace" start="46"> </span><span class="variable" start="47" select="quick">$padCount</span><span class="whitespace" start="56"> 
                            </span><span class="op" start="58">return</span><span class="whitespace" start="64"> </span><span class="variable" start="65" select="quick">$padChar</span><span class="op" start="73">,</span><span class="op">'</span><span class="literal" start="74"></span><span class="op">'</span><span class="parenthesis" start="76">)</span><span class="parenthesis" start="77">)</span><span class="z">"</span><span id="wx12293" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx12297" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12299"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">lt</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w12313"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="92" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$padString</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">&amp;#10;</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28"> </span><span class="op">'</span><span class="op" start="31">,</span><span class="whitespace" start="32"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="33" pair-end="91" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="45">for</span><span class="whitespace" start="48"> </span><span id="rng-$i" class="variable" start="49" select="quick">$i</span><span class="whitespace" start="51"> </span><span class="op" start="52">in</span><span class="whitespace" start="54"> </span><span class="numeric" start="55">1</span><span class="whitespace" start="56"> </span><span class="op" start="57">to</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$fixedWidth</span><span class="whitespace" start="71"> 
                            </span><span class="op" start="73">return</span><span class="whitespace" start="79"> </span><span class="variable" start="80" select="quick">$padChar</span><span class="op" start="88">,</span><span class="op">'</span><span class="literal" start="89"></span><span class="op">'</span><span class="parenthesis" start="91">)</span><span class="parenthesis" start="92">)</span><span class="z">"</span><span id="wx12357" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx12361" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx12365" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w12367"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?plain">plain</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w12377"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?para">para</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx12391" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w12393"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?total">total</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="12" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$para</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12416" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w12418"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="whitespace" start="2"> </span><span class="op" start="3">to</span><span class="whitespace" start="5"> </span><span class="variable" start="6" select="quick">$total</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w12432"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx12446" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w12448"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="13" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="filter" start="13">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w12461"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isJoined">isJoined</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">gt</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="whitespace" start="27"> </span><span class="op" start="28">and</span><span class="whitespace" start="31"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="32" pair-end="53" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="axis" start="42">@</span><span class="qname" start="43" select="quick">value</span><span class="op" start="48">,</span><span class="whitespace" start="49"> </span><span class="op">'</span><span class="literal" start="50">(</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx12502" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w12504"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isLiteral">isLiteral</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="17" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">type</span><span class="parenthesis" start="16">)</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">then</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="24" pair-end="30" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><span class="axis" start="37">@</span><span class="qname" start="38" select="quick">type</span><span class="whitespace" start="42"> </span><span class="op" start="43">eq</span><span class="whitespace" start="45"> </span><span class="op">'</span><span class="literal" start="46">literal</span><span class="op">'</span><span class="z">"</span><span id="wx12549" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w12551"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?literalQuote">literalQuote</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="23" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">value</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">1</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">1</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx12575" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w12577"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isLiteral</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w12587"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w12597"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$literalQuote</span><span class="z">"</span><span id="wx12605" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx12609" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx12613" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w12615"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
          
          </span><span class="ww" id="w12619"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="whitespace" start="6"> </span><span class="op" start="7">eq</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">variable</span><span class="op">'</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$index</span><span class="whitespace" start="31"> </span><span class="op" start="32">+</span><span class="whitespace" start="33"> </span><span class="numeric" start="34">2</span><span class="whitespace" start="35"> </span><span class="op" start="36">lt</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$total</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w12648"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="17" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="whitespace" start="13"> </span><span class="op" start="14">+</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">1</span><span class="filter" start="17">]</span><span class="step" start="18">/</span><span class="axis" start="19">@</span><span class="qname" start="20" select="quick">type</span><span class="whitespace" start="24"> </span><span class="op" start="25">eq</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">whitespace</span><span class="op">'</span><span class="whitespace" start="40"> </span><span class="op" start="41">and</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$para</span><span class="filter" start="50" pair-end="61" select="quick">[</span><span class="variable" start="51" select="quick">$index</span><span class="whitespace" start="57"> </span><span class="op" start="58">+</span><span class="whitespace" start="59"> </span><span class="numeric" start="60">2</span><span class="filter" start="61">]</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">value</span><span class="whitespace" start="69"> </span><span class="op" start="70">eq</span><span class="whitespace" start="72"> </span><span class="op">'</span><span class="literal" start="73">in</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w12694"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="21" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">rng-</span><span class="op">'</span><span class="op" start="14">,</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx12716" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx12720" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx12724" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w12726"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?className">className</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w12736"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w12740"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w12754"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="96" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">type</span><span class="whitespace" start="10"> </span><span class="op" start="11">eq</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">literal</span><span class="op">'</span><span class="whitespace" start="23"> </span><span class="op" start="24">and</span><span class="whitespace" start="27">
                                      </span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="28" pair-end="95" select="quick">matches</span></a><span class="parenthesis">(</span><span class="axis" start="36">@</span><span class="qname" start="37" select="quick">value</span><span class="whitespace" start="42"> </span><span class="op" start="43">,</span><span class="op">'</span><span class="literal" start="44">select[\s\p{Zs}]*=[\s\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]</span><span class="op">'</span><span class="parenthesis" start="95">)</span><span class="parenthesis" start="96">)</span><span class="whitespace" start="97">
                                      </span><span class="op" start="98">then</span><span class="whitespace" start="102"> </span><span class="op">'</span><span class="literal" start="103">select</span><span class="op">'</span><span class="whitespace" start="111">
                                      </span><span class="op" start="112">else</span><span class="whitespace" start="116"> </span><span class="axis" start="117">@</span><span class="qname" start="118" select="quick">type</span><span class="z">"</span><span id="wx12797" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx12801" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w12803"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w12807"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p">p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="17" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="whitespace" start="13"> </span><span class="op" start="14">-</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">1</span><span class="filter" start="17">]</span><span class="whitespace" start="18"> </span><span class="z">"</span><span id="wx12829" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w12831"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="100" select="quick">(</span><span class="variable" start="5" select="quick">$p</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">eq</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">literal</span><span class="op">'</span><span class="whitespace" start="26"> </span><span class="op" start="27">and</span><span class="whitespace" start="30">
                                      </span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="31" pair-end="99" select="quick">matches</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$p</span><span class="step" start="41">/</span><span class="axis" start="42">@</span><span class="qname" start="43" select="quick">value</span><span class="whitespace" start="48"> </span><span class="op" start="49">,</span><span class="op">'</span><span class="literal" start="50">name[\s\p{Zs}]*=[\s\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]</span><span class="op">'</span><span class="parenthesis" start="99">)</span><span class="parenthesis" start="100">)</span><span class="whitespace" start="101">
                                      </span><span class="op" start="102">then</span><span class="whitespace" start="106"> </span><span class="op">'</span><span class="literal" start="107">external</span><span class="op">'</span><span class="whitespace" start="117">
                                      </span><span class="op" start="118">else</span><span class="whitespace" start="122"> </span><span class="op">'</span><span class="literal" start="123">qname</span><span class="op">'</span><span class="z">"</span><span id="wx12879" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx12883" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx12887" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx12891" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w12893"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$className</span><span class="z">"</span><span id="wx12907" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w12909"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$className</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">external</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w12925"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="21" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">ext-</span><span class="op">'</span><span class="op" start="14">,</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx12947" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx12951" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w12953"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx12968" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w12970"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="43" select="quick">(</span><span class="axis" start="2">@</span><span class="qname" start="3" select="quick">value</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="parenthesis" start="11" pair-end="19" select="quick">(</span><span class="op">'</span><span class="literal" start="12">(</span><span class="op">'</span><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">[</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">or</span><span class="whitespace" start="23"> </span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">type</span><span class="whitespace" start="29"> </span><span class="op" start="30">eq</span><span class="whitespace" start="32"> </span><span class="op">'</span><span class="literal" start="33">function</span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="whitespace" start="44"> </span><span class="op" start="45">and</span><span class="whitespace" start="48"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="49" pair-end="62" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="53">@</span><span class="qname" start="54" select="quick">pair-end</span><span class="parenthesis" start="62">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w13014"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">color: pink;</span><span class="op">'</span><span class="z">"</span><span id="wx13030" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13034" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w13036"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">pair-end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w13047"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pair-end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">pair-end</span><span class="z">"</span><span id="wx13062" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13066" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w13068"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="10" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">type</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">or</span><span class="whitespace" start="14"> 
                        </span><span class="parenthesis" start="16" pair-end="78" select="quick">(</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">type</span><span class="whitespace" start="22"> </span><span class="op" start="23">=</span><span class="whitespace" start="24"> </span><span class="parenthesis" start="25" pair-end="77" select="quick">(</span><span class="op">'</span><span class="literal" start="26">function</span><span class="op">'</span><span class="op" start="36">,</span><span class="op">'</span><span class="literal" start="37">filter</span><span class="op">'</span><span class="op" start="45">,</span><span class="op">'</span><span class="literal" start="46">parenthesis</span><span class="op">'</span><span class="op" start="59">,</span><span class="op">'</span><span class="literal" start="60">variable</span><span class="op">'</span><span class="op" start="70">,</span><span class="op">'</span><span class="literal" start="71">node</span><span class="op">'</span><span class="parenthesis" start="77">)</span><span class="parenthesis" start="78">)</span><span class="whitespace" start="79"> </span><span class="op" start="80">and</span><span class="whitespace" start="83"> </span><span class="parenthesis" start="84" pair-end="108" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="85" pair-end="107" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="89">@</span><span class="qname" start="90" select="quick">value</span><span class="whitespace" start="95"> </span><span class="op" start="96">=</span><span class="whitespace" start="97"> </span><span class="parenthesis" start="98" pair-end="106" select="quick">(</span><span class="op">'</span><span class="literal" start="99">)</span><span class="op">'</span><span class="op" start="102">,</span><span class="op">'</span><span class="literal" start="103">]</span><span class="op">'</span><span class="parenthesis" start="106">)</span><span class="parenthesis" start="107">)</span><span class="parenthesis" start="108">)</span><span class="whitespace" start="109"> </span><span class="op" start="110">or</span><span class="whitespace" start="112">
                        </span><span class="parenthesis" start="113" pair-end="166" select="quick">(</span><span class="axis" start="114">@</span><span class="qname" start="115" select="quick">value</span><span class="whitespace" start="120"> </span><span class="op" start="121">eq</span><span class="whitespace" start="123"> </span><span class="op">'</span><span class="literal" start="124">*</span><span class="op">'</span><span class="whitespace" start="127"> </span><span class="op" start="128">and</span><span class="whitespace" start="131"> </span><span class="variable" start="132" select="quick">$para</span><span class="filter" start="137" pair-end="148" select="quick">[</span><span class="variable" start="138" select="quick">$index</span><span class="whitespace" start="144"> </span><span class="op" start="145">-</span><span class="whitespace" start="146"> </span><span class="numeric" start="147">1</span><span class="filter" start="148">]</span><span class="step" start="149">/</span><span class="axis" start="150">@</span><span class="qname" start="151" select="quick">class</span><span class="whitespace" start="156"> </span><span class="op" start="157">eq</span><span class="whitespace" start="159"> </span><span class="op">'</span><span class="literal" start="160">axis</span><span class="op">'</span><span class="parenthesis" start="166">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w13168"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">select</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">quick</span><span class="op">'</span><span class="z">"</span><span id="wx13184" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13188" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="z">&lt;!--</span><span class="cm">
          &lt;xsl:choose&gt;
          &lt;xsl:when test="@type = ('literal','comment')"&gt;
          &lt;xsl:analyze-string 
          select="if ($isLiteral) then substring(@value, 2, string-length(@value) - 2)
          else @value" regex="\n"&gt;
          &lt;xsl:matching-substring&gt;
          &lt;br&gt;&lt;/br&gt;
          &lt;/xsl:matching-substring&gt;
          &lt;xsl:non-matching-substring&gt;
          &lt;xsl:value-of select="."/&gt;
          &lt;/xsl:non-matching-substring&gt;
          &lt;/xsl:analyze-string&gt;
          &lt;/xsl:when&gt;
          &lt;xsl:otherwise&gt;
          &lt;xsl:value-of select="if ($isJoined) then substring(@value, 1, string-length(@value) - 1) else @value"/&gt;
          &lt;/xsl:otherwise&gt;
          &lt;/xsl:choose&gt;
          </span><span class="z">--&gt;</span><span class="txt">
          
          </span><span class="ww" id="w13194"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w13198"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="parenthesis" start="9" pair-end="29" select="quick">(</span><span class="op">'</span><span class="literal" start="10">literal</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">comment</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w13221"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><span class="variable" start="5" select="quick">$isLiteral</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="22" pair-end="68" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="32">@</span><span class="qname" start="33" select="quick">value</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="numeric" start="40">2</span><span class="op" start="41">,</span><span class="whitespace" start="42"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="43" pair-end="63" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="axis" start="57">@</span><span class="qname" start="58" select="quick">value</span><span class="parenthesis" start="63">)</span><span class="whitespace" start="64"> </span><span class="op" start="65">-</span><span class="whitespace" start="66"> </span><span class="numeric" start="67">2</span><span class="parenthesis" start="68">)</span><span class="whitespace" start="69">
                                    </span><span class="op" start="70">else</span><span class="whitespace" start="74"> </span><span class="axis" start="75">@</span><span class="qname" start="76" select="quick">value</span><span class="z">"</span><span id="wx13260" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13264" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w13266"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w13270"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="14" select="quick">(</span><span class="variable" start="5" select="quick">$isJoined</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">then</span><span class="whitespace" start="20"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="21" pair-end="67" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="31">@</span><span class="qname" start="32" select="quick">value</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="numeric" start="39">1</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="42" pair-end="62" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="axis" start="56">@</span><span class="qname" start="57" select="quick">value</span><span class="parenthesis" start="62">)</span><span class="whitespace" start="63"> </span><span class="op" start="64">-</span><span class="whitespace" start="65"> </span><span class="numeric" start="66">1</span><span class="parenthesis" start="67">)</span><span class="whitespace" start="68"> </span><span class="op" start="69">else</span><span class="whitespace" start="73"> </span><span class="axis" start="74">@</span><span class="qname" start="75" select="quick">value</span><span class="z">"</span><span id="wx13309" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx13313" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx13317" class="ec">&gt;</span></span><span class="txt">
          
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx13321" class="ec">&gt;</span></span><span class="txt">
        
        
        </span><span class="ww" id="w13323"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isJoined</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w13333"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">parenthesis</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w13343"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">(</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx13349" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx13353" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13357" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w13359"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isLiteral</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w13369"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w13379"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$literalQuote</span><span class="z">"</span><span id="wx13387" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx13391" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13395" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx13399" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx13403" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx13407" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w13409"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">token</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">plainLine</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w13425"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w13429"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="z">"</span><span id="wx13444" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w13446"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx13461" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w13463"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?revChars">revChars</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-reverse" class="solar"><span class="function" start="1" pair-end="37" select="quick">reverse</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-to-codepoints" class="solar"><span class="function" start="9" pair-end="36" select="quick">string-to-codepoints</span></a><span class="parenthesis">(</span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">value</span><span class="parenthesis" start="36">)</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer*</span><span class="z">"</span><span id="wx13490" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w13492"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?lastLF">lastLF</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="16" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$revChars</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">+</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">1</span><span class="whitespace" start="21"> </span><span class="op" start="22">-</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-index-of" class="solar"><span class="function" start="24" pair-end="46" select="quick">index-of</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$revChars</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="numeric" start="44">10</span><span class="parenthesis" start="46">)</span><span class="filter" start="47" pair-end="49" select="quick">[</span><span class="numeric" start="48">1</span><span class="filter" start="49">]</span><span class="z">"</span><span id="wx13526" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w13528"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="30" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">value</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$lastLF</span><span class="whitespace" start="26"> </span><span class="op" start="27">+</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx13547" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx13551" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx13555" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w13557"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">token</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">dev</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w13573"><span class="es">&lt;</span><span class="en">p</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w13577"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx13586" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">p</span><span id="wx13590" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx13594" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w13596"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}stringToCharSequence">loc:stringToCharSequence</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w13612"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?string">string</span><span class="z">"</span><span id="wx13620" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w13622"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$i" class="variable" start="5" select="quick">$i</span><span class="whitespace" start="7"> </span><span class="op" start="8">in</span><span class="whitespace" start="10"> </span><span class="numeric" start="11">1</span><span class="whitespace" start="12"> </span><span class="op" start="13">to</span><span class="whitespace" start="15"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="16" pair-end="37" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="30" select="quick">$string</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">
                          </span><span class="op" start="39">return</span><span class="whitespace" start="45"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="46" pair-end="70" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="56" select="quick">$string</span><span class="op" start="63">,</span><span class="whitespace" start="64"> </span><span class="variable" start="65" select="quick">$i</span><span class="op" start="67">,</span><span class="whitespace" start="68"> </span><span class="numeric" start="69">1</span><span class="parenthesis" start="70">)</span><span class="z">"</span><span id="wx13656" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx13660" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w13662"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createPairs">loc:createPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w13678"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?brackets">brackets</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx13692" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w13694"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nested">nested</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w13710"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?getNesting" class="solar"><span class="tcall">getNesting</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w13720"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">positions</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$brackets</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx13746" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w13748"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx13768" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w13770"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx13790" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx13794" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx13798" class="ec">&gt;</span></span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm">  pair up start and end elements </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w13804"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ends">ends</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nested</span><span class="filter" start="8" pair-end="13" select="quick">[</span><span class="axis" start="9">@</span><span class="qname" start="10" select="quick">end</span><span class="filter" start="13">]</span><span class="z">"</span><span id="wx13822" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w13824"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nested</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="axis" start="9">@</span><span class="qname" start="10" select="quick">start</span><span class="filter" start="15">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w13838"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx13859" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w13861"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">level</span><span class="z">"</span><span id="wx13876" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w13878"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pair">pair</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="24" select="quick">(</span><span class="variable" start="2" select="quick">$ends</span><span class="filter" start="7" pair-end="23" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">level</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$level</span><span class="filter" start="23">]</span><span class="parenthesis" start="24">)</span><span class="filter" start="25" pair-end="47" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="26" pair-end="37" select="quick">number</span></a><span class="parenthesis">(</span><span class="axis" start="33">@</span><span class="qname" start="34" select="quick">end</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38"> </span><span class="op" start="39">&gt;</span><span class="whitespace" start="40"> </span><span class="variable" start="41" select="quick">$start</span><span class="filter" start="47">]</span><span class="filter" start="48" pair-end="50" select="quick">[</span><span class="numeric" start="49">1</span><span class="filter" start="50">]</span><span class="z">"</span><span class="z">
                    </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx13922" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w13924"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="7" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="6">.</span><span class="parenthesis" start="7">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w13939"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx13953" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w13955"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx13969" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w13971"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w13981"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span id="wx13998" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx14002" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx14006" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx14010" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx14014" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w14016"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?getNesting">getNesting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w14026"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?positions">positions</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx14040" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14042"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14056" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14058"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14072" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w14074"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pos">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$positions</span><span class="filter" start="11" pair-end="18" select="quick">[</span><span class="variable" start="12" select="quick">$index</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx14091" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14093"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isOpen">isOpen</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="28" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">[</span><span class="op">'</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">(:</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx14133" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14135"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isBracket">isBracket</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="22" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">)</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx14170" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14172"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isComment">isComment</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="24" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(:</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">:)</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx14207" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14209"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?blockType">blockType</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="14">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$isBracket</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">then</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">bracket</span><span class="op">'</span><span class="whitespace" start="30">
                                           </span><span class="op" start="31">else</span><span class="whitespace" start="35"> </span><span class="if" start="36" pair-end="49">if</span><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$isComment</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50"> </span><span class="op" start="51">then</span><span class="whitespace" start="55"> </span><span class="op">'</span><span class="literal" start="56">comment</span><span class="op">'</span><span class="whitespace" start="65">
                                           </span><span class="op" start="66">else</span><span class="whitespace" start="70"> </span><span class="op">'</span><span class="literal" start="71">predicate</span><span class="op">'</span><span class="z">"</span><span id="wx14251" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14253"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="11">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$isOpen</span><span class="parenthesis" start="11">)</span><span class="whitespace" start="12"> </span><span class="op" start="13">then</span><span class="whitespace" start="17">
                                          </span><span class="variable" start="18" select="quick">$level</span><span class="whitespace" start="24"> </span><span class="op" start="25">+</span><span class="whitespace" start="26"> </span><span class="numeric" start="27">1</span><span class="whitespace" start="28"> </span><span class="op" start="29">else</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$level</span><span class="whitespace" start="40"> </span><span class="op" start="41">-</span><span class="whitespace" start="42"> </span><span class="numeric" start="43">1</span><span class="z">"</span><span id="wx14286" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w14288"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w14292"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$pos</span><span class="parenthesis" start="11">)</span><span class="z">"</span><span id="wx14303" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w14305"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isOpen</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w14315"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$blockType</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w14327"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">position</span><span class="z">"</span><span id="wx14344" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w14346"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newLevel</span><span class="z">"</span><span id="wx14360" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx14364" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14368" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w14370"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w14374"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$blockType</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w14386"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">position</span><span class="z">"</span><span id="wx14403" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w14405"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx14419" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx14423" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx14427" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx14431" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w14433"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w14437"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">&gt;</span><span class="whitespace" start="13"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="14" pair-end="30" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$positions</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx14456" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w14458"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w14462"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?getNesting" class="solar"><span class="tcall">getNesting</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w14472"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14492" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w14494"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14518" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx14522" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx14526" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx14530" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx14534" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w14536"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createBlocks">loc:createBlocks</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w14552"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chars">chars</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx14566" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14568"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?skip">skip</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx14582" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14584"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14598" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14600"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?awaiting">awaiting</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx14614" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14616"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14630" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14632"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14646" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w14648"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?charCount">charCount</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="13" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$chars</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx14665" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w14667"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char">char</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx14684" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14686"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nChar">nChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">+</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx14707" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w14709"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pChar">pChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">-</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx14730" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w14732"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w14748"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w14752"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w14768"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="32">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$char</span><span class="whitespace" start="9"> </span><span class="op" start="10">=</span><span class="whitespace" start="11"> </span><span class="op">'</span><span class="literal" start="12">(</span><span class="op">'</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$nChar</span><span class="whitespace" start="26"> </span><span class="op" start="27">=</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">:</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="whitespace" start="33"> </span><span class="op" start="34">then</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$level</span><span class="whitespace" start="45"> </span><span class="op" start="46">+</span><span class="whitespace" start="47"> </span><span class="numeric" start="48">1</span><span class="whitespace" start="49">
                                </span><span class="op" start="50">else</span><span class="whitespace" start="54"> </span><span class="if" start="55">if</span><span class="whitespace" start="57"> </span><span class="parenthesis" start="58" pair-end="103" select="quick">(</span><span class="variable" start="59" select="quick">$char</span><span class="whitespace" start="64"> </span><span class="op" start="65">=</span><span class="whitespace" start="66"> </span><span class="op">'</span><span class="literal" start="67">)</span><span class="op">'</span><span class="whitespace" start="70"> </span><span class="op" start="71">and</span><span class="whitespace" start="74"> </span><span class="variable" start="75" select="quick">$pChar</span><span class="whitespace" start="81"> </span><span class="op" start="82">=</span><span class="whitespace" start="83"> </span><span class="op">'</span><span class="literal" start="84">:</span><span class="op">'</span><span class="whitespace" start="87"> </span><span class="op" start="88">and</span><span class="whitespace" start="91"> </span><span class="variable" start="92" select="quick">$level</span><span class="whitespace" start="98"> </span><span class="op" start="99">gt</span><span class="whitespace" start="101"> </span><span class="numeric" start="102">0</span><span class="parenthesis" start="103">)</span><span class="whitespace" start="104"> </span><span class="op" start="105">then</span><span class="whitespace" start="109"> </span><span class="variable" start="110" select="quick">$level</span><span class="whitespace" start="116"> </span><span class="numeric" start="117">-1</span><span class="whitespace" start="119">
                                </span><span class="op" start="120">else</span><span class="whitespace" start="124"> </span><span class="variable" start="125" select="quick">$level</span><span class="z">"</span><span id="wx14845" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14849" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w14851"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w14855"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx14863" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx14867" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx14871" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx14875" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w14877"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nowAwaiting">nowAwaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w14887"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w14891"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="op" start="10">=</span><span class="op">'</span><span class="literal" start="11"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w14905"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="37">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$char</span><span class="whitespace" start="9"> </span><span class="op" start="10">=</span><span class="whitespace" start="11"> </span><span class="parenthesis" start="12" pair-end="36" select="quick">(</span><span class="op">'</span><span class="literal" start="13">&amp;apos;&amp;apos;</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">&amp;quot;</span><span class="op">'</span><span class="parenthesis" start="36">)</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">
                                </span><span class="op" start="39">then</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$char</span><span class="whitespace" start="49"> 
                                </span><span class="op" start="51">else</span><span class="whitespace" start="55"> </span><span class="if" start="56">if</span><span class="whitespace" start="58"> </span><span class="parenthesis" start="59" pair-end="88" select="quick">(</span><span class="variable" start="60" select="quick">$char</span><span class="whitespace" start="65"> </span><span class="op" start="66">=</span><span class="whitespace" start="67"> </span><span class="op">'</span><span class="literal" start="68">(</span><span class="op">'</span><span class="whitespace" start="71"> </span><span class="op" start="72">and</span><span class="whitespace" start="75"> </span><span class="variable" start="76" select="quick">$nChar</span><span class="whitespace" start="82"> </span><span class="op" start="83">=</span><span class="whitespace" start="84"> </span><span class="op">'</span><span class="literal" start="85">:</span><span class="op">'</span><span class="parenthesis" start="88">)</span><span class="whitespace" start="89"> </span><span class="op" start="90">then</span><span class="whitespace" start="94"> </span><span class="op">'</span><span class="literal" start="95">:)</span><span class="op">'</span><span class="whitespace" start="99"> 
                                </span><span class="op" start="101">else</span><span class="whitespace" start="105"> </span><span class="op">'</span><span class="literal" start="106"></span><span class="op">'</span><span class="z">"</span><span id="wx14968" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14972" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w14974"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$awaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w14988"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx14998" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15002" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w15004"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">:)</span><span class="op">'</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$char</span><span class="whitespace" start="27"> </span><span class="op" start="28">=</span><span class="whitespace" start="29"> </span><span class="op">'</span><span class="literal" start="30">)</span><span class="op">'</span><span class="whitespace" start="33"> </span><span class="op" start="34">and</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$pChar</span><span class="whitespace" start="44"> </span><span class="op" start="45">=</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47">:</span><span class="op">'</span><span class="whitespace" start="50"> </span><span class="op" start="51">and</span><span class="whitespace" start="54"> </span><span class="variable" start="55" select="quick">$level</span><span class="whitespace" start="61"> </span><span class="op" start="62">=</span><span class="whitespace" start="63"> </span><span class="numeric" start="64">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w15048"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx15058" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15062" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w15064"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w15068"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span id="wx15076" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx15080" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx15084" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx15088" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w15090"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nowSkip">nowSkip</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w15106"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w15110"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$skip</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w15120"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx15130" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15134" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w15136"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$awaiting</span><span class="whitespace" start="18"> </span><span class="op" start="19">and</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$nChar</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$char</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w15158"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="1" pair-end="6" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx15168" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15172" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w15174"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w15178"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx15188" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx15192" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx15196" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx15200" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w15202"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13"></span><span class="op">'</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$nowAwaiting</span><span class="whitespace" start="32"> </span><span class="op" start="33">=</span><span class="whitespace" start="34"> </span><span class="op">'</span><span class="literal" start="35"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w15228"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="parenthesis" start="9" pair-end="25" select="quick">(</span><span class="op">'</span><span class="literal" start="10">[</span><span class="op">'</span><span class="op" start="13">,</span><span class="op">'</span><span class="literal" start="14">]</span><span class="op">'</span><span class="op" start="17">,</span><span class="op">'</span><span class="literal" start="18">(</span><span class="op">'</span><span class="op" start="21">,</span><span class="op">'</span><span class="literal" start="22">)</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w15258"><span class="es">&lt;</span><span class="en">block</span><span class="z"> </span><span class="atn">position</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$index</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$char</span><span class="op">}</span><span class="z">"</span><span id="wx15276" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15280" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15284" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w15286"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isFound">isFound</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="29" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$nowAwaiting</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">and</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="35" pair-end="56" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$skip</span><span class="whitespace" start="44"> </span><span class="op" start="45">or</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$nowSkip</span><span class="parenthesis" start="56">)</span><span class="z">"</span><span id="wx15324" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w15326"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newStart">newStart</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="13" select="quick">(</span><span class="variable" start="5" select="quick">$isFound</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">then</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$index</span><span class="whitespace" start="26"> </span><span class="op" start="27">else</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$start</span><span class="z">"</span><span id="wx15358" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w15360"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$isFound</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w15380"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">:)</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">comment</span><span class="op">'</span><span class="whitespace" start="37"> </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">literal</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w15414"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w15430"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="z">"</span><span id="wx15444" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15448" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w15450"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx15464" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w15466"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="z">"</span><span id="wx15480" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx15484" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15488" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w15490"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w15494"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="variable" start="11" select="quick">$charCount</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w15508"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="21" pair-end="33" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$isFound</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w15531"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">:)</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">comment</span><span class="op">'</span><span class="whitespace" start="37"> </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">literal</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w15565"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w15581"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span id="wx15595" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15599" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w15601"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx15615" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx15619" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15623" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15627" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w15629"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w15633"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createBlocks" class="solar"><span class="function" start="1" pair-end="82" select="quick">loc:createBlocks</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chars</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$nowSkip</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="variable" start="36" select="quick">$index</span><span class="whitespace" start="42"> </span><span class="op" start="43">+</span><span class="whitespace" start="44"> </span><span class="numeric" start="45">1</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$nowAwaiting</span><span class="op" start="60">,</span><span class="whitespace" start="61"> </span><span class="variable" start="62" select="quick">$newStart</span><span class="op" start="71">,</span><span class="whitespace" start="72"> </span><span class="variable" start="73" select="quick">$newLevel</span><span class="parenthesis" start="82">)</span><span class="z">"</span><span id="wx15663" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx15667" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx15671" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx15675" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> top-level call - marks up tokens with their type </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w15681"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}getTokens">loc:getTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w15691"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx15705" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15707"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?omitPairs">omitPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx15721" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15723"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx15737" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15739"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createTokens" class="solar"><span class="function" start="1" pair-end="42" select="quick">loc:createTokens</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chunk</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$omitPairs</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="numeric" start="38">1</span><span class="op" start="39">,</span><span class="whitespace" start="40"> </span><span class="numeric" start="41">1</span><span class="parenthesis" start="42">)</span><span class="z">"</span><span id="wx15771" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w15773"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}rationalizeTokens" class="solar"><span class="function" start="1" pair-end="70" select="quick">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$tokens</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="numeric" start="32">1</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="35" pair-end="41" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$pbPairs</span><span class="op" start="52">,</span><span class="whitespace" start="53"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="54" pair-end="60" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="60">)</span><span class="op" start="61">,</span><span class="whitespace" start="62"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="63" pair-end="69" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="69">)</span><span class="parenthesis" start="70">)</span><span class="z">"</span><span id="wx15805" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx15809" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="ww" id="w15811"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}rationalizeTokens">loc:rationalizeTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w15821"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx15835" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15837"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx15851" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15853"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevIsClosed">prevIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx15867" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15869"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx15883" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15885"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?typeExpected">typeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx15899" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15901"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?quantifierExpected">quantifierExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx15915" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> when closed, a probable operator is a QName instead </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w15921"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx15944" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15946"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isQuantifier">isQuantifier</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$quantifierExpected</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$token</span><span class="step" start="31">/</span><span class="axis" start="32">@</span><span class="qname" start="33" select="quick">value</span><span class="whitespace" start="38"> </span><span class="op" start="39">=</span><span class="whitespace" start="40"> </span><span class="parenthesis" start="41" pair-end="53" select="quick">(</span><span class="op">'</span><span class="literal" start="42">?</span><span class="op">'</span><span class="op" start="45">,</span><span class="op">'</span><span class="literal" start="46">*</span><span class="op">'</span><span class="op" start="49">,</span><span class="op">'</span><span class="literal" start="50">+</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx15983" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w15985"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?currentIsClosed">currentIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isQuantifier</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="18" pair-end="34" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$token</span><span class="step" start="28">/</span><span class="axis" start="29">@</span><span class="qname" start="30" select="quick">type</span><span class="parenthesis" start="34">)</span><span class="whitespace" start="35"> </span><span class="op" start="36">or</span><span class="whitespace" start="38"> </span><span class="parenthesis" start="39" pair-end="134" select="quick">(</span><span class="variable" start="40" select="quick">$token</span><span class="step" start="46">/</span><span class="axis" start="47">@</span><span class="qname" start="48" select="quick">value</span><span class="whitespace" start="53"> </span><span class="op" start="54">=</span><span class="whitespace" start="55"> </span><span class="parenthesis" start="56" pair-end="69" select="quick">(</span><span class="op">'</span><span class="literal" start="57">)</span><span class="op">'</span><span class="op" start="60">,</span><span class="op">'</span><span class="literal" start="61">]</span><span class="op">'</span><span class="op" start="64">,</span><span class="whitespace" start="65"> </span><span class="op">'</span><span class="literal" start="66">}</span><span class="op">'</span><span class="parenthesis" start="69">)</span><span class="whitespace" start="70"> </span><span class="op" start="71">or</span><span class="whitespace" start="73"> </span><span class="parenthesis" start="74" pair-end="133" select="quick">(</span><span class="variable" start="75" select="quick">$token</span><span class="step" start="81">/</span><span class="axis" start="82">@</span><span class="qname" start="83" select="quick">type</span><span class="whitespace" start="87"> </span><span class="op" start="88">=</span><span class="whitespace" start="89"> </span><span class="parenthesis" start="90" pair-end="132" select="quick">(</span><span class="op">'</span><span class="literal" start="91">literal</span><span class="op">'</span><span class="op" start="100">,</span><span class="op">'</span><span class="literal" start="101">numeric</span><span class="op">'</span><span class="op" start="110">,</span><span class="op">'</span><span class="literal" start="111">variable</span><span class="op">'</span><span class="op" start="121">,</span><span class="whitespace" start="122"> </span><span class="op">'</span><span class="literal" start="123">context</span><span class="op">'</span><span class="parenthesis" start="132">)</span><span class="parenthesis" start="133">)</span><span class="parenthesis" start="134">)</span><span class="z">"</span><span id="wx16071" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w16073"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w16083"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">start</span><span class="z">"</span><span id="wx16100" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w16102"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">end</span><span class="z">"</span><span id="wx16119" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w16121"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">value</span><span class="z">"</span><span id="wx16138" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w16140"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w16144"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16163"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$prevIsClosed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w16173"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">op</span><span class="op">'</span><span class="z">"</span><span id="wx16189" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx16193" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16197" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w16199"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="18" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$isQuantifier</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">and</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="24" pair-end="41" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="28" select="quick">$prevIsClosed</span><span class="parenthesis" start="41">)</span><span class="whitespace" start="42"> </span><span class="op" start="43">and</span><span class="whitespace" start="46"> </span><span class="variable" start="47" select="quick">$token</span><span class="step" start="53">/</span><span class="axis" start="54">@</span><span class="qname" start="55" select="quick">value</span><span class="whitespace" start="60"> </span><span class="op" start="61">eq</span><span class="whitespace" start="63"> </span><span class="op">'</span><span class="literal" start="64">*</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm">
          &lt;xsl:attribute name="type" select="'any'"/&gt;
          
          </span><span class="z">--&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16238" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w16240"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="parenthesis" start="16" pair-end="40" select="quick">(</span><span class="op">'</span><span class="literal" start="17">function</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">if</span><span class="op">'</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">node</span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="whitespace" start="41"> </span><span class="op" start="42">or</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$token</span><span class="step" start="51">/</span><span class="axis" start="52">@</span><span class="qname" start="53" select="quick">value</span><span class="whitespace" start="58"> </span><span class="op" start="59">=</span><span class="whitespace" start="60"> </span><span class="parenthesis" start="61" pair-end="69" select="quick">(</span><span class="op">'</span><span class="literal" start="62">(</span><span class="op">'</span><span class="op" start="65">,</span><span class="op">'</span><span class="literal" start="66">[</span><span class="op">'</span><span class="parenthesis" start="69">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16289"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pair">pair</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pbPairs</span><span class="filter" start="9" pair-end="30" select="quick">[</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">start</span><span class="whitespace" start="16"> </span><span class="op" start="17">=</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$token</span><span class="step" start="25">/</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">end</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx16314" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w16316"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w16320"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$token</span><span class="step" start="25">/</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">type</span><span class="whitespace" start="31"> </span><span class="op" start="32">=</span><span class="whitespace" start="33"> </span><span class="parenthesis" start="34" pair-end="53" select="quick">(</span><span class="op">'</span><span class="literal" start="35">node</span><span class="op">'</span><span class="op" start="41">,</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">function</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w16350"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">node-type</span><span class="op">'</span><span class="z">"</span><span id="wx16366" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16370" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w16372"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w16376"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span id="wx16393" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx16397" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx16401" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w16403"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="17" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$pair</span><span class="parenthesis" start="16">)</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w16419"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w16432"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pair-end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span id="wx16449" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx16453" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w16455"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">level</span><span class="z">"</span><span id="wx16472" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx16476" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16480" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w16482"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16492"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="17" select="quick">(</span><span class="variable" start="5" select="quick">$token</span><span class="step" start="11">/</span><span class="axis" start="12">@</span><span class="qname" start="13" select="quick">type</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">then</span><span class="whitespace" start="23"> </span><span class="variable" start="24" select="quick">$token</span><span class="step" start="30">/</span><span class="axis" start="31">@</span><span class="qname" start="32" select="quick">type</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">type-name</span><span class="op">'</span><span class="z">"</span><span id="wx16526" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16530" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w16532"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isQuantifier</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16542"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">quantifier</span><span class="op">'</span><span class="z">"</span><span id="wx16558" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16562" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w16564"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16577"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span id="wx16594" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16598" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx16602" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx16606" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w16608"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ignorable">ignorable</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="parenthesis" start="16" pair-end="40" select="quick">(</span><span class="op">'</span><span class="literal" start="17">whitespace</span><span class="op">'</span><span class="op" start="29">,</span><span class="whitespace" start="30"> </span><span class="op">'</span><span class="literal" start="31">comment</span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span id="wx16644" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w16646"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isNewClosed">isNewClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w16662"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w16666"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ignorable</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16676"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$prevIsClosed</span><span class="z">"</span><span id="wx16684" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16688" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w16690"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16709"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="18" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$prevIsClosed</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span id="wx16720" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16724" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w16726"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w16730"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$currentIsClosed</span><span class="z">"</span><span id="wx16738" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx16742" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx16746" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx16750" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w16752"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newTypeExpected">newTypeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><span class="variable" start="5" select="quick">$ignorable</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$typeExpected</span><span class="whitespace" start="35">
                          </span><span class="op" start="36">else</span><span class="whitespace" start="40"> </span><span class="parenthesis" start="41" pair-end="66" select="quick">(</span><span class="variable" start="42" select="quick">$token</span><span class="step" start="48">/</span><span class="axis" start="49">@</span><span class="qname" start="50" select="quick">type</span><span class="whitespace" start="54"> </span><span class="op" start="55">=</span><span class="whitespace" start="56"> </span><span class="op">'</span><span class="literal" start="57">type-op</span><span class="op">'</span><span class="parenthesis" start="66">)</span><span class="whitespace" start="67"> </span><span class="op" start="68">or</span><span class="whitespace" start="70"> </span><span class="parenthesis" start="71" pair-end="93" select="quick">(</span><span class="variable" start="72" select="quick">$token</span><span class="step" start="78">/</span><span class="axis" start="79">@</span><span class="qname" start="80" select="quick">value</span><span class="whitespace" start="85"> </span><span class="op" start="86">eq</span><span class="whitespace" start="88"> </span><span class="op">'</span><span class="literal" start="89">as</span><span class="op">'</span><span class="parenthesis" start="93">)</span><span class="z">"</span><span id="wx16810" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w16812"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">le</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="28" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w16833"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?qExpected">qExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$token</span><span class="step" start="24">/</span><span class="axis" start="25">@</span><span class="qname" start="26" select="quick">value</span><span class="whitespace" start="31"> </span><span class="op" start="32">=</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">)</span><span class="op">'</span><span class="z">"</span><span id="wx16866" class="sc">/&gt;</span></span><span class="txt"> 
      
      
      </span><span class="ww" id="w16868"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}rationalizeTokens" class="solar"><span class="function" start="1" pair-end="96" select="quick">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$tokens</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$index</span><span class="whitespace" start="38"> </span><span class="op" start="39">+</span><span class="whitespace" start="40"> </span><span class="numeric" start="41">1</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$isNewClosed</span><span class="op" start="56">,</span><span class="whitespace" start="57">
                            </span><span class="variable" start="58" select="quick">$pbPairs</span><span class="op" start="66">,</span><span class="whitespace" start="67"> </span><span class="variable" start="68" select="quick">$newTypeExpected</span><span class="op" start="84">,</span><span class="whitespace" start="85"> </span><span class="variable" start="86" select="quick">$qExpected</span><span class="parenthesis" start="96">)</span><span class="z">"</span><span id="wx16898" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx16902" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx16906" class="ec">&gt;</span></span><span class="txt">
  
  
  </span><span class="ww" id="w16908"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createTokens">loc:createTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w16918"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?string">string</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx16932" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w16934"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?excludes">excludes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx16948" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w16950"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx16964" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w16966"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx16980" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w16982"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?exclude">exclude</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$excludes</span><span class="filter" start="10" pair-end="17" select="quick">[</span><span class="variable" start="11" select="quick">$index</span><span class="filter" start="17">]</span><span class="z">"</span><span id="wx17005" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w17007"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="parenthesis" start="27" pair-end="28" select="quick">(</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                          </span><span class="op" start="30">else</span><span class="whitespace" start="34"> </span><span class="if" start="35">if</span><span class="whitespace" start="37"> </span><span class="parenthesis" start="38" pair-end="52" select="quick">(</span><span class="variable" start="39" select="quick">$exclude</span><span class="step" start="47">/</span><span class="axis" start="48">@</span><span class="qname" start="49" select="quick">end</span><span class="parenthesis" start="52">)</span><span class="whitespace" start="53"> </span><span class="op" start="54">then</span><span class="whitespace" start="58"> 
                          </span><span class="variable" start="60" select="quick">$exclude</span><span class="step" start="68">/</span><span class="axis" start="69">@</span><span class="qname" start="70" select="quick">end</span><span class="whitespace" start="73"> </span><span class="type-op" start="74">cast as</span><span class="whitespace" start="81"> </span><span class="type-name" start="82">xs:integer</span><span class="whitespace" start="92"> </span><span class="op" start="93">+</span><span class="whitespace" start="94"> </span><span class="numeric" start="95">1</span><span class="whitespace" start="96">
                          </span><span class="op" start="97">else</span><span class="whitespace" start="101"> </span><span class="parenthesis" start="102" pair-end="103" select="quick">(</span><span class="parenthesis" start="103">)</span><span class="z">"</span><span id="wx17070" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w17072"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?exStart">exStart</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="parenthesis" start="27" pair-end="28" select="quick">(</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                          </span><span class="op" start="30">else</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$exclude</span><span class="step" start="43">/</span><span class="axis" start="44">@</span><span class="qname" start="45" select="quick">start</span><span class="z">"</span><span id="wx17111" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w17113"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part">part</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w17123"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w17127"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$exclude</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$index</span><span class="whitespace" start="27"> </span><span class="op" start="28">=</span><span class="whitespace" start="29"> </span><span class="numeric" start="30">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w17148"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$string</span><span class="z">"</span><span id="wx17156" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17160" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w17162"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="16" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$exStart</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$exStart</span><span class="whitespace" start="30"> </span><span class="op" start="31">ge</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$start</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w17183"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="45" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$start</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$exStart</span><span class="whitespace" start="36"> </span><span class="op" start="37">-</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$start</span><span class="parenthesis" start="45">)</span><span class="z">"</span><span id="wx17204" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17208" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w17210"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w17214"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="63" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$start</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="28" pair-end="49" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="42" select="quick">$string</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50"> </span><span class="op" start="51">+</span><span class="whitespace" start="52"> </span><span class="numeric" start="53">1</span><span class="whitespace" start="54"> </span><span class="op" start="55">-</span><span class="whitespace" start="56"> </span><span class="variable" start="57" select="quick">$start</span><span class="parenthesis" start="63">)</span><span class="z">"</span><span id="wx17242" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx17246" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx17250" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx17254" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w17256"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="20" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">gt</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w17273"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}rawTokens" class="solar"><span class="function" start="1" pair-end="20" select="quick">loc:rawTokens</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span id="wx17296" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="z">&lt;!--</span><span class="cm"> The XSLT that generates the tokens </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="ww" id="w17302"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}processTokens" class="solar"><span class="function" start="1" pair-end="37" select="quick">loc:processTokens</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$tokens</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$start</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">1</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span id="wx17319" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17323" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w17325"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="20" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w17341"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w17351"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">start</span><span class="z">"</span><span id="wx17368" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w17370"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w17383"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">end</span><span class="z">"</span><span id="wx17400" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17404" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w17406"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stringEnd">stringEnd</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w17416"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$exclude</span><span class="step" start="13">/</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">end</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$exclude</span><span class="step" start="33">/</span><span class="axis" start="34">@</span><span class="qname" start="35" select="quick">end</span><span class="whitespace" start="38"> </span><span class="op" start="39">else</span><span class="whitespace" start="43"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="44" pair-end="65" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="58" select="quick">$string</span><span class="parenthesis" start="65">)</span><span class="z">"</span><span id="wx17445" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx17449" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w17451"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w17461"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="69" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$exclude</span><span class="step" start="28">/</span><span class="axis" start="29">@</span><span class="qname" start="30" select="quick">start</span><span class="op" start="35">,</span><span class="whitespace" start="36"> </span><span class="variable" start="37" select="quick">$stringEnd</span><span class="whitespace" start="47"> </span><span class="op" start="48">+</span><span class="whitespace" start="49"> </span><span class="numeric" start="50">1</span><span class="whitespace" start="51"> </span><span class="op" start="52">-</span><span class="whitespace" start="53"> </span><span class="variable" start="54" select="quick">$exclude</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">start</span><span class="parenthesis" start="69">)</span><span class="z">"</span><span id="wx17492" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx17496" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w17498"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="14" select="quick">name</span></a><span class="parenthesis">(</span><span class="variable" start="6" select="quick">$exclude</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span id="wx17515" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx17519" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17523" class="ec">&gt;</span></span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> iterate 1 pos beyond end of excludes length </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w17529"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="21" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$excludes</span><span class="parenthesis" start="20">)</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">and</span><span class="whitespace" start="26"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="27" pair-end="42" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="31">empty</span><span class="parenthesis">(</span><span class="variable" start="37" select="quick">$end</span><span class="parenthesis" start="41">)</span><span class="parenthesis" start="42">)</span><span class="whitespace" start="43"> </span><span class="op" start="44">and</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$index</span><span class="whitespace" start="54"> </span><span class="op" start="55">le</span><span class="whitespace" start="57"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="58" pair-end="73" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="64" select="quick">$excludes</span><span class="parenthesis" start="73">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w17566"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createTokens" class="solar"><span class="function" start="1" pair-end="54" select="quick">loc:createTokens</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$string</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$excludes</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$end</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$index</span><span class="whitespace" start="50"> </span><span class="op" start="51">+</span><span class="whitespace" start="52"> </span><span class="numeric" start="53">1</span><span class="parenthesis" start="54">)</span><span class="z">"</span><span id="wx17590" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17594" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx17598" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w17600"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}processTokens">loc:processTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w17616"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx17630" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w17632"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx17646" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w17648"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx17662" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w17664"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span id="wx17687" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w17689"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="10" pair-end="30" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="24" select="quick">$token</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx17716" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w17718"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w17728"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx17742" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w17744"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$end</span><span class="whitespace" start="5"> </span><span class="op" start="6">-</span><span class="whitespace" start="7"> </span><span class="numeric" start="8">1</span><span class="z">"</span><span id="wx17762" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w17764"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="z">"</span><span id="wx17778" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w17780"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isSimpleOps">isSimpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="xmlspectrum.xsl.html#v?simpleOps" class="solar"><span class="variable" start="10" select="quick">$simpleOps</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx17804" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w17806"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w17816"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="23">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$token</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="parenthesis" start="13" pair-end="22" select="quick">(</span><span class="op">'</span><span class="literal" start="14">/</span><span class="op">'</span><span class="op" start="17">,</span><span class="op">'</span><span class="literal" start="18">//</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">then</span><span class="whitespace" start="29"> </span><span class="op">'</span><span class="literal" start="30">step</span><span class="op">'</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">op</span><span class="op">'</span><span class="z">"</span><span id="wx17857" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17861" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w17863"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isDoubleToken">isDoubleToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w17879"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w17883"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w17893"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx17903" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17907" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w17909"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w17913"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?splitToken">splitToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="31" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$token</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18">[\s\p{Zs}]+</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span id="wx17941" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w17943"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="5" pair-end="22" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$splitToken</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">ne</span><span class="whitespace" start="26"> </span><span class="numeric" start="27">2</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29"> </span><span class="op" start="30">then</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="35" pair-end="41" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="whitespace" start="42">
                        </span><span class="op" start="43">else</span><span class="whitespace" start="47"> </span><span class="if" start="48">if</span><span class="whitespace" start="50"> </span><span class="parenthesis" start="51" pair-end="107" select="quick">(</span><span class="variable" start="52" select="quick">$splitToken</span><span class="filter" start="63" pair-end="65" select="quick">[</span><span class="numeric" start="64">1</span><span class="filter" start="65">]</span><span class="whitespace" start="66"> </span><span class="op" start="67">eq</span><span class="whitespace" start="69"> </span><span class="op">'</span><span class="literal" start="70">instance</span><span class="op">'</span><span class="whitespace" start="80"> </span><span class="op" start="81">and</span><span class="whitespace" start="84"> </span><span class="variable" start="85" select="quick">$splitToken</span><span class="filter" start="96" pair-end="98" select="quick">[</span><span class="numeric" start="97">2</span><span class="filter" start="98">]</span><span class="whitespace" start="99"> </span><span class="op" start="100">eq</span><span class="whitespace" start="102"> </span><span class="op">'</span><span class="literal" start="103">of</span><span class="op">'</span><span class="parenthesis" start="107">)</span><span class="whitespace" start="108"> 
                        </span><span class="op" start="110">then</span><span class="whitespace" start="114"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="115" pair-end="120" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="120">)</span><span class="whitespace" start="121">
                        </span><span class="op" start="122">else</span><span class="whitespace" start="126"> </span><span class="if" start="127">if</span><span class="whitespace" start="129"> </span><span class="parenthesis" start="130" pair-end="202" select="quick">(</span><span class="variable" start="131" select="quick">$splitToken</span><span class="filter" start="142" pair-end="144" select="quick">[</span><span class="numeric" start="143">1</span><span class="filter" start="144">]</span><span class="whitespace" start="145"> </span><span class="op" start="146">=</span><span class="whitespace" start="147"> </span><span class="parenthesis" start="148" pair-end="174" select="quick">(</span><span class="op">'</span><span class="literal" start="149">cast</span><span class="op">'</span><span class="op" start="155">,</span><span class="op">'</span><span class="literal" start="156">castable</span><span class="op">'</span><span class="op" start="166">,</span><span class="op">'</span><span class="literal" start="167">treat</span><span class="op">'</span><span class="parenthesis" start="174">)</span><span class="whitespace" start="175"> </span><span class="op" start="176">and</span><span class="whitespace" start="179"> </span><span class="variable" start="180" select="quick">$splitToken</span><span class="filter" start="191" pair-end="193" select="quick">[</span><span class="numeric" start="192">2</span><span class="filter" start="193">]</span><span class="whitespace" start="194"> </span><span class="op" start="195">eq</span><span class="whitespace" start="197"> </span><span class="op">'</span><span class="literal" start="198">as</span><span class="op">'</span><span class="parenthesis" start="202">)</span><span class="whitespace" start="203">
                        </span><span class="op" start="204">then</span><span class="whitespace" start="208"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="209" pair-end="214" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="214">)</span><span class="whitespace" start="215"> </span><span class="op" start="216">else</span><span class="whitespace" start="220"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="221" pair-end="227" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="227">)</span><span class="z">"</span><span id="wx18056" class="sc">/&gt;</span></span><span class="txt">
            
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx18060" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx18064" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx18068" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w18070"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isDoubleToken</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w18080"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">type-op</span><span class="op">'</span><span class="z">"</span><span id="wx18096" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx18100" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w18102"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?functionType">functionType</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w18118"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18122"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="whitespace" start="13"> </span><span class="op" start="14">or</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$isDoubleToken</span><span class="whitespace" start="31"> </span><span class="op" start="32">or</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="35" pair-end="55" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="49" select="quick">$token</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56"> </span><span class="op" start="57">=</span><span class="whitespace" start="58"> </span><span class="numeric" start="59">1</span><span class="whitespace" start="60"> </span><span class="op" start="61">or</span><span class="whitespace" start="63"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="64" pair-end="89" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="68" pair-end="88" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="78" select="quick">$token</span><span class="op" start="84">,</span><span class="op">'</span><span class="literal" start="85">(</span><span class="op">'</span><span class="parenthesis" start="88">)</span><span class="parenthesis" start="89">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w18161"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx18167" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18171" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w18173"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w18177"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fnName">fnName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="34" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$token</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18">[\s\p{Zs}]+|\(</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="filter" start="35" pair-end="37" select="quick">[</span><span class="numeric" start="36">1</span><span class="filter" start="37">]</span><span class="z">"</span><span id="wx18208" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w18210"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w18214"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$fnName</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w18230"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">if</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx18236" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18240" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w18242"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">some</span><span class="whitespace" start="5"> </span><span id="rng-$n" class="variable" start="6" select="quick">$n</span><span class="whitespace" start="8"> </span><span class="op" start="9">in</span><span class="whitespace" start="11"> </span><a href="xmlspectrum.xsl.html#v?nodeTests" class="solar"><span class="variable" start="12" select="quick">$nodeTests</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">satisfies</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$n</span><span class="whitespace" start="35"> </span><span class="op" start="36">=</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w18266"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx18272" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18276" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w18278"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">some</span><span class="whitespace" start="5"> </span><span id="rng-$x" class="variable" start="6" select="quick">$x</span><span class="whitespace" start="8"> </span><span class="op" start="9">in</span><span class="whitespace" start="11"> </span><a href="xmlspectrum.xsl.html#v?typeTests" class="solar"><span class="variable" start="12" select="quick">$typeTests</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">satisfies</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$x</span><span class="whitespace" start="35"> </span><span class="op" start="36">=</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w18302"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">type</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx18308" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18312" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w18314"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w18318"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">function</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx18324" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx18328" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx18332" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx18336" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx18340" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx18344" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w18346"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w18350"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="25" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$token</span><span class="op" start="19">,</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">Q{</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18368"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">bracedq</span><span class="op">'</span><span class="z">"</span><span id="wx18384" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18388" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18390"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="whitespace" start="13"> </span><span class="op" start="14">or</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$isDoubleToken</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18406" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18408"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$functionType</span><span class="whitespace" start="14"> </span><span class="op" start="15">ne</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18424"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$functionType</span><span class="z">"</span><span id="wx18438" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18442" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18444"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="1" pair-end="23" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="op">'</span><span class="literal" start="19">::</span><span class="op">'</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">or</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$token</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38">@</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18472"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">axis</span><span class="op">'</span><span class="z">"</span><span id="wx18488" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18492" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18494"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="1" pair-end="29" select="quick">matches</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$token</span><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">[\s\p{Zs}]+</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18511"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">whitespace</span><span class="op">'</span><span class="z">"</span><span id="wx18527" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18531" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18533"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="19" select="quick">(</span><span class="op">'</span><span class="literal" start="11">.</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">..</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18555"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">context</span><span class="op">'</span><span class="z">"</span><span id="wx18571" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18575" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18577"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="18" select="quick">(</span><span class="op">'</span><span class="literal" start="11">(</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">)</span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18599"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">parenthesis</span><span class="op">'</span><span class="z">"</span><span id="wx18615" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18619" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18621"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="18" select="quick">(</span><span class="op">'</span><span class="literal" start="11">[</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">]</span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18643"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">filter</span><span class="op">'</span><span class="z">"</span><span id="wx18659" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18663" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18665"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="1" pair-end="14" select="quick">number</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$token</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">=</span><span class="whitespace" start="17"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="18" pair-end="31" select="quick">number</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$token</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18685"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">numeric</span><span class="op">'</span><span class="z">"</span><span id="wx18701" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18705" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18707"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="xmlspectrum.xsl.html#v?ambiguousOps" class="solar"><span class="variable" start="10" select="quick">$ambiguousOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18721"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">probableOp</span><span class="op">'</span><span class="z">"</span><span id="wx18737" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18741" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18743"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="xmlspectrum.xsl.html#v?higherOps" class="solar"><span class="variable" start="10" select="quick">$higherOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18757"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="51" select="quick">starts-with</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}nextNonWhite" class="solar"><span class="function" start="13" pair-end="45" select="quick">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable" start="30" select="quick">$tokens</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$index</span><span class="parenthesis" start="45">)</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="op">'</span><span class="literal" start="48">$</span><span class="op">'</span><span class="parenthesis" start="51">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w18781"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">higher</span><span class="op">'</span><span class="z">"</span><span id="wx18797" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx18801" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18805" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18807"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18823"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}nextNonWhite" class="solar"><span class="function" start="1" pair-end="33" select="quick">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$tokens</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$index</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38">(</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w18845"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">if</span><span class="op">'</span><span class="z">"</span><span id="wx18861" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx18865" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18869" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w18871"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="24" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$token</span><span class="op" start="19">,</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">$</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w18889"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">variable</span><span class="op">'</span><span class="z">"</span><span id="wx18905" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx18909" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx18913" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx18917" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w18919"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">le</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="28" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w18940"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}processTokens" class="solar"><span class="function" start="1" pair-end="44" select="quick">loc:processTokens</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$tokens</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$end</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$index</span><span class="whitespace" start="40"> </span><span class="op" start="41">+</span><span class="whitespace" start="42"> </span><span class="numeric" start="43">1</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span id="wx18961" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx18965" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx18969" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w18971"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}nextNonWhite">loc:nextNonWhite</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w18987"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx19001" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w19003"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx19017" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w19019"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w19023"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="1" pair-end="6" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="z">&lt;!--</span><span class="cm"> test="$index + 2 lt count($tokens)"&gt;  </span><span class="z">--&gt;</span><span class="txt"> 
        </span><span class="ww" id="w19039"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="55">if</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="4" pair-end="48" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$tokens</span><span class="filter" start="19" pair-end="30" select="quick">[</span><span class="variable" start="20" select="quick">$index</span><span class="whitespace" start="26"> </span><span class="op" start="27">+</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="filter" start="30">]</span><span class="op" start="31">,</span><span class="op">'</span><span class="literal" start="32">[\s\p{Zs}]+</span><span class="op">'</span><span class="op" start="45">,</span><span class="op">'</span><span class="literal" start="46"></span><span class="op">'</span><span class="parenthesis" start="48">)</span><span class="whitespace" start="49"> </span><span class="op" start="50">eq</span><span class="whitespace" start="52"> </span><span class="op">'</span><span class="literal" start="53"></span><span class="op">'</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56">
                              </span><span class="op" start="57">then</span><span class="whitespace" start="61"> </span><span class="variable" start="62" select="quick">$tokens</span><span class="filter" start="69" pair-end="80" select="quick">[</span><span class="variable" start="70" select="quick">$index</span><span class="whitespace" start="76"> </span><span class="op" start="77">+</span><span class="whitespace" start="78"> </span><span class="numeric" start="79">2</span><span class="filter" start="80">]</span><span class="whitespace" start="81"> </span><span class="op" start="82">else</span><span class="whitespace" start="86"> </span><span class="variable" start="87" select="quick">$tokens</span><span class="filter" start="94" pair-end="105" select="quick">[</span><span class="variable" start="95" select="quick">$index</span><span class="whitespace" start="101"> </span><span class="op" start="102">+</span><span class="whitespace" start="103"> </span><span class="numeric" start="104">1</span><span class="filter" start="105">]</span><span class="z">"</span><span id="wx19096" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx19100" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w19102"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx19108" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx19112" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx19116" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w19118"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}rawTokens">loc:rawTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w19134"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx19148" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w19150"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z">
        </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(((-)?\d+)(\.)?(\d+([eE][\+\-]?)?\d*)?)|(\?)|(Q\{{[^\{{\}}]*\}})|(instance[\s\p{{Zs}}]+of)|(cast[\s\p{{Zs}}]+as)|(:=)|(\|\|)|(castable[\s\p{{Zs}}]+as)|(treat[\s\p{{Zs}}]+as)|((\$[\s\p{{Zs}}]*)?[\i\*][\p{{L}}\p{{Nd}}\.\-]*(:[\p{{L}}\p{{Nd}}\.\-\*]*)?(::)?:?(#\d+)?)(\()?|(\.\.)|((-)?\d?\.\d*)|-|([&amp;lt;&amp;gt;!]=)|(&amp;gt;&amp;gt;|&amp;lt;&amp;lt;)|(//)|([\s\p{{Zs}}]+)|(\C)</span><span class="z">"</span><span class="z">
        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chunk</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w19166"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w19170"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="1" pair-end="9" select="quick">string</span></a><span class="parenthesis">(</span><span class="context" start="8">.</span><span class="parenthesis" start="9">)</span><span class="z">"</span><span id="wx19181" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx19185" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx19189" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx19193" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx19197" class="ec">&gt;</span></span><span class="txt">
</span></p></div></body></html>