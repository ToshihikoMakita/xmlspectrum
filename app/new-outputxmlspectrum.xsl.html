<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>xmlspectrum.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></head><body><div><p class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm">

XMLSpectrum by Phil Fearon Qutoric Limited 2012 (c)&#xD;
http://qutoric.com&#xD;
License: Apache 2.0 http://www.apache.org/licenses/LICENSE-2.0.html&#xD;
&#xD;
Purpose: Syntax highlighter for XPath (text), XML, XSLT and XSD 1.1 file formats&#xD;
&#xD;
Interface Functions:&#xD;
====================&#xD;
f:render(xml-content, is-xml, root-prefix)&#xD;
loc:showXPath(text-content)&#xD;
f:get-css(is-light-theme)&#xD;
f:indent(spans, char-width)&#xD;
f:link(spans, paths, location)&#xD;
&#xD;
Interface Templates:&#xD;
====================&#xD;
&lt;xsl:template match="span" mode="markup"&gt;&#xD;
&#xD;
Global Variables (for overriding)&#xD;
=================================&#xD;
w3c-xpath-functions-uri: location of resource proxy&#xD;
font-name:               abbreviated font name [std|scp] default&#xD;
                         is std for standard monospace - override&#xD;
                         with 'scp' for 'Souce Code Pro'&#xD;
                         font-family&#xD;
&#xD;
</span><span class="z">--&gt;</span><span class="txt">

&#xD;
</span><span class="ww" id="w9"><span class="es">&lt;</span><a class="solar" href="index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="z">
                
</span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                
</span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                
</span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.sketchpath.functions</span><span class="z">"</span><span class="z">
                
</span><span class="atn">xmlns:css</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-defs.com</span><span class="z">"</span><span class="z">
                
</span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">loc f xs css</span><span class="z">"</span><span class="z">
                
</span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="z">"</span><span class="z">
                
</span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">internal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> import xsl just for self-testing </span><span class="z">--&gt;</span><span class="txt">
  
</span><span class="ww" id="w64"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="dummy.xsl.html" class="solar"><span class="href">dummy.xsl</span></a><span class="z">"</span><span id="wx72" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w74"><span class="es">&lt;</span><span class="enxsl">xsl:include</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="sub/dummy2.xsl.html" class="solar"><span class="href">sub/dummy2.xsl</span></a><span class="z">"</span><span id="wx82" class="sc">/&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> override these variables </span><span class="z">--&gt;</span><span class="txt">
  
</span><span class="ww" id="w88"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?w3c-xpath-functions-uri">w3c-xpath-functions-uri</span><span class="z">"</span><span class="z">
                
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">http://www.w3.org/TR/xpath-functions/</span><span class="op">'</span><span class="z">"</span><span id="wx104" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w106"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?font-name">font-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">std</span><span class="op">'</span><span class="z">"</span><span id="wx122" class="sc">/&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm">
  
signature:&#xD;
      f:render(xml-content, is-xml, root-prefix)&#xD;
  &#xD;
  description:&#xD;
      Converts the xml content string to a sequence of span elements. with each&#xD;
      containing a class attribute used for coloring with CSS. &#xD;
  &#xD;
  params:&#xD;
      xml-content: string containing well-balanced XML extract - namespace and prefix&#xD;
                   declarations not required&#xD;
      is-xsl:      boolean specifying whether coloring is for XSLT, if this is false&#xD;
                   then XSD 1.1 coloring scheme is used instead&#xD;
      root-prefix: string prefix used for elements requiring special coloring for XSLT&#xD;
                   or XSD 1.1 - often 'xsl' and 'xs' respectively&#xD;
  </span><span class="z">--&gt;</span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w128"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}render">f:render</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w138"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlText">xmlText</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx152" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w154"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx168" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w170"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix-a">root-prefix-a</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx184" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w186"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><span class="variable" start="5" select="quick">$root-prefix-a</span><span class="whitespace" start="19"> </span><span class="op" start="20">eq</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23"></span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> 
                          
</span><span class="op" start="29">then</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34"></span><span class="op">'</span><span class="whitespace" start="36">
                          
</span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="43" pair-end="69" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="50" select="quick">$root-prefix-a</span><span class="op" start="64">,</span><span class="whitespace" start="65"> </span><span class="op">'</span><span class="literal" start="66">:</span><span class="op">'</span><span class="parenthesis" start="69">)</span><span class="z">"</span><span id="wx234" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w236"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens-a">tokens-a</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="26" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$xmlText</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">&amp;lt;</span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx264" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w266"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="40" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="5" pair-end="33" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens-a</span><span class="filter" start="30" pair-end="32" select="quick">[</span><span class="numeric" start="31">1</span><span class="filter" start="32">]</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"></span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="whitespace" start="41"> </span><span class="op" start="42">then</span><span class="whitespace" start="46"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function" start="47" pair-end="71" select="quick">subsequence</span></a><span class="parenthesis">(</span><span class="variable" start="59" select="quick">$tokens-a</span><span class="op" start="68">,</span><span class="whitespace" start="69"> </span><span class="numeric" start="70">2</span><span class="parenthesis" start="71">)</span><span class="whitespace" start="72"> </span><span class="op" start="73">else</span><span class="whitespace" start="77"> </span><span class="variable" start="78" select="quick">$tokens-a</span><span class="z">"</span><span id="wx310" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w312"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}iterateTokens" class="solar"><span class="function" start="1" pair-end="61" select="quick">f:iterateTokens</span></a><span class="parenthesis">(</span><span class="numeric" start="17">0</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$tokens</span><span class="op" start="27">,</span><span class="numeric" start="28">1</span><span class="op" start="29">,</span><span class="op">'</span><span class="literal" start="30">n</span><span class="op">'</span><span class="op" start="33">,</span><span class="numeric" start="34">0</span><span class="op" start="35">,</span><span class="whitespace" start="36"> </span><span class="numeric" start="37">0</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$is-xsl</span><span class="op" start="47">,</span><span class="whitespace" start="48"> </span><span class="variable" start="49" select="quick">$root-prefix</span><span class="parenthesis" start="61">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx355" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w357"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="z">"</span><span id="wx365" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx369" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> 
  
signature:&#xD;
      f:indent(spans, char-width)&#xD;
  &#xD;
  description&#xD;
      &#xD;
      Adds space characters for indentation to spans from XML-text processed with f:render. &#xD;
      XML contents is indented in the conventional way, multi-line attribute names and values&#xD;
      are aligned vertically&#xD;
  &#xD;
  parameters:&#xD;
      spans:          Sequence of 'span' element nodes created by f:render&#xD;
      char-width:     integer: Number of characters for each indent level&#xD;
      auto-trim:      boolean: Trims any leading whitespace before indentation&#xD;
  &#xD;
  &#xD;
   </span><span class="z">--&gt;</span><span class="txt">
  
</span><span class="ww" id="w375"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}indent">f:indent</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w385"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx399" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w401"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char-width">char-width</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx415" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w417"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx431" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w433"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?indentSpans" class="solar"><span class="tcall">indentSpans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w443"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx469" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w471"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx491" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w493"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx513" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w515"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char-width</span><span class="z">"</span><span id="wx535" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w537"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx557" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w559"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx579" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w581"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx603" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w605"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="1" select="quick">$auto-trim</span></a><span class="z">"</span><span id="wx625" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx629" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx633" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w635"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?indentSpans">indentSpans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w645"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx665" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w667"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx681" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w683"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx697" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w699"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?margin">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx713" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w715"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?an-offset">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx729" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w731"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?av-offset">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx745" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w747"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?multi-line">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx761" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w763"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx777" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w779"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx796" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w798"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="z">"</span><span id="wx815" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w817"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nextClass">nextClass</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">+</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="step" start="19">/</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx847" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w849"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevClass">prevClass</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">-</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="step" start="19">/</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx879" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w881"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level2">level2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">scx</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$level</span><span class="whitespace" start="33"> </span><span class="op" start="34">+</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">1</span><span class="whitespace" start="37">
                                        
</span><span class="op" start="39">else</span><span class="whitespace" start="43"> </span><span class="if" start="44">if</span><span class="whitespace" start="46"> </span><span class="parenthesis" start="47" pair-end="62" select="quick">(</span><span class="variable" start="48" select="quick">$class</span><span class="whitespace" start="54"> </span><span class="op" start="55">eq</span><span class="whitespace" start="57"> </span><span class="op">'</span><span class="literal" start="58">ez</span><span class="op">'</span><span class="parenthesis" start="62">)</span><span class="whitespace" start="63"> </span><span class="op" start="64">then</span><span class="whitespace" start="68"> </span><span class="variable" start="69" select="quick">$level</span><span class="whitespace" start="75"> </span><span class="op" start="76">-</span><span class="whitespace" start="77"> </span><span class="numeric" start="78">1</span><span class="whitespace" start="79">
                                        
</span><span class="op" start="81">else</span><span class="whitespace" start="85"> </span><span class="variable" start="86" select="quick">$level</span><span class="z">"</span><span id="wx939" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w941"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?outdent">outdent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><span class="variable" start="5" select="quick">$index</span><span class="whitespace" start="11"> </span><span class="op" start="12">lt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$spans</span><span class="parenthesis" start="27">)</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29"> </span><span class="op" start="30">then</span><span class="whitespace" start="34">
                          
</span><span class="variable" start="36" select="quick">$spans</span><span class="filter" start="42" pair-end="53" select="quick">[</span><span class="variable" start="43" select="quick">$index</span><span class="whitespace" start="49"> </span><span class="op" start="50">+</span><span class="whitespace" start="51"> </span><span class="numeric" start="52">1</span><span class="filter" start="53">]</span><span class="step" start="54">/</span><span class="axis" start="55">@</span><span class="qname" start="56" select="quick">class</span><span class="whitespace" start="61"> </span><span class="op" start="62">eq</span><span class="whitespace" start="64"> </span><span class="op">'</span><span class="literal" start="65">ez</span><span class="op">'</span><span class="whitespace" start="69">
                          
</span><span class="op" start="71">else</span><span class="whitespace" start="75"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="76" pair-end="82" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="82">)</span><span class="z">"</span><span id="wx998" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w1000"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$span</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
&#xD;
      </span><span class="ww" id="w1013"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indentOutput">indentOutput</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}indentTextSpan" class="solar"><span class="function" start="1" pair-end="128" select="quick">f:indentTextSpan</span></a><span class="parenthesis">(</span><span class="whitespace" start="18">
                                                
</span><span class="variable" start="20" select="quick">$span</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$level</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$margin</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$an-offset</span><span class="op" start="54">,</span><span class="whitespace" start="55"> </span><span class="variable" start="56" select="quick">$av-offset</span><span class="op" start="66">,</span><span class="whitespace" start="67"> </span><span class="variable" start="68" select="quick">$outdent</span><span class="op" start="76">,</span><span class="whitespace" start="77">
                                                
</span><span class="variable" start="79" select="quick">$nextClass</span><span class="op" start="89">,</span><span class="whitespace" start="90"> </span><span class="variable" start="91" select="quick">$prevClass</span><span class="op" start="101">,</span><span class="whitespace" start="102"> </span><span class="variable" start="103" select="quick">$multi-line</span><span class="op" start="114">,</span><span class="whitespace" start="115"> </span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="116" select="quick">$auto-trim</span></a><span class="whitespace" start="126">
                                                
</span><span class="parenthesis" start="128">)</span><span class="z">"</span><span id="wx1059" class="sc">/&gt;</span></span><span class="txt">
      
&#xD;
      </span><span class="ww" id="w1061"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">span</span><span class="z">"</span><span id="wx1071" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w1073"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">lt</span><span class="whitespace" start="10"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="11" pair-end="23" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$spans</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w1090"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?indentSpans" class="solar"><span class="tcall">indentSpans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w1100"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx1124" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1126"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level2</span><span class="z">"</span><span id="wx1146" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1148"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$margin</span><span class="z">"</span><span id="wx1168" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1170"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">an-offset</span><span class="z">"</span><span id="wx1192" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1194"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">av-offset</span><span class="z">"</span><span id="wx1216" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1218"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$indentOutput</span><span class="step" start="14">/</span><span class="qname" start="15" select="quick">multi-line</span><span class="z">"</span><span id="wx1240" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1242"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="1" select="quick">$auto-trim</span></a><span class="z">"</span><span id="wx1262" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1266" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1270" class="ec">&gt;</span></span><span class="txt">
      
&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1274" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1278" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w1280"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}clark-name">f:clark-name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w1296"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx1310" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1312"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?name">name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1326" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w1328"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="28" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$name</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">:</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx1350" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1352"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix-length">prefix-length</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$prefix</span><span class="whitespace" start="12"> </span><span class="op" start="13">eq</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">1</span><span class="whitespace" start="26">
                          
</span><span class="op" start="28">else</span><span class="whitespace" start="32"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="33" pair-end="54" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="47" select="quick">$prefix</span><span class="parenthesis" start="54">)</span><span class="whitespace" start="55"> </span><span class="op" start="56">+</span><span class="whitespace" start="57"> </span><span class="numeric" start="58">2</span><span class="z">"</span><span id="wx1391" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w1393"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?local-name">local-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="32" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$name</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$prefix-length</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1419" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1421"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
        
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$prefix</span><span class="whitespace" start="12"> </span><span class="op" start="13">eq</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24">
                
</span><span class="variable" start="26" select="quick">$local-name</span><span class="whitespace" start="37">
                
</span><span class="op" start="39">else</span><span class="whitespace" start="43">
                
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="45" pair-end="112" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="52">{</span><span class="op">'</span><span class="op" start="55">,</span><span class="whitespace" start="56">
                
</span><span class="variable" start="58" select="quick">$xmlns</span><span class="step" start="64">/</span><span class="qname" start="65" select="quick">ns</span><span class="filter" start="67" pair-end="86" select="quick">[</span><span class="axis" start="68">@</span><span class="qname" start="69" select="quick">prefix</span><span class="whitespace" start="75"> </span><span class="op" start="76">eq</span><span class="whitespace" start="78"> </span><span class="variable" start="79" select="quick">$prefix</span><span class="filter" start="86">]</span><span class="step" start="87">/</span><span class="axis" start="88">@</span><span class="qname" start="89" select="quick">uri</span><span class="op" start="92">,</span><span class="whitespace" start="93">
                
</span><span class="op">'</span><span class="literal" start="95">}</span><span class="op">'</span><span class="op" start="98">,</span><span class="whitespace" start="99">
                
</span><span class="variable" start="101" select="quick">$local-name</span><span class="parenthesis" start="112">)</span><span class="whitespace" start="113">
                
</span><span class="z">"</span><span id="wx1477" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1481" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w1483"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}gen-id">f:gen-id</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w1499"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?type-prefix">type-prefix</span><span class="z">"</span><span id="wx1507" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1509"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span id="wx1517" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1519"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char">char</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="27" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$type-prefix</span><span class="op" start="23">,</span><span class="numeric" start="24">1</span><span class="op" start="25">,</span><span class="numeric" start="26">1</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx1540" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1542"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="30" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$char</span><span class="op" start="13">,</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">?</span><span class="op">'</span><span class="op" start="18">,</span><span class="variable" start="19" select="quick">$clark-name</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx1560" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1564" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> 
  
description&#xD;
      XSLT Template&#xD;
      Adds ids and hrefs to span elements for global-variables, named-templates and functions&#xD;
  &#xD;
  parameters:&#xD;
      xmlns:          declared prefixes/namespaces on root-element for current document&#xD;
      globals:        clark-notation names for all globally declared items that may be&#xD;
                      referenced.&#xD;
   </span><span class="z">--&gt;</span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w1570"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">span</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">markup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w1586"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1606" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1608"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1628" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1630"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?path-length">path-length</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1650" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w1652"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ref-name">ref-name</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">variable</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31">
                          
</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="33" pair-end="47" select="quick">substring</span></a><span class="parenthesis">(</span><span class="context" start="43">.</span><span class="op" start="44">,</span><span class="whitespace" start="45"> </span><span class="numeric" start="46">2</span><span class="parenthesis" start="47">)</span><span class="whitespace" start="48">
                          
</span><span class="op" start="50">else</span><span class="whitespace" start="54"> </span><span class="context" start="55">.</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1697" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1699"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}clark-name" class="solar"><span class="function" start="1" pair-end="31" select="quick">f:clark-name</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$xmlns</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$ref-name</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx1725" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w1727"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?id">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}gen-id" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:gen-id</span></a><span class="parenthesis">(</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">class</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$clark-name</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx1748" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w1750"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w1754"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">class</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="36" select="quick">(</span><span class="op">'</span><span class="literal" start="11">fname</span><span class="op">'</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">tname</span><span class="op">'</span><span class="op" start="27">,</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">vname</span><span class="op">'</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w1783"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w1787"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx1796" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1798"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$id</span><span class="z">"</span><span id="wx1812" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w1814"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ref-name</span><span class="z">"</span><span id="wx1822" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx1826" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1830" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w1832"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">class</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">enxsl</span><span class="op">'</span><span class="whitespace" start="17">
                      
</span><span class="op" start="19">and</span><span class="whitespace" start="22"> </span><span class="parenthesis" start="23" pair-end="86" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="24" pair-end="49" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="context" start="34">.</span><span class="op" start="35">,</span><span class="whitespace" start="36"> </span><span class="op">'</span><span class="literal" start="37">stylesheet</span><span class="op">'</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50">
                      
 </span><span class="op" start="53">or</span><span class="whitespace" start="55">  </span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="57" pair-end="81" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="context" start="67">.</span><span class="op" start="68">,</span><span class="whitespace" start="69"> </span><span class="op">'</span><span class="literal" start="70">transform</span><span class="op">'</span><span class="parenthesis" start="81">)</span><span class="whitespace" start="82">
                      
  </span><span class="parenthesis" start="86">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w1876"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">solar</span><span class="z">"</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="34" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$path-length</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">index.html</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w1902"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w1906"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx1915" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w1917"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$id</span><span class="z">"</span><span id="wx1931" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w1933"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ref-name</span><span class="z">"</span><span id="wx1941" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx1945" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="cl">a</span><span id="wx1949" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1953" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w1955"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">class</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="48" select="quick">(</span><span class="op">'</span><span class="literal" start="11">variable</span><span class="op">'</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">href</span><span class="op">'</span><span class="op" start="29">,</span><span class="op">'</span><span class="literal" start="30">tcall</span><span class="op">'</span><span class="op" start="37">,</span><span class="op">'</span><span class="literal" start="38">function</span><span class="op">'</span><span class="parenthesis" start="48">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w1987"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?global-refs">global-refs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">variable</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31">
                              
    </span><span class="variable" start="37" select="quick">$globals</span><span class="step" start="45">/</span><span class="qname" start="46" select="quick">file</span><span class="step" start="50">/</span><span class="qname" start="51" select="quick">variables</span><span class="whitespace" start="60">
                              
</span><span class="op" start="62">else</span><span class="whitespace" start="66"> </span><span class="if" start="67">if</span><span class="whitespace" start="69"> </span><span class="parenthesis" start="70" pair-end="88" select="quick">(</span><span class="axis" start="71">@</span><span class="qname" start="72" select="quick">class</span><span class="whitespace" start="77"> </span><span class="op" start="78">eq</span><span class="whitespace" start="80"> </span><span class="op">'</span><span class="literal" start="81">tcall</span><span class="op">'</span><span class="parenthesis" start="88">)</span><span class="whitespace" start="89"> </span><span class="op" start="90">then</span><span class="whitespace" start="94">
                              
    </span><span class="variable" start="100" select="quick">$globals</span><span class="step" start="108">/</span><span class="qname" start="109" select="quick">file</span><span class="step" start="113">/</span><span class="qname" start="114" select="quick">templates</span><span class="whitespace" start="123">
                              
</span><span class="op" start="125">else</span><span class="whitespace" start="129"> </span><span class="if" start="130">if</span><span class="whitespace" start="132"> </span><span class="parenthesis" start="133" pair-end="154" select="quick">(</span><span class="axis" start="134">@</span><span class="qname" start="135" select="quick">class</span><span class="whitespace" start="140"> </span><span class="op" start="141">eq</span><span class="whitespace" start="143"> </span><span class="op">'</span><span class="literal" start="144">function</span><span class="op">'</span><span class="parenthesis" start="154">)</span><span class="whitespace" start="155"> </span><span class="op" start="156">then</span><span class="whitespace" start="160">
                              
    </span><span class="variable" start="166" select="quick">$globals</span><span class="step" start="174">/</span><span class="qname" start="175" select="quick">file</span><span class="step" start="179">/</span><span class="qname" start="180" select="quick">functions</span><span class="whitespace" start="189">
                              
</span><span class="op" start="191">else</span><span class="whitespace" start="195"> </span><span class="parenthesis" start="196" pair-end="197" select="quick">(</span><span class="parenthesis" start="197">)</span><span class="z">"</span><span id="wx2077" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w2079"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?resolved-ref">resolved-ref</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="24" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$global-refs</span><span class="parenthesis" start="24">)</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31">
                              
    </span><span class="parenthesis" start="37" pair-end="81" select="quick">(</span><span class="variable" start="38" select="quick">$global-refs</span><span class="step" start="50">/</span><span class="qname" start="51" select="quick">item</span><span class="filter" start="55" pair-end="80" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="56" pair-end="64" select="quick">string</span></a><span class="parenthesis">(</span><span class="context" start="63">.</span><span class="parenthesis" start="64">)</span><span class="whitespace" start="65"> </span><span class="op" start="66">eq</span><span class="whitespace" start="68"> </span><span class="variable" start="69" select="quick">$clark-name</span><span class="filter" start="80">]</span><span class="parenthesis" start="81">)</span><span class="filter" start="82" pair-end="84" select="quick">[</span><span class="numeric" start="83">1</span><span class="filter" start="84">]</span><span class="step" start="85">/</span><span class="context" start="86">..</span><span class="step" start="88">/</span><span class="axis" start="89">parent::</span><span class="qname" start="97" select="quick">file</span><span class="step" start="101">/</span><span class="axis" start="102">@</span><span class="qname" start="103" select="quick">path</span><span class="whitespace" start="107">
                              
</span><span class="op" start="109">else</span><span class="whitespace" start="113"> </span><span class="parenthesis" start="114" pair-end="115" select="quick">(</span><span class="parenthesis" start="115">)</span><span class="z">"</span><span id="wx2140" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w2142"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href">href</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">class</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">href</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27">
                              
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="33" pair-end="50" select="quick">concat</span></a><span class="parenthesis">(</span><span class="context" start="40">.</span><span class="op" start="41">,</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">.html</span><span class="op">'</span><span class="parenthesis" start="50">)</span><span class="whitespace" start="51">
                              
</span><span class="op" start="53">else</span><span class="whitespace" start="57"> </span><span class="if" start="58">if</span><span class="whitespace" start="60"> </span><span class="parenthesis" start="61" pair-end="108" select="quick">(</span><span class="axis" start="62">@</span><span class="qname" start="63" select="quick">class</span><span class="whitespace" start="68"> </span><span class="op" start="69">eq</span><span class="whitespace" start="71"> </span><span class="op">'</span><span class="literal" start="72">function</span><span class="op">'</span><span class="whitespace" start="82"> </span><span class="op" start="83">and</span><span class="whitespace" start="86"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="87" pair-end="107" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="91" pair-end="106" select="quick">contains</span></a><span class="parenthesis">(</span><span class="context" start="100">.</span><span class="op" start="101">,</span><span class="whitespace" start="102"> </span><span class="op">'</span><span class="literal" start="103">:</span><span class="op">'</span><span class="parenthesis" start="106">)</span><span class="parenthesis" start="107">)</span><span class="parenthesis" start="108">)</span><span class="whitespace" start="109"> </span><span class="op" start="110">then</span><span class="whitespace" start="114">
                              
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="120" pair-end="176" select="quick">concat</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?w3c-xpath-functions-uri" class="solar"><span class="variable" start="127" select="quick">$w3c-xpath-functions-uri</span></a><span class="op" start="151">,</span><span class="whitespace" start="152"> </span><span class="op">'</span><span class="literal" start="153">#</span><span class="op">'</span><span class="op" start="156">,</span><span class="whitespace" start="157"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="158" pair-end="175" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="165">func-</span><span class="op">'</span><span class="op" start="172">,</span><span class="whitespace" start="173"> </span><span class="context" start="174">.</span><span class="parenthesis" start="175">)</span><span class="parenthesis" start="176">)</span><span class="whitespace" start="177">
                              
</span><span class="op" start="179">else</span><span class="whitespace" start="183"> </span><span class="if" start="184">if</span><span class="whitespace" start="186"> </span><span class="parenthesis" start="187" pair-end="209" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="188" pair-end="208" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="195" select="quick">$resolved-ref</span><span class="parenthesis" start="208">)</span><span class="parenthesis" start="209">)</span><span class="whitespace" start="210"> </span><span class="op" start="211">then</span><span class="whitespace" start="215">
                              
    </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="221" pair-end="290" select="quick">concat</span></a><span class="parenthesis">(</span><span class="whitespace" start="228">
                              
    </span><span class="variable" start="234" select="quick">$path-length</span><span class="op" start="246">,</span><span class="whitespace" start="247">
                              
    </span><span class="variable" start="253" select="quick">$resolved-ref</span><span class="op" start="266">,</span><span class="whitespace" start="267">
                              
    </span><span class="op">'</span><span class="literal" start="273">.html</span><span class="op">'</span><span class="op" start="280">,</span><span class="whitespace" start="281"> </span><span class="op">'</span><span class="literal" start="282">#</span><span class="op">'</span><span class="op" start="285">,</span><span class="whitespace" start="286"> </span><span class="variable" start="287" select="quick">$id</span><span class="parenthesis" start="290">)</span><span class="whitespace" start="291">
                              
</span><span class="op" start="293">else</span><span class="whitespace" start="297"> </span><span class="parenthesis" start="298" pair-end="299" select="quick">(</span><span class="parenthesis" start="299">)</span><span class="z">"</span><span id="wx2278" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w2280"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w2284"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$href</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w2297"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$href</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">solar</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w2315"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx2323" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="cl">a</span><span id="wx2327" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2331" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w2333"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w2337"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx2345" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2349" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2353" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2357" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w2359"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w2363"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx2371" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2375" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2379" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2383" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w2385"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-xmlns">f:get-xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w2401"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx2415" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w2417"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p-spans">p-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w2433"><span class="es">&lt;</span><span class="en">p</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w2437"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w2447"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                          
 </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2473" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w2475"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx2495" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2499" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="cl">p</span><span id="wx2503" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2507" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w2509"><span class="es">&lt;</span><span class="en">xmlns</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w2513"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$p-spans</span><span class="step" start="9">/</span><span class="qname" start="10" select="quick">span</span><span class="filter" start="14" pair-end="30" select="quick">[</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">class</span><span class="whitespace" start="21"> </span><span class="op" start="22">eq</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">atn</span><span class="op">'</span><span class="filter" start="30">]</span><span class="filter" start="31" pair-end="55" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="32" pair-end="54" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="context" start="44">.</span><span class="op" start="45">,</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47">xmlns</span><span class="op">'</span><span class="parenthesis" start="54">)</span><span class="filter" start="55">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w2546"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?att-value">att-value</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w2556"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-next-class" class="solar"><span class="tcall">get-next-class</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w2566"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2586" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w2588"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="axis" start="7">preceding-sibling::</span><span class="qname" start="26" select="quick">*</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx2612" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w2614"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">av</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2642" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2646" class="ec">&gt;</span></span><span class="txt"> 
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2650" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w2652"><span class="es">&lt;</span><span class="en">ns</span><span class="z"> </span><span class="atn">prefix</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function" start="1" pair-end="23" select="quick">substring-after</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">:</span><span class="op">'</span><span class="parenthesis" start="23">)</span><span class="op">}</span><span class="z">"</span><span class="z">
            
</span><span class="atn">uri</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="context" start="1">.</span><span class="step" start="2">/</span><span class="axis" start="3">following-sibling::</span><span class="qname" start="22" select="quick">*</span><span class="filter" start="23" pair-end="39" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="24" pair-end="33" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">lt</span><span class="whitespace" start="37"> </span><span class="numeric" start="38">5</span><span class="filter" start="39">]</span><span class="filter" start="40" pair-end="55" select="quick">[</span><span class="axis" start="41">@</span><span class="qname" start="42" select="quick">class</span><span class="whitespace" start="47"> </span><span class="op" start="48">eq</span><span class="whitespace" start="50"> </span><span class="op">'</span><span class="literal" start="51">av</span><span class="op">'</span><span class="filter" start="55">]</span><span class="filter" start="56" pair-end="58" select="quick">[</span><span class="numeric" start="57">1</span><span class="filter" start="58">]</span><span class="op">}</span><span class="z">"</span><span id="wx2703" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2707" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="cl">xmlns</span><span id="wx2711" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx2715" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w2717"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-root-spans">get-root-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w2727"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx2747" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w2749"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2763" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w2765"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx2782" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w2784"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">lt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$spans</span><span class="parenthesis" start="27">)</span><span class="whitespace" start="28">
                  
</span><span class="op" start="30">and</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$span</span><span class="step" start="39">/</span><span class="axis" start="40">@</span><span class="qname" start="41" select="quick">class</span><span class="whitespace" start="46"> </span><span class="op" start="47">ne</span><span class="whitespace" start="49"> </span><span class="op">'</span><span class="literal" start="50">scx</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w2818"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span id="wx2826" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w2828"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w2838"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx2856" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2860" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2864" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2868" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w2870"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-next-class">get-next-class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w2886"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx2906" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w2908"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2922" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w2924"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2944" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w2946"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx2963" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w2965"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w2969"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="whitespace" start="13"> </span><span class="op" start="14">eq</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$class</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w2986"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span id="wx2994" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2998" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w3000"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">lt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$spans</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w3021"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?get-root-spans" class="solar"><span class="tcall">get-root-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w3031"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx3049" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3053" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3057" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3061" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3065" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w3067"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}indentTextSpan">f:indentTextSpan</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w3083"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx3097" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3099"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3113" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3115"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?margin">margin</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3129" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3131"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?an-offset">an-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3145" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3147"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?av-offset">av-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3161" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3163"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?outdent">outdent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3177" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3179"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nextClass">nextClass</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx3193" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3195"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevClass">prevClass</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx3209" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3211"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?multi-line">multi-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3225" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w3227"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3241" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3243"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="z">"</span><span id="wx3260" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3262"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line-parts">line-parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w3278"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\n.*|\r\n.*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w3294"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w3298"><span class="es">&lt;</span><span class="en">nl</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w3302"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="15" select="quick">substring</span></a><span class="parenthesis">(</span><span class="context" start="11">.</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">2</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx3328" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w3330"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="5" select="quick">$auto-trim</span></a><span class="parenthesis" start="15">)</span><span class="whitespace" start="16">
                                  
</span><span class="op" start="18">then</span><span class="whitespace" start="22"> </span><a href="xmlspectrum.xsl.html#f?{internal}left-trim" class="solar"><span class="function" start="23" pair-end="40" select="quick">f:left-trim</span></a><span class="parenthesis">(</span><span class="variable" start="35" select="quick">$text</span><span class="parenthesis" start="40">)</span><span class="whitespace" start="41">
                                  
</span><span class="op" start="43">else</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$text</span><span class="z">"</span><span id="wx3353" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">nl</span><span id="wx3357" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx3361" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w3363"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w3367"><span class="es">&lt;</span><span class="en">tt</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w3371"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3379" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">tt</span><span id="wx3383" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx3387" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx3391" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3395" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3397"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?firstLine">firstLine</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$line-parts</span><span class="filter" start="12" pair-end="14" select="quick">[</span><span class="numeric" start="13">1</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx3420" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3422"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indented-lines">indented-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w3438"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$a" class="variable" start="5" select="quick">$a</span><span class="whitespace" start="7"> </span><span class="op" start="8">in</span><span class="whitespace" start="10"> </span><span class="variable" start="11" select="quick">$line-parts</span><span class="filter" start="22" pair-end="38" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="23" pair-end="29" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="28">.</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">eq</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">nl</span><span class="op">'</span><span class="filter" start="38">]</span><span class="whitespace" start="39"> </span><span class="op" start="40">return</span><span class="whitespace" start="46">
                            
</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="48" pair-end="57" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="55" select="quick">$a</span><span class="parenthesis" start="57">)</span><span class="z">"</span><span id="wx3471" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3475" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3477"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?flat-part">flat-part</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$line-parts</span><span class="filter" start="12" pair-end="28" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="13" pair-end="19" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="18">.</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">eq</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">tt</span><span class="op">'</span><span class="filter" start="28">]</span><span class="z">"</span><span id="wx3509" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    </span><span class="z">&lt;!--</span><span class="cm"> should be max of 1 </span><span class="z">--&gt;</span><span class="txt">
    
</span><span class="ww" id="w3515"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?flat-line">flat-line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><span class="variable" start="5" select="quick">$flat-part</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$flat-part</span><span class="whitespace" start="32"> </span><span class="op" start="33">else</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"></span><span class="op">'</span><span class="z">"</span><span id="wx3549" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    &#xD;
    </span><span class="z">&lt;!--</span><span class="cm"> constant indent when first attribute is on a new line </span><span class="z">--&gt;</span><span class="txt">
    
</span><span class="ww" id="w3555"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?compact">compact</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">4</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3575" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    </span><span class="ww" id="w3577"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?lineOffset">lineOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="23" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="22" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$firstLine</span><span class="parenthesis" start="22">)</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24">
                          
    </span><span class="op" start="30">then</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="35" pair-end="59" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="49" select="quick">$firstLine</span><span class="parenthesis" start="59">)</span><span class="whitespace" start="60">
                          
</span><span class="op" start="62">else</span><span class="whitespace" start="66"> </span><span class="numeric" start="67">0</span><span class="z">"</span><span id="wx3615" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3617"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?an-outOffset">an-outOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><span class="variable" start="5" select="quick">$class</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="27" select="quick">(</span><span class="op">'</span><span class="literal" start="15">en</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">enxsl</span><span class="op">'</span><span class="parenthesis" start="27">)</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                          
    </span><span class="op" start="35">then</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$lineOffset</span><span class="whitespace" start="51"> </span><span class="op" start="52">+</span><span class="whitespace" start="53"> </span><span class="numeric" start="54">1</span><span class="whitespace" start="55">
                          
</span><span class="op" start="57">else</span><span class="whitespace" start="61"> </span><span class="if" start="62">if</span><span class="whitespace" start="64"> </span><span class="parenthesis" start="65" pair-end="93" select="quick">(</span><span class="variable" start="66" select="quick">$prevClass</span><span class="whitespace" start="76"> </span><span class="op" start="77">=</span><span class="whitespace" start="78"> </span><span class="parenthesis" start="79" pair-end="92" select="quick">(</span><span class="op">'</span><span class="literal" start="80">en</span><span class="op">'</span><span class="op" start="84">,</span><span class="op">'</span><span class="literal" start="85">enxsl</span><span class="op">'</span><span class="parenthesis" start="92">)</span><span class="parenthesis" start="93">)</span><span class="whitespace" start="94">
                          
    </span><span class="op" start="100">then</span><span class="whitespace" start="104">
                          
</span><span class="if" start="106">if</span><span class="whitespace" start="108"> </span><span class="parenthesis" start="109" pair-end="133" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="110" pair-end="132" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="117" select="quick">$indented-lines</span><span class="parenthesis" start="132">)</span><span class="parenthesis" start="133">)</span><span class="whitespace" start="134"> </span><span class="op" start="135">then</span><span class="whitespace" start="139"> 
                          
    </span><span class="variable" start="146" select="quick">$compact</span><span class="whitespace" start="154">
                          
    </span><span class="op" start="160">else</span><span class="whitespace" start="164"> </span><span class="variable" start="165" select="quick">$an-offset</span><span class="whitespace" start="175"> </span><span class="op" start="176">+</span><span class="whitespace" start="177"> </span><span class="variable" start="178" select="quick">$lineOffset</span><span class="whitespace" start="189">
                          
</span><span class="op" start="191">else</span><span class="whitespace" start="195"> </span><span class="variable" start="196" select="quick">$an-offset</span><span class="z">"</span><span id="wx3708" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3710"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?av-outOffset">av-outOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="32" select="quick">(</span><span class="variable" start="5" select="quick">$prevClass</span><span class="whitespace" start="15"> </span><span class="op" start="16">=</span><span class="whitespace" start="17"> </span><span class="parenthesis" start="18" pair-end="31" select="quick">(</span><span class="op">'</span><span class="literal" start="19">en</span><span class="op">'</span><span class="op" start="23">,</span><span class="op">'</span><span class="literal" start="24">enxsl</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="parenthesis" start="32">)</span><span class="whitespace" start="33">
                          
    </span><span class="op" start="39">then</span><span class="whitespace" start="43"> </span><span class="numeric" start="44">0</span><span class="whitespace" start="45">
                          
</span><span class="op" start="47">else</span><span class="whitespace" start="51"> </span><span class="if" start="52">if</span><span class="whitespace" start="54"> </span><span class="parenthesis" start="55" pair-end="87" select="quick">(</span><span class="variable" start="56" select="quick">$class</span><span class="whitespace" start="62"> </span><span class="op" start="63">eq</span><span class="whitespace" start="65"> </span><span class="op">'</span><span class="literal" start="66">atn</span><span class="op">'</span><span class="whitespace" start="71"> </span><span class="op" start="72">and</span><span class="whitespace" start="75"> </span><span class="variable" start="76" select="quick">$multi-line</span><span class="parenthesis" start="87">)</span><span class="whitespace" start="88">
                          
    </span><span class="op" start="94">then</span><span class="whitespace" start="98"> </span><span class="variable" start="99" select="quick">$lineOffset</span><span class="whitespace" start="110"> 
                          
</span><span class="op" start="113">else</span><span class="whitespace" start="117"> </span><span class="if" start="118">if</span><span class="whitespace" start="120"> </span><span class="parenthesis" start="121" pair-end="306" select="quick">(</span><span class="variable" start="122" select="quick">$prevClass</span><span class="whitespace" start="132"> </span><span class="op" start="133">eq</span><span class="whitespace" start="135"> </span><span class="op">'</span><span class="literal" start="136">atneq</span><span class="op">'</span><span class="whitespace" start="143"> </span><span class="op" start="144">or</span><span class="whitespace" start="146"> </span><span class="variable" start="147" select="quick">$class</span><span class="whitespace" start="153"> </span><span class="op" start="154">=</span><span class="whitespace" start="155"> </span><span class="parenthesis" start="156" pair-end="183" select="quick">(</span><span class="op">'</span><span class="literal" start="157">atneq</span><span class="op">'</span><span class="op" start="164">,</span><span class="op">'</span><span class="literal" start="165">atn</span><span class="op">'</span><span class="op" start="170">,</span><span class="op">'</span><span class="literal" start="171">vname</span><span class="op">'</span><span class="op" start="178">,</span><span class="op">'</span><span class="literal" start="179">av</span><span class="op">'</span><span class="parenthesis" start="183">)</span><span class="whitespace" start="184">
                          
    </span><span class="op" start="190">or</span><span class="whitespace" start="192"> </span><span class="parenthesis" start="193" pair-end="253" select="quick">(</span><span class="variable" start="194" select="quick">$class</span><span class="whitespace" start="200"> </span><span class="op" start="201">eq</span><span class="whitespace" start="203"> </span><span class="op">'</span><span class="literal" start="204">z</span><span class="op">'</span><span class="whitespace" start="207"> </span><span class="op" start="208">and</span><span class="whitespace" start="211"> </span><span class="variable" start="212" select="quick">$nextClass</span><span class="whitespace" start="222"> </span><span class="op" start="223">=</span><span class="whitespace" start="224"> </span><span class="parenthesis" start="225" pair-end="252" select="quick">(</span><span class="op">'</span><span class="literal" start="226">atneq</span><span class="op">'</span><span class="op" start="233">,</span><span class="op">'</span><span class="literal" start="234">atn</span><span class="op">'</span><span class="op" start="239">,</span><span class="op">'</span><span class="literal" start="240">vname</span><span class="op">'</span><span class="op" start="247">,</span><span class="op">'</span><span class="literal" start="248">av</span><span class="op">'</span><span class="parenthesis" start="252">)</span><span class="parenthesis" start="253">)</span><span class="whitespace" start="254">
                          
</span><span class="op" start="256">or</span><span class="whitespace" start="258"> </span><span class="parenthesis" start="259" pair-end="305" select="quick">(</span><span class="variable" start="260" select="quick">$class</span><span class="whitespace" start="266"> </span><span class="op" start="267">eq</span><span class="whitespace" start="269"> </span><span class="op">'</span><span class="literal" start="270">z</span><span class="op">'</span><span class="whitespace" start="273"> </span><span class="op" start="274">and</span><span class="whitespace" start="277"> </span><span class="variable" start="278" select="quick">$prevClass</span><span class="whitespace" start="288"> </span><span class="op" start="289">=</span><span class="whitespace" start="290"> </span><span class="parenthesis" start="291" pair-end="304" select="quick">(</span><span class="op">'</span><span class="literal" start="292">vname</span><span class="op">'</span><span class="op" start="299">,</span><span class="op">'</span><span class="literal" start="300">av</span><span class="op">'</span><span class="parenthesis" start="304">)</span><span class="parenthesis" start="305">)</span><span class="parenthesis" start="306">)</span><span class="whitespace" start="307">
                          
    </span><span class="op" start="313">then</span><span class="whitespace" start="317"> </span><span class="variable" start="318" select="quick">$av-offset</span><span class="whitespace" start="328"> </span><span class="op" start="329">+</span><span class="whitespace" start="330"> </span><span class="variable" start="331" select="quick">$lineOffset</span><span class="whitespace" start="342">
                          
</span><span class="op" start="344">else</span><span class="whitespace" start="348"> </span><span class="variable" start="349" select="quick">$av-offset</span><span class="z">"</span><span id="wx3886" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3888"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?offset">offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="32" select="quick">(</span><span class="variable" start="5" select="quick">$prevClass</span><span class="whitespace" start="15"> </span><span class="op" start="16">=</span><span class="whitespace" start="17"> </span><span class="parenthesis" start="18" pair-end="31" select="quick">(</span><span class="op">'</span><span class="literal" start="19">en</span><span class="op">'</span><span class="op" start="23">,</span><span class="op">'</span><span class="literal" start="24">enxsl</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="parenthesis" start="32">)</span><span class="whitespace" start="33">
                          
    </span><span class="op" start="39">then</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$compact</span><span class="whitespace" start="52">
                          
</span><span class="op" start="54">else</span><span class="whitespace" start="58"> </span><span class="if" start="59">if</span><span class="whitespace" start="61"> </span><span class="parenthesis" start="62" pair-end="82" select="quick">(</span><span class="variable" start="63" select="quick">$nextClass</span><span class="whitespace" start="73"> </span><span class="op" start="74">eq</span><span class="whitespace" start="76"> </span><span class="op">'</span><span class="literal" start="77">atn</span><span class="op">'</span><span class="parenthesis" start="82">)</span><span class="whitespace" start="83"> 
                          
    </span><span class="op" start="90">then</span><span class="whitespace" start="94"> </span><span class="variable" start="95" select="quick">$an-outOffset</span><span class="whitespace" start="108">
                          
</span><span class="op" start="110">else</span><span class="whitespace" start="114"> </span><span class="if" start="115">if</span><span class="whitespace" start="117"> </span><span class="parenthesis" start="118" pair-end="162" select="quick">(</span><span class="variable" start="119" select="quick">$nextClass</span><span class="whitespace" start="129"> </span><span class="op" start="130">=</span><span class="whitespace" start="131"> </span><span class="op">'</span><span class="literal" start="132">av</span><span class="op">'</span><span class="whitespace" start="136"> </span><span class="op" start="137">or</span><span class="whitespace" start="139"> </span><span class="variable" start="140" select="quick">$class</span><span class="whitespace" start="146"> </span><span class="op" start="147">eq</span><span class="whitespace" start="149"> </span><span class="op">'</span><span class="literal" start="150">whitespace</span><span class="op">'</span><span class="parenthesis" start="162">)</span><span class="whitespace" start="163">
                          
    </span><span class="op" start="169">then</span><span class="whitespace" start="173"> </span><span class="variable" start="174" select="quick">$an-outOffset</span><span class="whitespace" start="187"> </span><span class="op" start="188">+</span><span class="whitespace" start="189"> </span><span class="variable" start="190" select="quick">$av-outOffset</span><span class="whitespace" start="203">
                          
</span><span class="op" start="205">else</span><span class="whitespace" start="209"> </span><span class="numeric" start="210">0</span><span class="z">"</span><span id="wx3982" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w3984"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent">indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}createIndent" class="solar"><span class="function" start="1" pair-end="44" select="quick">f:createIndent</span></a><span class="parenthesis">(</span><span class="parenthesis" start="16" pair-end="33" select="quick">(</span><span class="variable" start="17" select="quick">$level</span><span class="whitespace" start="23"> </span><span class="op" start="24">*</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$margin</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">+</span><span class="whitespace" start="36"> </span><span class="variable" start="37" select="quick">$offset</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span id="wx4011" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4013"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?last-level">last-level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="13" select="quick">(</span><span class="variable" start="5" select="quick">$outdent</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">then</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$level</span><span class="whitespace" start="26"> </span><span class="op" start="27">-</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="whitespace" start="30"> </span><span class="op" start="31">else</span><span class="whitespace" start="35"> </span><span class="variable" start="36" select="quick">$level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4049" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4051"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?last-indent">last-indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}createIndent" class="solar"><span class="function" start="1" pair-end="49" select="quick">f:createIndent</span></a><span class="parenthesis">(</span><span class="parenthesis" start="16" pair-end="38" select="quick">(</span><span class="variable" start="17" select="quick">$last-level</span><span class="whitespace" start="28"> </span><span class="op" start="29">*</span><span class="whitespace" start="30"> </span><span class="variable" start="31" select="quick">$margin</span><span class="parenthesis" start="38">)</span><span class="whitespace" start="39"> </span><span class="op" start="40">+</span><span class="whitespace" start="41"> </span><span class="variable" start="42" select="quick">$offset</span><span class="parenthesis" start="49">)</span><span class="z">"</span><span id="wx4078" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    </span><span class="ww" id="w4080"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line-count">line-count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="22" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$indented-lines</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4103" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w4105"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-text">span-text</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="27" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$indented-lines</span><span class="parenthesis" start="27">)</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                          
</span><span class="op" start="31">then</span><span class="whitespace" start="35"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="36" pair-end="223" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="whitespace" start="48">
                          
</span><span class="parenthesis" start="50" pair-end="217" select="quick">(</span><span class="variable" start="51" select="quick">$flat-line</span><span class="op" start="61">,</span><span class="whitespace" start="62">
                          
</span><span class="higher" start="64">for</span><span class="whitespace" start="67"> </span><span id="rng-$num" class="variable" start="68" select="quick">$num</span><span class="whitespace" start="72"> </span><span class="op" start="73">in</span><span class="whitespace" start="75"> </span><span class="numeric" start="76">1</span><span class="whitespace" start="77"> </span><span class="op" start="78">to</span><span class="whitespace" start="80"> </span><span class="variable" start="81" select="quick">$line-count</span><span class="whitespace" start="92"> </span><span class="op" start="93">-</span><span class="whitespace" start="94"> </span><span class="numeric" start="95">1</span><span class="whitespace" start="96"> </span><span class="op" start="97">return</span><span class="whitespace" start="103">
                          
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="105" pair-end="151" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="112">&amp;#10;</span><span class="op">'</span><span class="op" start="119">,</span><span class="whitespace" start="120"> </span><a href="highlight-file.xsl.html#v?indent" class="solar"><span class="variable" start="121" select="quick">$indent</span></a><span class="op" start="128">,</span><span class="whitespace" start="129"> </span><span class="variable" start="130" select="quick">$indented-lines</span><span class="filter" start="145" pair-end="150" select="quick">[</span><span class="variable" start="146" select="quick">$num</span><span class="filter" start="150">]</span><span class="parenthesis" start="151">)</span><span class="op" start="152">,</span><span class="whitespace" start="153">
                          
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="155" pair-end="213" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="162">&amp;#10;</span><span class="op">'</span><span class="op" start="169">,</span><span class="whitespace" start="170"> </span><span class="variable" start="171" select="quick">$last-indent</span><span class="op" start="183">,</span><span class="whitespace" start="184"> </span><span class="variable" start="185" select="quick">$indented-lines</span><span class="filter" start="200" pair-end="212" select="quick">[</span><span class="variable" start="201" select="quick">$line-count</span><span class="filter" start="212">]</span><span class="parenthesis" start="213">)</span><span class="whitespace" start="214"> 
                          
</span><span class="parenthesis" start="217">)</span><span class="op" start="218">,</span><span class="whitespace" start="219">
                          
</span><span class="op">'</span><span class="literal" start="221"></span><span class="op">'</span><span class="parenthesis" start="223">)</span><span class="whitespace" start="224">
                          
</span><span class="op" start="226">else</span><span class="whitespace" start="230"> </span><span class="if" start="231">if</span><span class="whitespace" start="233"> </span><span class="parenthesis" start="234" pair-end="263" select="quick">(</span><span class="variable" start="235" select="quick">$multi-line</span><span class="whitespace" start="246"> </span><span class="op" start="247">and</span><span class="whitespace" start="250"> </span><span class="variable" start="251" select="quick">$offset</span><span class="whitespace" start="258"> </span><span class="op" start="259">gt</span><span class="whitespace" start="261"> </span><span class="numeric" start="262">0</span><span class="parenthesis" start="263">)</span><span class="whitespace" start="264"> </span><span class="op" start="265">then</span><span class="whitespace" start="269">
                          
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="271" pair-end="309" select="quick">concat</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?indent" class="solar"><span class="variable" start="278" select="quick">$indent</span></a><span class="op" start="285">,</span><span class="whitespace" start="286"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="287" pair-end="308" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="294" select="quick">$line-parts</span><span class="filter" start="305" pair-end="307" select="quick">[</span><span class="numeric" start="306">1</span><span class="filter" start="307">]</span><span class="parenthesis" start="308">)</span><span class="parenthesis" start="309">)</span><span class="whitespace" start="310">
                          
</span><span class="op" start="312">else</span><span class="whitespace" start="316"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="317" pair-end="338" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="324" select="quick">$line-parts</span><span class="filter" start="335" pair-end="337" select="quick">[</span><span class="numeric" start="336">1</span><span class="filter" start="337">]</span><span class="parenthesis" start="338">)</span><span class="z">"</span><span id="wx4242" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4244"><span class="es">&lt;</span><span class="en">output</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w4248"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w4252"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">*</span><span class="z">"</span><span id="wx4263" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w4265"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span-text</span><span class="z">"</span><span id="wx4273" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx4277" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w4279"><span class="es">&lt;</span><span class="en">an-offset</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w4283"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$an-outOffset</span><span class="z">"</span><span id="wx4291" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="cl">an-offset</span><span id="wx4295" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w4297"><span class="es">&lt;</span><span class="en">av-offset</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w4301"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$av-outOffset</span><span class="z">"</span><span id="wx4309" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="cl">av-offset</span><span id="wx4313" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w4315"><span class="es">&lt;</span><span class="en">multi-line</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w4319"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="23" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$indented-lines</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx4330" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="cl">multi-line</span><span id="wx4334" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="cl">output</span><span id="wx4338" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4342" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w4344"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}left-trim">f:left-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4360"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span id="wx4368" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4370"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="26" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$text</span><span class="op" start="14">,</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">^\s+</span><span class="op">'</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24"></span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx4391" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4395" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w4397"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}createIndent">f:createIndent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4413"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padCount">padCount</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4427" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4429"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">ge</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w4443"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="1" pair-end="53" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="13">for</span><span class="whitespace" start="16"> </span><span id="rng-$i" class="variable" start="17" select="quick">$i</span><span class="whitespace" start="19"> </span><span class="op" start="20">in</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">1</span><span class="whitespace" start="24"> </span><span class="op" start="25">to</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$padCount</span><span class="whitespace" start="37"> 
                            
</span><span class="op" start="40">return</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47"> </span><span class="op">'</span><span class="op" start="50">,</span><span class="op">'</span><span class="literal" start="51"></span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx4474" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4478" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4482" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm">
  
XSLT function signature: &#xD;
      f:get-css(is-light-theme)&#xD;
  &#xD;
  description:&#xD;
  &#xD;
      Generates a CSS file used to colorise span elements generates by the previous 2 functions&#xD;
      The colors generated depend on whether a light or dark them is specified with the is-light-theme&#xD;
      parameter. The color theme uses the 'Solarized' color points specified at: http://ethanschoonover.com/solarized&#xD;
  &#xD;
  params:&#xD;
      is-light-theme: boolean indicating whether to generate colors for a light or dark background. &#xD;
  &#xD;
  </span><span class="z">--&gt;</span><span class="txt">
  
</span><span class="ww" id="w4488"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-css">f:get-css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4498"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-light-theme">is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4512" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4514"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-document" class="solar"><span class="function" start="1" pair-end="12" select="quick">document</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="10"></span><span class="op">'</span><span class="parenthesis" start="12">)</span><span class="step" start="13">/</span><span class="qname" start="14" select="quick">xsl:stylesheet</span><span class="step" start="28">/</span><span class="qname" start="29" select="quick">css:theme</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w4539"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx4559" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx4563" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4567" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w4569"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}prefixed-name">f:prefixed-name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4585"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx4599" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4601"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?name">name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string+</span><span class="z">"</span><span id="wx4615" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4617"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$name</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w4627"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="18" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$prefix</span><span class="op" start="15">,</span><span class="whitespace" start="16"> </span><span class="context" start="17">.</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span id="wx4641" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx4645" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4649" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w4651"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-xsd-names">f:get-xsd-names</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4667"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx4681" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4683"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
        
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$a" class="variable" start="5" select="quick">$a</span><span class="whitespace" start="7"> </span><span class="op" start="8">in</span><span class="whitespace" start="10"> </span><span class="parenthesis" start="11" pair-end="20" select="quick">(</span><span class="op">'</span><span class="literal" start="12">assert</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">return</span><span class="whitespace" start="28"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="29" pair-end="47" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="36" select="quick">$prefix</span><span class="op" start="43">,</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$a</span><span class="parenthesis" start="47">)</span><span class="z">"</span><span id="wx4711" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4715" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w4717"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-xsd-fnames">f:get-xsd-fnames</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4733"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx4747" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4749"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">
        
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$a" class="variable" start="5" select="quick">$a</span><span class="whitespace" start="7"> </span><span class="op" start="8">in</span><span class="whitespace" start="10"> </span><span class="parenthesis" start="11" pair-end="33" select="quick">(</span><span class="op">'</span><span class="literal" start="12">element</span><span class="op">'</span><span class="op" start="21">,</span><span class="op">'</span><span class="literal" start="22">attribute</span><span class="op">'</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">return</span><span class="whitespace" start="41"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="42" pair-end="60" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="49" select="quick">$prefix</span><span class="op" start="56">,</span><span class="whitespace" start="57"> </span><span class="variable" start="58" select="quick">$a</span><span class="parenthesis" start="60">)</span><span class="z">"</span><span id="wx4781" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4785" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w4787"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">css:font</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4803"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="24" select="quick">(</span><a href="highlight-file.xsl.html#v?font-name" class="solar"><span class="variable" start="5" select="quick">$font-name</span></a><span class="whitespace" start="15"> </span><span class="op" start="16">eq</span><span class="whitespace" start="18"> </span><span class="op">'</span><span class="literal" start="19">scp</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="whitespace" start="25"> </span><span class="op" start="26">then</span><span class="whitespace" start="30"> </span><span class="axis" start="31">@</span><span class="qname" start="32" select="quick">scp</span><span class="whitespace" start="35"> </span><span class="op" start="36">else</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41"></span><span class="op">'</span><span class="z">"</span><span id="wx4832" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4836" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w4838"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">css:background</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">css</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4854"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-light-theme">is-light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4874" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4876"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-light-theme</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="axis" start="27">@</span><span class="qname" start="28" select="quick">light</span><span class="whitespace" start="33"> </span><span class="op" start="34">else</span><span class="whitespace" start="38"> </span><span class="axis" start="39">@</span><span class="qname" start="40" select="quick">dark</span><span class="z">"</span><span id="wx4898" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4902" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  &#xD;
  </span><span class="ww" id="w4904"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}getTagType">f:getTagType</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w4914"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx4928" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4930"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t">t</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="z">"</span><span id="wx4944" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4946"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t1">t1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="17" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$t</span><span class="op" start="13">,</span><span class="numeric" start="14">1</span><span class="op" start="15">,</span><span class="numeric" start="16">1</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span id="wx4967" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w4969"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t2">t2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="17" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$t</span><span class="op" start="13">,</span><span class="numeric" start="14">2</span><span class="op" start="15">,</span><span class="numeric" start="16">1</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span id="wx4990" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w4992"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w4996"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">?</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5012"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">pi</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">?</span><span class="op">'</span><span class="z">"</span><span id="wx5026" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5030" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w5032"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">!</span><span class="op">'</span><span class="whitespace" start="11"> </span><span class="op" start="12">and</span><span class="whitespace" start="15"> </span><span class="variable" start="16" select="quick">$t2</span><span class="whitespace" start="19"> </span><span class="op" start="20">eq</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">-</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5058"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">cm</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">!--</span><span class="op">'</span><span class="z">"</span><span id="wx5072" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5076" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w5078"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">!</span><span class="op">'</span><span class="whitespace" start="11"> </span><span class="op" start="12">and</span><span class="whitespace" start="15"> </span><span class="variable" start="16" select="quick">$t2</span><span class="whitespace" start="19"> </span><span class="op" start="20">eq</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">[</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5104"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">cd</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">![CDATA[</span><span class="op">'</span><span class="z">"</span><span id="wx5118" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5122" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w5124"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">!</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5140"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">dt</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">!</span><span class="op">'</span><span class="z">"</span><span id="wx5154" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5158" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w5160"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t1</span><span class="whitespace" start="4"> </span><span class="op" start="5">eq</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">/</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w5176"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">cl</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6">/</span><span class="op">'</span><span class="z">"</span><span id="wx5190" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5194" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="z">&lt;!--</span><span class="cm"> open tag (may be  self-closing) </span><span class="z">--&gt;</span><span class="txt">
      
</span><span class="ww" id="w5200"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5204"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">tg</span><span class="op">'</span><span class="op" start="5">,</span><span class="op">'</span><span class="literal" start="6"></span><span class="op">'</span><span class="z">"</span><span id="wx5218" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5222" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5226" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5230" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w5232"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}expected-offset">f:expected-offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w5248"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?in">in</span><span class="z">"</span><span id="wx5256" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5258"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="19" select="quick">(</span><span class="variable" start="5" select="quick">$in</span><span class="whitespace" start="8"> </span><span class="op" start="9">eq</span><span class="whitespace" start="11"> </span><span class="op">'</span><span class="literal" start="12">?&amp;gt;</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">then</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">2</span><span class="whitespace" start="27">
                          
</span><span class="op" start="29">else</span><span class="whitespace" start="33"> </span><span class="if" start="34">if</span><span class="whitespace" start="36"> </span><span class="parenthesis" start="37" pair-end="53" select="quick">(</span><span class="variable" start="38" select="quick">$in</span><span class="whitespace" start="41"> </span><span class="op" start="42">eq</span><span class="whitespace" start="44"> </span><span class="op">'</span><span class="literal" start="45">--&amp;gt;</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="whitespace" start="54"> </span><span class="op" start="55">then</span><span class="whitespace" start="59"> </span><span class="numeric" start="60">3</span><span class="whitespace" start="61">
                          
</span><span class="op" start="63">else</span><span class="whitespace" start="67"> </span><span class="if" start="68">if</span><span class="whitespace" start="70"> </span><span class="parenthesis" start="71" pair-end="84" select="quick">(</span><span class="variable" start="72" select="quick">$in</span><span class="whitespace" start="75"> </span><span class="op" start="76">eq</span><span class="whitespace" start="78"> </span><span class="op">'</span><span class="literal" start="79">]]&gt;</span><span class="op">'</span><span class="parenthesis" start="84">)</span><span class="whitespace" start="85"> </span><span class="op" start="86">then</span><span class="whitespace" start="90"> </span><span class="numeric" start="91">9</span><span class="whitespace" start="92">
                          
</span><span class="op" start="94">else</span><span class="whitespace" start="98"> </span><span class="numeric" start="99">1</span><span class="z">"</span><span id="wx5320" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5324" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w5326"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}iterateTokens">f:iterateTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w5342"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?counter">counter</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5356" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5358"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5372" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5374"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5388" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5390"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?expected">expected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5404" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5406"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?beganAt">beganAt</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5420" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5422"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5436" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5438"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx5452" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5454"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5468" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w5470"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsd">is-xsd</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$is-xsl</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx5493" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w5495"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx5518" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5520"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevToken">prevToken</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="19" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="whitespace" start="15"> </span><span class="op" start="16">+</span><span class="whitespace" start="17"> </span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx5547" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5549"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nextToken">nextToken</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="19" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="whitespace" start="15"> </span><span class="op" start="16">-</span><span class="whitespace" start="17"> </span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx5576" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w5578"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?awaiting">awaiting</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expected</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">n</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx5604" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    </span><span class="z">&lt;!--</span><span class="cm">
    
&lt;trace&gt;&#xD;
    token: &lt;xsl:value-of select="$token"/&gt;&#xD;
    expected: &lt;xsl:value-of select="$expected"/&gt;&#xD;
    index: &lt;xsl:value-of select="$index"/&gt;&#xD;
    &lt;/trace&gt;&#xD;
    &#xD;
    </span><span class="z">--&gt;</span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w5610"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?expectedOutput">expectedOutput</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w5626"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="z">&lt;!--</span><span class="cm">  looking to close an open tag </span><span class="z">--&gt;</span><span class="txt">
        
</span><span class="z">&lt;!--</span><span class="cm"> consider: &lt;!DOCTYPE person [&lt;!ELEMENT ... ]&gt; as well as reference only </span><span class="z">--&gt;</span><span class="txt">
        
</span><span class="ww" id="w5644"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?beforeFind">beforeFind</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="35" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$token</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$expected</span><span class="parenthesis" start="35">)</span><span class="z">"</span><span id="wx5664" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w5666"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?found">found</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="36" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="5" pair-end="30" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$beforeFind</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">gt</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">0</span><span class="parenthesis" start="36">)</span><span class="whitespace" start="37">
                              
</span><span class="op" start="39">then</span><span class="whitespace" start="43"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="44" pair-end="49" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50"> 
                              
</span><span class="op" start="53">else</span><span class="whitespace" start="57"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="58" pair-end="92" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="70" select="quick">$beforeFind</span><span class="op" start="81">,</span><span class="whitespace" start="82"> </span><span class="variable" start="83" select="quick">$expected</span><span class="parenthesis" start="92">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx5713" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w5715"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$found</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w5725"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?offset">offset</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}expected-offset" class="solar"><span class="function" start="1" pair-end="28" select="quick">f:expected-offset</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$expected</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5748" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w5750"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?begin-token">begin-token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="17" select="quick">[</span><span class="variable" start="9" select="quick">$beganAt</span><span class="filter" start="17">]</span><span class="z">"</span><span id="wx5767" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w5769"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w5779"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
                
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="50" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">&amp;lt;</span><span class="op">'</span><span class="op" start="14">,</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="15" pair-end="49" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$begin-token</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="numeric" start="39">1</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="variable" start="42" select="quick">$offset</span><span class="parenthesis" start="49">)</span><span class="parenthesis" start="50">)</span><span class="z">"</span><span id="wx5803" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx5807" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w5809"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part-token">part-token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="36" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$begin-token</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$offset</span><span class="whitespace" start="32"> </span><span class="op" start="33">+</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">1</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx5833" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w5835"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w5839"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getTagType" class="solar"><span class="function" start="1" pair-end="31" select="quick">f:getTagType</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$tokens</span><span class="filter" start="21" pair-end="30" select="quick">[</span><span class="variable" start="22" select="quick">$beganAt</span><span class="filter" start="30">]</span><span class="parenthesis" start="31">)</span><span class="filter" start="32" pair-end="34" select="quick">[</span><span class="numeric" start="33">1</span><span class="filter" start="34">]</span><span class="z">"</span><span id="wx5862" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w5864"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> 
                
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="1" pair-end="131" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="whitespace" start="13">
                        
</span><span class="parenthesis" start="15" pair-end="124" select="quick">(</span><span class="variable" start="16" select="quick">$part-token</span><span class="op" start="27">,</span><span class="whitespace" start="28">
                        
</span><span class="higher" start="30">for</span><span class="whitespace" start="33"> </span><span id="rng-$x" class="variable" start="34" select="quick">$x</span><span class="whitespace" start="36"> </span><span class="op" start="37">in</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$beganAt</span><span class="whitespace" start="48"> </span><span class="op" start="49">+</span><span class="whitespace" start="50"> </span><span class="numeric" start="51">1</span><span class="whitespace" start="52"> </span><span class="op" start="53">to</span><span class="whitespace" start="55"> </span><span class="parenthesis" start="56" pair-end="66" select="quick">(</span><span class="variable" start="57" select="quick">$index</span><span class="whitespace" start="63"> </span><span class="numeric" start="64">-1</span><span class="parenthesis" start="66">)</span><span class="whitespace" start="67"> </span><span class="op" start="68">return</span><span class="whitespace" start="74">
                        
</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="76" pair-end="102" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="83">&amp;lt;</span><span class="op">'</span><span class="op" start="89">,</span><span class="whitespace" start="90"> </span><span class="variable" start="91" select="quick">$tokens</span><span class="filter" start="98" pair-end="101" select="quick">[</span><span class="variable" start="99" select="quick">$x</span><span class="filter" start="101">]</span><span class="parenthesis" start="102">)</span><span class="op" start="103">,</span><span class="whitespace" start="104">
                        
</span><span class="op">'</span><span class="literal" start="106">&amp;lt;</span><span class="op">'</span><span class="op" start="112">,</span><span class="variable" start="113" select="quick">$beforeFind</span><span class="parenthesis" start="124">)</span><span class="whitespace" start="125">
                        
</span><span class="op" start="127">,</span><span class="whitespace" start="128"> </span><span class="op">'</span><span class="literal" start="129"></span><span class="op">'</span><span class="parenthesis" start="131">)</span><span class="whitespace" start="132">
                        
</span><span class="z">"</span><span id="wx5928" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx5932" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w5934"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5944"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expected</span><span class="z">"</span><span id="wx5952" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx5956" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w5958"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">txt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="z">&lt;!--</span><span class="cm">
            
id="{js:getStackIndex()}"&gt;&#xD;
            </span><span class="z">--&gt;</span><span class="txt">
            
</span><span class="ww" id="w5972"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="76" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="19" pair-end="44" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$beforeFind</span><span class="parenthesis" start="44">)</span><span class="whitespace" start="45"> </span><span class="op" start="46">+</span><span class="whitespace" start="47"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="48" pair-end="71" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="62" select="quick">$expected</span><span class="parenthesis" start="71">)</span><span class="whitespace" start="72"> </span><span class="op" start="73">+</span><span class="whitespace" start="74"> </span><span class="numeric" start="75">1</span><span class="parenthesis" start="76">)</span><span class="z">"</span><span id="wx6000" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx6004" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6008" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6012" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx6016" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w6018"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char1">char1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="21" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="numeric" start="18">1</span><span class="op" start="19">,</span><span class="numeric" start="20">1</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx6045" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w6047"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-element-start">is-element-start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="14" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="20" pair-end="46" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="24" select="quick">$char1</span><span class="whitespace" start="30"> </span><span class="op" start="31">=</span><span class="whitespace" start="32"> </span><span class="parenthesis" start="33" pair-end="45" select="quick">(</span><span class="op">'</span><span class="literal" start="34">?</span><span class="op">'</span><span class="op" start="37">,</span><span class="op">'</span><span class="literal" start="38">!</span><span class="op">'</span><span class="op" start="41">,</span><span class="op">'</span><span class="literal" start="42">/</span><span class="op">'</span><span class="parenthesis" start="45">)</span><span class="parenthesis" start="46">)</span><span class="z">"</span><span id="wx6093" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w6095"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-root-element">is-root-element</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$counter</span><span class="whitespace" start="9"> </span><span class="op" start="10">eq</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">0</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$is-element-start</span><span class="z">"</span><span id="wx6123" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="z">&lt;!--</span><span class="cm"> if root-prefix not initially supplied, get this from the first element name </span><span class="z">--&gt;</span><span class="txt">
    
</span><span class="ww" id="w6129"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-root-prefix">new-root-prefix</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$is-root-element</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22">
                          
</span><span class="op" start="24">then</span><span class="whitespace" start="28"> </span><span class="if" start="29">if</span><span class="whitespace" start="31"> </span><span class="parenthesis" start="32" pair-end="51" select="quick">(</span><span class="variable" start="33" select="quick">$root-prefix</span><span class="whitespace" start="45"> </span><span class="op" start="46">eq</span><span class="whitespace" start="48"> </span><span class="op">'</span><span class="literal" start="49"></span><span class="op">'</span><span class="parenthesis" start="51">)</span><span class="whitespace" start="52">
                          
    </span><span class="op" start="58">then</span><span class="whitespace" start="62"> 
                          
        </span><span class="higher" start="73">for</span><span class="whitespace" start="76"> </span><span id="rng-$s" class="variable" start="77" select="quick">$s</span><span class="whitespace" start="79"> </span><span class="op" start="80">in</span><span class="whitespace" start="82"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="83" pair-end="111" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="100" select="quick">$token</span><span class="op" start="106">,</span><span class="whitespace" start="107"> </span><span class="op">'</span><span class="literal" start="108">:</span><span class="op">'</span><span class="parenthesis" start="111">)</span><span class="whitespace" start="112"> </span><span class="op" start="113">return</span><span class="whitespace" start="119">
                          
            </span><span class="if" start="133">if</span><span class="whitespace" start="135"> </span><span class="parenthesis" start="136" pair-end="145" select="quick">(</span><span class="variable" start="137" select="quick">$s</span><span class="whitespace" start="139"> </span><span class="op" start="140">eq</span><span class="whitespace" start="142"> </span><span class="op">'</span><span class="literal" start="143"></span><span class="op">'</span><span class="parenthesis" start="145">)</span><span class="whitespace" start="146"> </span><span class="op" start="147">then</span><span class="whitespace" start="151"> </span><span class="op">'</span><span class="literal" start="152"></span><span class="op">'</span><span class="whitespace" start="154"> </span><span class="op" start="155">else</span><span class="whitespace" start="159"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="160" pair-end="174" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="167" select="quick">$s</span><span class="op" start="169">,</span><span class="whitespace" start="170"> </span><span class="op">'</span><span class="literal" start="171">:</span><span class="op">'</span><span class="parenthesis" start="174">)</span><span class="whitespace" start="175">
                          
    </span><span class="op" start="181">else</span><span class="whitespace" start="185"> </span><span class="variable" start="186" select="quick">$root-prefix</span><span class="whitespace" start="198">
                          
</span><span class="op" start="200">else</span><span class="whitespace" start="204"> </span><span class="variable" start="205" select="quick">$root-prefix</span><span class="z">"</span><span id="wx6219" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    </span><span class="z">&lt;!--</span><span class="cm"> return 2 strings if required close found - that befoe and that after (even if empty string)
    
 if no required close found - just return the required close</span><span class="z">--&gt;</span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w6225"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parseStrings">parseStrings</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w6241"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="14" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w6254"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?requiredClose">requiredClose</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w6270"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char2">char2</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="21" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="numeric" start="18">2</span><span class="op" start="19">,</span><span class="numeric" start="20">1</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx6297" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w6299"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w6303"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">?</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">?&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6321" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w6323"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">!</span><span class="op">'</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$char2</span><span class="whitespace" start="25"> </span><span class="op" start="26">eq</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">-</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">--&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6351" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w6353"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">!</span><span class="op">'</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$char2</span><span class="whitespace" start="25"> </span><span class="op" start="26">eq</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">[</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">]]&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6381" class="ec">&gt;</span></span><span class="txt"> </span><span class="z">&lt;!--</span><span class="cm"> assume cdata: &lt;![CDATA[]]&gt; </span><span class="z">--&gt;</span><span class="txt">
            
</span><span class="ww" id="w6387"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">!</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w6403"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="25" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="5" pair-end="24" select="quick">contains</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$token</span><span class="op" start="20">,</span><span class="op">'</span><span class="literal" start="21">[</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="op" start="27">then</span><span class="whitespace" start="31"> </span><span class="op">'</span><span class="literal" start="32">]&gt;</span><span class="op">'</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">&gt;</span><span class="op">'</span><span class="z">"</span><span id="wx6434" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6438" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w6440"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&amp;gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6446" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6450" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx6454" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w6456"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?beforeClose">beforeClose</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="40" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$token</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$requiredClose</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx6482" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w6484"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w6488"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$token</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">eq</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="z">&lt;!--</span><span class="cm">
            
&lt;x/&gt;&#xD;
            </span><span class="z">--&gt;</span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6511" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w6513"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="22" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$is-element-start</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="z">&lt;!--</span><span class="cm"> cdata, dtd, pi, comment, or close-tag </span><span class="z">--&gt;</span><span class="txt">
            
</span><span class="ww" id="w6530"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?foundClose">foundClose</span><span class="z">"</span><span class="z">
                          
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="37" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="5" pair-end="31" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$beforeClose</span><span class="parenthesis" start="31">)</span><span class="whitespace" start="32"> </span><span class="op" start="33">gt</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">0</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">
                                  
</span><span class="op" start="40">then</span><span class="whitespace" start="44"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="45" pair-end="50" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="50">)</span><span class="whitespace" start="51"> 
                                  
</span><span class="op" start="54">else</span><span class="whitespace" start="58"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="59" pair-end="99" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="71" select="quick">$beforeClose</span><span class="op" start="83">,</span><span class="whitespace" start="84"> </span><span class="variable" start="85" select="quick">$requiredClose</span><span class="parenthesis" start="99">)</span><span class="z">"</span><span class="z">
                          
</span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx6577" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w6579"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w6583"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$foundClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w6593"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tagType">tagType</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getTagType" class="solar"><span class="function" start="1" pair-end="20" select="quick">f:getTagType</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$token</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string+</span><span class="z">"</span><span id="wx6616" class="sc">/&gt;</span></span><span class="txt">
                
</span><span class="ww" id="w6618"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tagStart">tagStart</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tagType</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">2</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx6635" class="sc">/&gt;</span></span><span class="txt">
                
</span><span class="ww" id="w6637"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isElementClose">isElementClose</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char1</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">/</span><span class="op">'</span><span class="z">"</span><span id="wx6657" class="sc">/&gt;</span></span><span class="txt">
                
&#xD;
                </span><span class="ww" id="w6659"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$isElementClose</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">ez</span><span class="op">'</span><span class="whitespace" start="31"> </span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><span class="op">'</span><span class="literal" start="37">z</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  
</span><span class="ww" id="w6687"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="24" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">&amp;lt;</span><span class="op">'</span><span class="op" start="14">,</span><span class="variable" start="15" select="quick">$tagStart</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx6702" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx6706" class="ec">&gt;</span></span><span class="txt">
                
</span><span class="ww" id="w6708"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tagContent">tagContent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="53" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$beforeClose</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="25" pair-end="48" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$tagStart</span><span class="parenthesis" start="48">)</span><span class="whitespace" start="49"> </span><span class="op" start="50">+</span><span class="whitespace" start="51"> </span><span class="numeric" start="52">1</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx6735" class="sc">/&gt;</span></span><span class="txt">
                
&#xD;
                </span><span class="ww" id="w6737"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
                  
</span><span class="ww" id="w6741"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isElementClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    
</span><span class="ww" id="w6751"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="55" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl</span><span class="whitespace" start="12"> </span><span class="op" start="13">and</span><span class="whitespace" start="16"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="17" pair-end="54" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$tagContent</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="variable" start="42" select="quick">$root-prefix</span><span class="parenthesis" start="54">)</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56">
                                 
</span><span class="op" start="58">then</span><span class="whitespace" start="62"> </span><span class="op">'</span><span class="literal" start="63">clxsl</span><span class="op">'</span><span class="whitespace" start="70">
                                 
</span><span class="op" start="72">else</span><span class="whitespace" start="76"> </span><span class="if" start="77">if</span><span class="whitespace" start="79"> </span><span class="parenthesis" start="80" pair-end="137" select="quick">(</span><span class="variable" start="81" select="quick">$is-xsd</span><span class="whitespace" start="88"> </span><span class="op" start="89">and</span><span class="whitespace" start="92"> </span><span class="variable" start="93" select="quick">$tagContent</span><span class="whitespace" start="104"> </span><span class="op" start="105">=</span><span class="whitespace" start="106"> </span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-fnames" class="solar"><span class="function" start="107" pair-end="136" select="quick">f:get-xsd-fnames</span></a><span class="parenthesis">(</span><span class="variable" start="124" select="quick">$root-prefix</span><span class="parenthesis" start="136">)</span><span class="parenthesis" start="137">)</span><span class="whitespace" start="138"> </span><span class="op" start="139">then</span><span class="whitespace" start="143"> </span><span class="op">'</span><span class="literal" start="144">clxsl</span><span class="op">'</span><span class="whitespace" start="151">
                                 
</span><span class="op" start="153">else</span><span class="whitespace" start="157"> </span><span class="op">'</span><span class="literal" start="158">cl</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                      
</span><span class="ww" id="w6814"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tagContent</span><span class="z">"</span><span id="wx6822" class="sc">/&gt;</span></span><span class="txt">
                    
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx6826" class="ec">&gt;</span></span><span class="txt">
                  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6830" class="ec">&gt;</span></span><span class="txt">
                  
</span><span class="ww" id="w6832"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                    
</span><span class="ww" id="w6836"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$tagType</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                      
</span><span class="ww" id="w6851"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tagContent</span><span class="z">"</span><span id="wx6859" class="sc">/&gt;</span></span><span class="txt">
                    
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx6863" class="ec">&gt;</span></span><span class="txt">
                  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6867" class="ec">&gt;</span></span><span class="txt">
                
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6871" class="ec">&gt;</span></span><span class="txt">
                
</span><span class="ww" id="w6873"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$isElementClose</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">ec</span><span class="op">'</span><span class="whitespace" start="31"> </span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><span class="op">'</span><span class="literal" start="37">z</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  
</span><span class="ww" id="w6901"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isElementClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    
</span><span class="z">&lt;!--</span><span class="cm">
                    
&lt;xsl:attribute name="id" select="js:stackPop()"/&gt;&#xD;
                    </span><span class="z">--&gt;</span><span class="txt">
                  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6917" class="ec">&gt;</span></span><span class="txt">
                  
</span><span class="ww" id="w6919"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$requiredClose</span><span class="z">"</span><span id="wx6927" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx6931" class="ec">&gt;</span></span><span class="txt">
                
</span><span class="ww" id="w6933"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">txt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  
</span><span class="ww" id="w6943"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isElementClose</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    
</span><span class="z">&lt;!--</span><span class="cm">
                    
&lt;xsl:attribute name="id" select="js:getStackIndex()"/&gt;&#xD;
                    </span><span class="z">--&gt;</span><span class="txt">
                  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6959" class="ec">&gt;</span></span><span class="txt">
                  
</span><span class="ww" id="w6961"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="82" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="19" pair-end="45" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$beforeClose</span><span class="parenthesis" start="45">)</span><span class="whitespace" start="46"> </span><span class="op" start="47">+</span><span class="whitespace" start="48"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="49" pair-end="77" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="63" select="quick">$requiredClose</span><span class="parenthesis" start="77">)</span><span class="whitespace" start="78"> </span><span class="op" start="79">+</span><span class="whitespace" start="80"> </span><span class="numeric" start="81">1</span><span class="parenthesis" start="82">)</span><span class="z">"</span><span id="wx6989" class="sc">/&gt;</span></span><span class="txt">
                
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx6993" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6997" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ww" id="w6999"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w7003"><span class="es">&lt;</span><span class="en">required</span><span class="scx">&gt;</span><span class="txt">
                  
</span><span class="ww" id="w7007"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$requiredClose</span><span class="z">"</span><span id="wx7015" class="sc">/&gt;</span></span><span class="txt">
                
</span><span class="ez">&lt;/</span><span class="cl">required</span><span id="wx7019" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7023" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7027" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7031" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w7033"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            
&#xD;
            </span><span class="ww" id="w7037"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parts">parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w7053"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">&amp;quot;.*?&amp;quot;|'.*?'|[^'&amp;quot;]+|['&amp;quot;]</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="z">"</span><span class="z"> </span><span class="atn">flags</span><span class="atneq">=</span><span class="z">"</span><span class="av">s</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w7075"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
                  
</span><span class="ww" id="w7079"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx7087" class="sc">/&gt;</span></span><span class="txt">
                
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx7091" class="ec">&gt;</span></span><span class="txt">
                
</span><span class="ww" id="w7093"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
                  
</span><span class="ww" id="w7097"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx7105" class="sc">/&gt;</span></span><span class="txt">
                
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx7109" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx7113" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx7117" class="ec">&gt;</span></span><span class="txt">
            
&#xD;
            </span><span class="ww" id="w7119"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getAttributes" class="solar"><span class="function" start="1" pair-end="68" select="quick">f:getAttributes</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$token</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">0</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$parts</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">1</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$is-xsl</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$new-root-prefix</span><span class="op" start="64">,</span><span class="whitespace" start="65"> </span><span class="op">'</span><span class="literal" start="66"></span><span class="op">'</span><span class="parenthesis" start="68">)</span><span class="z">"</span><span id="wx7150" class="sc">/&gt;</span></span><span class="txt">
            
&#xD;
            </span><span class="z">&lt;!--</span><span class="cm"> must be an open tag, so check for attributes </span><span class="z">--&gt;</span><span class="txt">
            
&#xD;
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7158" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7162" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7166" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx7170" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7172"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx7192" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7194"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newCounter">newCounter</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="22" select="quick">(</span><span class="variable" start="5" select="quick">$is-element-start</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23">
                                            
</span><span class="op" start="25">then</span><span class="whitespace" start="29"> </span><span class="variable" start="30" select="quick">$counter</span><span class="whitespace" start="38"> </span><span class="op" start="39">+</span><span class="whitespace" start="40"> </span><span class="numeric" start="41">1</span><span class="whitespace" start="42"> </span><span class="op" start="43">else</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$counter</span><span class="z">"</span><span id="wx7224" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7226"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stillAwaiting">stillAwaiting</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">and</span><span class="whitespace" start="14"> </span><span class="type" start="15">empty</span><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$expectedOutput</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx7253" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7255"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="41" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="5" pair-end="26" select="quick">name</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$parseStrings</span><span class="filter" start="23" pair-end="25" select="quick">[</span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="parenthesis" start="26">)</span><span class="whitespace" start="27"> </span><span class="op" start="28">eq</span><span class="whitespace" start="30"> </span><span class="op">'</span><span class="literal" start="31">required</span><span class="op">'</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w7280"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parseStrings</span><span class="z">"</span><span id="wx7288" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7292" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7294"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expectedOutput</span><span class="z">"</span><span id="wx7302" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    </span><span class="ww" id="w7304"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newExpected">newExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="16" select="quick">(</span><span class="variable" start="5" select="quick">$index</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">then</span><span class="whitespace" start="22">
                          
</span><span class="op">'</span><span class="literal" start="24">n</span><span class="op">'</span><span class="whitespace" start="27">
                          
</span><span class="op" start="29">else</span><span class="whitespace" start="33"> </span><span class="if" start="34">if</span><span class="whitespace" start="36"> </span><span class="parenthesis" start="37" pair-end="52" select="quick">(</span><span class="variable" start="38" select="quick">$stillAwaiting</span><span class="parenthesis" start="52">)</span><span class="whitespace" start="53">
                          
</span><span class="op" start="55">then</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$expected</span><span class="whitespace" start="69">
                          
</span><span class="op" start="71">else</span><span class="whitespace" start="75"> </span><span class="if" start="76">if</span><span class="whitespace" start="78"> </span><span class="parenthesis" start="79" pair-end="105" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="80" pair-end="99" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="86" select="quick">$parseStrings</span><span class="parenthesis" start="99">)</span><span class="whitespace" start="100"> </span><span class="op" start="101">eq</span><span class="whitespace" start="103"> </span><span class="numeric" start="104">1</span><span class="parenthesis" start="105">)</span><span class="whitespace" start="106">
                          
</span><span class="op" start="108">then</span><span class="whitespace" start="112"> </span><span class="variable" start="113" select="quick">$parseStrings</span><span class="whitespace" start="126">
                          
</span><span class="op" start="128">else</span><span class="whitespace" start="132"> </span><span class="op">'</span><span class="literal" start="133">n</span><span class="op">'</span><span class="z">"</span><span id="wx7375" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7377"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newBeganAt">newBeganAt</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="19" select="quick">(</span><span class="variable" start="5" select="quick">$stillAwaiting</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">then</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$beganAt</span><span class="whitespace" start="34"> </span><span class="op" start="35">else</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$index</span><span class="z">"</span><span id="wx7409" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7411"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">le</span><span class="whitespace" start="10"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="11" pair-end="24" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$tokens</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w7428"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}iterateTokens" class="solar"><span class="function" start="1" pair-end="115" select="quick">f:iterateTokens</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$newCounter</span><span class="op" start="28">,</span><span class="whitespace" start="29"> </span><span class="variable" start="30" select="quick">$tokens</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$index</span><span class="whitespace" start="45"> </span><span class="op" start="46">+</span><span class="whitespace" start="47"> </span><span class="numeric" start="48">1</span><span class="op" start="49">,</span><span class="whitespace" start="50">
                            
</span><span class="variable" start="52" select="quick">$newExpected</span><span class="op" start="64">,</span><span class="whitespace" start="65"> </span><span class="variable" start="66" select="quick">$newBeganAt</span><span class="op" start="77">,</span><span class="whitespace" start="78"> </span><span class="variable" start="79" select="quick">$newLevel</span><span class="op" start="88">,</span><span class="whitespace" start="89"> </span><span class="variable" start="90" select="quick">$is-xsl</span><span class="op" start="97">,</span><span class="whitespace" start="98"> </span><span class="variable" start="99" select="quick">$new-root-prefix</span><span class="parenthesis" start="115">)</span><span class="z">"</span><span id="wx7464" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7468" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7472" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w7474"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}getAttributes">f:getAttributes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">item()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w7490"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attToken">attToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx7504" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7506"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?offset">offset</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7520" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7522"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parts">parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx7536" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7538"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7552" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7554"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx7568" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7570"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx7584" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7586"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ename">ename</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx7600" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7602"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsd">is-xsd</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$is-xsl</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx7625" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7627"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part1">part1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parts</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx7650" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w7652"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part2">part2</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parts</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">+</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx7679" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7681"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?elementName">elementName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="17" select="quick">(</span><span class="variable" start="5" select="quick">$ename</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15"></span><span class="op">'</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">then</span><span class="whitespace" start="23">
                          
</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="25" pair-end="51" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="34" select="quick">$part1</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">&gt;|\s+|/</span><span class="op">'</span><span class="parenthesis" start="51">)</span><span class="filter" start="52" pair-end="54" select="quick">[</span><span class="numeric" start="53">1</span><span class="filter" start="54">]</span><span class="whitespace" start="55">
                          
</span><span class="op" start="57">else</span><span class="whitespace" start="61"> </span><span class="variable" start="62" select="quick">$ename</span><span class="z">"</span><span id="wx7730" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7732"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl-element">is-xsl-element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xsl</span><span class="whitespace" start="8"> </span><span class="op" start="9">and</span><span class="whitespace" start="12"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="13" pair-end="48" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$attToken</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="variable" start="36" select="quick">$root-prefix</span><span class="parenthesis" start="48">)</span><span class="z">"</span><span id="wx7756" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7758"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="numeric" start="11">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w7772"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">es</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&amp;lt;</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7784" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w7786"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl-element</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21">
                   
</span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">enxsl</span><span class="op">'</span><span class="whitespace" start="35">
                   
</span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="if" start="42">if</span><span class="whitespace" start="44"> </span><span class="parenthesis" start="45" pair-end="103" select="quick">(</span><span class="variable" start="46" select="quick">$is-xsd</span><span class="whitespace" start="53"> </span><span class="op" start="54">and</span><span class="whitespace" start="57"> </span><span class="variable" start="58" select="quick">$elementName</span><span class="whitespace" start="70"> </span><span class="op" start="71">=</span><span class="whitespace" start="72"> </span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-fnames" class="solar"><span class="function" start="73" pair-end="102" select="quick">f:get-xsd-fnames</span></a><span class="parenthesis">(</span><span class="variable" start="90" select="quick">$root-prefix</span><span class="parenthesis" start="102">)</span><span class="parenthesis" start="103">)</span><span class="whitespace" start="104"> </span><span class="op" start="105">then</span><span class="whitespace" start="109"> </span><span class="op">'</span><span class="literal" start="110">enxsl</span><span class="op">'</span><span class="whitespace" start="117"> 
                   
</span><span class="op" start="120">else</span><span class="whitespace" start="124"> </span><span class="op">'</span><span class="literal" start="125">en</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="z">&lt;!--</span><span class="cm">
        
id="{js:stackPush($elementName)}"&gt;&#xD;
        </span><span class="z">--&gt;</span><span class="txt">
        
</span><span class="ww" id="w7843"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$elementName</span><span class="z">"</span><span id="wx7851" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx7855" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7859" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7861"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pre-close">pre-close</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="29" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$part1</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="op">'</span><span class="literal" start="26">&gt;</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx7883" class="sc">/&gt;</span></span><span class="txt"> 
    
&#xD;
    </span><span class="ww" id="w7885"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isFinalPart">isFinalPart</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">2</span><span class="whitespace" start="11"> </span><span class="op" start="12">gt</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$parts</span><span class="parenthesis" start="27">)</span><span class="whitespace" start="28">
                                             
</span><span class="op" start="30">or</span><span class="whitespace" start="32"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="33" pair-end="57" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="47" select="quick">$pre-close</span><span class="parenthesis" start="57">)</span><span class="whitespace" start="58"> </span><span class="op" start="59">gt</span><span class="whitespace" start="61"> </span><span class="numeric" start="62">0</span><span class="whitespace" start="63">
                                             
</span><span class="op" start="65">or</span><span class="whitespace" start="67"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="68" pair-end="90" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="80" select="quick">$part1</span><span class="op" start="86">,</span><span class="op">'</span><span class="literal" start="87">&gt;</span><span class="op">'</span><span class="parenthesis" start="90">)</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx7938" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w7940"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w7944"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isFinalPart</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="z">&lt;!--</span><span class="cm">  use sc class value to mark end of self-closed element </span><span class="z">--&gt;</span><span class="txt">
        
</span><span class="ww" id="w7958"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isSelfClosed">isSelfClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="1" pair-end="25" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$pre-close</span><span class="op" start="21">,</span><span class="op">'</span><span class="literal" start="22">/</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx7985" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w7987"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$isSelfClosed</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">sc</span><span class="op">'</span><span class="whitespace" start="29"> </span><span class="op" start="30">else</span><span class="whitespace" start="34"> </span><span class="op">'</span><span class="literal" start="35">scx</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w8015"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSelfClosed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="z">&lt;!--</span><span class="cm">
            
&lt;xsl:attribute name="id" select="js:stackPop()"/&gt;&#xD;
            </span><span class="z">--&gt;</span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8031" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w8033"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$isSelfClosed</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">/</span><span class="op">'</span><span class="whitespace" start="28"> </span><span class="op" start="29">else</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34"></span><span class="op">'</span><span class="z">"</span><span id="wx8057" class="sc">/&gt;</span></span><span class="txt">&amp;gt;</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8061" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w8063"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">txt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w8073"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSelfClosed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="z">&lt;!--</span><span class="cm">
            
&lt;xsl:attribute name="id" select="js:getStackIndex()"/&gt;&#xD;
            </span><span class="z">--&gt;</span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8089" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w8091"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="61" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$attToken</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="22" pair-end="46" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="36" select="quick">$pre-close</span><span class="parenthesis" start="46">)</span><span class="whitespace" start="47"> </span><span class="op" start="48">+</span><span class="whitespace" start="49"> </span><span class="variable" start="50" select="quick">$offset</span><span class="whitespace" start="57"> </span><span class="op" start="58">+</span><span class="whitespace" start="59"> </span><span class="numeric" start="60">2</span><span class="parenthesis" start="61">)</span><span class="z">"</span><span id="wx8116" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8120" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8124" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w8126"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="14" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$part2</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="z">&lt;!--</span><span class="cm"> attribute must exist and name occurs before value, so get this first </span><span class="z">--&gt;</span><span class="txt">
        
</span><span class="ww" id="w8143"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?left">left</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="16" select="quick">(</span><span class="variable" start="5" select="quick">$index</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17">
                              
</span><span class="op" start="19">then</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="24" pair-end="73" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="34" select="quick">$part1</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="42" pair-end="68" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="56" select="quick">$elementName</span><span class="parenthesis" start="68">)</span><span class="whitespace" start="69"> </span><span class="op" start="70">+</span><span class="whitespace" start="71"> </span><span class="numeric" start="72">1</span><span class="parenthesis" start="73">)</span><span class="whitespace" start="74">
                              
</span><span class="op" start="76">else</span><span class="whitespace" start="80"> </span><span class="variable" start="81" select="quick">$part1</span><span class="z">"</span><span id="wx8192" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w8194"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pre">pre</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="27" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$left</span><span class="op" start="23">,</span><span class="op">'</span><span class="literal" start="24">=</span><span class="op">'</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx8215" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="z">&lt;!--</span><span class="cm">
        
&lt;xsl:variable name="tokens" select="tokenize($pre, '\s+')"/&gt;&#xD;
        </span><span class="z">--&gt;</span><span class="txt">
        
</span><span class="ww" id="w8221"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}splitAttributeName" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:splitAttributeName</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$pre</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx8238" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w8240"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attSpans">attSpans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w8256"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w8266"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z">
                          
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="5" pair-end="19" select="quick">matches</span></a><span class="parenthesis">(</span><span class="context" start="13">.</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">\S</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> 
                                  
</span><span class="op" start="24">then</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">atn</span><span class="op">'</span><span class="whitespace" start="34">
                                  
</span><span class="op" start="36">else</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41">z</span><span class="op">'</span><span class="z">"</span><span id="wx8303" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w8305"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$class</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w8317"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx8325" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8329" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx8333" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx8337" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w8339"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?att-name">att-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$attSpans</span><span class="filter" start="10" pair-end="26" select="quick">[</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">class</span><span class="whitespace" start="17"> </span><span class="op" start="18">eq</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">atn</span><span class="op">'</span><span class="filter" start="26">]</span><span class="z">"</span><span id="wx8363" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w8365"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$attSpans</span><span class="z">"</span><span id="wx8373" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w8375"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isXPath">isXPath</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl-element</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21">
                              
</span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$att-name</span><span class="whitespace" start="37"> </span><span class="op" start="38">=</span><span class="whitespace" start="39"> </span><span class="parenthesis" start="40" pair-end="65" select="quick">(</span><span class="op">'</span><span class="literal" start="41">select</span><span class="op">'</span><span class="op" start="49">,</span><span class="op">'</span><span class="literal" start="50">test</span><span class="op">'</span><span class="op" start="56">,</span><span class="whitespace" start="57"> </span><span class="op">'</span><span class="literal" start="58">match</span><span class="op">'</span><span class="parenthesis" start="65">)</span><span class="whitespace" start="66">
                              
</span><span class="op" start="68">else</span><span class="whitespace" start="72"> </span><span class="if" start="73">if</span><span class="whitespace" start="75"> </span><span class="parenthesis" start="76" pair-end="172" select="quick">(</span><span class="variable" start="77" select="quick">$is-xsd</span><span class="whitespace" start="84"> </span><span class="op" start="85">and</span><span class="whitespace" start="88"> </span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-names" class="solar"><span class="function" start="89" pair-end="117" select="quick">f:get-xsd-names</span></a><span class="parenthesis">(</span><span class="variable" start="105" select="quick">$root-prefix</span><span class="parenthesis" start="117">)</span><span class="whitespace" start="118"> </span><span class="op" start="119">=</span><span class="whitespace" start="120"> </span><span class="variable" start="121" select="quick">$elementName</span><span class="whitespace" start="133"> </span><span class="op" start="134">and</span><span class="whitespace" start="137"> </span><span class="variable" start="138" select="quick">$attSpans</span><span class="filter" start="147" pair-end="162" select="quick">[</span><span class="axis" start="148">@</span><span class="qname" start="149" select="quick">class</span><span class="whitespace" start="154"> </span><span class="op" start="155">=</span><span class="whitespace" start="156"> </span><span class="op">'</span><span class="literal" start="157">atn</span><span class="op">'</span><span class="filter" start="162">]</span><span class="whitespace" start="163"> </span><span class="op" start="164">=</span><span class="whitespace" start="165"> </span><span class="op">'</span><span class="literal" start="166">test</span><span class="op">'</span><span class="parenthesis" start="172">)</span><span class="whitespace" start="173"> 
                              
</span><span class="op" start="176">then</span><span class="whitespace" start="180"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="181" pair-end="186" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="186">)</span><span class="whitespace" start="187">
                              
</span><span class="op" start="189">else</span><span class="whitespace" start="193"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="194" pair-end="200" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="200">)</span><span class="z">"</span><span id="wx8465" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="z">&lt;!--</span><span class="cm"> for coloring attribute values that are referenced from XPath </span><span class="z">--&gt;</span><span class="txt">
        
</span><span class="ww" id="w8471"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?metaXPathName">metaXPathName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-av-class" class="solar"><span class="function" start="1" pair-end="96" select="quick">f:get-av-class</span></a><span class="parenthesis">(</span><span class="variable" start="16" select="quick">$is-xsl-element</span><span class="op" start="31">,</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$is-xsd</span><span class="op" start="40">,</span><span class="whitespace" start="41"> 
                              
               </span><span class="variable" start="59" select="quick">$elementName</span><span class="op" start="71">,</span><span class="whitespace" start="72"> </span><span class="variable" start="73" select="quick">$att-name</span><span class="op" start="82">,</span><span class="whitespace" start="83"> </span><span class="variable" start="84" select="quick">$root-prefix</span><span class="parenthesis" start="96">)</span><span class="z">"</span><span id="wx8506" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        &#xD;
        </span><span class="ww" id="w8508"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">atneq</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w8518"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="40" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$left</span><span class="op" start="16">,</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="17" pair-end="35" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="31" select="quick">$pre</span><span class="parenthesis" start="35">)</span><span class="whitespace" start="36"> </span><span class="op" start="37">+</span><span class="whitespace" start="38"> </span><span class="numeric" start="39">1</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span id="wx8538" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8542" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w8544"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?sl">sl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part2</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:double</span><span class="z">"</span><span id="wx8567" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w8569"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w8579"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="21" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$part2</span><span class="op" start="17">,</span><span class="numeric" start="18">1</span><span class="op" start="19">,</span><span class="numeric" start="20">1</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx8594" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8598" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w8600"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attValue">attValue</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="29" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$part2</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">2</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$sl</span><span class="whitespace" start="25"> </span><span class="op" start="26">-</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">2</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx8627" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w8629"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w8633"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isXPath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w8643"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}showXPath" class="solar"><span class="function" start="1" pair-end="24" select="quick">loc:showXPath</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$attValue</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx8654" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8658" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w8660"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xsl</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w8670"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}processAVT" class="solar"><span class="function" start="1" pair-end="39" select="quick">f:processAVT</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$attValue</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$metaXPathName</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx8684" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8688" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w8690"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w8694"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$metaXPathName</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w8706"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$attValue</span><span class="z">"</span><span id="wx8714" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8718" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx8722" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx8726" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w8728"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">z</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w8738"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="22" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$part2</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$sl</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span id="wx8752" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx8756" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx8760" class="ec">&gt;</span></span><span class="txt">
      
&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx8764" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w8766"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newOffset">newOffset</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part1</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">+</span><span class="whitespace" start="24"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="25" pair-end="45" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$part2</span><span class="parenthesis" start="45">)</span><span class="whitespace" start="46"> </span><span class="op" start="47">+</span><span class="whitespace" start="48"> </span><span class="variable" start="49" select="quick">$offset</span><span class="z">"</span><span id="wx8794" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w8796"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="17" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$isFinalPart</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w8809"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}getAttributes" class="solar"><span class="function" start="1" pair-end="95" select="quick">f:getAttributes</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$attToken</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$newOffset</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="variable" start="40" select="quick">$parts</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$index</span><span class="whitespace" start="54"> </span><span class="op" start="55">+</span><span class="whitespace" start="56"> </span><span class="numeric" start="57">2</span><span class="op" start="58">,</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$is-xsl</span><span class="op" start="67">,</span><span class="whitespace" start="68"> </span><span class="variable" start="69" select="quick">$root-prefix</span><span class="op" start="81">,</span><span class="whitespace" start="82"> </span><span class="variable" start="83" select="quick">$elementName</span><span class="parenthesis" start="95">)</span><span class="z">"</span><span id="wx8842" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8846" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx8850" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w8852"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-av-class">f:get-av-class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w8868"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl-element">is-xsl-element</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx8882" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w8884"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsd">is-xsd</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx8898" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w8900"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?elementName">elementName</span><span class="z">"</span><span id="wx8908" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w8910"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?att-name">att-name</span><span class="z">"</span><span id="wx8918" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w8920"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span id="wx8928" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w8930"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
        
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="variable" start="5" select="quick">$is-xsl-element</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26">
                
</span><span class="if" start="28">if</span><span class="whitespace" start="30"> </span><span class="parenthesis" start="31" pair-end="128" select="quick">(</span><span class="variable" start="32" select="quick">$elementName</span><span class="whitespace" start="44"> </span><span class="op" start="45">=</span><span class="whitespace" start="46"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="47" pair-end="98" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="63" select="quick">$root-prefix</span><span class="op" start="75">,</span><span class="whitespace" start="76"> </span><span class="parenthesis" start="77" pair-end="97" select="quick">(</span><span class="op">'</span><span class="literal" start="78">variable</span><span class="op">'</span><span class="op" start="88">,</span><span class="whitespace" start="89"> </span><span class="op">'</span><span class="literal" start="90">param</span><span class="op">'</span><span class="parenthesis" start="97">)</span><span class="parenthesis" start="98">)</span><span class="whitespace" start="99">
                
    </span><span class="op" start="105">and</span><span class="whitespace" start="108"> </span><span class="variable" start="109" select="quick">$att-name</span><span class="whitespace" start="118"> </span><span class="op" start="119">eq</span><span class="whitespace" start="121"> </span><span class="op">'</span><span class="literal" start="122">name</span><span class="op">'</span><span class="parenthesis" start="128">)</span><span class="whitespace" start="129"> </span><span class="op" start="130">then</span><span class="whitespace" start="134"> </span><span class="op">'</span><span class="literal" start="135">vname</span><span class="op">'</span><span class="whitespace" start="142">
                
</span><span class="op" start="144">else</span><span class="whitespace" start="148"> </span><span class="if" start="149">if</span><span class="whitespace" start="151"> </span><span class="parenthesis" start="152" pair-end="249" select="quick">(</span><span class="variable" start="153" select="quick">$elementName</span><span class="whitespace" start="165"> </span><span class="op" start="166">=</span><span class="whitespace" start="167"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="168" pair-end="219" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="184" select="quick">$root-prefix</span><span class="op" start="196">,</span><span class="whitespace" start="197"> </span><span class="parenthesis" start="198" pair-end="218" select="quick">(</span><span class="op">'</span><span class="literal" start="199">import</span><span class="op">'</span><span class="op" start="207">,</span><span class="whitespace" start="208"> </span><span class="op">'</span><span class="literal" start="209">include</span><span class="op">'</span><span class="parenthesis" start="218">)</span><span class="parenthesis" start="219">)</span><span class="whitespace" start="220">
                
    </span><span class="op" start="226">and</span><span class="whitespace" start="229"> </span><span class="variable" start="230" select="quick">$att-name</span><span class="whitespace" start="239"> </span><span class="op" start="240">eq</span><span class="whitespace" start="242"> </span><span class="op">'</span><span class="literal" start="243">href</span><span class="op">'</span><span class="parenthesis" start="249">)</span><span class="whitespace" start="250"> </span><span class="op" start="251">then</span><span class="whitespace" start="255"> </span><span class="op">'</span><span class="literal" start="256">href</span><span class="op">'</span><span class="whitespace" start="262">
                
</span><span class="op" start="264">else</span><span class="whitespace" start="268"> </span><span class="if" start="269">if</span><span class="whitespace" start="271"> </span><span class="parenthesis" start="272" pair-end="365" select="quick">(</span><span class="variable" start="273" select="quick">$elementName</span><span class="whitespace" start="285"> </span><span class="op" start="286">=</span><span class="whitespace" start="287"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="288" pair-end="335" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="304" select="quick">$root-prefix</span><span class="op" start="316">,</span><span class="whitespace" start="317"> </span><span class="parenthesis" start="318" pair-end="334" select="quick">(</span><span class="op">'</span><span class="literal" start="319">call-template</span><span class="op">'</span><span class="parenthesis" start="334">)</span><span class="parenthesis" start="335">)</span><span class="whitespace" start="336">
                
    </span><span class="op" start="342">and</span><span class="whitespace" start="345"> </span><span class="variable" start="346" select="quick">$att-name</span><span class="whitespace" start="355"> </span><span class="op" start="356">eq</span><span class="whitespace" start="358"> </span><span class="op">'</span><span class="literal" start="359">name</span><span class="op">'</span><span class="parenthesis" start="365">)</span><span class="whitespace" start="366"> </span><span class="op" start="367">then</span><span class="whitespace" start="371"> </span><span class="op">'</span><span class="literal" start="372">tcall</span><span class="op">'</span><span class="whitespace" start="379">
                
</span><span class="op" start="381">else</span><span class="whitespace" start="385"> </span><span class="if" start="386">if</span><span class="whitespace" start="388"> </span><span class="parenthesis" start="389" pair-end="476" select="quick">(</span><span class="variable" start="390" select="quick">$elementName</span><span class="whitespace" start="402"> </span><span class="op" start="403">=</span><span class="whitespace" start="404"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="405" pair-end="445" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="421" select="quick">$root-prefix</span><span class="op" start="433">,</span><span class="whitespace" start="434"> </span><span class="op">'</span><span class="literal" start="435">function</span><span class="op">'</span><span class="parenthesis" start="445">)</span><span class="whitespace" start="446"> 
                
    </span><span class="op" start="453">and</span><span class="whitespace" start="456"> </span><span class="variable" start="457" select="quick">$att-name</span><span class="whitespace" start="466"> </span><span class="op" start="467">eq</span><span class="whitespace" start="469"> </span><span class="op">'</span><span class="literal" start="470">name</span><span class="op">'</span><span class="parenthesis" start="476">)</span><span class="whitespace" start="477"> </span><span class="op" start="478">then</span><span class="whitespace" start="482"> </span><span class="op">'</span><span class="literal" start="483">fname</span><span class="op">'</span><span class="whitespace" start="490">
                
</span><span class="op" start="492">else</span><span class="whitespace" start="496"> </span><span class="if" start="497">if</span><span class="whitespace" start="499"> </span><span class="parenthesis" start="500" pair-end="587" select="quick">(</span><span class="variable" start="501" select="quick">$elementName</span><span class="whitespace" start="513"> </span><span class="op" start="514">=</span><span class="whitespace" start="515"> </span><a href="xmlspectrum.xsl.html#f?{internal}prefixed-name" class="solar"><span class="function" start="516" pair-end="556" select="quick">f:prefixed-name</span></a><span class="parenthesis">(</span><span class="variable" start="532" select="quick">$root-prefix</span><span class="op" start="544">,</span><span class="whitespace" start="545"> </span><span class="op">'</span><span class="literal" start="546">template</span><span class="op">'</span><span class="parenthesis" start="556">)</span><span class="whitespace" start="557"> 
                
    </span><span class="op" start="564">and</span><span class="whitespace" start="567"> </span><span class="variable" start="568" select="quick">$att-name</span><span class="whitespace" start="577"> </span><span class="op" start="578">eq</span><span class="whitespace" start="580"> </span><span class="op">'</span><span class="literal" start="581">name</span><span class="op">'</span><span class="parenthesis" start="587">)</span><span class="whitespace" start="588"> </span><span class="op" start="589">then</span><span class="whitespace" start="593"> </span><span class="op">'</span><span class="literal" start="594">tname</span><span class="op">'</span><span class="whitespace" start="601">
                
</span><span class="op" start="603">else</span><span class="whitespace" start="607"> </span><span class="op">'</span><span class="literal" start="608">av</span><span class="op">'</span><span class="whitespace" start="612">
                
&#xD;
                </span><span class="op" start="616">else</span><span class="whitespace" start="620"> </span><span class="if" start="621">if</span><span class="whitespace" start="623"> </span><span class="parenthesis" start="624" pair-end="711" select="quick">(</span><span class="variable" start="625" select="quick">$is-xsd</span><span class="whitespace" start="632"> </span><span class="op" start="633">and</span><span class="whitespace" start="636"> </span><span class="variable" start="637" select="quick">$elementName</span><span class="whitespace" start="649"> </span><span class="op" start="650">=</span><span class="whitespace" start="651"> </span><a href="xmlspectrum.xsl.html#f?{internal}get-xsd-fnames" class="solar"><span class="function" start="652" pair-end="681" select="quick">f:get-xsd-fnames</span></a><span class="parenthesis">(</span><span class="variable" start="669" select="quick">$root-prefix</span><span class="parenthesis" start="681">)</span><span class="whitespace" start="682">
                
    </span><span class="op" start="688">and</span><span class="whitespace" start="691"> </span><span class="variable" start="692" select="quick">$att-name</span><span class="whitespace" start="701"> </span><span class="op" start="702">eq</span><span class="whitespace" start="704"> </span><span class="op">'</span><span class="literal" start="705">name</span><span class="op">'</span><span class="parenthesis" start="711">)</span><span class="whitespace" start="712"> </span><span class="op" start="713">then</span><span class="whitespace" start="717"> </span><span class="op">'</span><span class="literal" start="718">fname</span><span class="op">'</span><span class="whitespace" start="725"> </span><span class="op" start="726">else</span><span class="whitespace" start="730"> </span><span class="op">'</span><span class="literal" start="731">av</span><span class="op">'</span><span class="z">"</span><span id="wx9185" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx9189" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w9191"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}unescape-p">f:unescape-p</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w9201"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span id="wx9209" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w9211"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t1">t1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="32" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$text</span><span class="op" start="14">,</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">&amp;#x0300;</span><span class="op">'</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">{{</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx9238" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w9240"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="30" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$t1</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">&amp;#x0301;</span><span class="op">'</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="op">'</span><span class="literal" start="26">}}</span><span class="op">'</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx9261" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx9265" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w9267"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}processAVT">f:processAVT</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w9277"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?attText">attText</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9291" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w9293"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?class">class</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9307" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w9309"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?regex1">regex1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">\{.*?\}</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9331" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w9333"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?regex2">regex2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">part</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx9353" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w9355"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t1">t1</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="37" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$attText</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="op">'</span><span class="literal" start="19">\{\{</span><span class="op">'</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">&amp;#x0300;</span><span class="op">'</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span id="wx9382" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w9384"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?t2">t2</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="32" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$t1</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">\}\}</span><span class="op">'</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">&amp;#x0301;</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx9411" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="z">&lt;!--</span><span class="cm"> flags:s = match . to any char including \n </span><span class="z">--&gt;</span><span class="txt">
    
</span><span class="ww" id="w9417"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$t2</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$regex1</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">flags</span><span class="atneq">=</span><span class="z">"</span><span class="av">s</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
&#xD;
      </span><span class="ww" id="w9441"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w9445"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p">p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}unescape-p" class="solar"><span class="function" start="1" pair-end="51" select="quick">f:unescape-p</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="14" pair-end="50" select="quick">substring</span></a><span class="parenthesis">(</span><span class="context" start="24">.</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="numeric" start="27">2</span><span class="op" start="28">,</span><span class="whitespace" start="29"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="30" pair-end="45" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="context" start="44">.</span><span class="parenthesis" start="45">)</span><span class="whitespace" start="46"> </span><span class="op" start="47">-</span><span class="whitespace" start="48"> </span><span class="numeric" start="49">2</span><span class="parenthesis" start="50">)</span><span class="parenthesis" start="51">)</span><span class="z">"</span><span id="wx9478" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w9480"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w9490"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">{</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx9496" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9500" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w9502"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}showXPath" class="solar"><span class="function" start="1" pair-end="17" select="quick">loc:showXPath</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$p</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span id="wx9513" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w9515"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w9525"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">}</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx9531" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9535" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx9539" class="ec">&gt;</span></span><span class="txt">
      
&#xD;
      </span><span class="ww" id="w9541"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w9545"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p">p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}unescape-p" class="solar"><span class="function" start="1" pair-end="15" select="quick">f:unescape-p</span></a><span class="parenthesis">(</span><span class="context" start="14">.</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span id="wx9562" class="sc">/&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w9564"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$class</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w9576"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$p</span><span class="z">"</span><span id="wx9584" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx9588" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx9592" class="ec">&gt;</span></span><span class="txt">
      
&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx9596" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx9600" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w9602"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}splitAttributeName">f:splitAttributeName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w9612"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?text">text</span><span class="z">"</span><span id="wx9620" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w9622"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(\S+)|(\s+)</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$text</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w9638"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w9642"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx9650" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx9654" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx9658" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx9662" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> css dark-theme: background color #002b36 = base 03 
  
 light-theme #fdf6e3 = base 3</span><span class="z">--&gt;</span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w9668"><span class="es">&lt;</span><span class="en">css:theme</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w9672"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">@import url(http://fonts.googleapis.com/css?family=Source+Code+Pro);</span><span class="z">"</span><span id="wx9680" class="sc">/&gt;</span></span><span class="txt">
    
p.spectrum {&#xD;
        margin:0px;&#xD;
        font-family: </span><span class="ww" id="w9682"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">'Source Code Pro', </span><span class="z">"</span><span id="wx9690" class="sc">/&gt;</span></span><span class="txt">monospace;
    
    </span><span class="ww" id="w9692"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">font-size: 0.8em;</span><span class="z">"</span><span id="wx9700" class="sc">/&gt;</span></span><span class="txt">
    
    white-space: pre-wrap;&#xD;
        display: block;&#xD;
        border: none thin;&#xD;
        border-color: #405075;&#xD;
        background-color:</span><span class="ww" id="w9702"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#002b36</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#white</span><span class="z">"</span><span id="wx9716" class="sc">/&gt;</span></span><span class="txt">;
    
padding: 2px;&#xD;
    margin-bottom:5px;&#xD;
    }&#xD;
    &#xD;
    div.spectrum-toc {&#xD;
        font-family: </span><span class="ww" id="w9718"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">'Source Code Pro', </span><span class="z">"</span><span id="wx9726" class="sc">/&gt;</span></span><span class="txt">monospace;
    
    </span><span class="ww" id="w9728"><span class="es">&lt;</span><span class="en">css:font</span><span class="z"> </span><span class="atn">scp</span><span class="atneq">=</span><span class="z">"</span><span class="av">font-size: 0.8em;</span><span class="z">"</span><span id="wx9736" class="sc">/&gt;</span></span><span class="txt">
    
    display: block;&#xD;
        border: none thin;&#xD;
        border-color: #405075;&#xD;
        background-color: </span><span class="ww" id="w9738"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#002b36</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#white</span><span class="z">"</span><span id="wx9752" class="sc">/&gt;</span></span><span class="txt">;
    
    padding: 2px;&#xD;
    }&#xD;
    &#xD;
    ul.base1, ul.spectrum-toc {&#xD;
        color:</span><span class="ww" id="w9754"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#93a1a1</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#586e75</span><span class="z">"</span><span id="wx9768" class="sc">/&gt;</span></span><span class="txt">;
    
}&#xD;
    &#xD;
    .spectrum span {&#xD;
        white-space: pre-wrap;&#xD;
    }&#xD;
    /*&#xD;
    chosen theme background: </span><span class="ww" id="w9770"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">dark</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">light</span><span class="z">"</span><span id="wx9784" class="sc">/&gt;</span></span><span class="txt">;
    
&#xD;
    $base03:    #002b36; //background&#xD;
    $base02:    #073642; //highlighted-background&#xD;
    $base01:    #586e75;&#xD;
    $base00:    #657b83;&#xD;
    $base0:     #839496;&#xD;
    $base1:     #93a1a1;&#xD;
    $base2:     #eee8d5; //highlighted-background&#xD;
    $base3:     #fdf6e3; //background&#xD;
    $yellow:    #b58900;&#xD;
    $orange:    #cb4b16;&#xD;
    $red:       #dc322f;&#xD;
    $magenta:   #d33682;&#xD;
    $violet:    #6c71c4;&#xD;
    $blue:      #268bd2;&#xD;
    $cyan:      #2aa198;&#xD;
    $green:     #859900;&#xD;
    */&#xD;
    &#xD;
    /* solorized colors */&#xD;
    span.base03 {&#xD;
    color: #002b36;&#xD;
    }&#xD;
    span.base02 {&#xD;
    color: #073642;&#xD;
    }&#xD;
    &#xD;
    /* hover-effect [start] */&#xD;
    span.base03, span.ww:not(:hover), span.txt:not(:hover), span.cm:not(:hover), span.pi:not(:hover)  {&#xD;
    background-color: </span><span class="ww" id="w9786"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#002b36</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">white</span><span class="z">"</span><span id="wx9800" class="sc">/&gt;</span></span><span class="txt">;
    
}&#xD;
    span.ww {&#xD;
    background-color: </span><span class="ww" id="w9802"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#00202e</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#fdf6e3</span><span class="z">"</span><span id="wx9816" class="sc">/&gt;</span></span><span class="txt">;
    
}&#xD;
    /* hover-effect [end] */&#xD;
    &#xD;
    span.base01, span.eq-equ, span.z, span.sc, span.scx, span.ec, span.es, span.ez, span.atneq {&#xD;
    color: </span><span class="ww" id="w9818"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#586e75</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#93a1a1</span><span class="z">"</span><span id="wx9832" class="sc">/&gt;</span></span><span class="txt">;
    
}&#xD;
    span.base00 {&#xD;
    color: #657b83;&#xD;
    }&#xD;
    span.base0, span.txt, span.cd {&#xD;
    color: #839496;&#xD;
    }&#xD;
    span.base1, span.literal, span.av {&#xD;
    color:</span><span class="ww" id="w9834"><span class="es">&lt;</span><span class="en">css:background</span><span class="z"> </span><span class="atn">dark</span><span class="atneq">=</span><span class="z">"</span><span class="av">#93a1a1</span><span class="z">"</span><span class="z"> </span><span class="atn">light</span><span class="atneq">=</span><span class="z">"</span><span class="av">#586e75</span><span class="z">"</span><span id="wx9848" class="sc">/&gt;</span></span><span class="txt">;
    
}&#xD;
    span.base2 {&#xD;
        color: #eee8d5;&#xD;
    }&#xD;
    span.base3 {&#xD;
        color: #fdf6e3;&#xD;
    }&#xD;
    span.yellow, span.op, span.type-op, span.if, span.higher, span.step {&#xD;
        color: #b58900;&#xD;
    }&#xD;
    span.orange, span.type, span.node-type, span.function {&#xD;
        color: #cb4b16;&#xD;
    }&#xD;
    span.red, span.fname, span.tname {&#xD;
        color: #dc322f;&#xD;
    }&#xD;
    span.magenta, span.vname, span.variable, span.external {&#xD;
        color: #d33682;&#xD;
    }&#xD;
    span.violet, span.qname, span.type-name, span.unclosed, span.en, span.cl, span.href, span.tcall {&#xD;
        color: #6c71c4;&#xD;
    }&#xD;
    span.blue, span.enxsl, span.clxsl, span.enx, &#xD;
    span.filter, span.parenthesis, span.node{&#xD;
        color: #268bd2;&#xD;
    }&#xD;
    span.cyan, span.atn, span.numeric, span.pi, span.dt, span.axis, span.context {&#xD;
        color: #2aa198;&#xD;
    }&#xD;
    span.green, span.cm, span.comment {&#xD;
        color: #859900;&#xD;
    }&#xD;
    a.solar {&#xD;
        text-decoration:none;&#xD;
    }&#xD;
  </span><span class="ez">&lt;/</span><span class="cl">css:theme</span><span id="wx9852" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> xpath-colorer </span><span class="z">--&gt;</span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w9858"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ops">ops</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">, / = &amp;lt; &amp;gt; + - * ? | != &amp;lt;= &amp;gt;= &amp;lt;&amp;lt; &amp;gt;&amp;gt; //</span><span class="op">'</span><span class="z">"</span><span id="wx9874" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w9876"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?aOps">aOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">or and eq ne lt le gt ge is to div idiv mod union intersect except in return satisfies then else</span><span class="op">'</span><span class="z">"</span><span id="wx9892" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w9894"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?hOps">hOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">for some every</span><span class="op">'</span><span class="z">"</span><span id="wx9910" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w9912"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">attribute comment document-node element node processing-instruction text</span><span class="op">'</span><span class="z">"</span><span id="wx9928" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w9930"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?types">types</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">empty item node schema-attribute schema-element type</span><span class="op">'</span><span class="z">"</span><span id="wx9946" class="sc">/&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w9948"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ambiguousOps">ambiguousOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="21" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?aOps" class="solar"><span class="variable" start="10" select="quick">$aOps</span></a><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">\s+</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx9975" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w9977"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?simpleOps">simpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="20" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?ops" class="solar"><span class="variable" start="10" select="quick">$ops</span></a><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">\s+</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx10004" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w10006"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodeTests">nodeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="22" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?nodes" class="solar"><span class="variable" start="10" select="quick">$nodes</span></a><span class="op" start="16">,</span><span class="op">'</span><span class="literal" start="17">\s+</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx10033" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w10035"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?typeTests">typeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="22" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?types" class="solar"><span class="variable" start="10" select="quick">$types</span></a><span class="op" start="16">,</span><span class="op">'</span><span class="literal" start="17">\s+</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx10062" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w10064"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?higherOps">higherOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="21" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#v?hOps" class="solar"><span class="variable" start="10" select="quick">$hOps</span></a><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">\s+</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx10091" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ww" id="w10093"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?bgColor">bgColor</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">black</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx10115" class="sc">/&gt;</span></span><span class="txt">
  
&#xD;
  &#xD;
  </span><span class="z">&lt;!--</span><span class="cm">
  
signature:&#xD;
      loc:showXPath(text-content)&#xD;
  &#xD;
  description:&#xD;
  &#xD;
      Converts the xpath content string to a sequence of span elements. with each&#xD;
      containing a class attribute used for coloring with CSS. &#xD;
  &#xD;
  params:&#xD;
     text-content: string containing a single XPath expression&#xD;
  </span><span class="z">--&gt;</span><span class="txt">
  
</span><span class="ww" id="w10121"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}showXPath">loc:showXPath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w10131"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span id="wx10139" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w10141"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chars">chars</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}stringToCharSequence" class="solar"><span class="function" start="1" pair-end="32" select="quick">loc:stringToCharSequence</span></a><span class="parenthesis">(</span><span class="variable" start="26" select="quick">$chunk</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx10164" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w10166"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?blocks">blocks</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w10182"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createBlocks" class="solar"><span class="function" start="1" pair-end="46" select="quick">loc:createBlocks</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chars</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="26" pair-end="32" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="32">)</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">1</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"></span><span class="op">'</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="numeric" start="42">0</span><span class="op" start="43">,</span><span class="whitespace" start="44"> </span><span class="numeric" start="45">0</span><span class="parenthesis" start="46">)</span><span class="z">"</span><span id="wx10212" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx10216" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10218"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createPairs" class="solar"><span class="function" start="1" pair-end="72" select="quick">loc:createPairs</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$blocks</span><span class="filter" start="24" pair-end="71" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="25" pair-end="30" select="quick">name</span></a><span class="parenthesis">(</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">=</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">block</span><span class="op">'</span><span class="whitespace" start="41"> </span><span class="op" start="42">and</span><span class="whitespace" start="45"> </span><span class="axis" start="46">@</span><span class="qname" start="47" select="quick">type</span><span class="whitespace" start="51"> </span><span class="op" start="52">=</span><span class="whitespace" start="53"> </span><span class="parenthesis" start="54" pair-end="70" select="quick">(</span><span class="op">'</span><span class="literal" start="55">[</span><span class="op">'</span><span class="op" start="58">,</span><span class="op">'</span><span class="literal" start="59">]</span><span class="op">'</span><span class="op" start="62">,</span><span class="op">'</span><span class="literal" start="63">(</span><span class="op">'</span><span class="op" start="66">,</span><span class="op">'</span><span class="literal" start="67">)</span><span class="op">'</span><span class="parenthesis" start="70">)</span><span class="filter" start="71">]</span><span class="parenthesis" start="72">)</span><span class="z">"</span><span id="wx10277" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w10279"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?omitPairs">omitPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="41" select="quick">(</span><span class="variable" start="2" select="quick">$blocks</span><span class="filter" start="9" pair-end="40" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="10" pair-end="15" select="quick">name</span></a><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">=</span><span class="whitespace" start="18"> </span><span class="parenthesis" start="19" pair-end="39" select="quick">(</span><span class="op">'</span><span class="literal" start="20">literal</span><span class="op">'</span><span class="op" start="29">,</span><span class="op">'</span><span class="literal" start="30">comment</span><span class="op">'</span><span class="parenthesis" start="39">)</span><span class="filter" start="40">]</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span id="wx10318" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w10320"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w10336"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}getTokens" class="solar"><span class="function" start="1" pair-end="43" select="quick">loc:getTokens</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$chunk</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$omitPairs</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$pbPairs</span><span class="parenthesis" start="43">)</span><span class="z">"</span><span id="wx10353" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx10357" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w10359"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?plain" class="solar"><span class="tcall">plain</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w10369"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">para</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="z">"</span><span id="wx10383" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx10387" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx10391" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  &#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> //////////////////////////////////////////////////////////////////////////////////////////////// </span><span class="z">--&gt;</span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> 
  
 Sample output:&#xD;
  &lt;block position="3" type="["/&gt;&#xD;
  &lt;literal type="'" start="54" end="61"/&gt;&#xD;
  &lt;comment start="65" end="69"/&gt;&#xD;
  &lt;comment start="76"/&gt; // if not closed&#xD;
   </span><span class="z">--&gt;</span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> diagnostic formatting function - not used </span><span class="z">--&gt;</span><span class="txt">
  
</span><span class="ww" id="w10405"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}pad">loc:pad</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w10421"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padStringIn">padStringIn</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx10435" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10437"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fixedWidth">fixedWidth</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx10451" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10453"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padString">padString</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="33" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$padStringIn</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">\n</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">\\n</span><span class="op">'</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span id="wx10485" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10487"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stringLength">stringLength</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="25" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$padString</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span id="wx10510" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10512"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padChar">padChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="22" select="quick">(</span><span class="variable" start="5" select="quick">$fixedWidth</span><span class="whitespace" start="16"> </span><span class="op" start="17">gt</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">20</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">then</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">.</span><span class="op">'</span><span class="whitespace" start="32"> </span><span class="op" start="33">else</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"> </span><span class="op">'</span><span class="z">"</span><span id="wx10546" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10548"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padCount">padCount</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$fixedWidth</span><span class="whitespace" start="12"> </span><span class="op" start="13">-</span><span class="whitespace" start="14"> </span><span class="variable" start="15" select="quick">$stringLength</span><span class="z">"</span><span id="wx10572" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10574"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">ge</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w10588"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="78" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$padString</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="20" pair-end="77" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="32">for</span><span class="whitespace" start="35"> </span><span id="rng-$i" class="variable" start="36" select="quick">$i</span><span class="whitespace" start="38"> </span><span class="op" start="39">in</span><span class="whitespace" start="41"> </span><span class="numeric" start="42">1</span><span class="whitespace" start="43"> </span><span class="op" start="44">to</span><span class="whitespace" start="46"> </span><span class="variable" start="47" select="quick">$padCount</span><span class="whitespace" start="56"> 
                            
</span><span class="op" start="59">return</span><span class="whitespace" start="65"> </span><span class="variable" start="66" select="quick">$padChar</span><span class="op" start="74">,</span><span class="op">'</span><span class="literal" start="75"></span><span class="op">'</span><span class="parenthesis" start="77">)</span><span class="parenthesis" start="78">)</span><span class="z">"</span><span id="wx10623" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx10627" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10629"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">lt</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w10643"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="93" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$padString</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">&amp;#10;</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28"> </span><span class="op">'</span><span class="op" start="31">,</span><span class="whitespace" start="32"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="33" pair-end="92" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="45">for</span><span class="whitespace" start="48"> </span><span id="rng-$i" class="variable" start="49" select="quick">$i</span><span class="whitespace" start="51"> </span><span class="op" start="52">in</span><span class="whitespace" start="54"> </span><span class="numeric" start="55">1</span><span class="whitespace" start="56"> </span><span class="op" start="57">to</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$fixedWidth</span><span class="whitespace" start="71"> 
                            
</span><span class="op" start="74">return</span><span class="whitespace" start="80"> </span><span class="variable" start="81" select="quick">$padChar</span><span class="op" start="89">,</span><span class="op">'</span><span class="literal" start="90"></span><span class="op">'</span><span class="parenthesis" start="92">)</span><span class="parenthesis" start="93">)</span><span class="z">"</span><span id="wx10687" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx10691" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx10695" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w10697"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?plain">plain</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w10707"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?para">para</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx10721" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w10723"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?total">total</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="12" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$para</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx10746" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w10748"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="whitespace" start="2"> </span><span class="op" start="3">to</span><span class="whitespace" start="5"> </span><span class="variable" start="6" select="quick">$total</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w10762"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx10776" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w10778"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="13" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="filter" start="13">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w10791"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isJoined">isJoined</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                      
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="21" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">gt</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="whitespace" start="27"> </span><span class="op" start="28">and</span><span class="whitespace" start="31"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="32" pair-end="53" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="axis" start="42">@</span><span class="qname" start="43" select="quick">value</span><span class="op" start="48">,</span><span class="whitespace" start="49"> </span><span class="op">'</span><span class="literal" start="50">(</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx10832" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w10834"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isLiteral">isLiteral</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="17" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">type</span><span class="parenthesis" start="16">)</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">then</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="24" pair-end="30" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><span class="axis" start="37">@</span><span class="qname" start="38" select="quick">type</span><span class="whitespace" start="42"> </span><span class="op" start="43">eq</span><span class="whitespace" start="45"> </span><span class="op">'</span><span class="literal" start="46">literal</span><span class="op">'</span><span class="z">"</span><span id="wx10879" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w10881"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?literalQuote">literalQuote</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="23" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">value</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">1</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">1</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx10905" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w10907"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isLiteral</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w10917"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w10927"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$literalQuote</span><span class="z">"</span><span id="wx10935" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx10939" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx10943" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w10945"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w10949"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="whitespace" start="6"> </span><span class="op" start="7">eq</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">variable</span><span class="op">'</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$index</span><span class="whitespace" start="31"> </span><span class="op" start="32">+</span><span class="whitespace" start="33"> </span><span class="numeric" start="34">2</span><span class="whitespace" start="35"> </span><span class="op" start="36">lt</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$total</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w10978"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="17" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="whitespace" start="13"> </span><span class="op" start="14">+</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">1</span><span class="filter" start="17">]</span><span class="step" start="18">/</span><span class="axis" start="19">@</span><span class="qname" start="20" select="quick">type</span><span class="whitespace" start="24"> </span><span class="op" start="25">eq</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">whitespace</span><span class="op">'</span><span class="whitespace" start="40"> </span><span class="op" start="41">and</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$para</span><span class="filter" start="50" pair-end="61" select="quick">[</span><span class="variable" start="51" select="quick">$index</span><span class="whitespace" start="57"> </span><span class="op" start="58">+</span><span class="whitespace" start="59"> </span><span class="numeric" start="60">2</span><span class="filter" start="61">]</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">value</span><span class="whitespace" start="69"> </span><span class="op" start="70">eq</span><span class="whitespace" start="72"> </span><span class="op">'</span><span class="literal" start="73">in</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w11024"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="21" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">rng-</span><span class="op">'</span><span class="op" start="14">,</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx11046" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11050" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11054" class="ec">&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11056"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?className">className</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11066"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w11070"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w11084"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="97" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">type</span><span class="whitespace" start="10"> </span><span class="op" start="11">eq</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">literal</span><span class="op">'</span><span class="whitespace" start="23"> </span><span class="op" start="24">and</span><span class="whitespace" start="27">
                                      
</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="29" pair-end="96" select="quick">matches</span></a><span class="parenthesis">(</span><span class="axis" start="37">@</span><span class="qname" start="38" select="quick">value</span><span class="whitespace" start="43"> </span><span class="op" start="44">,</span><span class="op">'</span><span class="literal" start="45">select[\s\p{Zs}]*=[\s\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]</span><span class="op">'</span><span class="parenthesis" start="96">)</span><span class="parenthesis" start="97">)</span><span class="whitespace" start="98">
                                      
</span><span class="op" start="100">then</span><span class="whitespace" start="104"> </span><span class="op">'</span><span class="literal" start="105">select</span><span class="op">'</span><span class="whitespace" start="113">
                                      
</span><span class="op" start="115">else</span><span class="whitespace" start="119"> </span><span class="axis" start="120">@</span><span class="qname" start="121" select="quick">type</span><span class="z">"</span><span id="wx11127" class="sc">/&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx11131" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ww" id="w11133"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w11137"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p">p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="17" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="whitespace" start="13"> </span><span class="op" start="14">-</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">1</span><span class="filter" start="17">]</span><span class="whitespace" start="18"> </span><span class="z">"</span><span id="wx11159" class="sc">/&gt;</span></span><span class="txt">
                
</span><span class="ww" id="w11161"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="101" select="quick">(</span><span class="variable" start="5" select="quick">$p</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">eq</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">literal</span><span class="op">'</span><span class="whitespace" start="26"> </span><span class="op" start="27">and</span><span class="whitespace" start="30">
                                      
</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="32" pair-end="100" select="quick">matches</span></a><span class="parenthesis">(</span><span class="variable" start="40" select="quick">$p</span><span class="step" start="42">/</span><span class="axis" start="43">@</span><span class="qname" start="44" select="quick">value</span><span class="whitespace" start="49"> </span><span class="op" start="50">,</span><span class="op">'</span><span class="literal" start="51">name[\s\p{Zs}]*=[\s\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]</span><span class="op">'</span><span class="parenthesis" start="100">)</span><span class="parenthesis" start="101">)</span><span class="whitespace" start="102">
                                      
</span><span class="op" start="104">then</span><span class="whitespace" start="108"> </span><span class="op">'</span><span class="literal" start="109">external</span><span class="op">'</span><span class="whitespace" start="119">
                                      
</span><span class="op" start="121">else</span><span class="whitespace" start="125"> </span><span class="op">'</span><span class="literal" start="126">qname</span><span class="op">'</span><span class="z">"</span><span id="wx11209" class="sc">/&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx11213" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx11217" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx11221" class="ec">&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11223"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$className</span><span class="z">"</span><span id="wx11237" class="sc">/&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11239"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$className</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">external</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11255"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="21" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">ext-</span><span class="op">'</span><span class="op" start="14">,</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx11277" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11281" class="ec">&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11283"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx11298" class="sc">/&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11300"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="43" select="quick">(</span><span class="axis" start="2">@</span><span class="qname" start="3" select="quick">value</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="parenthesis" start="11" pair-end="19" select="quick">(</span><span class="op">'</span><span class="literal" start="12">(</span><span class="op">'</span><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">[</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">or</span><span class="whitespace" start="23"> </span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">type</span><span class="whitespace" start="29"> </span><span class="op" start="30">eq</span><span class="whitespace" start="32"> </span><span class="op">'</span><span class="literal" start="33">function</span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="whitespace" start="44"> </span><span class="op" start="45">and</span><span class="whitespace" start="48"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="49" pair-end="62" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="53">@</span><span class="qname" start="54" select="quick">pair-end</span><span class="parenthesis" start="62">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11344"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">color: pink;</span><span class="op">'</span><span class="z">"</span><span id="wx11360" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11364" class="ec">&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11366"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">pair-end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11377"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pair-end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">pair-end</span><span class="z">"</span><span id="wx11392" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11396" class="ec">&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11398"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="10" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">type</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">or</span><span class="whitespace" start="14"> 
                        
</span><span class="parenthesis" start="17" pair-end="79" select="quick">(</span><span class="axis" start="18">@</span><span class="qname" start="19" select="quick">type</span><span class="whitespace" start="23"> </span><span class="op" start="24">=</span><span class="whitespace" start="25"> </span><span class="parenthesis" start="26" pair-end="78" select="quick">(</span><span class="op">'</span><span class="literal" start="27">function</span><span class="op">'</span><span class="op" start="37">,</span><span class="op">'</span><span class="literal" start="38">filter</span><span class="op">'</span><span class="op" start="46">,</span><span class="op">'</span><span class="literal" start="47">parenthesis</span><span class="op">'</span><span class="op" start="60">,</span><span class="op">'</span><span class="literal" start="61">variable</span><span class="op">'</span><span class="op" start="71">,</span><span class="op">'</span><span class="literal" start="72">node</span><span class="op">'</span><span class="parenthesis" start="78">)</span><span class="parenthesis" start="79">)</span><span class="whitespace" start="80"> </span><span class="op" start="81">and</span><span class="whitespace" start="84"> </span><span class="parenthesis" start="85" pair-end="109" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="86" pair-end="108" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="90">@</span><span class="qname" start="91" select="quick">value</span><span class="whitespace" start="96"> </span><span class="op" start="97">=</span><span class="whitespace" start="98"> </span><span class="parenthesis" start="99" pair-end="107" select="quick">(</span><span class="op">'</span><span class="literal" start="100">)</span><span class="op">'</span><span class="op" start="103">,</span><span class="op">'</span><span class="literal" start="104">]</span><span class="op">'</span><span class="parenthesis" start="107">)</span><span class="parenthesis" start="108">)</span><span class="parenthesis" start="109">)</span><span class="whitespace" start="110"> </span><span class="op" start="111">or</span><span class="whitespace" start="113">
                        
</span><span class="parenthesis" start="115" pair-end="168" select="quick">(</span><span class="axis" start="116">@</span><span class="qname" start="117" select="quick">value</span><span class="whitespace" start="122"> </span><span class="op" start="123">eq</span><span class="whitespace" start="125"> </span><span class="op">'</span><span class="literal" start="126">*</span><span class="op">'</span><span class="whitespace" start="129"> </span><span class="op" start="130">and</span><span class="whitespace" start="133"> </span><span class="variable" start="134" select="quick">$para</span><span class="filter" start="139" pair-end="150" select="quick">[</span><span class="variable" start="140" select="quick">$index</span><span class="whitespace" start="146"> </span><span class="op" start="147">-</span><span class="whitespace" start="148"> </span><span class="numeric" start="149">1</span><span class="filter" start="150">]</span><span class="step" start="151">/</span><span class="axis" start="152">@</span><span class="qname" start="153" select="quick">class</span><span class="whitespace" start="158"> </span><span class="op" start="159">eq</span><span class="whitespace" start="161"> </span><span class="op">'</span><span class="literal" start="162">axis</span><span class="op">'</span><span class="parenthesis" start="168">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11498"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">select</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">quick</span><span class="op">'</span><span class="z">"</span><span id="wx11514" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11518" class="ec">&gt;</span></span><span class="txt">
          
&#xD;
          </span><span class="z">&lt;!--</span><span class="cm">
          
&lt;xsl:choose&gt;&#xD;
          &lt;xsl:when test="@type = ('literal','comment')"&gt;&#xD;
          &lt;xsl:analyze-string &#xD;
          select="if ($isLiteral) then substring(@value, 2, string-length(@value) - 2)&#xD;
          else @value" regex="\n"&gt;&#xD;
          &lt;xsl:matching-substring&gt;&#xD;
          &lt;br&gt;&lt;/br&gt;&#xD;
          &lt;/xsl:matching-substring&gt;&#xD;
          &lt;xsl:non-matching-substring&gt;&#xD;
          &lt;xsl:value-of select="."/&gt;&#xD;
          &lt;/xsl:non-matching-substring&gt;&#xD;
          &lt;/xsl:analyze-string&gt;&#xD;
          &lt;/xsl:when&gt;&#xD;
          &lt;xsl:otherwise&gt;&#xD;
          &lt;xsl:value-of select="if ($isJoined) then substring(@value, 1, string-length(@value) - 1) else @value"/&gt;&#xD;
          &lt;/xsl:otherwise&gt;&#xD;
          &lt;/xsl:choose&gt;&#xD;
          </span><span class="z">--&gt;</span><span class="txt">
          
&#xD;
          </span><span class="ww" id="w11524"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11528"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="parenthesis" start="9" pair-end="29" select="quick">(</span><span class="op">'</span><span class="literal" start="10">literal</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">comment</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w11551"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><span class="variable" start="5" select="quick">$isLiteral</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="22" pair-end="68" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="32">@</span><span class="qname" start="33" select="quick">value</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="numeric" start="40">2</span><span class="op" start="41">,</span><span class="whitespace" start="42"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="43" pair-end="63" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="axis" start="57">@</span><span class="qname" start="58" select="quick">value</span><span class="parenthesis" start="63">)</span><span class="whitespace" start="64"> </span><span class="op" start="65">-</span><span class="whitespace" start="66"> </span><span class="numeric" start="67">2</span><span class="parenthesis" start="68">)</span><span class="whitespace" start="69">
                                    
</span><span class="op" start="71">else</span><span class="whitespace" start="75"> </span><span class="axis" start="76">@</span><span class="qname" start="77" select="quick">value</span><span class="z">"</span><span id="wx11590" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx11594" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w11596"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w11600"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="14" select="quick">(</span><span class="variable" start="5" select="quick">$isJoined</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">then</span><span class="whitespace" start="20"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="21" pair-end="67" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="31">@</span><span class="qname" start="32" select="quick">value</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="numeric" start="39">1</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="42" pair-end="62" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="axis" start="56">@</span><span class="qname" start="57" select="quick">value</span><span class="parenthesis" start="62">)</span><span class="whitespace" start="63"> </span><span class="op" start="64">-</span><span class="whitespace" start="65"> </span><span class="numeric" start="66">1</span><span class="parenthesis" start="67">)</span><span class="whitespace" start="68"> </span><span class="op" start="69">else</span><span class="whitespace" start="73"> </span><span class="axis" start="74">@</span><span class="qname" start="75" select="quick">value</span><span class="z">"</span><span id="wx11639" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx11643" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx11647" class="ec">&gt;</span></span><span class="txt">
          
&#xD;
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx11651" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
        &#xD;
        </span><span class="ww" id="w11653"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isJoined</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w11663"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">parenthesis</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11673"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">(</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx11679" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx11683" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11687" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
        </span><span class="ww" id="w11689"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isLiteral</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w11699"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">op</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w11709"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$literalQuote</span><span class="z">"</span><span id="wx11717" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx11721" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx11725" class="ec">&gt;</span></span><span class="txt">
        
&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx11729" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx11733" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx11737" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w11739"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">token</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">plainLine</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w11755"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w11759"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="z">"</span><span id="wx11774" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w11776"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx11791" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w11793"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?revChars">revChars</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-reverse" class="solar"><span class="function" start="1" pair-end="37" select="quick">reverse</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-to-codepoints" class="solar"><span class="function" start="9" pair-end="36" select="quick">string-to-codepoints</span></a><span class="parenthesis">(</span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">value</span><span class="parenthesis" start="36">)</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer*</span><span class="z">"</span><span id="wx11820" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w11822"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?lastLF">lastLF</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="16" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$revChars</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">+</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">1</span><span class="whitespace" start="21"> </span><span class="op" start="22">-</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-index-of" class="solar"><span class="function" start="24" pair-end="46" select="quick">index-of</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$revChars</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="numeric" start="44">10</span><span class="parenthesis" start="46">)</span><span class="filter" start="47" pair-end="49" select="quick">[</span><span class="numeric" start="48">1</span><span class="filter" start="49">]</span><span class="z">"</span><span id="wx11856" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w11858"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="30" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">value</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$lastLF</span><span class="whitespace" start="26"> </span><span class="op" start="27">+</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx11877" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx11881" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx11885" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w11887"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">token</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">dev</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w11903"><span class="es">&lt;</span><span class="en">p</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w11907"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx11916" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">p</span><span id="wx11920" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx11924" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w11926"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}stringToCharSequence">loc:stringToCharSequence</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w11942"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?string">string</span><span class="z">"</span><span id="wx11950" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w11952"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$i" class="variable" start="5" select="quick">$i</span><span class="whitespace" start="7"> </span><span class="op" start="8">in</span><span class="whitespace" start="10"> </span><span class="numeric" start="11">1</span><span class="whitespace" start="12"> </span><span class="op" start="13">to</span><span class="whitespace" start="15"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="16" pair-end="37" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="30" select="quick">$string</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">
                          
</span><span class="op" start="40">return</span><span class="whitespace" start="46"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="47" pair-end="71" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="57" select="quick">$string</span><span class="op" start="64">,</span><span class="whitespace" start="65"> </span><span class="variable" start="66" select="quick">$i</span><span class="op" start="68">,</span><span class="whitespace" start="69"> </span><span class="numeric" start="70">1</span><span class="parenthesis" start="71">)</span><span class="z">"</span><span id="wx11986" class="sc">/&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx11990" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w11992"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createPairs">loc:createPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w12008"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?brackets">brackets</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx12022" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12024"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nested">nested</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w12040"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?getNesting" class="solar"><span class="tcall">getNesting</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w12050"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">positions</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$brackets</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx12076" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w12078"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12098" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w12100"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12120" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx12124" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx12128" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="z">&lt;!--</span><span class="cm">  pair up start and end elements </span><span class="z">--&gt;</span><span class="txt">
    
</span><span class="ww" id="w12134"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ends">ends</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nested</span><span class="filter" start="8" pair-end="13" select="quick">[</span><span class="axis" start="9">@</span><span class="qname" start="10" select="quick">end</span><span class="filter" start="13">]</span><span class="z">"</span><span id="wx12152" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12154"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nested</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="axis" start="9">@</span><span class="qname" start="10" select="quick">start</span><span class="filter" start="15">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w12168"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12189" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w12191"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">level</span><span class="z">"</span><span id="wx12206" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w12208"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pair">pair</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="24" select="quick">(</span><span class="variable" start="2" select="quick">$ends</span><span class="filter" start="7" pair-end="23" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">level</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$level</span><span class="filter" start="23">]</span><span class="parenthesis" start="24">)</span><span class="filter" start="25" pair-end="47" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="26" pair-end="37" select="quick">number</span></a><span class="parenthesis">(</span><span class="axis" start="33">@</span><span class="qname" start="34" select="quick">end</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38"> </span><span class="op" start="39">&gt;</span><span class="whitespace" start="40"> </span><span class="variable" start="41" select="quick">$start</span><span class="filter" start="47">]</span><span class="filter" start="48" pair-end="50" select="quick">[</span><span class="numeric" start="49">1</span><span class="filter" start="50">]</span><span class="z">"</span><span class="z">
                    
</span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx12252" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w12254"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="7" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="6">.</span><span class="parenthesis" start="7">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w12269"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx12283" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w12285"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx12299" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w12301"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w12311"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span id="wx12328" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx12332" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx12336" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx12340" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx12344" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w12346"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?getNesting">getNesting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w12356"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?positions">positions</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx12370" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12372"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12386" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12388"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12402" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w12404"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pos">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$positions</span><span class="filter" start="11" pair-end="18" select="quick">[</span><span class="variable" start="12" select="quick">$index</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx12421" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12423"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isOpen">isOpen</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="28" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">[</span><span class="op">'</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">(:</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx12463" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12465"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isBracket">isBracket</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="22" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">)</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx12500" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12502"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isComment">isComment</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="24" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(:</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">:)</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx12537" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12539"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?blockType">blockType</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="14">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$isBracket</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">then</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">bracket</span><span class="op">'</span><span class="whitespace" start="30">
                                           
</span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><span class="if" start="37" pair-end="50">if</span><span class="parenthesis">(</span><span class="variable" start="40" select="quick">$isComment</span><span class="parenthesis" start="50">)</span><span class="whitespace" start="51"> </span><span class="op" start="52">then</span><span class="whitespace" start="56"> </span><span class="op">'</span><span class="literal" start="57">comment</span><span class="op">'</span><span class="whitespace" start="66">
                                           
</span><span class="op" start="68">else</span><span class="whitespace" start="72"> </span><span class="op">'</span><span class="literal" start="73">predicate</span><span class="op">'</span><span class="z">"</span><span id="wx12581" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12583"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="11">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$isOpen</span><span class="parenthesis" start="11">)</span><span class="whitespace" start="12"> </span><span class="op" start="13">then</span><span class="whitespace" start="17">
                                          
</span><span class="variable" start="19" select="quick">$level</span><span class="whitespace" start="25"> </span><span class="op" start="26">+</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">1</span><span class="whitespace" start="29"> </span><span class="op" start="30">else</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$level</span><span class="whitespace" start="41"> </span><span class="op" start="42">-</span><span class="whitespace" start="43"> </span><span class="numeric" start="44">1</span><span class="z">"</span><span id="wx12616" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w12618"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w12622"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$pos</span><span class="parenthesis" start="11">)</span><span class="z">"</span><span id="wx12633" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w12635"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isOpen</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w12645"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$blockType</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w12657"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">position</span><span class="z">"</span><span id="wx12674" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w12676"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newLevel</span><span class="z">"</span><span id="wx12690" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx12694" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx12698" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w12700"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w12704"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$blockType</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w12716"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">position</span><span class="z">"</span><span id="wx12733" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w12735"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx12749" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx12753" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx12757" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx12761" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w12763"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w12767"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">&gt;</span><span class="whitespace" start="13"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="14" pair-end="30" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$positions</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx12786" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w12788"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w12792"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#t?getNesting" class="solar"><span class="tcall">getNesting</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w12802"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12822" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w12824"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12848" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx12852" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx12856" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx12860" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx12864" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w12866"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createBlocks">loc:createBlocks</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w12882"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chars">chars</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx12896" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12898"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?skip">skip</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx12912" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12914"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12928" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12930"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?awaiting">awaiting</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx12944" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12946"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12960" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w12962"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx12976" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w12978"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?charCount">charCount</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="13" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$chars</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx12995" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w12997"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char">char</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx13014" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w13016"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nChar">nChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">+</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx13037" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w13039"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pChar">pChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">-</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx13060" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13062"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w13078"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w13082"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13098"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="32">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$char</span><span class="whitespace" start="9"> </span><span class="op" start="10">=</span><span class="whitespace" start="11"> </span><span class="op">'</span><span class="literal" start="12">(</span><span class="op">'</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$nChar</span><span class="whitespace" start="26"> </span><span class="op" start="27">=</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">:</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="whitespace" start="33"> </span><span class="op" start="34">then</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$level</span><span class="whitespace" start="45"> </span><span class="op" start="46">+</span><span class="whitespace" start="47"> </span><span class="numeric" start="48">1</span><span class="whitespace" start="49">
                                
</span><span class="op" start="51">else</span><span class="whitespace" start="55"> </span><span class="if" start="56">if</span><span class="whitespace" start="58"> </span><span class="parenthesis" start="59" pair-end="104" select="quick">(</span><span class="variable" start="60" select="quick">$char</span><span class="whitespace" start="65"> </span><span class="op" start="66">=</span><span class="whitespace" start="67"> </span><span class="op">'</span><span class="literal" start="68">)</span><span class="op">'</span><span class="whitespace" start="71"> </span><span class="op" start="72">and</span><span class="whitespace" start="75"> </span><span class="variable" start="76" select="quick">$pChar</span><span class="whitespace" start="82"> </span><span class="op" start="83">=</span><span class="whitespace" start="84"> </span><span class="op">'</span><span class="literal" start="85">:</span><span class="op">'</span><span class="whitespace" start="88"> </span><span class="op" start="89">and</span><span class="whitespace" start="92"> </span><span class="variable" start="93" select="quick">$level</span><span class="whitespace" start="99"> </span><span class="op" start="100">gt</span><span class="whitespace" start="102"> </span><span class="numeric" start="103">0</span><span class="parenthesis" start="104">)</span><span class="whitespace" start="105"> </span><span class="op" start="106">then</span><span class="whitespace" start="110"> </span><span class="variable" start="111" select="quick">$level</span><span class="whitespace" start="117"> </span><span class="numeric" start="118">-1</span><span class="whitespace" start="120">
                                
</span><span class="op" start="122">else</span><span class="whitespace" start="126"> </span><span class="variable" start="127" select="quick">$level</span><span class="z">"</span><span id="wx13175" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13179" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13181"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13185"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx13193" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx13197" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx13201" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx13205" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13207"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nowAwaiting">nowAwaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w13217"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w13221"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="op" start="10">=</span><span class="op">'</span><span class="literal" start="11"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13235"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="37">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$char</span><span class="whitespace" start="9"> </span><span class="op" start="10">=</span><span class="whitespace" start="11"> </span><span class="parenthesis" start="12" pair-end="36" select="quick">(</span><span class="op">'</span><span class="literal" start="13">&amp;apos;&amp;apos;</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">&amp;quot;</span><span class="op">'</span><span class="parenthesis" start="36">)</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">
                                
</span><span class="op" start="40">then</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$char</span><span class="whitespace" start="50"> 
                                
</span><span class="op" start="53">else</span><span class="whitespace" start="57"> </span><span class="if" start="58">if</span><span class="whitespace" start="60"> </span><span class="parenthesis" start="61" pair-end="90" select="quick">(</span><span class="variable" start="62" select="quick">$char</span><span class="whitespace" start="67"> </span><span class="op" start="68">=</span><span class="whitespace" start="69"> </span><span class="op">'</span><span class="literal" start="70">(</span><span class="op">'</span><span class="whitespace" start="73"> </span><span class="op" start="74">and</span><span class="whitespace" start="77"> </span><span class="variable" start="78" select="quick">$nChar</span><span class="whitespace" start="84"> </span><span class="op" start="85">=</span><span class="whitespace" start="86"> </span><span class="op">'</span><span class="literal" start="87">:</span><span class="op">'</span><span class="parenthesis" start="90">)</span><span class="whitespace" start="91"> </span><span class="op" start="92">then</span><span class="whitespace" start="96"> </span><span class="op">'</span><span class="literal" start="97">:)</span><span class="op">'</span><span class="whitespace" start="101"> 
                                
</span><span class="op" start="104">else</span><span class="whitespace" start="108"> </span><span class="op">'</span><span class="literal" start="109"></span><span class="op">'</span><span class="z">"</span><span id="wx13298" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13302" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13304"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$awaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13318"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx13328" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13332" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13334"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">:)</span><span class="op">'</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$char</span><span class="whitespace" start="27"> </span><span class="op" start="28">=</span><span class="whitespace" start="29"> </span><span class="op">'</span><span class="literal" start="30">)</span><span class="op">'</span><span class="whitespace" start="33"> </span><span class="op" start="34">and</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$pChar</span><span class="whitespace" start="44"> </span><span class="op" start="45">=</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47">:</span><span class="op">'</span><span class="whitespace" start="50"> </span><span class="op" start="51">and</span><span class="whitespace" start="54"> </span><span class="variable" start="55" select="quick">$level</span><span class="whitespace" start="61"> </span><span class="op" start="62">=</span><span class="whitespace" start="63"> </span><span class="numeric" start="64">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13378"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx13388" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13392" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13394"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13398"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span id="wx13406" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx13410" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx13414" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx13418" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13420"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nowSkip">nowSkip</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w13436"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w13440"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$skip</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13450"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx13460" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13464" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13466"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$awaiting</span><span class="whitespace" start="18"> </span><span class="op" start="19">and</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$nChar</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$char</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13488"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="1" pair-end="6" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx13498" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13502" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13504"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13508"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx13518" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx13522" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx13526" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx13530" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13532"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13"></span><span class="op">'</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$nowAwaiting</span><span class="whitespace" start="32"> </span><span class="op" start="33">=</span><span class="whitespace" start="34"> </span><span class="op">'</span><span class="literal" start="35"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w13558"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="parenthesis" start="9" pair-end="25" select="quick">(</span><span class="op">'</span><span class="literal" start="10">[</span><span class="op">'</span><span class="op" start="13">,</span><span class="op">'</span><span class="literal" start="14">]</span><span class="op">'</span><span class="op" start="17">,</span><span class="op">'</span><span class="literal" start="18">(</span><span class="op">'</span><span class="op" start="21">,</span><span class="op">'</span><span class="literal" start="22">)</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w13588"><span class="es">&lt;</span><span class="en">block</span><span class="z"> </span><span class="atn">position</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$index</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$char</span><span class="op">}</span><span class="z">"</span><span id="wx13606" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13610" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13614" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13616"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isFound">isFound</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="29" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$nowAwaiting</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">and</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="35" pair-end="56" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$skip</span><span class="whitespace" start="44"> </span><span class="op" start="45">or</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$nowSkip</span><span class="parenthesis" start="56">)</span><span class="z">"</span><span id="wx13654" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13656"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newStart">newStart</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="13" select="quick">(</span><span class="variable" start="5" select="quick">$isFound</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">then</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$index</span><span class="whitespace" start="26"> </span><span class="op" start="27">else</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$start</span><span class="z">"</span><span id="wx13688" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13690"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$isFound</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w13710"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">:)</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">comment</span><span class="op">'</span><span class="whitespace" start="37"> </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">literal</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w13744"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13760"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="z">"</span><span id="wx13774" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13778" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13780"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx13794" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w13796"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="z">"</span><span id="wx13810" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx13814" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13818" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w13820"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w13824"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="variable" start="11" select="quick">$charCount</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w13838"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="21" pair-end="33" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$isFound</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w13861"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">:)</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">comment</span><span class="op">'</span><span class="whitespace" start="37"> </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">literal</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w13895"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w13911"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span id="wx13925" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13929" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w13931"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx13945" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx13949" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx13953" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx13957" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w13959"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w13963"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createBlocks" class="solar"><span class="function" start="1" pair-end="82" select="quick">loc:createBlocks</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chars</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$nowSkip</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="variable" start="36" select="quick">$index</span><span class="whitespace" start="42"> </span><span class="op" start="43">+</span><span class="whitespace" start="44"> </span><span class="numeric" start="45">1</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$nowAwaiting</span><span class="op" start="60">,</span><span class="whitespace" start="61"> </span><span class="variable" start="62" select="quick">$newStart</span><span class="op" start="71">,</span><span class="whitespace" start="72"> </span><span class="variable" start="73" select="quick">$newLevel</span><span class="parenthesis" start="82">)</span><span class="z">"</span><span id="wx13993" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx13997" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx14001" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx14005" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> top-level call - marks up tokens with their type </span><span class="z">--&gt;</span><span class="txt">
  
</span><span class="ww" id="w14011"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}getTokens">loc:getTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w14021"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx14035" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14037"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?omitPairs">omitPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx14051" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14053"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx14067" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14069"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createTokens" class="solar"><span class="function" start="1" pair-end="42" select="quick">loc:createTokens</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chunk</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$omitPairs</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="numeric" start="38">1</span><span class="op" start="39">,</span><span class="whitespace" start="40"> </span><span class="numeric" start="41">1</span><span class="parenthesis" start="42">)</span><span class="z">"</span><span id="wx14101" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w14103"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}rationalizeTokens" class="solar"><span class="function" start="1" pair-end="70" select="quick">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$tokens</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="numeric" start="32">1</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="35" pair-end="41" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$pbPairs</span><span class="op" start="52">,</span><span class="whitespace" start="53"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="54" pair-end="60" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="60">)</span><span class="op" start="61">,</span><span class="whitespace" start="62"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="63" pair-end="69" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="69">)</span><span class="parenthesis" start="70">)</span><span class="z">"</span><span id="wx14135" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx14139" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  &#xD;
  </span><span class="ww" id="w14141"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}rationalizeTokens">loc:rationalizeTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w14151"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx14165" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14167"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx14181" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14183"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevIsClosed">prevIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx14197" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14199"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx14213" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14215"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?typeExpected">typeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx14229" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14231"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?quantifierExpected">quantifierExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx14245" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="z">&lt;!--</span><span class="cm"> when closed, a probable operator is a QName instead </span><span class="z">--&gt;</span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w14251"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx14274" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14276"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isQuantifier">isQuantifier</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$quantifierExpected</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$token</span><span class="step" start="31">/</span><span class="axis" start="32">@</span><span class="qname" start="33" select="quick">value</span><span class="whitespace" start="38"> </span><span class="op" start="39">=</span><span class="whitespace" start="40"> </span><span class="parenthesis" start="41" pair-end="53" select="quick">(</span><span class="op">'</span><span class="literal" start="42">?</span><span class="op">'</span><span class="op" start="45">,</span><span class="op">'</span><span class="literal" start="46">*</span><span class="op">'</span><span class="op" start="49">,</span><span class="op">'</span><span class="literal" start="50">+</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx14313" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14315"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?currentIsClosed">currentIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isQuantifier</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="18" pair-end="34" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$token</span><span class="step" start="28">/</span><span class="axis" start="29">@</span><span class="qname" start="30" select="quick">type</span><span class="parenthesis" start="34">)</span><span class="whitespace" start="35"> </span><span class="op" start="36">or</span><span class="whitespace" start="38"> </span><span class="parenthesis" start="39" pair-end="129" select="quick">(</span><span class="variable" start="40" select="quick">$token</span><span class="step" start="46">/</span><span class="axis" start="47">@</span><span class="qname" start="48" select="quick">value</span><span class="whitespace" start="53"> </span><span class="op" start="54">=</span><span class="whitespace" start="55"> </span><span class="parenthesis" start="56" pair-end="64" select="quick">(</span><span class="op">'</span><span class="literal" start="57">)</span><span class="op">'</span><span class="op" start="60">,</span><span class="op">'</span><span class="literal" start="61">]</span><span class="op">'</span><span class="parenthesis" start="64">)</span><span class="whitespace" start="65"> </span><span class="op" start="66">or</span><span class="whitespace" start="68"> </span><span class="parenthesis" start="69" pair-end="128" select="quick">(</span><span class="variable" start="70" select="quick">$token</span><span class="step" start="76">/</span><span class="axis" start="77">@</span><span class="qname" start="78" select="quick">type</span><span class="whitespace" start="82"> </span><span class="op" start="83">=</span><span class="whitespace" start="84"> </span><span class="parenthesis" start="85" pair-end="127" select="quick">(</span><span class="op">'</span><span class="literal" start="86">literal</span><span class="op">'</span><span class="op" start="95">,</span><span class="op">'</span><span class="literal" start="96">numeric</span><span class="op">'</span><span class="op" start="105">,</span><span class="op">'</span><span class="literal" start="106">variable</span><span class="op">'</span><span class="op" start="116">,</span><span class="whitespace" start="117"> </span><span class="op">'</span><span class="literal" start="118">context</span><span class="op">'</span><span class="parenthesis" start="127">)</span><span class="parenthesis" start="128">)</span><span class="parenthesis" start="129">)</span><span class="z">"</span><span id="wx14396" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w14398"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w14408"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">start</span><span class="z">"</span><span id="wx14425" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w14427"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">end</span><span class="z">"</span><span id="wx14444" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w14446"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">value</span><span class="z">"</span><span id="wx14463" class="sc">/&gt;</span></span><span class="txt">
      
&#xD;
      </span><span class="ww" id="w14465"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w14469"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w14488"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$prevIsClosed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w14498"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">op</span><span class="op">'</span><span class="z">"</span><span id="wx14514" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx14518" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14522" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w14524"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="18" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$isQuantifier</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">and</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="24" pair-end="41" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="28" select="quick">$prevIsClosed</span><span class="parenthesis" start="41">)</span><span class="whitespace" start="42"> </span><span class="op" start="43">and</span><span class="whitespace" start="46"> </span><span class="variable" start="47" select="quick">$token</span><span class="step" start="53">/</span><span class="axis" start="54">@</span><span class="qname" start="55" select="quick">value</span><span class="whitespace" start="60"> </span><span class="op" start="61">eq</span><span class="whitespace" start="63"> </span><span class="op">'</span><span class="literal" start="64">*</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="z">&lt;!--</span><span class="cm">
          
&lt;xsl:attribute name="type" select="'any'"/&gt;&#xD;
          &#xD;
          </span><span class="z">--&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14563" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w14565"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="parenthesis" start="16" pair-end="40" select="quick">(</span><span class="op">'</span><span class="literal" start="17">function</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">if</span><span class="op">'</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">node</span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="whitespace" start="41"> </span><span class="op" start="42">or</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$token</span><span class="step" start="51">/</span><span class="axis" start="52">@</span><span class="qname" start="53" select="quick">value</span><span class="whitespace" start="58"> </span><span class="op" start="59">=</span><span class="whitespace" start="60"> </span><span class="parenthesis" start="61" pair-end="69" select="quick">(</span><span class="op">'</span><span class="literal" start="62">(</span><span class="op">'</span><span class="op" start="65">,</span><span class="op">'</span><span class="literal" start="66">[</span><span class="op">'</span><span class="parenthesis" start="69">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w14614"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pair">pair</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pbPairs</span><span class="filter" start="9" pair-end="30" select="quick">[</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">start</span><span class="whitespace" start="16"> </span><span class="op" start="17">=</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$token</span><span class="step" start="25">/</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">end</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx14639" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w14641"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w14645"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$token</span><span class="step" start="25">/</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">type</span><span class="whitespace" start="31"> </span><span class="op" start="32">eq</span><span class="whitespace" start="34"> </span><span class="op">'</span><span class="literal" start="35">node</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w14668"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">node-type</span><span class="op">'</span><span class="z">"</span><span id="wx14684" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14688" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w14690"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w14694"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span id="wx14711" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx14715" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx14719" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w14721"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="17" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$pair</span><span class="parenthesis" start="16">)</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w14737"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w14750"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pair-end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span id="wx14767" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx14771" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w14773"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">level</span><span class="z">"</span><span id="wx14790" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx14794" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14798" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w14800"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w14810"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="17" select="quick">(</span><span class="variable" start="5" select="quick">$token</span><span class="step" start="11">/</span><span class="axis" start="12">@</span><span class="qname" start="13" select="quick">type</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">then</span><span class="whitespace" start="23"> </span><span class="variable" start="24" select="quick">$token</span><span class="step" start="30">/</span><span class="axis" start="31">@</span><span class="qname" start="32" select="quick">type</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">type-name</span><span class="op">'</span><span class="z">"</span><span id="wx14844" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14848" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w14850"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isQuantifier</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w14860"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">quantifier</span><span class="op">'</span><span class="z">"</span><span id="wx14876" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14880" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w14882"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w14895"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span id="wx14912" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx14916" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx14920" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx14924" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w14926"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ignorable">ignorable</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="parenthesis" start="16" pair-end="40" select="quick">(</span><span class="op">'</span><span class="literal" start="17">whitespace</span><span class="op">'</span><span class="op" start="29">,</span><span class="whitespace" start="30"> </span><span class="op">'</span><span class="literal" start="31">comment</span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span id="wx14962" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w14964"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isNewClosed">isNewClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w14980"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w14984"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ignorable</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w14994"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$prevIsClosed</span><span class="z">"</span><span id="wx15002" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15006" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15008"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15027"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="18" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$prevIsClosed</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span id="wx15038" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15042" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15044"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15048"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$currentIsClosed</span><span class="z">"</span><span id="wx15056" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx15060" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx15064" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx15068" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15070"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newTypeExpected">newTypeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><span class="variable" start="5" select="quick">$ignorable</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$typeExpected</span><span class="whitespace" start="35">
                          
</span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="variable" start="42" select="quick">$token</span><span class="step" start="48">/</span><span class="axis" start="49">@</span><span class="qname" start="50" select="quick">type</span><span class="whitespace" start="54"> </span><span class="op" start="55">=</span><span class="whitespace" start="56"> </span><span class="op">'</span><span class="literal" start="57">type-op</span><span class="op">'</span><span class="z">"</span><span id="wx15111" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    &#xD;
    </span><span class="ww" id="w15113"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">le</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="28" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w15134"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?qExpected">qExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">
                    
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$token</span><span class="step" start="24">/</span><span class="axis" start="25">@</span><span class="qname" start="26" select="quick">value</span><span class="whitespace" start="31"> </span><span class="op" start="32">=</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">)</span><span class="op">'</span><span class="z">"</span><span id="wx15167" class="sc">/&gt;</span></span><span class="txt"> 
      
&#xD;
      &#xD;
      </span><span class="ww" id="w15169"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}rationalizeTokens" class="solar"><span class="function" start="1" pair-end="97" select="quick">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$tokens</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$index</span><span class="whitespace" start="38"> </span><span class="op" start="39">+</span><span class="whitespace" start="40"> </span><span class="numeric" start="41">1</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$isNewClosed</span><span class="op" start="56">,</span><span class="whitespace" start="57">
                            
</span><span class="variable" start="59" select="quick">$pbPairs</span><span class="op" start="67">,</span><span class="whitespace" start="68"> </span><span class="variable" start="69" select="quick">$newTypeExpected</span><span class="op" start="85">,</span><span class="whitespace" start="86"> </span><span class="variable" start="87" select="quick">$qExpected</span><span class="parenthesis" start="97">)</span><span class="z">"</span><span id="wx15199" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15203" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx15207" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  &#xD;
  </span><span class="ww" id="w15209"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createTokens">loc:createTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w15219"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?string">string</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx15233" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w15235"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?excludes">excludes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx15249" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w15251"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx15265" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w15267"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx15281" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15283"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?exclude">exclude</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$excludes</span><span class="filter" start="10" pair-end="17" select="quick">[</span><span class="variable" start="11" select="quick">$index</span><span class="filter" start="17">]</span><span class="z">"</span><span id="wx15306" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15308"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="parenthesis" start="27" pair-end="28" select="quick">(</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                          
</span><span class="op" start="31">else</span><span class="whitespace" start="35"> </span><span class="if" start="36">if</span><span class="whitespace" start="38"> </span><span class="parenthesis" start="39" pair-end="53" select="quick">(</span><span class="variable" start="40" select="quick">$exclude</span><span class="step" start="48">/</span><span class="axis" start="49">@</span><span class="qname" start="50" select="quick">end</span><span class="parenthesis" start="53">)</span><span class="whitespace" start="54"> </span><span class="op" start="55">then</span><span class="whitespace" start="59"> 
                          
</span><span class="variable" start="62" select="quick">$exclude</span><span class="step" start="70">/</span><span class="axis" start="71">@</span><span class="qname" start="72" select="quick">end</span><span class="whitespace" start="75"> </span><span class="type-op" start="76">cast as</span><span class="whitespace" start="83"> </span><span class="type-name" start="84">xs:integer</span><span class="whitespace" start="94"> </span><span class="op" start="95">+</span><span class="whitespace" start="96"> </span><span class="numeric" start="97">1</span><span class="whitespace" start="98">
                          
</span><span class="op" start="100">else</span><span class="whitespace" start="104"> </span><span class="parenthesis" start="105" pair-end="106" select="quick">(</span><span class="parenthesis" start="106">)</span><span class="z">"</span><span id="wx15371" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15373"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?exStart">exStart</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="parenthesis" start="27" pair-end="28" select="quick">(</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">
                          
</span><span class="op" start="31">else</span><span class="whitespace" start="35"> </span><span class="variable" start="36" select="quick">$exclude</span><span class="step" start="44">/</span><span class="axis" start="45">@</span><span class="qname" start="46" select="quick">start</span><span class="z">"</span><span id="wx15412" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15414"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part">part</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w15424"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w15428"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$exclude</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$index</span><span class="whitespace" start="27"> </span><span class="op" start="28">=</span><span class="whitespace" start="29"> </span><span class="numeric" start="30">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15449"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$string</span><span class="z">"</span><span id="wx15457" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15461" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15463"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="16" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$exStart</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$exStart</span><span class="whitespace" start="30"> </span><span class="op" start="31">ge</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$start</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15484"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="45" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$start</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$exStart</span><span class="whitespace" start="36"> </span><span class="op" start="37">-</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$start</span><span class="parenthesis" start="45">)</span><span class="z">"</span><span id="wx15505" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx15509" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15511"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15515"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="63" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$start</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="28" pair-end="49" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="42" select="quick">$string</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50"> </span><span class="op" start="51">+</span><span class="whitespace" start="52"> </span><span class="numeric" start="53">1</span><span class="whitespace" start="54"> </span><span class="op" start="55">-</span><span class="whitespace" start="56"> </span><span class="variable" start="57" select="quick">$start</span><span class="parenthesis" start="63">)</span><span class="z">"</span><span id="wx15543" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx15547" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx15551" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx15555" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15557"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="20" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">gt</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w15574"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                    
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}rawTokens" class="solar"><span class="function" start="1" pair-end="20" select="quick">loc:rawTokens</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span id="wx15597" class="sc">/&gt;</span></span><span class="txt">
      
&#xD;
      </span><span class="z">&lt;!--</span><span class="cm"> The XSLT that generates the tokens </span><span class="z">--&gt;</span><span class="txt">
      
</span><span class="ww" id="w15603"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}processTokens" class="solar"><span class="function" start="1" pair-end="37" select="quick">loc:processTokens</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$tokens</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$start</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">1</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span id="wx15620" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15624" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15626"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="20" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w15642"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w15652"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">start</span><span class="z">"</span><span id="wx15669" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15671"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15684"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">end</span><span class="z">"</span><span id="wx15701" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15705" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15707"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stringEnd">stringEnd</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15717"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$exclude</span><span class="step" start="13">/</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">end</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$exclude</span><span class="step" start="33">/</span><span class="axis" start="34">@</span><span class="qname" start="35" select="quick">end</span><span class="whitespace" start="38"> </span><span class="op" start="39">else</span><span class="whitespace" start="43"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="44" pair-end="65" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="58" select="quick">$string</span><span class="parenthesis" start="65">)</span><span class="z">"</span><span id="wx15746" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx15750" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15752"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w15762"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="69" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$exclude</span><span class="step" start="28">/</span><span class="axis" start="29">@</span><span class="qname" start="30" select="quick">start</span><span class="op" start="35">,</span><span class="whitespace" start="36"> </span><span class="variable" start="37" select="quick">$stringEnd</span><span class="whitespace" start="47"> </span><span class="op" start="48">+</span><span class="whitespace" start="49"> </span><span class="numeric" start="50">1</span><span class="whitespace" start="51"> </span><span class="op" start="52">-</span><span class="whitespace" start="53"> </span><span class="variable" start="54" select="quick">$exclude</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">start</span><span class="parenthesis" start="69">)</span><span class="z">"</span><span id="wx15793" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx15797" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w15799"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="14" select="quick">name</span></a><span class="parenthesis">(</span><span class="variable" start="6" select="quick">$exclude</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span id="wx15816" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx15820" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15824" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="z">&lt;!--</span><span class="cm"> iterate 1 pos beyond end of excludes length </span><span class="z">--&gt;</span><span class="txt">
    
</span><span class="ww" id="w15830"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="21" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$excludes</span><span class="parenthesis" start="20">)</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">and</span><span class="whitespace" start="26"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="27" pair-end="42" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="31">empty</span><span class="parenthesis">(</span><span class="variable" start="37" select="quick">$end</span><span class="parenthesis" start="41">)</span><span class="parenthesis" start="42">)</span><span class="whitespace" start="43"> </span><span class="op" start="44">and</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$index</span><span class="whitespace" start="54"> </span><span class="op" start="55">le</span><span class="whitespace" start="57"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="58" pair-end="73" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="64" select="quick">$excludes</span><span class="parenthesis" start="73">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w15867"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}createTokens" class="solar"><span class="function" start="1" pair-end="54" select="quick">loc:createTokens</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$string</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$excludes</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$end</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$index</span><span class="whitespace" start="50"> </span><span class="op" start="51">+</span><span class="whitespace" start="52"> </span><span class="numeric" start="53">1</span><span class="parenthesis" start="54">)</span><span class="z">"</span><span id="wx15891" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx15895" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx15899" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w15901"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}processTokens">loc:processTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w15917"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx15931" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w15933"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx15947" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w15949"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx15963" class="sc">/&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w15965"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span id="wx15988" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w15990"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z">
                  
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="10" pair-end="30" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="24" select="quick">$token</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx16017" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w16019"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w16029"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx16043" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w16045"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$end</span><span class="whitespace" start="5"> </span><span class="op" start="6">-</span><span class="whitespace" start="7"> </span><span class="numeric" start="8">1</span><span class="z">"</span><span id="wx16063" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w16065"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="z">"</span><span id="wx16079" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w16081"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isSimpleOps">isSimpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="xmlspectrum.xsl.html#v?simpleOps" class="solar"><span class="variable" start="10" select="quick">$simpleOps</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx16105" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w16107"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w16117"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="23">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$token</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="parenthesis" start="13" pair-end="22" select="quick">(</span><span class="op">'</span><span class="literal" start="14">/</span><span class="op">'</span><span class="op" start="17">,</span><span class="op">'</span><span class="literal" start="18">//</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">then</span><span class="whitespace" start="29"> </span><span class="op">'</span><span class="literal" start="30">step</span><span class="op">'</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">op</span><span class="op">'</span><span class="z">"</span><span id="wx16158" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx16162" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w16164"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isDoubleToken">isDoubleToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w16180"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16184"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w16194"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx16204" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16208" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w16210"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w16214"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?splitToken">splitToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                          
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="31" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$token</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18">[\s\p{Zs}]+</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span id="wx16242" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w16244"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
                
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="5" pair-end="22" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$splitToken</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">ne</span><span class="whitespace" start="26"> </span><span class="numeric" start="27">2</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29"> </span><span class="op" start="30">then</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="35" pair-end="41" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="whitespace" start="42">
                        
</span><span class="op" start="44">else</span><span class="whitespace" start="48"> </span><span class="if" start="49">if</span><span class="whitespace" start="51"> </span><span class="parenthesis" start="52" pair-end="108" select="quick">(</span><span class="variable" start="53" select="quick">$splitToken</span><span class="filter" start="64" pair-end="66" select="quick">[</span><span class="numeric" start="65">1</span><span class="filter" start="66">]</span><span class="whitespace" start="67"> </span><span class="op" start="68">eq</span><span class="whitespace" start="70"> </span><span class="op">'</span><span class="literal" start="71">instance</span><span class="op">'</span><span class="whitespace" start="81"> </span><span class="op" start="82">and</span><span class="whitespace" start="85"> </span><span class="variable" start="86" select="quick">$splitToken</span><span class="filter" start="97" pair-end="99" select="quick">[</span><span class="numeric" start="98">2</span><span class="filter" start="99">]</span><span class="whitespace" start="100"> </span><span class="op" start="101">eq</span><span class="whitespace" start="103"> </span><span class="op">'</span><span class="literal" start="104">of</span><span class="op">'</span><span class="parenthesis" start="108">)</span><span class="whitespace" start="109"> 
                        
</span><span class="op" start="112">then</span><span class="whitespace" start="116"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="117" pair-end="122" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="122">)</span><span class="whitespace" start="123">
                        
</span><span class="op" start="125">else</span><span class="whitespace" start="129"> </span><span class="if" start="130">if</span><span class="whitespace" start="132"> </span><span class="parenthesis" start="133" pair-end="205" select="quick">(</span><span class="variable" start="134" select="quick">$splitToken</span><span class="filter" start="145" pair-end="147" select="quick">[</span><span class="numeric" start="146">1</span><span class="filter" start="147">]</span><span class="whitespace" start="148"> </span><span class="op" start="149">=</span><span class="whitespace" start="150"> </span><span class="parenthesis" start="151" pair-end="177" select="quick">(</span><span class="op">'</span><span class="literal" start="152">cast</span><span class="op">'</span><span class="op" start="158">,</span><span class="op">'</span><span class="literal" start="159">castable</span><span class="op">'</span><span class="op" start="169">,</span><span class="op">'</span><span class="literal" start="170">treat</span><span class="op">'</span><span class="parenthesis" start="177">)</span><span class="whitespace" start="178"> </span><span class="op" start="179">and</span><span class="whitespace" start="182"> </span><span class="variable" start="183" select="quick">$splitToken</span><span class="filter" start="194" pair-end="196" select="quick">[</span><span class="numeric" start="195">2</span><span class="filter" start="196">]</span><span class="whitespace" start="197"> </span><span class="op" start="198">eq</span><span class="whitespace" start="200"> </span><span class="op">'</span><span class="literal" start="201">as</span><span class="op">'</span><span class="parenthesis" start="205">)</span><span class="whitespace" start="206">
                        
</span><span class="op" start="208">then</span><span class="whitespace" start="212"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="213" pair-end="218" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="218">)</span><span class="whitespace" start="219"> </span><span class="op" start="220">else</span><span class="whitespace" start="224"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="225" pair-end="231" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="231">)</span><span class="z">"</span><span id="wx16357" class="sc">/&gt;</span></span><span class="txt">
            
&#xD;
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx16361" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx16365" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx16369" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w16371"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isDoubleToken</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w16381"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">type-op</span><span class="op">'</span><span class="z">"</span><span id="wx16397" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx16401" class="ec">&gt;</span></span><span class="txt">
      
&#xD;
      </span><span class="ww" id="w16403"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?functionType">functionType</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w16419"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16423"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="whitespace" start="13"> </span><span class="op" start="14">or</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$isDoubleToken</span><span class="whitespace" start="31"> </span><span class="op" start="32">or</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="35" pair-end="55" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="49" select="quick">$token</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56"> </span><span class="op" start="57">=</span><span class="whitespace" start="58"> </span><span class="numeric" start="59">1</span><span class="whitespace" start="60"> </span><span class="op" start="61">or</span><span class="whitespace" start="63"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="64" pair-end="89" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="68" pair-end="88" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="78" select="quick">$token</span><span class="op" start="84">,</span><span class="op">'</span><span class="literal" start="85">(</span><span class="op">'</span><span class="parenthesis" start="88">)</span><span class="parenthesis" start="89">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w16462"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx16468" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16472" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ww" id="w16474"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w16478"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fnName">fnName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="34" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$token</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18">[\s\p{Zs}]+|\(</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="filter" start="35" pair-end="37" select="quick">[</span><span class="numeric" start="36">1</span><span class="filter" start="37">]</span><span class="z">"</span><span id="wx16509" class="sc">/&gt;</span></span><span class="txt">
            
</span><span class="ww" id="w16511"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              
</span><span class="ww" id="w16515"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$fnName</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w16531"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">if</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx16537" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16541" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ww" id="w16543"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">some</span><span class="whitespace" start="5"> </span><span id="rng-$n" class="variable" start="6" select="quick">$n</span><span class="whitespace" start="8"> </span><span class="op" start="9">in</span><span class="whitespace" start="11"> </span><a href="xmlspectrum.xsl.html#v?nodeTests" class="solar"><span class="variable" start="12" select="quick">$nodeTests</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">satisfies</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$n</span><span class="whitespace" start="35"> </span><span class="op" start="36">=</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w16567"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx16573" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16577" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ww" id="w16579"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">some</span><span class="whitespace" start="5"> </span><span id="rng-$x" class="variable" start="6" select="quick">$x</span><span class="whitespace" start="8"> </span><span class="op" start="9">in</span><span class="whitespace" start="11"> </span><a href="xmlspectrum.xsl.html#v?typeTests" class="solar"><span class="variable" start="12" select="quick">$typeTests</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">satisfies</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$x</span><span class="whitespace" start="35"> </span><span class="op" start="36">=</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w16603"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">type</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx16609" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16613" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ww" id="w16615"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                
</span><span class="ww" id="w16619"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">function</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx16625" class="ec">&gt;</span></span><span class="txt">
              
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx16629" class="ec">&gt;</span></span><span class="txt">
            
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx16633" class="ec">&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx16637" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx16641" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx16645" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w16647"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w16651"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="whitespace" start="13"> </span><span class="op" start="14">or</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$isDoubleToken</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16667" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16669"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$functionType</span><span class="whitespace" start="14"> </span><span class="op" start="15">ne</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16685"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$functionType</span><span class="z">"</span><span id="wx16699" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16703" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16705"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="1" pair-end="23" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="op">'</span><span class="literal" start="19">::</span><span class="op">'</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">or</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$token</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38">@</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16733"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">axis</span><span class="op">'</span><span class="z">"</span><span id="wx16749" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16753" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16755"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="1" pair-end="29" select="quick">matches</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$token</span><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">[\s\p{Zs}]+</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16772"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">whitespace</span><span class="op">'</span><span class="z">"</span><span id="wx16788" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16792" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16794"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="19" select="quick">(</span><span class="op">'</span><span class="literal" start="11">.</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">..</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16816"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">context</span><span class="op">'</span><span class="z">"</span><span id="wx16832" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16836" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16838"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="18" select="quick">(</span><span class="op">'</span><span class="literal" start="11">(</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">)</span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16860"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">parenthesis</span><span class="op">'</span><span class="z">"</span><span id="wx16876" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16880" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16882"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="18" select="quick">(</span><span class="op">'</span><span class="literal" start="11">[</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">]</span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16904"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">filter</span><span class="op">'</span><span class="z">"</span><span id="wx16920" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16924" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16926"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="1" pair-end="14" select="quick">number</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$token</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">=</span><span class="whitespace" start="17"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="18" pair-end="31" select="quick">number</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$token</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16946"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">numeric</span><span class="op">'</span><span class="z">"</span><span id="wx16962" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx16966" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w16968"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="xmlspectrum.xsl.html#v?ambiguousOps" class="solar"><span class="variable" start="10" select="quick">$ambiguousOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w16982"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">probableOp</span><span class="op">'</span><span class="z">"</span><span id="wx16998" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17002" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w17004"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="xmlspectrum.xsl.html#v?higherOps" class="solar"><span class="variable" start="10" select="quick">$higherOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w17018"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="51" select="quick">starts-with</span></a><span class="parenthesis">(</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}nextNonWhite" class="solar"><span class="function" start="13" pair-end="45" select="quick">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable" start="30" select="quick">$tokens</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$index</span><span class="parenthesis" start="45">)</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="op">'</span><span class="literal" start="48">$</span><span class="op">'</span><span class="parenthesis" start="51">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w17042"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">higher</span><span class="op">'</span><span class="z">"</span><span id="wx17058" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17062" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17066" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w17068"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w17084"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}nextNonWhite" class="solar"><span class="function" start="1" pair-end="33" select="quick">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$tokens</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$index</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38">(</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            
</span><span class="ww" id="w17106"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">if</span><span class="op">'</span><span class="z">"</span><span id="wx17122" class="sc">/&gt;</span></span><span class="txt">
          
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17126" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17130" class="ec">&gt;</span></span><span class="txt">
        
</span><span class="ww" id="w17132"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="24" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$token</span><span class="op" start="19">,</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">$</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
</span><span class="ww" id="w17150"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">variable</span><span class="op">'</span><span class="z">"</span><span id="wx17166" class="sc">/&gt;</span></span><span class="txt">
        
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17170" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx17174" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx17178" class="ec">&gt;</span></span><span class="txt">
    
&#xD;
    </span><span class="ww" id="w17180"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">le</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="28" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w17201"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}processTokens" class="solar"><span class="function" start="1" pair-end="44" select="quick">loc:processTokens</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$tokens</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$end</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$index</span><span class="whitespace" start="40"> </span><span class="op" start="41">+</span><span class="whitespace" start="42"> </span><span class="numeric" start="43">1</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span id="wx17222" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx17226" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx17230" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w17232"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}nextNonWhite">loc:nextNonWhite</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w17248"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx17262" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w17264"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx17278" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w17280"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w17284"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="1" pair-end="6" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="z">&lt;!--</span><span class="cm"> test="$index + 2 lt count($tokens)"&gt;  </span><span class="z">--&gt;</span><span class="txt"> 
        
</span><span class="ww" id="w17300"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="55">if</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="4" pair-end="48" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$tokens</span><span class="filter" start="19" pair-end="30" select="quick">[</span><span class="variable" start="20" select="quick">$index</span><span class="whitespace" start="26"> </span><span class="op" start="27">+</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="filter" start="30">]</span><span class="op" start="31">,</span><span class="op">'</span><span class="literal" start="32">[\s\p{Zs}]+</span><span class="op">'</span><span class="op" start="45">,</span><span class="op">'</span><span class="literal" start="46"></span><span class="op">'</span><span class="parenthesis" start="48">)</span><span class="whitespace" start="49"> </span><span class="op" start="50">eq</span><span class="whitespace" start="52"> </span><span class="op">'</span><span class="literal" start="53"></span><span class="op">'</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56">
                              
</span><span class="op" start="58">then</span><span class="whitespace" start="62"> </span><span class="variable" start="63" select="quick">$tokens</span><span class="filter" start="70" pair-end="81" select="quick">[</span><span class="variable" start="71" select="quick">$index</span><span class="whitespace" start="77"> </span><span class="op" start="78">+</span><span class="whitespace" start="79"> </span><span class="numeric" start="80">2</span><span class="filter" start="81">]</span><span class="whitespace" start="82"> </span><span class="op" start="83">else</span><span class="whitespace" start="87"> </span><span class="variable" start="88" select="quick">$tokens</span><span class="filter" start="95" pair-end="106" select="quick">[</span><span class="variable" start="96" select="quick">$index</span><span class="whitespace" start="102"> </span><span class="op" start="103">+</span><span class="whitespace" start="104"> </span><span class="numeric" start="105">1</span><span class="filter" start="106">]</span><span class="z">"</span><span id="wx17357" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx17361" class="ec">&gt;</span></span><span class="txt">
      
</span><span class="ww" id="w17363"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx17369" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx17373" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx17377" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
  </span><span class="ww" id="w17379"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}rawTokens">loc:rawTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
</span><span class="ww" id="w17395"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx17409" class="sc">/&gt;</span></span><span class="txt">
    
</span><span class="ww" id="w17411"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z">
        
</span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(((-)?\d+)(\.)?(\d+([eE][\+\-]?)?\d*)?)|(\?)|(instance[\s\p{{Zs}}]+of)|(cast[\s\p{{Zs}}]+as)|(castable[\s\p{{Zs}}]+as)|(treat[\s\p{{Zs}}]+as)|((\$[\s\p{{Zs}}]*)?[\i\*][\p{{L}}\p{{Nd}}\.\-]*(:[\p{{L}}\p{{Nd}}\.\-\*]*)?(::)?:?)(\()?|(\.\.)|((-)?\d?\.\d*)|-|([&amp;lt;&amp;gt;!]=)|(&amp;gt;&amp;gt;|&amp;lt;&amp;lt;)|(//)|([\s\p{{Zs}}]+)|(\C)</span><span class="z">"</span><span class="z">
        
</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chunk</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
</span><span class="ww" id="w17427"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
        
</span><span class="ww" id="w17431"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="1" pair-end="9" select="quick">string</span></a><span class="parenthesis">(</span><span class="context" start="8">.</span><span class="parenthesis" start="9">)</span><span class="z">"</span><span id="wx17442" class="sc">/&gt;</span></span><span class="txt">
      
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx17446" class="ec">&gt;</span></span><span class="txt">
    
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx17450" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx17454" class="ec">&gt;</span></span><span class="txt">
  
&#xD;
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx17458" class="ec">&gt;</span></span><span class="txt">

</span></p></div></body></html>