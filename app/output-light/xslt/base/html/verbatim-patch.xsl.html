<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>verbatim-patch.xsl</title><link rel="stylesheet" type="text/css" href="../../../theme.css"></head><body><div><p class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="ww" id="w5"><span class="es">&lt;</span><span class="enxsl">xsl:stylesheet</span><span class="z"> </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:db</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:doc</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://nwalsh.com/xsl/documentation/1.0</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/extension</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:fp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/extension</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:ghost</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook/ephemeral</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:h</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:m</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/mode</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:mp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/mode/private</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:t</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/template</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:tp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/template/private</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:u</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://nwalsh.com/xsl/unittests#</span><span class="z">"</span><span class="z">
                                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">db doc f fp ghost h m mp t tp u xs</span><span class="z">"</span><span class="z">
                                </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">


</span><span class="ww" id="w105"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}verbatim-patch-html">t:verbatim-patch-html</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w115"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?content">content</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx129" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w131"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?areas">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx145" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w147"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?everyNth">everyNth</span><span class="z">"</span><span class="z">  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">everyNth</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx168" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w170"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?width">width</span><span class="z">"</span><span class="z">     </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">width</span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx191" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w193"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padchar">padchar</span><span class="z">"</span><span class="z">   </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="28" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">padchar</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx214" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w216"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?separator">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="30" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">separator</span><span class="op">'</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx237" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w239"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?minlines">minlines</span><span class="z">"</span><span class="z">  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">minlines</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx260" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w262"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-empty-tags">pl-empty-tags</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w278"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span id="wx292" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx296" class="ec">&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;
    &lt;EMPTY&gt;
      &lt;xsl:copy-of select="$pl-empty-tags"/&gt;
    &lt;/EMPTY&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="ww" id="w302"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-lb">pl-no-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w318"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-empty-tags</span><span class="z">"</span><span class="z">
                     			 </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span id="wx332" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx336" class="ec">&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;
    &lt;NOLB&gt;
      &lt;xsl:copy-of select="$pl-no-lb"/&gt;
    &lt;/NOLB&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="ww" id="w342"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-wrap-lb">pl-no-wrap-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w358"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w368"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="20" select="quick">xs:QName</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="10">ghost:br</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span id="wx387" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w389"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-lb</span><span class="z">"</span><span id="wx403" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx407" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx411" class="ec">&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;NOWRAPLB&lt;/xsl:message&gt;
  &lt;xsl:for-each select="$pl-no-wrap-lb"&gt;
    &lt;xsl:message&gt;&lt;xsl:sequence select="."/&gt;&lt;/xsl:message&gt;
  &lt;/xsl:for-each&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="ww" id="w417"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-lines">pl-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w433"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}wrap-lines" class="solar"><span class="tcall">tp:wrap-lines</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w443"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-wrap-lb</span><span class="z">"</span><span id="wx457" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx461" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx465" class="ec">&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;
    &lt;LINES&gt;
      &lt;xsl:copy-of select="$pl-lines"/&gt;
    &lt;/LINES&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="ww" id="w471"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-callouts">pl-callouts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w487"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-callouts</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w503"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="z">"</span><span id="wx517" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx521" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx525" class="ec">&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;
    &lt;PL-LINES&gt;
      &lt;xsl:copy-of select="$pl-callouts"/&gt;
    &lt;/PL-LINES&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="ww" id="w531"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-removed-lines">pl-removed-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w547"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w551"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$everyNth</span><span class="whitespace" start="10"> </span><span class="qname" start="11" select="quick">&amp;</span><span class="op" start="12">gt</span><span class="qname" start="14" select="quick">;</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">0</span><span class="whitespace" start="17">
                </span><span class="qname" start="18" select="quick">	</span><span class="whitespace" start="19">              </span><span class="op" start="33">and</span><span class="whitespace" start="36"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="37" pair-end="52" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="43" select="quick">$pl-lines</span><span class="parenthesis" start="52">)</span><span class="whitespace" start="53"> </span><span class="qname" start="54" select="quick">&amp;</span><span class="op" start="55">gt</span><span class="qname" start="57" select="quick">;</span><span class="op" start="58">=</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$minlines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w583"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-callouts</span><span class="z">"</span><span class="z">
                     			     </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-restore-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w599"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">everyNth</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$everyNth</span><span class="z">"</span><span id="wx613" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w615"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width</span><span class="z">"</span><span id="wx629" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w631"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx645" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w647"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">padchar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padchar</span><span class="z">"</span><span id="wx661" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w663"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx677" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx681" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx685" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w687"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w691"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-callouts</span><span class="z">"</span><span class="z">
                     			     </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-restore-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w707"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">everyNth</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx721" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w723"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width</span><span class="z">"</span><span id="wx737" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w739"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx753" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w755"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">padchar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padchar</span><span class="z">"</span><span id="wx769" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w771"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx785" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx789" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx793" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx797" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx801" class="ec">&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;
    &lt;REMOVEDLINES&gt;
      &lt;xsl:copy-of select="$pl-removed-lines"/&gt;
    &lt;/REMOVEDLINES&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm"> put the lines into a tree so that we can use preceding:: to look for ID values </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w811"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?content-tree">content-tree</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w827"><span class="es">&lt;</span><span class="en">irrelevant</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> expand any embedded ghost:co elements, as appropriate </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="ww" id="w835"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-removed-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w851"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">origpl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx865" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx869" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">irrelevant</span><span id="wx873" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx877" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w879"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result">result</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w895"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content-tree</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span id="wx909" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx913" class="ec">&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;
    &lt;RESULT&gt;
      &lt;xsl:sequence select="$result"/&gt;
    &lt;/RESULT&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm"> don't return the ghost:tree </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w923"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$result</span><span class="step" start="8">/</span><span class="node" start="9" pair-end="14" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span id="wx935" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx939" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w945"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:co</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w961"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xml:id</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w972"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xml:id</span><span class="op">}</span><span class="z">"</span><span id="wx983" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx987" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ww" id="w989"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/callouts.xsl.html#t?{http://docbook.org/xslt/ns/template}callout-bug" class="solar"><span class="tcall">t:callout-bug</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w999"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">conum</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1009"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w1013"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">number</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w1024"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">number</span><span class="z">"</span><span id="wx1033" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1037" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ww" id="w1039"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w1043"><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:co</span><span class="z">"</span><span class="z">
            		      </span><span class="atn">level</span><span class="atneq">=</span><span class="z">"</span><span class="av">any</span><span class="z">"</span><span class="z">
            		      </span><span class="atn">from</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:programlisting|db:screen|db:literallayout|db:synopsis</span><span class="z">"</span><span class="z">
            		      </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">1</span><span class="z">"</span><span id="wx1069" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1073" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1077" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span id="wx1081" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1085" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1089" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w1091"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w1107"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?origpl">origpl</span><span class="z">"</span><span id="wx1115" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1117"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1121"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx1130" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1132"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1142"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">origpl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$origpl</span><span class="z">"</span><span id="wx1156" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx1160" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx1164" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1168" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w1170"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="op" start="35">|</span><span class="node" start="36" pair-end="41" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="z">
              	      </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w1196"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx1198" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1202" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm">
&lt;xsl:template match="ghost:tree" mode="mp:remove-ghost-tree"&gt;
  &lt;xsl:apply-templates mode="mp:remove-ghost-tree"/&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="*" mode="mp:remove-ghost-tree"&gt;
  &lt;xsl:copy&gt;
    &lt;xsl:copy-of select="@*"/&gt;
    &lt;xsl:apply-templates mode="mp:remove-ghost-tree"/&gt;
  &lt;/xsl:copy&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="comment()|processing-instruction()|text()"
	      mode="mp:remove-ghost-tree"&gt;
  &lt;xsl:copy/&gt;
&lt;/xsl:template&gt;
</span><span class="z">--&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w1216"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w1232"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?id">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">id</span><span class="z">"</span><span id="wx1247" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1249"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">namespace</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="1" pair-end="16" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="context" start="15">.</span><span class="parenthesis" start="16">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1275"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="filter" start="3" pair-end="113" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="4" pair-end="10" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">id</span><span class="op">'</span><span class="whitespace" start="19">
                                                 </span><span class="op" start="48">and</span><span class="whitespace" start="51"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="52" pair-end="67" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="context" start="66">.</span><span class="parenthesis" start="67">)</span><span class="whitespace" start="68"> </span><span class="op" start="69">!=</span><span class="whitespace" start="71"> </span><span class="op">'</span><span class="literal" start="72">http://docbook.org/ns/docbook/ephemeral</span><span class="op">'</span><span class="filter" start="113">]</span><span class="z">"</span><span id="wx1309" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1311"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">id</span><span class="whitespace" start="4"> </span><span class="op" start="5">and</span><span class="whitespace" start="8"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="9" pair-end="36" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="13">preceding::</span><span class="qname" start="24" select="quick">*</span><span class="filter" start="25" pair-end="35" select="quick">[</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">id</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$id</span><span class="filter" start="35">]</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1338"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$id</span><span class="z">"</span><span id="wx1352" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1356" class="ec">&gt;</span></span><span class="txt">

    </span><span class="ww" id="w1358"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span id="wx1366" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx1370" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1374" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w1376"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="op" start="35">|</span><span class="node" start="36" pair-end="41" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="z">
              	      </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w1402"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx1404" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1408" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w1414"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{http://docbook.org/xslt/ns/extension}lastLineNumber">f:lastLineNumber</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:decimal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w1430"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?listing">listing</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx1444" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1446"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?startnum">startnum</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:decimal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1462"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1466"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$listing</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">continuation</span><span class="whitespace" start="23"> </span><span class="op" start="24">!=</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">continues</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1485"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx1493" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1497" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1499"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1503"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev">prev</span><span class="z">"</span><span class="z">
                           </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$listing</span><span class="step" start="9">/</span><span class="axis" start="10">preceding::</span><span class="qname" start="21" select="quick">*</span><span class="filter" start="22" pair-end="55" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="23" pair-end="34" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="context" start="33">.</span><span class="parenthesis" start="34">)</span><span class="op" start="35">=</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="36" pair-end="54" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="46" select="quick">$listing</span><span class="parenthesis" start="54">)</span><span class="filter" start="55">]</span><span class="filter" start="56" pair-end="58" select="quick">[</span><span class="numeric" start="57">1</span><span class="filter" start="58">]</span><span class="z">"</span><span id="wx1534" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1536"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1540"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$prev</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1553"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx1561" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1565" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1567"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1571"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}lastLineNumber" class="solar"><span class="function" start="1" pair-end="23" select="quick">f:lastLineNumber</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$prev</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx1582" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1586" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1590" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1594" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1598" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1602" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1604"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?expanded-text">expanded-text</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1620"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$listing</span><span class="step" start="9">/</span><span class="node" start="10" pair-end="15" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1634"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w1638"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">self::</span><span class="qname" start="7" select="quick">db:inlinemediaobject</span><span class="whitespace" start="27">
                </span><span class="qname" start="28" select="quick">	</span><span class="qname" start="29" select="quick">	</span><span class="qname" start="30" select="quick">	</span><span class="op" start="31">and</span><span class="whitespace" start="34"> </span><span class="qname" start="35" select="quick">db:textobject</span><span class="step" start="48">/</span><span class="qname" start="49" select="quick">db:textdata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w1658"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1666" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1670" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ww" id="w1672"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">self::</span><span class="qname" start="7" select="quick">db:textobject</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="qname" start="25" select="quick">db:textdata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w1687"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1695" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1699" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ww" id="w1701"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w1705"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1713" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1717" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1721" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx1725" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1729" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1731"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-empty-tags">pl-empty-tags</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1747"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expanded-text</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span id="wx1761" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1765" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1767"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-lb">pl-no-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1783"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-empty-tags</span><span class="z">"</span><span class="z">
                     			 </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span id="wx1797" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1801" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1803"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-wrap-lb">pl-no-wrap-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1819"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1829"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="20" select="quick">xs:QName</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="10">ghost:br</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span id="wx1848" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1850"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-lb</span><span class="z">"</span><span id="wx1864" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1868" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1872" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1874"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-lines">pl-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1890"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}wrap-lines" class="solar"><span class="tcall">tp:wrap-lines</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1900"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-wrap-lb</span><span class="z">"</span><span id="wx1914" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1918" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1922" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w1924"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="16" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$pl-lines</span><span class="parenthesis" start="16">)</span><span class="z">"</span><span id="wx1935" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1939" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w1941"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-restore-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w1957"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?everyNth">everyNth</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1971" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w1973"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?width">width</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1987" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w1989"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padchar">padchar</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2003" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w2005"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?separator">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2019" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w2021"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?element">element</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2041" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w2043"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?startnum">startnum</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:decimal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2059"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2063"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="27" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$element</span><span class="step" start="13">/</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">continuation</span><span class="parenthesis" start="27">)</span><span class="whitespace" start="28">
                                      </span><span class="op" start="51">or</span><span class="whitespace" start="53"> </span><span class="variable" start="54" select="quick">$element</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">continuation</span><span class="whitespace" start="76"> </span><span class="op" start="77">!=</span><span class="whitespace" start="79"> </span><span class="op">'</span><span class="literal" start="80">continues</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2092"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx2100" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2104" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2106"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2110"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev">prev</span><span class="z">"</span><span class="z">
                           </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$element</span><span class="step" start="9">/</span><span class="axis" start="10">preceding::</span><span class="qname" start="21" select="quick">*</span><span class="filter" start="22" pair-end="55" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="23" pair-end="34" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="context" start="33">.</span><span class="parenthesis" start="34">)</span><span class="op" start="35">=</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="36" pair-end="54" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="46" select="quick">$element</span><span class="parenthesis" start="54">)</span><span class="filter" start="55">]</span><span class="filter" start="56" pair-end="58" select="quick">[</span><span class="numeric" start="57">1</span><span class="filter" start="58">]</span><span class="z">"</span><span id="wx2141" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2143"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2147"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$prev</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2160"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx2168" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2172" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2174"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2178"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}lastLineNumber" class="solar"><span class="function" start="1" pair-end="23" select="quick">f:lastLineNumber</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$prev</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx2189" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2193" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2197" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2201" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2205" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2209" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w2211"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?linenumber">linenumber</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="1" pair-end="10" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">+</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$startnum</span><span class="z">"</span><span id="wx2231" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w2233"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$everyNth</span><span class="whitespace" start="10"> </span><span class="qname" start="11" select="quick">&amp;</span><span class="op" start="12">gt</span><span class="qname" start="14" select="quick">;</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2249"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2253"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linenumber</span><span class="whitespace" start="12"> </span><span class="op" start="13">=</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="whitespace" start="16">
                </span><span class="qname" start="17" select="quick">	</span><span class="qname" start="18" select="quick">	</span><span class="whitespace" start="19">      </span><span class="op" start="25">or</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$linenumber</span><span class="whitespace" start="39"> </span><span class="op" start="40">mod</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$everyNth</span><span class="whitespace" start="53"> </span><span class="op" start="54">=</span><span class="whitespace" start="55"> </span><span class="numeric" start="56">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w2282"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?numwidth">numwidth</span><span class="z">"</span><span class="z">
              		      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="34" select="quick">string-length</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="15" pair-end="33" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$linenumber</span><span class="parenthesis" start="33">)</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx2302" class="sc">/&gt;</span></span><span class="txt">

        </span><span class="ww" id="w2304"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2314"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$numwidth</span><span class="whitespace" start="10"> </span><span class="qname" start="11" select="quick">&amp;</span><span class="op" start="12">lt</span><span class="qname" start="14" select="quick">;</span><span class="whitespace" start="15"> </span><span class="variable" start="16" select="quick">$width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2330"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pad" class="solar"><span class="function" start="1" pair-end="47" select="quick">f:pad</span></a><span class="parenthesis">(</span><span class="function" start="7" pair-end="36" select="quick">xs:integer</span><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$width</span><span class="whitespace" start="24"> </span><span class="op" start="25">-</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$numwidth</span><span class="parenthesis" start="36">)</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$padchar</span><span class="parenthesis" start="47">)</span><span class="z">"</span><span id="wx2351" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2355" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2357"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linenumber</span><span class="z">"</span><span id="wx2365" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2369" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2371"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2387"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber-separator</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2397"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx2405" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2409" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2413" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2417" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2419"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2423"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2433"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pad" class="solar"><span class="function" start="1" pair-end="23" select="quick">f:pad</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$width</span><span class="op" start="13">,</span><span class="whitespace" start="14"> </span><span class="variable" start="15" select="quick">$padchar</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx2447" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2451" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2453"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2469"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber-separator</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2479"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx2487" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2491" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2495" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2499" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2503" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2507" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w2509"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2513"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2523"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}restore-content" class="solar"><span class="tcall">t:restore-content</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w2533"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx2549" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2553" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2557" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2559"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2563"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx2573" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2577" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2581" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w2583"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="1" pair-end="10" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="qname" start="12" select="quick">&amp;</span><span class="op" start="13">lt</span><span class="qname" start="15" select="quick">;</span><span class="whitespace" start="16"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="17" pair-end="22" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2603"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">&amp;#10;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx2609" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2613" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2617" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w2623"><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:restore-content</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2639"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Restores content to empty elements.</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx2645" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w2647"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2651"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template reverses the flattening process performed by
the </span><span class="ww" id="w2655"><span class="es">&lt;</span><span class="en">code</span><span class="scx">&gt;</span><span class="txt">m:patch-empty-elements</span><span class="ez">&lt;/</span><span class="cl">code</span><span id="wx2661" class="ec">&gt;</span></span><span class="txt"> mode. It replaces pairs of
empty elements and their corresponding </span><span class="ww" id="w2663"><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">ghost:end</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx2669" class="ec">&gt;</span></span><span class="txt">s with 
an element that has content.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx2673" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx2677" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w2679"><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2683"><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2687"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w2691"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">nodes</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx2697" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w2699"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2703"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The sequence of nodes containing empty elements.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx2709" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx2713" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx2717" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span id="wx2721" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span id="wx2725" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w2727"><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w2731"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The nodes with content restored.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx2737" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span id="wx2741" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span id="wx2745" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w2747"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}restore-content">t:restore-content</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w2757"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx2773" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w2775"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?mark">mark</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="17" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">ghost:id</span><span class="filter" start="17">]</span><span class="filter" start="18" pair-end="20" select="quick">[</span><span class="numeric" start="19">1</span><span class="filter" start="20">]</span><span class="z">"</span><span id="wx2796" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm"> FIXME: I totally do not understand why straight-up node comparisons fail here.
       So I'm stepping back to comparing sequences of atomic values created
       with generate-id(). </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="ww" id="w2802"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2806"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="10" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$mark</span><span class="parenthesis" start="10">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2819"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx2827" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2831" class="ec">&gt;</span></span><span class="txt">

    </span><span class="ww" id="w2833"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2837"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?precmarkids">precmarkids</span><span class="z">"</span><span class="z">
                                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$node" class="variable" start="5" select="quick">$node</span><span class="whitespace" start="10"> </span><span class="op" start="11">in</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$mark</span><span class="step" start="19">/</span><span class="axis" start="20">preceding-sibling::</span><span class="node" start="39" pair-end="44" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="44">)</span><span class="whitespace" start="45"> </span><span class="op" start="46">return</span><span class="whitespace" start="52"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="53" pair-end="70" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="variable" start="65" select="quick">$node</span><span class="parenthesis" start="70">)</span><span class="z">"</span><span id="wx2869" class="sc">/&gt;</span></span><span class="txt">

      </span><span class="ww" id="w2871"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="37" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="8" pair-end="21" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="context" start="20">.</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">=</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$precmarkids</span><span class="filter" start="37">]</span><span class="z">"</span><span id="wx2889" class="sc">/&gt;</span></span><span class="txt">

      </span><span class="ww" id="w2891"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?follmarkids">follmarkids</span><span class="z">"</span><span class="z">
                                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$node" class="variable" start="5" select="quick">$node</span><span class="whitespace" start="10"> </span><span class="op" start="11">in</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="53" select="quick">(</span><span class="variable" start="15" select="quick">$mark</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$mark</span><span class="step" start="27">/</span><span class="axis" start="28">following-sibling::</span><span class="node" start="47" pair-end="52" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="52">)</span><span class="parenthesis" start="53">)</span><span class="whitespace" start="54"> </span><span class="op" start="55">return</span><span class="whitespace" start="61"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="62" pair-end="79" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="variable" start="74" select="quick">$node</span><span class="parenthesis" start="79">)</span><span class="z">"</span><span id="wx2928" class="sc">/&gt;</span></span><span class="txt">

      </span><span class="ww" id="w2930"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?rest">rest</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="37" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="8" pair-end="21" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="context" start="20">.</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">=</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$follmarkids</span><span class="filter" start="37">]</span><span class="z">"</span><span id="wx2954" class="sc">/&gt;</span></span><span class="txt">

      </span><span class="ww" id="w2956"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?id">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$mark</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">ghost:id</span><span class="z">"</span><span id="wx2973" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2975"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$rest</span><span class="filter" start="6" pair-end="34" select="quick">[</span><span class="axis" start="7">self::</span><span class="qname" start="13" select="quick">ghost:end</span><span class="filter" start="22" pair-end="33" select="quick">[</span><span class="axis" start="23">@</span><span class="qname" start="24" select="quick">idref</span><span class="op" start="29">=</span><span class="variable" start="30" select="quick">$id</span><span class="filter" start="33">]</span><span class="filter" start="34">]</span><span class="z">"</span><span id="wx2999" class="sc">/&gt;</span></span><span class="txt">

      </span><span class="z">&lt;!--</span><span class="cm">
      &lt;xsl:message&gt;
	&lt;xsl:text&gt;Restore &lt;/xsl:text&gt;
	&lt;xsl:value-of select="$id"/&gt;
	&lt;xsl:text&gt;, &lt;/xsl:text&gt;
	&lt;xsl:value-of select="count($end)"/&gt;
      &lt;/xsl:message&gt;
      </span><span class="z">--&gt;</span><span class="txt">

      </span><span class="ww" id="w3005"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?endpos">endpos</span><span class="z">"</span><span class="z">
              		    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}find-node-in-sequence" class="solar"><span class="function" start="1" pair-end="39" select="quick">f:find-node-in-sequence</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$rest</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$end</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="numeric" start="38">2</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx3028" class="sc">/&gt;</span></span><span class="txt">

      </span><span class="ww" id="w3030"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="11" select="quick">name</span></a><span class="parenthesis">(</span><span class="variable" start="6" select="quick">$mark</span><span class="parenthesis" start="11">)</span><span class="op">}</span><span class="z">"</span><span class="z">
             		   </span><span class="atn">namespace</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="1" pair-end="20" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$mark</span><span class="parenthesis" start="20">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w3056"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$mark</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">*</span><span class="z">"</span><span id="wx3067" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w3069"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}restore-content" class="solar"><span class="tcall">t:restore-content</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w3079"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z">
                			  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function" start="1" pair-end="34" select="quick">subsequence</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$rest</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">2</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$endpos</span><span class="whitespace" start="30"> </span><span class="op" start="31">-</span><span class="whitespace" start="32"> </span><span class="numeric" start="33">2</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx3106" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3110" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx3114" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3116"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}restore-content" class="solar"><span class="tcall">t:restore-content</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w3126"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z">
                			</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function" start="1" pair-end="29" select="quick">subsequence</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$rest</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$endpos</span><span class="op" start="27">+</span><span class="numeric" start="28">1</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx3148" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3152" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3156" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3160" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3164" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w3170"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-callouts</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w3186"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?areas">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3200" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w3202"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?linenumber">linenumber</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="1" pair-end="10" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="z">"</span><span id="wx3218" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w3220"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3224"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="33" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">ghost:line</span><span class="whitespace" start="19"> </span><span class="op" start="20">=</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$linenumber</span><span class="filter" start="33">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3242"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallouts" class="solar"><span class="tcall">tp:addcallouts</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w3252"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="33" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">ghost:line</span><span class="whitespace" start="19"> </span><span class="op" start="20">=</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$linenumber</span><span class="filter" start="33">]</span><span class="z">"</span><span id="wx3274" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w3276"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3290" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3294" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3298" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3300"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3304"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3312" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3316" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3320" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3324" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w3326"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}addcallouts">tp:addcallouts</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w3336"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?areas">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(db:area)*</span><span class="z">"</span><span id="wx3350" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w3352"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line">line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)</span><span class="z">"</span><span id="wx3366" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w3368"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newline">newline</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3384"><span class="es">&lt;</span><span class="en">ghost:line</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3388"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w3398"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span id="wx3415" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w3417"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$line</span><span class="step" start="6">/</span><span class="node" start="7" pair-end="12" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span id="wx3435" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3439" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">ghost:line</span><span id="wx3443" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3447" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w3449"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3453"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="13" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$areas</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3470"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newline</span><span class="z">"</span><span id="wx3478" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3482" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3484"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3488"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallouts" class="solar"><span class="tcall">tp:addcallouts</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w3498"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx3523" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w3525"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newline</span><span class="z">"</span><span id="wx3539" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3543" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3547" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3551" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3555" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w3557"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}addcallout">tp:addcallout</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w3567"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?area">area</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(db:area)</span><span class="z">"</span><span id="wx3581" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w3583"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx3597" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w3599"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pos">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx3619" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w3621"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3625"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="11" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$nodes</span><span class="parenthesis" start="11">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3638"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="whitespace" start="5"> </span><span class="qname" start="6" select="quick">&amp;</span><span class="op" start="7">lt</span><span class="qname" start="9" select="quick">;</span><span class="whitespace" start="10"> </span><span class="variable" start="11" select="quick">$area</span><span class="step" start="16">/</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">ghost:col</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w3657"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pad" class="solar"><span class="function" start="1" pair-end="47" select="quick">f:pad</span></a><span class="parenthesis">(</span><span class="function" start="7" pair-end="34" select="quick">xs:integer</span><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$area</span><span class="step" start="23">/</span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">ghost:col</span><span class="parenthesis" start="34">)</span><span class="whitespace" start="35"> </span><span class="op" start="36">-</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$pos</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="op">'</span><span class="literal" start="44"> </span><span class="op">'</span><span class="parenthesis" start="47">)</span><span class="z">"</span><span id="wx3683" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w3685"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:insert-callout</span><span class="z">"</span><span id="wx3699" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3703" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3707" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3709"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="whitespace" start="10"> </span><span class="type-op" start="11">instance of</span><span class="whitespace" start="22"> </span><span class="node-type" start="23" pair-end="28">text</span><span class="parenthesis">(</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3728"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w3732"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="whitespace" start="5"> </span><span class="op" start="6">=</span><span class="whitespace" start="7"> </span><span class="variable" start="8" select="quick">$area</span><span class="step" start="13">/</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">ghost:col</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w3749"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:insert-callout</span><span class="z">"</span><span id="wx3763" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w3765"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx3773" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3777" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ww" id="w3779"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="24" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$nodes</span><span class="filter" start="21" pair-end="23" select="quick">[</span><span class="numeric" start="22">1</span><span class="filter" start="23">]</span><span class="parenthesis" start="24">)</span><span class="whitespace" start="25"> </span><span class="op" start="26">=</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w3799"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span id="wx3810" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w3812"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	    </span><span class="ww" id="w3822"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span id="wx3836" class="sc">/&gt;</span></span><span class="txt">
	    </span><span class="ww" id="w3838"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx3863" class="sc">/&gt;</span></span><span class="txt">
	    </span><span class="ww" id="w3865"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="op" start="5">+</span><span class="numeric" start="6">1</span><span class="z">"</span><span id="wx3881" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3885" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3889" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ww" id="w3891"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w3895"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="26" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$nodes</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">1</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">1</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx3915" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w3917"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?rest">rest</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">text()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	    </span><span class="ww" id="w3933"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="23" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$nodes</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">2</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx3950" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3954" class="ec">&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w3956"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	    </span><span class="ww" id="w3966"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span id="wx3980" class="sc">/&gt;</span></span><span class="txt">
	    </span><span class="ww" id="w3982"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z">
                			    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="34" select="quick">(</span><span class="variable" start="2" select="quick">$rest</span><span class="op" start="7">,</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$nodes</span><span class="filter" start="15" pair-end="33" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="16" pair-end="25" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="qname" start="27" select="quick">&amp;</span><span class="op" start="28">gt</span><span class="qname" start="30" select="quick">;</span><span class="whitespace" start="31"> </span><span class="numeric" start="32">1</span><span class="filter" start="33">]</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx4012" class="sc">/&gt;</span></span><span class="txt">
	    </span><span class="ww" id="w4014"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="op" start="5">+</span><span class="numeric" start="6">1</span><span class="z">"</span><span id="wx4030" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4034" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4038" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4042" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4046" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4048"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4052"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span id="wx4063" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4065"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w4075"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span id="wx4089" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w4091"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx4116" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w4118"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="z">"</span><span id="wx4132" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4136" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4140" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4144" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4148" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w4150"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:area</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:insert-callout</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w4166"><span class="es">&lt;</span><span class="en">ghost:co</span><span class="z"> </span><span class="atn">number</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">ghost:number</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">xml:id</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xml:id</span><span class="op">}</span><span class="z">"</span><span id="wx4186" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4190" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w4196"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}wrap-lines">tp:wrap-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w4206"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx4226" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w4228"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?br">br</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4244"><span class="es">&lt;</span><span class="en">ghost:br</span><span id="wx4246" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4250" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w4252"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?wrapnodes">wrapnodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4268"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> FIXME: this is where f:verbatim-trim-blink-lines() should be called,
           but sometimes there's no context item. </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="ww" id="w4276"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="1" pair-end="34" select="quick">string</span></a><span class="parenthesis">(</span><a href="xslt/base/html/param.xsl.html#v?verbatim.trim.blank.lines" class="solar"><span class="variable" start="8" select="quick">$verbatim.trim.blank.lines</span></a><span class="parenthesis" start="34">)</span><span class="whitespace" start="35"> </span><span class="op" start="36">!=</span><span class="whitespace" start="38"> </span><span class="op">'</span><span class="literal" start="39">0</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w4295"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}trim-trailing-br" class="solar"><span class="function" start="1" pair-end="27" select="quick">fp:trim-trailing-br</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$nodes</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx4306" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4310" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4312"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w4316"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w4320"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="14" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="8" pair-end="13" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="filter" start="14">]</span><span class="filter" start="15" pair-end="30" select="quick">[</span><span class="axis" start="16">self::</span><span class="qname" start="22" select="quick">ghost:br</span><span class="filter" start="30">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	    </span><span class="z">&lt;!--</span><span class="cm"> because group-by will not form a group after the last one </span><span class="z">--&gt;</span><span class="txt">
	    </span><span class="ww" id="w4343"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="13" select="quick">(</span><span class="variable" start="2" select="quick">$nodes</span><span class="op" start="8">,</span><span class="whitespace" start="9"> </span><span class="variable" start="10" select="quick">$br</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx4356" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4360" class="ec">&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w4362"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	    </span><span class="ww" id="w4366"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx4374" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4378" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4382" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4386" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4390" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4394" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w4396"><span class="es">&lt;</span><span class="enxsl">xsl:for-each-group</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$wrapnodes</span><span class="z">"</span><span class="z"> </span><span class="atn">group-ending-with</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:br</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4412"><span class="es">&lt;</span><span class="en">ghost:line</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4416"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-current-group" class="solar"><span class="function" start="1" pair-end="15" select="quick">current-group</span></a><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w4428"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="19" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">self::</span><span class="qname" start="11" select="quick">ghost:br</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w4442"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx4450" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4454" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx4458" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">ghost:line</span><span id="wx4462" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each-group</span><span id="wx4466" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4470" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w4476"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{http://docbook.org/xslt/ns/extension}trim-trailing-br">fp:trim-trailing-br</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w4492"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx4506" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w4508"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4512"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="14" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="8" pair-end="13" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="filter" start="14">]</span><span class="filter" start="15" pair-end="30" select="quick">[</span><span class="axis" start="16">self::</span><span class="qname" start="22" select="quick">ghost:br</span><span class="filter" start="30">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4531"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}trim-trailing-br" class="solar"><span class="function" start="1" pair-end="49" select="quick">fp:trim-trailing-br</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$nodes</span><span class="filter" start="27" pair-end="48" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="28" pair-end="37" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="37">)</span><span class="qname" start="38" select="quick">&amp;</span><span class="op" start="39">lt</span><span class="qname" start="41" select="quick">;</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="42" pair-end="47" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="47">)</span><span class="filter" start="48">]</span><span class="parenthesis" start="49">)</span><span class="z">"</span><span id="wx4553" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4557" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4559"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4563"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx4571" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4575" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4579" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4583" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w4589"><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4605"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Unwraps an element with a particular name</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx4611" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w4613"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4617"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template takes a sequence of nodes. It traverses that sequence
making sure that any element with the specified name occurs at the top-most
level of the sequence: it closes all open elements that the named element
is nested within, outputs the named element, then reopens all the elements
that it had been nested within.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4623" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx4627" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w4629"><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4633"><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4637"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4641"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">unwrap</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx4647" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4649"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4653"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The name of the element to unwrap.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4659" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx4663" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx4667" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4669"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4673"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">content</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx4679" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4681"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4685"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The sequence of nodes.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4691" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx4695" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx4699" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4701"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="z"> </span><span class="atn">role</span><span class="atneq">=</span><span class="z">"</span><span class="av">private</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4711"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">stack</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx4717" class="ec">&gt;</span></span><span class="txt">
</span><span class="ww" id="w4719"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4723"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The stack of currently open elements.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4729" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx4733" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx4737" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span id="wx4741" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span id="wx4745" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w4747"><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w4751"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The original content sequence modified so that all elements named
</span><span class="ww" id="w4755"><span class="es">&lt;</span><span class="en">parameter</span><span class="scx">&gt;</span><span class="txt">unwrap</span><span class="ez">&lt;/</span><span class="cl">parameter</span><span id="wx4761" class="ec">&gt;</span></span><span class="txt"> are at the top level.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4765" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span id="wx4769" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span id="wx4773" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w4775"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}unwrap">t:unwrap</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w4785"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?unwrap">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName</span><span class="z">"</span><span id="wx4799" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w4801"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?content">content</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx4815" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w4817"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx4838" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w4840"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4844"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="13" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$content</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx4855" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4857"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="whitespace" start="12"> </span><span class="type-op" start="13">instance of</span><span class="whitespace" start="24"> </span><span class="node-type" start="25" pair-end="33">element</span><span class="parenthesis">(</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34">
                                    </span><span class="op" start="55">and</span><span class="whitespace" start="58"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="59" pair-end="80" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="69" select="quick">$content</span><span class="filter" start="77" pair-end="79" select="quick">[</span><span class="numeric" start="78">1</span><span class="filter" start="79">]</span><span class="parenthesis" start="80">)</span><span class="whitespace" start="81"> </span><span class="op" start="82">=</span><span class="whitespace" start="83"> </span><span class="variable" start="84" select="quick">$unwrap</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4890"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}close-stack" class="solar"><span class="tcall">tp:close-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w4900"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx4914" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4918" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4920"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx4931" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4933"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}open-stack" class="solar"><span class="tcall">tp:open-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w4943"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx4957" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4961" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4963"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w4973"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx4987" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w4989"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5014" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w5016"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx5030" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5034" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5038" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5040"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="filter" start="12" pair-end="28" select="quick">[</span><span class="axis" start="13">self::</span><span class="qname" start="19" select="quick">ghost:end</span><span class="filter" start="28">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5057"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx5068" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5070"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w5080"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx5094" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w5096"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5121" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w5123"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="30" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">lt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="24" pair-end="29" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="29">)</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx5150" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5154" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5158" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5160"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="whitespace" start="12"> </span><span class="type-op" start="13">instance of</span><span class="whitespace" start="24"> </span><span class="node-type" start="25" pair-end="33">element</span><span class="parenthesis">(</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5179"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx5190" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5192"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w5202"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx5216" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w5218"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5243" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w5245"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="21" select="quick">(</span><span class="variable" start="2" select="quick">$stack</span><span class="op" start="8">,</span><span class="whitespace" start="9"> </span><span class="variable" start="10" select="quick">$content</span><span class="filter" start="18" pair-end="20" select="quick">[</span><span class="numeric" start="19">1</span><span class="filter" start="20">]</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx5267" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5271" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5275" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5277"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5281"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx5292" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5294"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w5304"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx5318" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w5320"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5345" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ww" id="w5347"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx5361" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5365" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5369" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5373" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5377" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w5379"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}close-stack">tp:close-stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w5389"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx5410" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w5412"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5422"><span class="es">&lt;</span><span class="en">ghost:end</span><span class="z"> </span><span class="atn">idref</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="14" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="8" pair-end="13" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="filter" start="14">]</span><span class="step" start="15">/</span><span class="axis" start="16">@</span><span class="qname" start="17" select="quick">ghost:id</span><span class="op">}</span><span class="z">"</span><span id="wx5440" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;
      &lt;xsl:text&gt;close: &lt;/xsl:text&gt;
      &lt;xsl:value-of select="$stack[last()]/@ghost:id"/&gt;
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w5446"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}close-stack" class="solar"><span class="tcall">tp:close-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5456"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="30" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">lt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="24" pair-end="29" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="29">)</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx5483" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5487" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5491" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5495" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w5497"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}open-stack">tp:open-stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w5507"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx5528" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w5530"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5540"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:stack-copy</span><span class="z">"</span><span id="wx5557" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5559"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}open-stack" class="solar"><span class="tcall">tp:open-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5569"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx5594" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5598" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5602" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5606" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w5608"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:stack-copy</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w5624"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5628"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx5637" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5639"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:copy</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">yes</span><span class="op">'</span><span class="z">"</span><span id="wx5655" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx5659" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5663" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w5665"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}show-stack">tp:show-stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w5675"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx5696" class="sc">/&gt;</span></span><span class="txt">

  </span><span class="ww" id="w5698"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5702"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">STACK[</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5708" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5710"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="13" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$stack</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx5721" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5723"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">]</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5729" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx5733" class="ec">&gt;</span></span><span class="txt">

  </span><span class="ww" id="w5735"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5745"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5749"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">...</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5755" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5757"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="7" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="6">.</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx5768" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5770"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">,</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5776" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5778"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">ghost:id</span><span class="z">"</span><span id="wx5787" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx5791" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5795" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5799" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w5805"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w5827"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5831"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx5840" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5842"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span id="wx5850" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx5854" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5858" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w5860"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z">
              	      </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm"> Ok, there's a bug in MarkLogic server V4.2-1 that coalesces the nodes returned
       by xsl:analyze-string into a single node. Let's work around that. </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w5888"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5892"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-system-property" class="solar"><span class="function" start="1" pair-end="29" select="quick">system-property</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="17">xsl:vendor</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">=</span><span class="whitespace" start="32"> </span><span class="op">'</span><span class="literal" start="33">MarkLogic Corporation</span><span class="op">'</span><span class="whitespace" start="56">
                                    </span><span class="op" start="77">and</span><span class="whitespace" start="80"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-system-property" class="solar"><span class="function" start="81" pair-end="118" select="quick">system-property</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="97">xsl:product-version</span><span class="op">'</span><span class="parenthesis" start="118">)</span><span class="whitespace" start="119"> </span><span class="op" start="120">=</span><span class="whitespace" start="121"> </span><span class="op">'</span><span class="literal" start="122">4.2-1</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5928"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parts">parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">item()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5944"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\n</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5960"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5964"><span class="es">&lt;</span><span class="en">ghost:br</span><span id="wx5966" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx5970" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5972"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5976"><span class="es">&lt;</span><span class="en">ghost:x</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5980"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx5988" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">ghost:x</span><span id="wx5992" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx5996" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx6000" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx6004" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6006"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parts</span><span class="step" start="7">/</span><span class="node" start="8" pair-end="13" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6020"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6024"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">self::</span><span class="qname" start="7" select="quick">ghost:br</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6035"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx6043" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6047" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6049"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6053"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="step" start="2">/</span><span class="node" start="3" pair-end="8" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="8">)</span><span class="z">"</span><span id="wx6065" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6069" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6073" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx6077" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6081" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6083"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6087"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\n</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6103"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6107"><span class="es">&lt;</span><span class="en">ghost:br</span><span id="wx6109" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx6113" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w6115"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6119"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx6127" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx6131" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx6135" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6139" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6143" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6147" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6149"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z">
              	      </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6177"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx6179" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6183" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w6189"><span class="es">&lt;</span><span class="en">doc:mode</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6205"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Make all elements empty</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx6211" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6213"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6217"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This mode is used to completely flatten all nesting in a tree.
Every start tag is replaced with an empty tag that has a
</span><span class="ww" id="w6221"><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">ghost:id</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6233" class="ec">&gt;</span></span><span class="txt"> attribute. Every end tag is
replaced with an empty </span><span class="ww" id="w6235"><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">ghost:end</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6241" class="ec">&gt;</span></span><span class="txt"> element that has an 
</span><span class="ww" id="w6243"><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">idref</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6255" class="ec">&gt;</span></span><span class="txt"> attribute pointing to the
appropriate </span><span class="ww" id="w6257"><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">ghost:id</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6269" class="ec">&gt;</span></span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx6273" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6275"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">To reverse the process, see
</span><span class="ww" id="w6279"><span class="es">&lt;</span><span class="en">function</span><span class="z"> </span><span class="atn">role</span><span class="atneq">=</span><span class="z">"</span><span class="av">named-template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">t:restore-content</span><span class="ez">&lt;/</span><span class="cl">function</span><span id="wx6291" class="ec">&gt;</span></span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx6295" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx6299" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:mode</span><span id="wx6303" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6305"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6321"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="7" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="6">.</span><span class="parenthesis" start="7">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">namespace</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="1" pair-end="16" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="context" start="15">.</span><span class="parenthesis" start="16">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6347"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx6356" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6358"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="1" pair-end="13" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx6374" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx6378" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ww" id="w6380"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span id="wx6388" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w6390"><span class="es">&lt;</span><span class="en">ghost:end</span><span class="z"> </span><span class="atn">idref</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="1" pair-end="13" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span id="wx6402" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6406" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6408"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="op" start="35">|</span><span class="node" start="36" pair-end="41" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="z">
              	      </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6434"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx6436" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6440" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w6446"><span class="es">&lt;</span><span class="en">doc:mode</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6462"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Remove all newlines</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx6468" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6470"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="ww" id="w6474"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This mode is used to remove newlines from text content.
This is necessary in verbatim processing of elements such as
footnote because, although line breaks are significant in a verbatim
environment, they are not significant in the content of a footnote
in a verbatim environment.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx6480" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx6484" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:mode</span><span id="wx6488" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6490"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6506"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6510"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx6519" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6521"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span id="wx6529" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx6533" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6537" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6539"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="z">
              	      </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6557"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="22" select="quick">replace</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="op" start="10">,</span><span class="op">'</span><span class="literal" start="11">&amp;#10;</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19"> </span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span id="wx6576" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6580" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6582"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="z">
              	      </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6604"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx6606" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6610" class="ec">&gt;</span></span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w6616"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:areaspec</span><span class="op" start="12">|</span><span class="qname" start="13" select="quick">db:areaset</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6628"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx6630" class="sc">/&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6634" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6636"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:areaspec</span><span class="step" start="12">/</span><span class="qname" start="13" select="quick">db:area</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6648"><span class="es">&lt;</span><span class="en">db:area</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6652"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="filter" start="3" pair-end="23" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="4" pair-end="10" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">coords</span><span class="op">'</span><span class="filter" start="23">]</span><span class="z">"</span><span id="wx6673" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6675"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="73" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="2" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">units</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13">
              </span><span class="qname" start="14" select="quick">	</span><span class="qname" start="15" select="quick">	</span><span class="whitespace" start="16">   </span><span class="op" start="19">or</span><span class="whitespace" start="21"> </span><span class="axis" start="22">@</span><span class="qname" start="23" select="quick">units</span><span class="op" start="28">=</span><span class="op">'</span><span class="literal" start="29">linecolumn</span><span class="op">'</span><span class="whitespace" start="41">
              </span><span class="qname" start="42" select="quick">	</span><span class="qname" start="43" select="quick">	</span><span class="whitespace" start="44">   </span><span class="op" start="47">or</span><span class="whitespace" start="49"> </span><span class="axis" start="50">@</span><span class="qname" start="51" select="quick">units</span><span class="op" start="56">=</span><span class="op">'</span><span class="literal" start="57">linecolumnpair</span><span class="op">'</span><span class="parenthesis" start="73">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6715"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w6719"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="44" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="5" pair-end="43" select="quick">contains</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="14" pair-end="37" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">coords</span><span class="parenthesis" start="37">)</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="op">'</span><span class="literal" start="40"> </span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w6744"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="1" pair-end="24" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">coords</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx6762" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w6764"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/param.xsl.html#v?callout.defaultcolumn" class="solar"><span class="variable" start="1" select="quick">$callout.defaultcolumn</span></a><span class="z">"</span><span id="wx6778" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6782" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ww" id="w6784"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w6788"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?toks">toks</span><span class="z">"</span><span class="z">
              			</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="39" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="10" pair-end="33" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">coords</span><span class="parenthesis" start="33">)</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="op">'</span><span class="literal" start="36"> </span><span class="op">'</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx6814" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w6816"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">1</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx6833" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w6835"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">2</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx6852" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6856" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6860" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6864" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6866"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:number</span><span class="z">"</span><span class="z">
               		   </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="97" select="quick">count</span></a><span class="parenthesis">(</span><span class="axis" start="7">preceding-sibling::</span><span class="qname" start="26" select="quick">db:area</span><span class="whitespace" start="33">
                                                        </span><span class="op" start="67">|</span><span class="axis" start="68">preceding-sibling::</span><span class="qname" start="87" select="quick">db:areaset</span><span class="parenthesis" start="97">)</span><span class="quantifier" start="98">+</span><span class="numeric" start="99">1</span><span class="z">"</span><span id="wx6890" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">db:area</span><span id="wx6894" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6898" class="ec">&gt;</span></span><span class="txt">

</span><span class="ww" id="w6900"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:areaset</span><span class="step" start="11">/</span><span class="qname" start="12" select="quick">db:area</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="ww" id="w6912"><span class="es">&lt;</span><span class="en">db:area</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6916"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="filter" start="3" pair-end="23" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="4" pair-end="10" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">coords</span><span class="op">'</span><span class="filter" start="23">]</span><span class="z">"</span><span id="wx6937" class="sc">/&gt;</span></span><span class="txt">

    </span><span class="ww" id="w6939"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="31" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">preceding-sibling::</span><span class="qname" start="24" select="quick">db:area</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6953"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xml:id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">parent::</span><span class="qname" start="9" select="quick">db:areaset</span><span class="step" start="19">/</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">xml:id</span><span class="z">"</span><span id="wx6971" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6975" class="ec">&gt;</span></span><span class="txt">

    </span><span class="ww" id="w6977"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="73" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="2" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">units</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13">
              </span><span class="qname" start="14" select="quick">	</span><span class="qname" start="15" select="quick">	</span><span class="whitespace" start="16">   </span><span class="op" start="19">or</span><span class="whitespace" start="21"> </span><span class="axis" start="22">@</span><span class="qname" start="23" select="quick">units</span><span class="op" start="28">=</span><span class="op">'</span><span class="literal" start="29">linecolumn</span><span class="op">'</span><span class="whitespace" start="41">
              </span><span class="qname" start="42" select="quick">	</span><span class="qname" start="43" select="quick">	</span><span class="whitespace" start="44">   </span><span class="op" start="47">or</span><span class="whitespace" start="49"> </span><span class="axis" start="50">@</span><span class="qname" start="51" select="quick">units</span><span class="op" start="56">=</span><span class="op">'</span><span class="literal" start="57">linecolumnpair</span><span class="op">'</span><span class="parenthesis" start="73">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7017"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
	</span><span class="ww" id="w7021"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="44" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="5" pair-end="43" select="quick">contains</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="14" pair-end="37" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">coords</span><span class="parenthesis" start="37">)</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="op">'</span><span class="literal" start="40"> </span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w7046"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="1" pair-end="24" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">coords</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx7064" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w7066"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xslt/base/html/param.xsl.html#v?callout.defaultcolumn" class="solar"><span class="variable" start="1" select="quick">$callout.defaultcolumn</span></a><span class="z">"</span><span id="wx7080" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7084" class="ec">&gt;</span></span><span class="txt">
	</span><span class="ww" id="w7086"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
	  </span><span class="ww" id="w7090"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?toks">toks</span><span class="z">"</span><span class="z">
              			</span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="39" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="10" pair-end="33" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">coords</span><span class="parenthesis" start="33">)</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="op">'</span><span class="literal" start="36"> </span><span class="op">'</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx7116" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w7118"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">1</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx7135" class="sc">/&gt;</span></span><span class="txt">
	  </span><span class="ww" id="w7137"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">2</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx7154" class="sc">/&gt;</span></span><span class="txt">
	</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7158" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7162" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7166" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w7168"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:number</span><span class="z">"</span><span class="z">
               		   </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="131" select="quick">count</span></a><span class="parenthesis">(</span><span class="axis" start="7">parent::</span><span class="qname" start="15" select="quick">db:areaset</span><span class="step" start="25">/</span><span class="axis" start="26">preceding-sibling::</span><span class="qname" start="45" select="quick">db:area</span><span class="whitespace" start="52">
                                                    </span><span class="op" start="82">|</span><span class="axis" start="83">parent::</span><span class="qname" start="91" select="quick">db:areaset</span><span class="step" start="101">/</span><span class="axis" start="102">preceding-sibling::</span><span class="qname" start="121" select="quick">db:areaset</span><span class="parenthesis" start="131">)</span><span class="whitespace" start="132">
                       </span><span class="qname" start="133" select="quick">	</span><span class="qname" start="134" select="quick">	</span><span class="qname" start="135" select="quick">	</span><span class="whitespace" start="136">   </span><span class="op" start="139">+</span><span class="whitespace" start="140"> </span><span class="numeric" start="141">1</span><span class="z">"</span><span id="wx7204" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">db:area</span><span id="wx7208" class="ec">&gt;</span></span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7212" class="ec">&gt;</span></span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx7216" class="ec">&gt;</span></span><span class="txt">
</span></p></div></body></html>