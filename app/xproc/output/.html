
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html><head><title/><link rel="stylesheet" type="text/css" href="/theme.css"/></head><body><div><p class="spectrum"><span class="z">&lt;!--</span><span class="cm"> Copyright Phil Fearon - Qutoric limited 2012 - philipfearon@qutoric.com </span><span class="z">--&gt;</span><span class="txt">&#xD;
</span><span class="ww" id="w5"><span class="es">&lt;</span><a class="solar" href="/index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}transform">xsl:transform</span></a><span class="z"> </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">&#xD;
               </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">&#xD;
               </span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.sketchpath.functions</span><span class="z">"</span><span class="z">&#xD;
               </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs loc</span><span class="z">"</span><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w39"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ops">ops</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">, / = &amp;lt; &amp;gt; + - * ? | != &amp;lt;= &amp;gt;= &amp;lt;&amp;lt; &amp;gt;&amp;gt; //</span><span class="op">'</span><span class="z">"</span><span id="wx55" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w57"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?aOps">aOps</span><span class="z">"</span><span class="z">&#xD;
               </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">or and eq ne lt le gt ge is to div idiv mod union intersect except in return satisfies then else</span><span class="op">'</span><span class="z">"</span><span id="wx73" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w75"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?hOps">hOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">for some every</span><span class="op">'</span><span class="z">"</span><span id="wx91" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w93"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z">&#xD;
               </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">attribute comment document-node element node processing-instruction text</span><span class="op">'</span><span class="z">"</span><span id="wx109" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w111"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?types">types</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">empty item node schema-attribute schema-element type</span><span class="op">'</span><span class="z">"</span><span id="wx127" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w129"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ambiguousOps">ambiguousOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="21" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="/.html#v?aOps" class="solar"><span class="variable" start="10" select="quick">$aOps</span></a><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">\s+</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx156" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w158"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?simpleOps">simpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="20" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="/.html#v?ops" class="solar"><span class="variable" start="10" select="quick">$ops</span></a><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">\s+</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx185" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w187"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodeTests">nodeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="22" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="/.html#v?nodes" class="solar"><span class="variable" start="10" select="quick">$nodes</span></a><span class="op" start="16">,</span><span class="op">'</span><span class="literal" start="17">\s+</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx214" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w216"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?typeTests">typeTests</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="22" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="/.html#v?types" class="solar"><span class="variable" start="10" select="quick">$types</span></a><span class="op" start="16">,</span><span class="op">'</span><span class="literal" start="17">\s+</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx243" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w245"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?higherOps">higherOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="21" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="/.html#v?hOps" class="solar"><span class="variable" start="10" select="quick">$hOps</span></a><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">\s+</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx272" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ww" id="w274"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?bgColor">bgColor</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">black</span><span class="op">'</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx296" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
&#xD;
 </span><span class="ww" id="w298"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}showXPath">loc:showXPath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w308"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span id="wx316" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w318"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chars">chars</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}stringToCharSequence" class="solar"><span class="function" start="1" pair-end="32" select="quick">loc:stringToCharSequence</span></a><span class="parenthesis">(</span><span class="variable" start="26" select="quick">$chunk</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx341" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w343"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?blocks">blocks</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w359"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}createBlocks" class="solar"><span class="function" start="1" pair-end="46" select="quick">loc:createBlocks</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chars</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="26" pair-end="32" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="32">)</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">1</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"/><span class="op">'</span><span class="op" start="40">,</span><span class="whitespace" start="41"> </span><span class="numeric" start="42">0</span><span class="op" start="43">,</span><span class="whitespace" start="44"> </span><span class="numeric" start="45">0</span><span class="parenthesis" start="46">)</span><span class="z">"</span><span id="wx389" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx393" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w395"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z">&#xD;
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}createPairs" class="solar"><span class="function" start="1" pair-end="72" select="quick">loc:createPairs</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$blocks</span><span class="filter" start="24" pair-end="71" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="25" pair-end="30" select="quick">name</span></a><span class="parenthesis">(</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">=</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">block</span><span class="op">'</span><span class="whitespace" start="41"> </span><span class="op" start="42">and</span><span class="whitespace" start="45"> </span><span class="axis" start="46">@</span><span class="qname" start="47" select="quick">type</span><span class="whitespace" start="51"> </span><span class="op" start="52">=</span><span class="whitespace" start="53"> </span><span class="parenthesis" start="54" pair-end="70" select="quick">(</span><span class="op">'</span><span class="literal" start="55">[</span><span class="op">'</span><span class="op" start="58">,</span><span class="op">'</span><span class="literal" start="59">]</span><span class="op">'</span><span class="op" start="62">,</span><span class="op">'</span><span class="literal" start="63">(</span><span class="op">'</span><span class="op" start="66">,</span><span class="op">'</span><span class="literal" start="67">)</span><span class="op">'</span><span class="parenthesis" start="70">)</span><span class="filter" start="71">]</span><span class="parenthesis" start="72">)</span><span class="z">"</span><span id="wx454" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w456"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?omitPairs">omitPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="41" select="quick">(</span><span class="variable" start="2" select="quick">$blocks</span><span class="filter" start="9" pair-end="40" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="10" pair-end="15" select="quick">name</span></a><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">=</span><span class="whitespace" start="18"> </span><span class="parenthesis" start="19" pair-end="39" select="quick">(</span><span class="op">'</span><span class="literal" start="20">literal</span><span class="op">'</span><span class="op" start="29">,</span><span class="op">'</span><span class="literal" start="30">comment</span><span class="op">'</span><span class="parenthesis" start="39">)</span><span class="filter" start="40">]</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span id="wx495" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w497"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w513"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}getTokens" class="solar"><span class="function" start="1" pair-end="43" select="quick">loc:getTokens</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$chunk</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$omitPairs</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$pbPairs</span><span class="parenthesis" start="43">)</span><span class="z">"</span><span id="wx530" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx534" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w536"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#t?plain" class="solar"><span class="tcall">plain</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w546"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">para</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="z">"</span><span id="wx560" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx564" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx568" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
&#xD;
 </span><span class="z">&lt;!--</span><span class="cm"> //////////////////////////////////////////////////////////////////////////////////////////////// </span><span class="z">--&gt;</span><span class="txt">&#xD;
&#xD;
 </span><span class="z">&lt;!--</span><span class="cm"> &#xD;
  Sample output:&#xD;
 &lt;block position="3" type="["/&gt;&#xD;
 &lt;literal type="'" start="54" end="61"/&gt;&#xD;
 &lt;comment start="65" end="69"/&gt;&#xD;
 &lt;comment start="76"/&gt; // if not closed&#xD;
 </span><span class="z">--&gt;</span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w578"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}pad">loc:pad</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w594"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padStringIn">padStringIn</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span id="wx608" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w610"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fixedWidth">fixedWidth</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx624" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w626"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padString">padString</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="33" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$padStringIn</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">\n</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">\\n</span><span class="op">'</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span id="wx658" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w660"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stringLength">stringLength</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="25" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$padString</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span id="wx683" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w685"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padChar">padChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="22" select="quick">(</span><span class="variable" start="5" select="quick">$fixedWidth</span><span class="whitespace" start="16"> </span><span class="op" start="17">gt</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">20</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">then</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">.</span><span class="op">'</span><span class="whitespace" start="32"> </span><span class="op" start="33">else</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38"> </span><span class="op">'</span><span class="z">"</span><span id="wx719" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w721"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padCount">padCount</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$fixedWidth</span><span class="whitespace" start="12"> </span><span class="op" start="13">-</span><span class="whitespace" start="14"> </span><span class="variable" start="15" select="quick">$stringLength</span><span class="z">"</span><span id="wx745" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w747"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">ge</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w761"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">&#xD;
    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="90" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$padString</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="20" pair-end="89" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="32">for</span><span class="whitespace" start="35"> </span><span id="rng-$i" class="variable" start="36" select="quick">$i</span><span class="whitespace" start="38"> </span><span class="op" start="39">in</span><span class="whitespace" start="41"> </span><span class="numeric" start="42">1</span><span class="whitespace" start="43"> </span><span class="op" start="44">to</span><span class="whitespace" start="46"> </span><span class="variable" start="47" select="quick">$padCount</span><span class="whitespace" start="56"> &#xD;
            </span><span class="op" start="71">return</span><span class="whitespace" start="77"> </span><span class="variable" start="78" select="quick">$padChar</span><span class="op" start="86">,</span><span class="op">'</span><span class="literal" start="87"/><span class="op">'</span><span class="parenthesis" start="89">)</span><span class="parenthesis" start="90">)</span><span class="z">"</span><span id="wx796" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx800" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w802"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padCount</span><span class="whitespace" start="10"> </span><span class="op" start="11">lt</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w816"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">&#xD;
    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="105" select="quick">concat</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$padString</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="op">'</span><span class="literal" start="20">&amp;#10;</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28"> </span><span class="op">'</span><span class="op" start="31">,</span><span class="whitespace" start="32"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="33" pair-end="104" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="higher" start="45">for</span><span class="whitespace" start="48"> </span><span id="rng-$i" class="variable" start="49" select="quick">$i</span><span class="whitespace" start="51"> </span><span class="op" start="52">in</span><span class="whitespace" start="54"> </span><span class="numeric" start="55">1</span><span class="whitespace" start="56"> </span><span class="op" start="57">to</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$fixedWidth</span><span class="whitespace" start="71"> &#xD;
            </span><span class="op" start="86">return</span><span class="whitespace" start="92"> </span><span class="variable" start="93" select="quick">$padChar</span><span class="op" start="101">,</span><span class="op">'</span><span class="literal" start="102"/><span class="op">'</span><span class="parenthesis" start="104">)</span><span class="parenthesis" start="105">)</span><span class="z">"</span><span id="wx860" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx864" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx868" class="ec">&gt;</span></span><span class="txt">&#xD;
 &#xD;
 </span><span class="ww" id="w870"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">loc:p</span><span class="filter" start="6" pair-end="24" select="quick">[</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="whitespace" start="13"> </span><span class="op" start="14">eq</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">dummy</span><span class="op">'</span><span class="filter" start="24">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w890"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?test-all">test-all</span><span class="z">"</span><span class="z">&#xD;
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="comment" start="1">(: comments may be nested&#xD;
                                 (: phil's tokenizer must&#xD;
                                    handle quotes also :)&#xD;
                                  like this :)</span><span class="whitespace" start="192">&#xD;
                              </span><span class="context" start="224">.</span><span class="step" start="225">/</span><span class="qname" start="226" select="quick">loc:history</span><span class="step" start="237">/</span><span class="qname" start="238" select="quick">loc:*</span><span class="step" start="243">/</span><span class="whitespace" start="244">&#xD;
                              </span><span class="axis" start="276">following-sibling::</span><span class="qname" start="295" select="quick">loc:books</span><span class="whitespace" start="304">&#xD;
                              </span><span class="filter" start="336" pair-end="356" select="quick">[</span><span class="axis" start="337">@</span><span class="qname" start="338" select="quick">id</span><span class="whitespace" start="340"> </span><span class="op" start="341">=</span><span class="whitespace" start="342"> </span><span class="parenthesis" start="343" pair-end="355" select="quick">(</span><span class="op">'</span><span class="literal" start="344">a</span><span class="op">'</span><span class="op" start="347">,</span><span class="op">'</span><span class="literal" start="348">b</span><span class="op">'</span><span class="op" start="351">,</span><span class="op">'</span><span class="literal" start="352">c</span><span class="op">'</span><span class="parenthesis" start="355">)</span><span class="filter" start="356">]</span><span class="z">"</span><span id="wx935" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w937"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$test-all</span><span class="z">"</span><span id="wx945" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx949" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w951"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?plain">plain</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w961"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?para">para</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx975" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w977"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?total">total</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="12" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$para</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1000" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w1002"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="whitespace" start="2"> </span><span class="op" start="3">to</span><span class="whitespace" start="5"> </span><span class="variable" start="6" select="quick">$total</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w1016"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1030" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w1032"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="13" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="filter" start="13">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w1045"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w1049"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="whitespace" start="6"> </span><span class="op" start="7">eq</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">variable</span><span class="op">'</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$index</span><span class="whitespace" start="31"> </span><span class="op" start="32">+</span><span class="whitespace" start="33"> </span><span class="numeric" start="34">2</span><span class="whitespace" start="35"> </span><span class="op" start="36">lt</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$total</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w1078"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="17" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="whitespace" start="13"> </span><span class="op" start="14">+</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">1</span><span class="filter" start="17">]</span><span class="step" start="18">/</span><span class="axis" start="19">@</span><span class="qname" start="20" select="quick">type</span><span class="whitespace" start="24"> </span><span class="op" start="25">eq</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">whitespace</span><span class="op">'</span><span class="whitespace" start="40"> </span><span class="op" start="41">and</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$para</span><span class="filter" start="50" pair-end="61" select="quick">[</span><span class="variable" start="51" select="quick">$index</span><span class="whitespace" start="57"> </span><span class="op" start="58">+</span><span class="whitespace" start="59"> </span><span class="numeric" start="60">2</span><span class="filter" start="61">]</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">value</span><span class="whitespace" start="69"> </span><span class="op" start="70">eq</span><span class="whitespace" start="72"> </span><span class="op">'</span><span class="literal" start="73">in</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w1124"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="21" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">rng-</span><span class="op">'</span><span class="op" start="14">,</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx1146" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1150" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1154" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w1156"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?className">className</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w1166"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w1170"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
        </span><span class="ww" id="w1184"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">&#xD;
         </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="136" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">type</span><span class="whitespace" start="10"> </span><span class="op" start="11">eq</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">literal</span><span class="op">'</span><span class="whitespace" start="23"> </span><span class="op" start="24">and</span><span class="whitespace" start="27">&#xD;
                    </span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="49" pair-end="116" select="quick">matches</span></a><span class="parenthesis">(</span><span class="axis" start="57">@</span><span class="qname" start="58" select="quick">value</span><span class="whitespace" start="63"> </span><span class="op" start="64">,</span><span class="op">'</span><span class="literal" start="65">select[\n\p{Zs}]*=[\n\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]</span><span class="op">'</span><span class="parenthesis" start="116">)</span><span class="whitespace" start="117">&#xD;
                 </span><span class="parenthesis" start="136">)</span><span class="whitespace" start="137">&#xD;
                 </span><span class="op" start="156">then</span><span class="whitespace" start="160"> </span><span class="op">'</span><span class="literal" start="161">select</span><span class="op">'</span><span class="whitespace" start="169"> </span><span class="op" start="170">else</span><span class="whitespace" start="174"> </span><span class="axis" start="175">@</span><span class="qname" start="176" select="quick">type</span><span class="z">"</span><span id="wx1228" class="sc">/&gt;</span></span><span class="txt">&#xD;
       </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1232" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ww" id="w1234"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
        </span><span class="ww" id="w1238"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?p">p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$para</span><span class="filter" start="6" pair-end="17" select="quick">[</span><span class="variable" start="7" select="quick">$index</span><span class="whitespace" start="13"> </span><span class="op" start="14">-</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">1</span><span class="filter" start="17">]</span><span class="whitespace" start="18"> </span><span class="z">"</span><span id="wx1260" class="sc">/&gt;</span></span><span class="txt">&#xD;
        </span><span class="ww" id="w1262"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">&#xD;
         </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="140" select="quick">(</span><span class="variable" start="5" select="quick">$p</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">eq</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">literal</span><span class="op">'</span><span class="whitespace" start="26"> </span><span class="op" start="27">and</span><span class="whitespace" start="30">&#xD;
                    </span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="52" pair-end="120" select="quick">matches</span></a><span class="parenthesis">(</span><span class="variable" start="60" select="quick">$p</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">value</span><span class="whitespace" start="69"> </span><span class="op" start="70">,</span><span class="op">'</span><span class="literal" start="71">name[\n\p{Zs}]*=[\n\p{Zs}]*[&amp;quot;&amp;apos;&amp;apos;]</span><span class="op">'</span><span class="parenthesis" start="120">)</span><span class="whitespace" start="121">&#xD;
                 </span><span class="parenthesis" start="140">)</span><span class="whitespace" start="141">&#xD;
                 </span><span class="op" start="160">then</span><span class="whitespace" start="164"> </span><span class="op">'</span><span class="literal" start="165">external</span><span class="op">'</span><span class="whitespace" start="175">&#xD;
                 </span><span class="op" start="194">else</span><span class="whitespace" start="198"> </span><span class="op">'</span><span class="literal" start="199">qname</span><span class="op">'</span><span class="z">"</span><span id="wx1311" class="sc">/&gt;</span></span><span class="txt">&#xD;
       </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1315" class="ec">&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1319" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1323" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
     </span><span class="ww" id="w1325"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$className</span><span class="z">"</span><span id="wx1339" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
     </span><span class="ww" id="w1341"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$className</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">external</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w1357"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="21" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">ext-</span><span class="op">'</span><span class="op" start="14">,</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">value</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx1379" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1383" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
     </span><span class="ww" id="w1385"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx1400" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
     </span><span class="ww" id="w1402"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="43" select="quick">(</span><span class="axis" start="2">@</span><span class="qname" start="3" select="quick">value</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="parenthesis" start="11" pair-end="19" select="quick">(</span><span class="op">'</span><span class="literal" start="12">(</span><span class="op">'</span><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">[</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">or</span><span class="whitespace" start="23"> </span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">type</span><span class="whitespace" start="29"> </span><span class="op" start="30">eq</span><span class="whitespace" start="32"> </span><span class="op">'</span><span class="literal" start="33">function</span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="whitespace" start="44"> </span><span class="op" start="45">and</span><span class="whitespace" start="48"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="49" pair-end="62" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="53">@</span><span class="qname" start="54" select="quick">pair-end</span><span class="parenthesis" start="62">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w1446"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">color: pink;</span><span class="op">'</span><span class="z">"</span><span id="wx1462" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1466" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
     </span><span class="ww" id="w1468"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">pair-end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w1479"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pair-end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">pair-end</span><span class="z">"</span><span id="wx1494" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1498" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
     </span><span class="ww" id="w1500"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="10" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">type</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">or</span><span class="whitespace" start="14"> &#xD;
                   </span><span class="parenthesis" start="36" pair-end="98" select="quick">(</span><span class="axis" start="37">@</span><span class="qname" start="38" select="quick">type</span><span class="whitespace" start="42"> </span><span class="op" start="43">=</span><span class="whitespace" start="44"> </span><span class="parenthesis" start="45" pair-end="97" select="quick">(</span><span class="op">'</span><span class="literal" start="46">function</span><span class="op">'</span><span class="op" start="56">,</span><span class="op">'</span><span class="literal" start="57">filter</span><span class="op">'</span><span class="op" start="65">,</span><span class="op">'</span><span class="literal" start="66">parenthesis</span><span class="op">'</span><span class="op" start="79">,</span><span class="op">'</span><span class="literal" start="80">variable</span><span class="op">'</span><span class="op" start="90">,</span><span class="op">'</span><span class="literal" start="91">node</span><span class="op">'</span><span class="parenthesis" start="97">)</span><span class="parenthesis" start="98">)</span><span class="whitespace" start="99"> &#xD;
                      </span><span class="op" start="124">and</span><span class="whitespace" start="127"> </span><span class="parenthesis" start="128" pair-end="152" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="129" pair-end="151" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="133">@</span><span class="qname" start="134" select="quick">value</span><span class="whitespace" start="139"> </span><span class="op" start="140">=</span><span class="whitespace" start="141"> </span><span class="parenthesis" start="142" pair-end="150" select="quick">(</span><span class="op">'</span><span class="literal" start="143">)</span><span class="op">'</span><span class="op" start="146">,</span><span class="op">'</span><span class="literal" start="147">]</span><span class="op">'</span><span class="parenthesis" start="150">)</span><span class="parenthesis" start="151">)</span><span class="parenthesis" start="152">)</span><span class="whitespace" start="153">&#xD;
                    </span><span class="op" start="175">or</span><span class="whitespace" start="177">&#xD;
                   </span><span class="parenthesis" start="198" pair-end="251" select="quick">(</span><span class="axis" start="199">@</span><span class="qname" start="200" select="quick">value</span><span class="whitespace" start="205"> </span><span class="op" start="206">eq</span><span class="whitespace" start="208"> </span><span class="op">'</span><span class="literal" start="209">*</span><span class="op">'</span><span class="whitespace" start="212"> </span><span class="op" start="213">and</span><span class="whitespace" start="216"> </span><span class="variable" start="217" select="quick">$para</span><span class="filter" start="222" pair-end="233" select="quick">[</span><span class="variable" start="223" select="quick">$index</span><span class="whitespace" start="229"> </span><span class="op" start="230">-</span><span class="whitespace" start="231"> </span><span class="numeric" start="232">1</span><span class="filter" start="233">]</span><span class="step" start="234">/</span><span class="axis" start="235">@</span><span class="qname" start="236" select="quick">class</span><span class="whitespace" start="241"> </span><span class="op" start="242">eq</span><span class="whitespace" start="244"> </span><span class="op">'</span><span class="literal" start="245">axis</span><span class="op">'</span><span class="parenthesis" start="251">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w1600"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">select</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">quick</span><span class="op">'</span><span class="z">"</span><span id="wx1616" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1620" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
     </span><span class="ww" id="w1622"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w1626"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="parenthesis" start="9" pair-end="29" select="quick">(</span><span class="op">'</span><span class="literal" start="10">literal</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">comment</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w1649"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">value</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\n</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
        </span><span class="ww" id="w1666"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">&#xD;
         </span><span class="ww" id="w1670"><span class="es">&lt;</span><span class="en">br</span><span id="wx1672" class="sc">/&gt;</span></span><span class="txt">&#xD;
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx1676" class="ec">&gt;</span></span><span class="txt">&#xD;
        </span><span class="ww" id="w1678"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">&#xD;
         </span><span class="ww" id="w1682"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1690" class="sc">/&gt;</span></span><span class="txt">&#xD;
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx1694" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx1698" class="ec">&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1702" class="ec">&gt;</span></span><span class="txt">&#xD;
      </span><span class="ww" id="w1704"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w1708"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">value</span><span class="z">"</span><span id="wx1717" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1721" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1725" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
    </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx1729" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx1733" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx1737" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1741" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w1743"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">token</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">plainLine</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w1759"><span class="es">&lt;</span><span class="en">span</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w1763"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">type</span><span class="z">"</span><span id="wx1778" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w1780"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx1795" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w1797"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?revChars">revChars</span><span class="z">"</span><span class="z">&#xD;
                 </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-reverse" class="solar"><span class="function" start="1" pair-end="37" select="quick">reverse</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-to-codepoints" class="solar"><span class="function" start="9" pair-end="36" select="quick">string-to-codepoints</span></a><span class="parenthesis">(</span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">value</span><span class="parenthesis" start="36">)</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer*</span><span class="z">"</span><span id="wx1824" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w1826"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?lastLF">lastLF</span><span class="z">"</span><span class="z">&#xD;
                 </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="16" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$revChars</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">+</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">1</span><span class="whitespace" start="21"> </span><span class="op" start="22">-</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-index-of" class="solar"><span class="function" start="24" pair-end="46" select="quick">index-of</span></a><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$revChars</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="numeric" start="44">10</span><span class="parenthesis" start="46">)</span><span class="filter" start="47" pair-end="49" select="quick">[</span><span class="numeric" start="48">1</span><span class="filter" start="49">]</span><span class="z">"</span><span id="wx1860" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w1862"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="30" select="quick">substring</span></a><span class="parenthesis">(</span><span class="axis" start="11">@</span><span class="qname" start="12" select="quick">value</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$lastLF</span><span class="whitespace" start="26"> </span><span class="op" start="27">+</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx1881" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx1885" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1889" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w1891"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">token</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">dev</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w1907"><span class="es">&lt;</span><span class="en">p</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w1911"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span id="wx1920" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="cl">p</span><span id="wx1924" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1928" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w1930"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}stringToCharSequence">loc:stringToCharSequence</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w1946"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?string">string</span><span class="z">"</span><span id="wx1954" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w1956"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$i" class="variable" start="5" select="quick">$i</span><span class="whitespace" start="7"> </span><span class="op" start="8">in</span><span class="whitespace" start="10"> </span><span class="numeric" start="11">1</span><span class="whitespace" start="12"> </span><span class="op" start="13">to</span><span class="whitespace" start="15"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="16" pair-end="37" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="30" select="quick">$string</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">&#xD;
                        </span><span class="op" start="64">return</span><span class="whitespace" start="70"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="71" pair-end="95" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="81" select="quick">$string</span><span class="op" start="88">,</span><span class="whitespace" start="89"> </span><span class="variable" start="90" select="quick">$i</span><span class="op" start="92">,</span><span class="whitespace" start="93"> </span><span class="numeric" start="94">1</span><span class="parenthesis" start="95">)</span><span class="z">"</span><span id="wx1990" class="sc">/&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1994" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w1996"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createPairs">loc:createPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w2012"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?brackets">brackets</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx2026" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2028"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nested">nested</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w2044"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#t?getNesting" class="solar"><span class="tcall">getNesting</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w2054"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">positions</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$brackets</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx2080" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w2082"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2102" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w2104"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2124" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2128" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2132" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="z">&lt;!--</span><span class="cm">  pair up start and end elements </span><span class="z">--&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w2138"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ends">ends</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nested</span><span class="filter" start="8" pair-end="13" select="quick">[</span><span class="axis" start="9">@</span><span class="qname" start="10" select="quick">end</span><span class="filter" start="13">]</span><span class="z">"</span><span id="wx2156" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2158"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nested</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="axis" start="9">@</span><span class="qname" start="10" select="quick">start</span><span class="filter" start="15">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w2172"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2193" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w2195"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">level</span><span class="z">"</span><span id="wx2210" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w2212"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pair">pair</span><span class="z">"</span><span class="z"> &#xD;
                 </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="24" select="quick">(</span><span class="variable" start="2" select="quick">$ends</span><span class="filter" start="7" pair-end="23" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">level</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$level</span><span class="filter" start="23">]</span><span class="parenthesis" start="24">)</span><span class="whitespace" start="25">&#xD;
                          </span><span class="filter" start="53" pair-end="75" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="54" pair-end="65" select="quick">number</span></a><span class="parenthesis">(</span><span class="axis" start="61">@</span><span class="qname" start="62" select="quick">end</span><span class="parenthesis" start="65">)</span><span class="whitespace" start="66"> </span><span class="op" start="67">&gt;</span><span class="whitespace" start="68"> </span><span class="variable" start="69" select="quick">$start</span><span class="filter" start="75">]</span><span class="filter" start="76" pair-end="78" select="quick">[</span><span class="numeric" start="77">1</span><span class="filter" start="78">]</span><span class="z">"</span><span class="z">&#xD;
    </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx2257" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w2259"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="20" select="quick">concat</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="8" pair-end="14" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="13">.</span><span class="parenthesis" start="14">)</span><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">}}</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w2281"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx2295" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w2297"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx2311" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w2313"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w2323"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span id="wx2340" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2344" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx2348" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2352" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx2356" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w2358"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?getNesting">getNesting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w2368"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?positions">positions</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2382" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2384"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2398" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2400"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2414" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w2416"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pos">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$positions</span><span class="filter" start="11" pair-end="18" select="quick">[</span><span class="variable" start="12" select="quick">$index</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx2433" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2435"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isOpen">isOpen</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="28" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">[</span><span class="op">'</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">(:</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2475" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2477"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isBracket">isBracket</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="22" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">)</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2512" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2514"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isComment">isComment</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">type</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="24" select="quick">(</span><span class="op">'</span><span class="literal" start="15">(:</span><span class="op">'</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">:)</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2549" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2551"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?blockType">blockType</span><span class="z">"</span><span class="z">&#xD;
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="14">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$isBracket</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">then</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">bracket</span><span class="op">'</span><span class="whitespace" start="30">&#xD;
                        </span><span class="op" start="56">else</span><span class="whitespace" start="60"> </span><span class="if" start="61" pair-end="74">if</span><span class="parenthesis">(</span><span class="variable" start="64" select="quick">$isComment</span><span class="parenthesis" start="74">)</span><span class="whitespace" start="75"> </span><span class="op" start="76">then</span><span class="whitespace" start="80"> </span><span class="op">'</span><span class="literal" start="81">comment</span><span class="op">'</span><span class="whitespace" start="90">&#xD;
                        </span><span class="op" start="116">else</span><span class="whitespace" start="120"> </span><span class="op">'</span><span class="literal" start="121">predicate</span><span class="op">'</span><span class="z">"</span><span id="wx2593" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2595"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z">&#xD;
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="11">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$isOpen</span><span class="parenthesis" start="11">)</span><span class="whitespace" start="12">&#xD;
                        </span><span class="op" start="38">then</span><span class="whitespace" start="42"> </span><span class="variable" start="43" select="quick">$level</span><span class="whitespace" start="49"> </span><span class="op" start="50">+</span><span class="whitespace" start="51"> </span><span class="numeric" start="52">1</span><span class="whitespace" start="53">&#xD;
                        </span><span class="op" start="79">else</span><span class="whitespace" start="83"> </span><span class="variable" start="84" select="quick">$level</span><span class="whitespace" start="90"> </span><span class="op" start="91">-</span><span class="whitespace" start="92"> </span><span class="numeric" start="93">1</span><span class="z">"</span><span id="wx2628" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2630"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w2634"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$pos</span><span class="parenthesis" start="11">)</span><span class="z">"</span><span id="wx2645" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w2647"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isOpen</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w2657"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$blockType</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w2669"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">position</span><span class="z">"</span><span id="wx2686" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w2688"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newLevel</span><span class="z">"</span><span id="wx2702" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx2706" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2710" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w2712"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w2716"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$blockType</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w2728"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="step" start="5">/</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">position</span><span class="z">"</span><span id="wx2745" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w2747"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx2761" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx2765" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2769" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2773" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w2775"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w2779"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">&gt;</span><span class="whitespace" start="13"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="14" pair-end="30" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$positions</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx2798" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w2800"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w2804"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#t?getNesting" class="solar"><span class="tcall">getNesting</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w2814"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2834" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w2836"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2860" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2864" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2868" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2872" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2876" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w2878"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createBlocks">loc:createBlocks</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w2894"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chars">chars</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx2908" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2910"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?skip">skip</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx2924" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2926"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2940" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2942"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?awaiting">awaiting</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx2956" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2958"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2972" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w2974"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?level">level</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2988" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w2990"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?charCount">charCount</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="13" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$chars</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx3007" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3009"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?char">char</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx3026" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w3028"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nChar">nChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">+</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx3049" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w3051"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pChar">pChar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chars</span><span class="filter" start="7" pair-end="18" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="whitespace" start="14"> </span><span class="op" start="15">-</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="filter" start="18">]</span><span class="z">"</span><span id="wx3072" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3074"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newLevel">newLevel</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w3090"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w3094"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3110"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="whitespace" start="1">&#xD;
                           </span><span class="if" start="30" pair-end="61">if</span><span class="parenthesis">(</span><span class="variable" start="33" select="quick">$char</span><span class="whitespace" start="38"> </span><span class="op" start="39">=</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41">(</span><span class="op">'</span><span class="whitespace" start="44"> </span><span class="op" start="45">and</span><span class="whitespace" start="48"> </span><span class="variable" start="49" select="quick">$nChar</span><span class="whitespace" start="55"> </span><span class="op" start="56">=</span><span class="whitespace" start="57"> </span><span class="op">'</span><span class="literal" start="58">:</span><span class="op">'</span><span class="parenthesis" start="61">)</span><span class="whitespace" start="62"> </span><span class="op" start="63">then</span><span class="whitespace" start="67"> </span><span class="variable" start="68" select="quick">$level</span><span class="whitespace" start="74"> </span><span class="op" start="75">+</span><span class="whitespace" start="76"> </span><span class="numeric" start="77">1</span><span class="whitespace" start="78">&#xD;
                           </span><span class="op" start="107">else</span><span class="whitespace" start="111"> </span><span class="if" start="112">if</span><span class="whitespace" start="114"> </span><span class="parenthesis" start="115" pair-end="160" select="quick">(</span><span class="variable" start="116" select="quick">$char</span><span class="whitespace" start="121"> </span><span class="op" start="122">=</span><span class="whitespace" start="123"> </span><span class="op">'</span><span class="literal" start="124">)</span><span class="op">'</span><span class="whitespace" start="127"> </span><span class="op" start="128">and</span><span class="whitespace" start="131"> </span><span class="variable" start="132" select="quick">$pChar</span><span class="whitespace" start="138"> </span><span class="op" start="139">=</span><span class="whitespace" start="140"> </span><span class="op">'</span><span class="literal" start="141">:</span><span class="op">'</span><span class="whitespace" start="144"> </span><span class="op" start="145">and</span><span class="whitespace" start="148"> </span><span class="variable" start="149" select="quick">$level</span><span class="whitespace" start="155"> </span><span class="op" start="156">gt</span><span class="whitespace" start="158"> </span><span class="numeric" start="159">0</span><span class="parenthesis" start="160">)</span><span class="whitespace" start="161"> </span><span class="op" start="162">then</span><span class="whitespace" start="166"> </span><span class="variable" start="167" select="quick">$level</span><span class="whitespace" start="173"> </span><span class="numeric" start="174">-1</span><span class="whitespace" start="176">&#xD;
                           </span><span class="op" start="205">else</span><span class="whitespace" start="209"> </span><span class="variable" start="210" select="quick">$level</span><span class="z">"</span><span id="wx3188" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3192" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3194"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3198"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$level</span><span class="z">"</span><span id="wx3206" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3210" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3214" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3218" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3220"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nowAwaiting">nowAwaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w3230"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w3234"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="op" start="10">=</span><span class="op">'</span><span class="literal" start="11"/><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3248"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">&#xD;
                   </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="37">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$char</span><span class="whitespace" start="9"> </span><span class="op" start="10">=</span><span class="whitespace" start="11"> </span><span class="parenthesis" start="12" pair-end="36" select="quick">(</span><span class="op">'</span><span class="literal" start="13">&amp;apos;&amp;apos;</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">&amp;quot;</span><span class="op">'</span><span class="parenthesis" start="36">)</span><span class="parenthesis" start="37">)</span><span class="whitespace" start="38">&#xD;
                           </span><span class="op" start="67">then</span><span class="whitespace" start="71"> </span><span class="variable" start="72" select="quick">$char</span><span class="whitespace" start="77"> &#xD;
                           </span><span class="op" start="107">else</span><span class="whitespace" start="111"> </span><span class="if" start="112">if</span><span class="whitespace" start="114"> </span><span class="parenthesis" start="115" pair-end="144" select="quick">(</span><span class="variable" start="116" select="quick">$char</span><span class="whitespace" start="121"> </span><span class="op" start="122">=</span><span class="whitespace" start="123"> </span><span class="op">'</span><span class="literal" start="124">(</span><span class="op">'</span><span class="whitespace" start="127"> </span><span class="op" start="128">and</span><span class="whitespace" start="131"> </span><span class="variable" start="132" select="quick">$nChar</span><span class="whitespace" start="138"> </span><span class="op" start="139">=</span><span class="whitespace" start="140"> </span><span class="op">'</span><span class="literal" start="141">:</span><span class="op">'</span><span class="parenthesis" start="144">)</span><span class="whitespace" start="145"> </span><span class="op" start="146">then</span><span class="whitespace" start="150"> </span><span class="op">'</span><span class="literal" start="151">:)</span><span class="op">'</span><span class="whitespace" start="155"> &#xD;
                           </span><span class="op" start="185">else</span><span class="whitespace" start="189"> </span><span class="op">'</span><span class="literal" start="190"/><span class="op">'</span><span class="z">"</span><span id="wx3311" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3315" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3317"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$awaiting</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3331"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"/><span class="op">'</span><span class="z">"</span><span id="wx3341" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3345" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3347"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13">:)</span><span class="op">'</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$char</span><span class="whitespace" start="27"> </span><span class="op" start="28">=</span><span class="whitespace" start="29"> </span><span class="op">'</span><span class="literal" start="30">)</span><span class="op">'</span><span class="whitespace" start="33"> </span><span class="op" start="34">and</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$pChar</span><span class="whitespace" start="44"> </span><span class="op" start="45">=</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47">:</span><span class="op">'</span><span class="whitespace" start="50"> </span><span class="op" start="51">and</span><span class="whitespace" start="54"> </span><span class="variable" start="55" select="quick">$level</span><span class="whitespace" start="61"> </span><span class="op" start="62">=</span><span class="whitespace" start="63"> </span><span class="numeric" start="64">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3391"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"/><span class="op">'</span><span class="z">"</span><span id="wx3401" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3405" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3407"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3411"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span id="wx3419" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3423" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3427" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3431" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3433"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nowSkip">nowSkip</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w3449"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w3453"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$skip</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3463"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx3473" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3477" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3479"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$awaiting</span><span class="whitespace" start="18"> </span><span class="op" start="19">and</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$nChar</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$char</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3501"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="1" pair-end="6" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx3511" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3515" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3517"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3521"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx3531" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3535" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3539" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3543" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3545"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13"/><span class="op">'</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$nowAwaiting</span><span class="whitespace" start="32"> </span><span class="op" start="33">=</span><span class="whitespace" start="34"> </span><span class="op">'</span><span class="literal" start="35"/><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w3571"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="parenthesis" start="9" pair-end="25" select="quick">(</span><span class="op">'</span><span class="literal" start="10">[</span><span class="op">'</span><span class="op" start="13">,</span><span class="op">'</span><span class="literal" start="14">]</span><span class="op">'</span><span class="op" start="17">,</span><span class="op">'</span><span class="literal" start="18">(</span><span class="op">'</span><span class="op" start="21">,</span><span class="op">'</span><span class="literal" start="22">)</span><span class="op">'</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w3601"><span class="es">&lt;</span><span class="en">block</span><span class="z"> </span><span class="atn">position</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$index</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$char</span><span class="op">}</span><span class="z">"</span><span id="wx3619" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3623" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3627" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3629"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isFound">isFound</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">&#xD;
   </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="29" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$nowAwaiting</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">and</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="35" pair-end="56" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="39" select="quick">$skip</span><span class="whitespace" start="44"> </span><span class="op" start="45">or</span><span class="whitespace" start="47"> </span><span class="variable" start="48" select="quick">$nowSkip</span><span class="parenthesis" start="56">)</span><span class="z">"</span><span id="wx3667" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3669"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newStart">newStart</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="13" select="quick">(</span><span class="variable" start="5" select="quick">$isFound</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">then</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$index</span><span class="whitespace" start="26"> </span><span class="op" start="27">else</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$start</span><span class="z">"</span><span id="wx3701" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3703"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"/><span class="op">'</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$isFound</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w3723"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">:)</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">comment</span><span class="op">'</span><span class="whitespace" start="37"> </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">literal</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w3757"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3773"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$char</span><span class="z">"</span><span id="wx3787" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3791" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3793"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx3807" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w3809"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="z">"</span><span id="wx3823" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx3827" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3831" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w3833"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w3837"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="variable" start="11" select="quick">$charCount</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w3851"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"/><span class="op">'</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="21" pair-end="33" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$isFound</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w3874"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$awaiting</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">:)</span><span class="op">'</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">then</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">comment</span><span class="op">'</span><span class="whitespace" start="37"> </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><span class="op">'</span><span class="literal" start="43">literal</span><span class="op">'</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w3908"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="whitespace" start="10"> </span><span class="op" start="11">ne</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">:)</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w3924"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$awaiting</span><span class="z">"</span><span id="wx3938" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3942" class="ec">&gt;</span></span><span class="txt">&#xD;
      </span><span class="ww" id="w3944"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx3958" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx3962" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3966" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3970" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w3972"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w3976"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">&#xD;
       </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}createBlocks" class="solar"><span class="function" start="1" pair-end="185" select="quick">loc:createBlocks</span></a><span class="parenthesis">(</span><span class="whitespace" start="18">&#xD;
                                 </span><span class="variable" start="53" select="quick">$chars</span><span class="op" start="59">,</span><span class="whitespace" start="60"> </span><span class="variable" start="61" select="quick">$nowSkip</span><span class="op" start="69">,</span><span class="whitespace" start="70"> </span><span class="variable" start="71" select="quick">$index</span><span class="whitespace" start="77"> </span><span class="op" start="78">+</span><span class="whitespace" start="79"> </span><span class="numeric" start="80">1</span><span class="op" start="81">,</span><span class="whitespace" start="82"> </span><span class="variable" start="83" select="quick">$nowAwaiting</span><span class="op" start="95">,</span><span class="whitespace" start="96">&#xD;
                                 </span><span class="variable" start="131" select="quick">$newStart</span><span class="op" start="140">,</span><span class="whitespace" start="141"> </span><span class="variable" start="142" select="quick">$newLevel</span><span class="whitespace" start="151">&#xD;
                                </span><span class="parenthesis" start="185">)</span><span class="z">"</span><span id="wx4008" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4012" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4016" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4020" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="z">&lt;!--</span><span class="cm"> top-level call - marks up tokens with their type </span><span class="z">--&gt;</span><span class="txt">&#xD;
 </span><span class="ww" id="w4026"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}getTokens">loc:getTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w4036"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx4050" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4052"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?omitPairs">omitPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx4066" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4068"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx4082" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4084"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}createTokens" class="solar"><span class="function" start="1" pair-end="42" select="quick">loc:createTokens</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$chunk</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$omitPairs</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="numeric" start="38">1</span><span class="op" start="39">,</span><span class="whitespace" start="40"> </span><span class="numeric" start="41">1</span><span class="parenthesis" start="42">)</span><span class="z">"</span><span id="wx4116" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w4118"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}rationalizeTokens" class="solar"><span class="function" start="1" pair-end="70" select="quick">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$tokens</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="numeric" start="32">1</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="35" pair-end="41" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$pbPairs</span><span class="op" start="52">,</span><span class="whitespace" start="53"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="54" pair-end="60" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="60">)</span><span class="op" start="61">,</span><span class="whitespace" start="62"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="63" pair-end="69" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="69">)</span><span class="parenthesis" start="70">)</span><span class="z">"</span><span id="wx4150" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4154" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
&#xD;
 </span><span class="ww" id="w4156"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}rationalizeTokens">loc:rationalizeTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w4166"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx4180" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4182"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx4196" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4198"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prevIsClosed">prevIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4212" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4214"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pbPairs">pbPairs</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx4228" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4230"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?typeExpected">typeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4244" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4246"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?quantifierExpected">quantifierExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx4260" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> when closed, a probable operator is a QName instead </span><span class="z">--&gt;</span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w4266"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx4289" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4291"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isQuantifier">isQuantifier</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$quantifierExpected</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$token</span><span class="step" start="31">/</span><span class="axis" start="32">@</span><span class="qname" start="33" select="quick">value</span><span class="whitespace" start="38"> </span><span class="op" start="39">=</span><span class="whitespace" start="40"> </span><span class="parenthesis" start="41" pair-end="53" select="quick">(</span><span class="op">'</span><span class="literal" start="42">?</span><span class="op">'</span><span class="op" start="45">,</span><span class="op">'</span><span class="literal" start="46">*</span><span class="op">'</span><span class="op" start="49">,</span><span class="op">'</span><span class="literal" start="50">+</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx4328" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4330"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?currentIsClosed">currentIsClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">&#xD;
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isQuantifier</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="18" pair-end="34" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$token</span><span class="step" start="28">/</span><span class="axis" start="29">@</span><span class="qname" start="30" select="quick">type</span><span class="parenthesis" start="34">)</span><span class="whitespace" start="35"> </span><span class="op" start="36">or</span><span class="whitespace" start="38"> &#xD;
                        </span><span class="parenthesis" start="65" pair-end="170" select="quick">(</span><span class="variable" start="66" select="quick">$token</span><span class="step" start="72">/</span><span class="axis" start="73">@</span><span class="qname" start="74" select="quick">value</span><span class="whitespace" start="79"> </span><span class="op" start="80">=</span><span class="whitespace" start="81"> </span><span class="parenthesis" start="82" pair-end="90" select="quick">(</span><span class="op">'</span><span class="literal" start="83">)</span><span class="op">'</span><span class="op" start="86">,</span><span class="op">'</span><span class="literal" start="87">]</span><span class="op">'</span><span class="parenthesis" start="90">)</span><span class="whitespace" start="91"> </span><span class="op" start="92">or</span><span class="whitespace" start="94"> &#xD;
                        </span><span class="parenthesis" start="121" pair-end="169" select="quick">(</span><span class="variable" start="122" select="quick">$token</span><span class="step" start="128">/</span><span class="axis" start="129">@</span><span class="qname" start="130" select="quick">type</span><span class="whitespace" start="134"> </span><span class="op" start="135">=</span><span class="whitespace" start="136"> </span><span class="parenthesis" start="137" pair-end="168" select="quick">(</span><span class="op">'</span><span class="literal" start="138">literal</span><span class="op">'</span><span class="op" start="147">,</span><span class="op">'</span><span class="literal" start="148">numeric</span><span class="op">'</span><span class="op" start="157">,</span><span class="op">'</span><span class="literal" start="158">variable</span><span class="op">'</span><span class="parenthesis" start="168">)</span><span class="parenthesis" start="169">)</span><span class="parenthesis" start="170">)</span><span class="z">"</span><span id="wx4406" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w4408"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w4418"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">start</span><span class="z">"</span><span id="wx4435" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w4437"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">end</span><span class="z">"</span><span id="wx4454" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w4456"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">value</span><span class="z">"</span><span id="wx4473" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
   </span><span class="ww" id="w4475"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w4479"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w4498"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$prevIsClosed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w4508"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">op</span><span class="op">'</span><span class="z">"</span><span id="wx4524" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4528" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4532" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w4534"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="18" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$isQuantifier</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">and</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="24" pair-end="41" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="28" select="quick">$prevIsClosed</span><span class="parenthesis" start="41">)</span><span class="whitespace" start="42"> </span><span class="op" start="43">and</span><span class="whitespace" start="46"> </span><span class="variable" start="47" select="quick">$token</span><span class="step" start="53">/</span><span class="axis" start="54">@</span><span class="qname" start="55" select="quick">value</span><span class="whitespace" start="60"> </span><span class="op" start="61">eq</span><span class="whitespace" start="63"> </span><span class="op">'</span><span class="literal" start="64">*</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="z">&lt;!--</span><span class="cm">&#xD;
        &lt;xsl:attribute name="type" select="'any'"/&gt;&#xD;
     </span><span class="z">--&gt;</span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4573" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w4575"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="parenthesis" start="16" pair-end="40" select="quick">(</span><span class="op">'</span><span class="literal" start="17">function</span><span class="op">'</span><span class="op" start="27">,</span><span class="op">'</span><span class="literal" start="28">if</span><span class="op">'</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">node</span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="whitespace" start="41"> </span><span class="op" start="42">or</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$token</span><span class="step" start="51">/</span><span class="axis" start="52">@</span><span class="qname" start="53" select="quick">value</span><span class="whitespace" start="58"> </span><span class="op" start="59">=</span><span class="whitespace" start="60"> </span><span class="parenthesis" start="61" pair-end="69" select="quick">(</span><span class="op">'</span><span class="literal" start="62">(</span><span class="op">'</span><span class="op" start="65">,</span><span class="op">'</span><span class="literal" start="66">[</span><span class="op">'</span><span class="parenthesis" start="69">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w4624"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pair">pair</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pbPairs</span><span class="filter" start="9" pair-end="30" select="quick">[</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">start</span><span class="whitespace" start="16"> </span><span class="op" start="17">=</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$token</span><span class="step" start="25">/</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">end</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx4649" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w4651"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w4655"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$token</span><span class="step" start="25">/</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">type</span><span class="whitespace" start="31"> </span><span class="op" start="32">eq</span><span class="whitespace" start="34"> </span><span class="op">'</span><span class="literal" start="35">node</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w4678"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">node-type</span><span class="op">'</span><span class="z">"</span><span id="wx4694" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4698" class="ec">&gt;</span></span><span class="txt">&#xD;
      </span><span class="ww" id="w4700"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w4704"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span id="wx4721" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4725" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4729" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w4731"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="17" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$pair</span><span class="parenthesis" start="16">)</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w4747"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w4760"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pair-end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">end</span><span class="z">"</span><span id="wx4777" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4781" class="ec">&gt;</span></span><span class="txt">&#xD;
      </span><span class="ww" id="w4783"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">level</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pair</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">level</span><span class="z">"</span><span id="wx4800" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4804" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4808" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w4810"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w4820"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="17" select="quick">(</span><span class="variable" start="5" select="quick">$token</span><span class="step" start="11">/</span><span class="axis" start="12">@</span><span class="qname" start="13" select="quick">type</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">then</span><span class="whitespace" start="23"> </span><span class="variable" start="24" select="quick">$token</span><span class="step" start="30">/</span><span class="axis" start="31">@</span><span class="qname" start="32" select="quick">type</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">type-name</span><span class="op">'</span><span class="z">"</span><span id="wx4854" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4858" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w4860"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isQuantifier</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w4870"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">quantifier</span><span class="op">'</span><span class="z">"</span><span id="wx4886" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4890" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w4892"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w4905"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="z">"</span><span id="wx4922" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4926" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4930" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx4934" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w4936"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ignorable">ignorable</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="parenthesis" start="16" pair-end="40" select="quick">(</span><span class="op">'</span><span class="literal" start="17">whitespace</span><span class="op">'</span><span class="op" start="29">,</span><span class="whitespace" start="30"> </span><span class="op">'</span><span class="literal" start="31">comment</span><span class="op">'</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span id="wx4972" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w4974"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isNewClosed">isNewClosed</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w4990"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w4994"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ignorable</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5004"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$prevIsClosed</span><span class="z">"</span><span id="wx5012" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5016" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5018"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="step" start="7">/</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">type</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">probableOp</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5037"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="18" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$prevIsClosed</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span id="wx5048" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5052" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5054"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5058"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$currentIsClosed</span><span class="z">"</span><span id="wx5066" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5070" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5074" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx5078" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5080"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newTypeExpected">newTypeExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z">&#xD;
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="15" select="quick">(</span><span class="variable" start="5" select="quick">$ignorable</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">then</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$typeExpected</span><span class="whitespace" start="35">&#xD;
                </span><span class="op" start="53">else</span><span class="whitespace" start="57"> </span><span class="variable" start="58" select="quick">$token</span><span class="step" start="64">/</span><span class="axis" start="65">@</span><span class="qname" start="66" select="quick">type</span><span class="whitespace" start="70"> </span><span class="op" start="71">=</span><span class="whitespace" start="72"> </span><span class="op">'</span><span class="literal" start="73">type-op</span><span class="op">'</span><span class="z">"</span><span id="wx5121" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5123"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">le</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="28" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w5144"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?qExpected">qExpected</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$typeExpected</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$token</span><span class="step" start="24">/</span><span class="axis" start="25">@</span><span class="qname" start="26" select="quick">value</span><span class="whitespace" start="31"> </span><span class="op" start="32">=</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">)</span><span class="op">'</span><span class="z">"</span><span id="wx5177" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
&#xD;
   </span><span class="ww" id="w5179"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z">&#xD;
                 </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}rationalizeTokens" class="solar"><span class="function" start="1" pair-end="114" select="quick">loc:rationalizeTokens</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$tokens</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$index</span><span class="whitespace" start="38"> </span><span class="op" start="39">+</span><span class="whitespace" start="40"> </span><span class="numeric" start="41">1</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$isNewClosed</span><span class="op" start="56">,</span><span class="whitespace" start="57">&#xD;
                 </span><span class="variable" start="76" select="quick">$pbPairs</span><span class="op" start="84">,</span><span class="whitespace" start="85"> </span><span class="variable" start="86" select="quick">$newTypeExpected</span><span class="op" start="102">,</span><span class="whitespace" start="103"> </span><span class="variable" start="104" select="quick">$qExpected</span><span class="parenthesis" start="114">)</span><span class="z">"</span><span id="wx5209" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5213" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> check tokens like </span><span class="z">--&gt;</span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5221" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
&#xD;
 </span><span class="ww" id="w5223"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}createTokens">loc:createTokens</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w5233"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?string">string</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx5247" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w5249"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?excludes">excludes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx5263" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w5265"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5279" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w5281"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5295" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5297"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?exclude">exclude</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$excludes</span><span class="filter" start="10" pair-end="17" select="quick">[</span><span class="variable" start="11" select="quick">$index</span><span class="filter" start="17">]</span><span class="z">"</span><span id="wx5320" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5322"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer?</span><span class="z">"</span><span class="z">&#xD;
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21">&#xD;
                           </span><span class="op" start="50">then</span><span class="whitespace" start="54"> </span><span class="parenthesis" start="55" pair-end="56" select="quick">(</span><span class="parenthesis" start="56">)</span><span class="whitespace" start="57">&#xD;
                        </span><span class="op" start="83">else</span><span class="whitespace" start="87"> </span><span class="if" start="88">if</span><span class="whitespace" start="90"> </span><span class="parenthesis" start="91" pair-end="105" select="quick">(</span><span class="variable" start="92" select="quick">$exclude</span><span class="step" start="100">/</span><span class="axis" start="101">@</span><span class="qname" start="102" select="quick">end</span><span class="parenthesis" start="105">)</span><span class="whitespace" start="106">&#xD;
                           </span><span class="op" start="135">then</span><span class="whitespace" start="139">&#xD;
                           </span><span class="variable" start="168" select="quick">$exclude</span><span class="step" start="176">/</span><span class="axis" start="177">@</span><span class="qname" start="178" select="quick">end</span><span class="whitespace" start="181"> </span><span class="type-op" start="182">cast as</span><span class="whitespace" start="189"> </span><span class="type-name" start="190">xs:integer</span><span class="whitespace" start="200"> </span><span class="op" start="201">+</span><span class="whitespace" start="202"> </span><span class="numeric" start="203">1</span><span class="whitespace" start="204">&#xD;
                        </span><span class="op" start="230">else</span><span class="whitespace" start="234"> </span><span class="parenthesis" start="235" pair-end="236" select="quick">(</span><span class="parenthesis" start="236">)</span><span class="z">"</span><span id="wx5385" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5387"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?exStart">exStart</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer?</span><span class="z">"</span><span class="z">&#xD;
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> </span><span class="parenthesis" start="27" pair-end="28" select="quick">(</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29">&#xD;
                </span><span class="op" start="47">else</span><span class="whitespace" start="51"> </span><span class="variable" start="52" select="quick">$exclude</span><span class="step" start="60">/</span><span class="axis" start="61">@</span><span class="qname" start="62" select="quick">start</span><span class="z">"</span><span id="wx5426" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5428"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?part">part</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w5438"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w5442"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$exclude</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$index</span><span class="whitespace" start="27"> </span><span class="op" start="28">=</span><span class="whitespace" start="29"> </span><span class="numeric" start="30">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5463"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$string</span><span class="z">"</span><span id="wx5471" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5475" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5477"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="16" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$exStart</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$exStart</span><span class="whitespace" start="30"> </span><span class="op" start="31">ge</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$start</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5498"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="45" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$start</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$exStart</span><span class="whitespace" start="36"> </span><span class="op" start="37">-</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$start</span><span class="parenthesis" start="45">)</span><span class="z">"</span><span id="wx5519" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5523" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5525"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5529"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="63" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$start</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="28" pair-end="49" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="42" select="quick">$string</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50"> </span><span class="op" start="51">+</span><span class="whitespace" start="52"> </span><span class="numeric" start="53">1</span><span class="whitespace" start="54"> </span><span class="op" start="55">-</span><span class="whitespace" start="56"> </span><span class="variable" start="57" select="quick">$start</span><span class="parenthesis" start="63">)</span><span class="z">"</span><span id="wx5557" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5561" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5565" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx5569" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5571"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="20" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">gt</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w5588"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}rawTokens" class="solar"><span class="function" start="1" pair-end="20" select="quick">loc:rawTokens</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$part</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span id="wx5611" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
   </span><span class="z">&lt;!--</span><span class="cm"> The XSLT that generates the tokens </span><span class="z">--&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w5617"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}processTokens" class="solar"><span class="function" start="1" pair-end="37" select="quick">loc:processTokens</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$tokens</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$start</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="numeric" start="36">1</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span id="wx5634" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5638" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5640"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="20" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$exclude</span><span class="parenthesis" start="19">)</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w5656"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w5666"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">start</span><span class="z">"</span><span id="wx5683" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5685"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5698"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$exclude</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">end</span><span class="z">"</span><span id="wx5715" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5719" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5721"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stringEnd">stringEnd</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5731"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$exclude</span><span class="step" start="13">/</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">end</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19">&#xD;
                           </span><span class="op" start="48">then</span><span class="whitespace" start="52"> </span><span class="variable" start="53" select="quick">$exclude</span><span class="step" start="61">/</span><span class="axis" start="62">@</span><span class="qname" start="63" select="quick">end</span><span class="whitespace" start="66">&#xD;
                           </span><span class="op" start="95">else</span><span class="whitespace" start="99"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="100" pair-end="121" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="114" select="quick">$string</span><span class="parenthesis" start="121">)</span><span class="z">"</span><span id="wx5760" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx5764" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5766"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w5776"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="107" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$string</span><span class="op" start="18">,</span><span class="whitespace" start="19">&#xD;
                                     </span><span class="variable" start="58" select="quick">$exclude</span><span class="step" start="66">/</span><span class="axis" start="67">@</span><span class="qname" start="68" select="quick">start</span><span class="op" start="73">,</span><span class="whitespace" start="74"> </span><span class="variable" start="75" select="quick">$stringEnd</span><span class="whitespace" start="85"> </span><span class="op" start="86">+</span><span class="whitespace" start="87"> </span><span class="numeric" start="88">1</span><span class="whitespace" start="89"> </span><span class="op" start="90">-</span><span class="whitespace" start="91"> </span><span class="variable" start="92" select="quick">$exclude</span><span class="step" start="100">/</span><span class="axis" start="101">@</span><span class="qname" start="102" select="quick">start</span><span class="parenthesis" start="107">)</span><span class="z">"</span><span id="wx5807" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5811" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w5813"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="14" select="quick">name</span></a><span class="parenthesis">(</span><span class="variable" start="6" select="quick">$exclude</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span id="wx5830" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx5834" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5838" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="z">&lt;!--</span><span class="cm"> iterate 1 pos beyond end of excludes length </span><span class="z">--&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w5844"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="21" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="5">empty</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$excludes</span><span class="parenthesis" start="20">)</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> &#xD;
                </span><span class="op" start="41">and</span><span class="whitespace" start="44"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="45" pair-end="60" select="quick">not</span></a><span class="parenthesis">(</span><span class="type" start="49">empty</span><span class="parenthesis">(</span><span class="variable" start="55" select="quick">$end</span><span class="parenthesis" start="59">)</span><span class="parenthesis" start="60">)</span><span class="whitespace" start="61"> &#xD;
                </span><span class="op" start="80">and</span><span class="whitespace" start="83"> </span><span class="variable" start="84" select="quick">$index</span><span class="whitespace" start="90"> </span><span class="op" start="91">le</span><span class="whitespace" start="93"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="94" pair-end="109" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="100" select="quick">$excludes</span><span class="parenthesis" start="109">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w5881"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}createTokens" class="solar"><span class="function" start="1" pair-end="54" select="quick">loc:createTokens</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$string</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$excludes</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$end</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$index</span><span class="whitespace" start="50"> </span><span class="op" start="51">+</span><span class="whitespace" start="52"> </span><span class="numeric" start="53">1</span><span class="parenthesis" start="54">)</span><span class="z">"</span><span id="wx5905" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5909" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5913" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w5915"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}processTokens">loc:processTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w5931"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx5945" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w5947"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?start">start</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5961" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w5963"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx5977" class="sc">/&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w5979"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?token">token</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tokens</span><span class="filter" start="8" pair-end="15" select="quick">[</span><span class="variable" start="9" select="quick">$index</span><span class="filter" start="15">]</span><span class="z">"</span><span id="wx6002" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w6004"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="10" pair-end="30" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="24" select="quick">$token</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx6031" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w6033"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">token</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w6043"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">start</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$start</span><span class="z">"</span><span id="wx6057" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w6059"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$end</span><span class="whitespace" start="5"> </span><span class="op" start="6">-</span><span class="whitespace" start="7"> </span><span class="numeric" start="8">1</span><span class="z">"</span><span id="wx6077" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w6079"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">value</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="z">"</span><span id="wx6093" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w6095"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isSimpleOps">isSimpleOps</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="/.html#v?simpleOps" class="solar"><span class="variable" start="10" select="quick">$simpleOps</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx6119" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w6121"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w6131"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="23">if</span><span class="parenthesis">(</span><span class="variable" start="4" select="quick">$token</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="parenthesis" start="13" pair-end="22" select="quick">(</span><span class="op">'</span><span class="literal" start="14">/</span><span class="op">'</span><span class="op" start="17">,</span><span class="op">'</span><span class="literal" start="18">//</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">then</span><span class="whitespace" start="29"> </span><span class="op">'</span><span class="literal" start="30">step</span><span class="op">'</span><span class="whitespace" start="36"> </span><span class="op" start="37">else</span><span class="whitespace" start="41"> </span><span class="op">'</span><span class="literal" start="42">op</span><span class="op">'</span><span class="z">"</span><span id="wx6172" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6176" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w6178"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?isDoubleToken">isDoubleToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w6194"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6198"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w6208"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="1" pair-end="7" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx6218" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6222" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w6224"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w6228"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?splitToken">splitToken</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="31" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$token</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18">[\n\p{Zs}]+</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span id="wx6256" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ww" id="w6258"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">&#xD;
       </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="28" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="5" pair-end="22" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$splitToken</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">ne</span><span class="whitespace" start="26"> </span><span class="numeric" start="27">2</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29"> &#xD;
               </span><span class="op" start="47">then</span><span class="whitespace" start="51"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="52" pair-end="58" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="58">)</span><span class="whitespace" start="59">&#xD;
               </span><span class="op" start="76">else</span><span class="whitespace" start="80"> </span><span class="if" start="81">if</span><span class="whitespace" start="83"> </span><span class="parenthesis" start="84" pair-end="140" select="quick">(</span><span class="variable" start="85" select="quick">$splitToken</span><span class="filter" start="96" pair-end="98" select="quick">[</span><span class="numeric" start="97">1</span><span class="filter" start="98">]</span><span class="whitespace" start="99"> </span><span class="op" start="100">eq</span><span class="whitespace" start="102"> </span><span class="op">'</span><span class="literal" start="103">instance</span><span class="op">'</span><span class="whitespace" start="113"> </span><span class="op" start="114">and</span><span class="whitespace" start="117"> </span><span class="variable" start="118" select="quick">$splitToken</span><span class="filter" start="129" pair-end="131" select="quick">[</span><span class="numeric" start="130">2</span><span class="filter" start="131">]</span><span class="whitespace" start="132"> </span><span class="op" start="133">eq</span><span class="whitespace" start="135"> </span><span class="op">'</span><span class="literal" start="136">of</span><span class="op">'</span><span class="parenthesis" start="140">)</span><span class="whitespace" start="141"> &#xD;
               </span><span class="op" start="159">then</span><span class="whitespace" start="163"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="164" pair-end="169" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="169">)</span><span class="whitespace" start="170">&#xD;
               </span><span class="op" start="187">else</span><span class="whitespace" start="191"> </span><span class="if" start="192">if</span><span class="whitespace" start="194"> </span><span class="parenthesis" start="195" pair-end="267" select="quick">(</span><span class="variable" start="196" select="quick">$splitToken</span><span class="filter" start="207" pair-end="209" select="quick">[</span><span class="numeric" start="208">1</span><span class="filter" start="209">]</span><span class="whitespace" start="210"> </span><span class="op" start="211">=</span><span class="whitespace" start="212"> </span><span class="parenthesis" start="213" pair-end="239" select="quick">(</span><span class="op">'</span><span class="literal" start="214">cast</span><span class="op">'</span><span class="op" start="220">,</span><span class="op">'</span><span class="literal" start="221">castable</span><span class="op">'</span><span class="op" start="231">,</span><span class="op">'</span><span class="literal" start="232">treat</span><span class="op">'</span><span class="parenthesis" start="239">)</span><span class="whitespace" start="240"> </span><span class="op" start="241">and</span><span class="whitespace" start="244"> </span><span class="variable" start="245" select="quick">$splitToken</span><span class="filter" start="256" pair-end="258" select="quick">[</span><span class="numeric" start="257">2</span><span class="filter" start="258">]</span><span class="whitespace" start="259"> </span><span class="op" start="260">eq</span><span class="whitespace" start="262"> </span><span class="op">'</span><span class="literal" start="263">as</span><span class="op">'</span><span class="parenthesis" start="267">)</span><span class="whitespace" start="268">&#xD;
               </span><span class="op" start="285">then</span><span class="whitespace" start="289"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="290" pair-end="295" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="295">)</span><span class="whitespace" start="296"> </span><span class="op" start="297">else</span><span class="whitespace" start="301"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-false" class="solar"><span class="function" start="302" pair-end="308" select="quick">false</span></a><span class="parenthesis">(</span><span class="parenthesis" start="308">)</span><span class="z">"</span><span id="wx6371" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6375" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6379" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx6383" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w6385"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isDoubleToken</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w6395"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">type-op</span><span class="op">'</span><span class="z">"</span><span id="wx6411" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6415" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
   </span><span class="ww" id="w6417"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?functionType">functionType</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w6433"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6437"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z">&#xD;
      </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="whitespace" start="13"> </span><span class="op" start="14">or</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$isDoubleToken</span><span class="whitespace" start="31"> </span><span class="op" start="32">or</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="35" pair-end="55" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="49" select="quick">$token</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56"> </span><span class="op" start="57">=</span><span class="whitespace" start="58"> </span><span class="numeric" start="59">1</span><span class="whitespace" start="60"> </span><span class="op" start="61">or</span><span class="whitespace" start="63"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="64" pair-end="89" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="68" pair-end="88" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="78" select="quick">$token</span><span class="op" start="84">,</span><span class="op">'</span><span class="literal" start="85">(</span><span class="op">'</span><span class="parenthesis" start="88">)</span><span class="parenthesis" start="89">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w6476"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span id="wx6478" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6482" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ww" id="w6484"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w6488"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?fnName">fnName</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="34" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$token</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18">[\n\p{Zs}]+|\(</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="filter" start="35" pair-end="37" select="quick">[</span><span class="numeric" start="36">1</span><span class="filter" start="37">]</span><span class="z">"</span><span id="wx6519" class="sc">/&gt;</span></span><span class="txt">&#xD;
      </span><span class="ww" id="w6521"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
       </span><span class="ww" id="w6525"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$fnName</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
        </span><span class="ww" id="w6541"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">if</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx6547" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6551" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ww" id="w6553"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">some</span><span class="whitespace" start="5"> </span><span id="rng-$n" class="variable" start="6" select="quick">$n</span><span class="whitespace" start="8"> </span><span class="op" start="9">in</span><span class="whitespace" start="11"> </span><a href="/.html#v?nodeTests" class="solar"><span class="variable" start="12" select="quick">$nodeTests</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">satisfies</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$n</span><span class="whitespace" start="35"> </span><span class="op" start="36">=</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
        </span><span class="ww" id="w6577"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx6583" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6587" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ww" id="w6589"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">some</span><span class="whitespace" start="5"> </span><span id="rng-$x" class="variable" start="6" select="quick">$x</span><span class="whitespace" start="8"> </span><span class="op" start="9">in</span><span class="whitespace" start="11"> </span><a href="/.html#v?typeTests" class="solar"><span class="variable" start="12" select="quick">$typeTests</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">satisfies</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$x</span><span class="whitespace" start="35"> </span><span class="op" start="36">=</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$fnName</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
        </span><span class="ww" id="w6613"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">type</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx6619" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6623" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ww" id="w6625"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">&#xD;
        </span><span class="ww" id="w6629"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">function</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx6635" class="ec">&gt;</span></span><span class="txt">&#xD;
       </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6639" class="ec">&gt;</span></span><span class="txt">&#xD;
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6643" class="ec">&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6647" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6651" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx6655" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w6657"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w6661"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$isSimpleOps</span><span class="whitespace" start="13"> </span><span class="op" start="14">or</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$isDoubleToken</span><span class="z">"</span><span id="wx6673" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6675"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$functionType</span><span class="whitespace" start="14"> </span><span class="op" start="15">ne</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18"/><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6691"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$functionType</span><span class="z">"</span><span id="wx6705" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6709" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6711"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-ends-with" class="solar"><span class="function" start="1" pair-end="23" select="quick">ends-with</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$token</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="op">'</span><span class="literal" start="19">::</span><span class="op">'</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">or</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$token</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38">@</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6739"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">axis</span><span class="op">'</span><span class="z">"</span><span id="wx6755" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6759" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6761"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-matches" class="solar"><span class="function" start="1" pair-end="29" select="quick">matches</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$token</span><span class="op" start="15">,</span><span class="op">'</span><span class="literal" start="16">[\n\p{Zs}]+</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6778"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">whitespace</span><span class="op">'</span><span class="z">"</span><span id="wx6794" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6798" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6800"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="19" select="quick">(</span><span class="op">'</span><span class="literal" start="11">.</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">..</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6822"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">context</span><span class="op">'</span><span class="z">"</span><span id="wx6838" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6842" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6844"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="18" select="quick">(</span><span class="op">'</span><span class="literal" start="11">(</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">)</span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6866"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">parenthesis</span><span class="op">'</span><span class="z">"</span><span id="wx6882" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6886" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6888"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="parenthesis" start="10" pair-end="18" select="quick">(</span><span class="op">'</span><span class="literal" start="11">[</span><span class="op">'</span><span class="op" start="14">,</span><span class="op">'</span><span class="literal" start="15">]</span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6910"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">filter</span><span class="op">'</span><span class="z">"</span><span id="wx6926" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6930" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6932"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="1" pair-end="14" select="quick">number</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$token</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">=</span><span class="whitespace" start="17"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="18" pair-end="31" select="quick">number</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$token</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6952"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">numeric</span><span class="op">'</span><span class="z">"</span><span id="wx6968" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6972" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w6974"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="/.html#v?ambiguousOps" class="solar"><span class="variable" start="10" select="quick">$ambiguousOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w6988"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">probableOp</span><span class="op">'</span><span class="z">"</span><span id="wx7004" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7008" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w7010"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><a href="/.html#v?higherOps" class="solar"><span class="variable" start="10" select="quick">$higherOps</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w7024"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="51" select="quick">starts-with</span></a><span class="parenthesis">(</span><a href="/.html#f?{com.qutoric.sketchpath.functions}nextNonWhite" class="solar"><span class="function" start="13" pair-end="45" select="quick">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable" start="30" select="quick">$tokens</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$index</span><span class="parenthesis" start="45">)</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="op">'</span><span class="literal" start="48">$</span><span class="op">'</span><span class="parenthesis" start="51">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w7048"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">higher</span><span class="op">'</span><span class="z">"</span><span id="wx7064" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7068" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7072" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w7074"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$token</span><span class="whitespace" start="7"> </span><span class="op" start="8">eq</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">if</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w7090"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}nextNonWhite" class="solar"><span class="function" start="1" pair-end="33" select="quick">loc:nextNonWhite</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$tokens</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$index</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34"> </span><span class="op" start="35">eq</span><span class="whitespace" start="37"> </span><span class="op">'</span><span class="literal" start="38">(</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
      </span><span class="ww" id="w7112"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">if</span><span class="op">'</span><span class="z">"</span><span id="wx7128" class="sc">/&gt;</span></span><span class="txt">&#xD;
     </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7132" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7136" class="ec">&gt;</span></span><span class="txt">&#xD;
    </span><span class="ww" id="w7138"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="24" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$token</span><span class="op" start="19">,</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">$</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
     </span><span class="ww" id="w7156"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">type</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">variable</span><span class="op">'</span><span class="z">"</span><span id="wx7172" class="sc">/&gt;</span></span><span class="txt">&#xD;
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7176" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7180" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx7184" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
  </span><span class="ww" id="w7186"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">le</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="28" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$tokens</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w7207"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="/.html#f?{com.qutoric.sketchpath.functions}processTokens" class="solar"><span class="function" start="1" pair-end="44" select="quick">loc:processTokens</span></a><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$tokens</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$end</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$index</span><span class="whitespace" start="40"> </span><span class="op" start="41">+</span><span class="whitespace" start="42"> </span><span class="numeric" start="43">1</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span id="wx7228" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7232" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7236" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w7238"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}nextNonWhite">loc:nextNonWhite</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w7254"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tokens">tokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx7268" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w7270"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx7284" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w7286"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w7290"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-true" class="solar"><span class="function" start="1" pair-end="6" select="quick">true</span></a><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="z">&lt;!--</span><span class="cm"> test="$index + 2 lt count($tokens)"&gt;  </span><span class="z">--&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w7306"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">&#xD;
         </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1" pair-end="55">if</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="4" pair-end="48" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$tokens</span><span class="filter" start="19" pair-end="30" select="quick">[</span><span class="variable" start="20" select="quick">$index</span><span class="whitespace" start="26"> </span><span class="op" start="27">+</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="filter" start="30">]</span><span class="op" start="31">,</span><span class="op">'</span><span class="literal" start="32">[\n\p{Zs}]+</span><span class="op">'</span><span class="op" start="45">,</span><span class="op">'</span><span class="literal" start="46"/><span class="op">'</span><span class="parenthesis" start="48">)</span><span class="whitespace" start="49"> </span><span class="op" start="50">eq</span><span class="whitespace" start="52"> </span><span class="op">'</span><span class="literal" start="53"/><span class="op">'</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56">&#xD;
                    </span><span class="op" start="78">then</span><span class="whitespace" start="82"> </span><span class="variable" start="83" select="quick">$tokens</span><span class="filter" start="90" pair-end="101" select="quick">[</span><span class="variable" start="91" select="quick">$index</span><span class="whitespace" start="97"> </span><span class="op" start="98">+</span><span class="whitespace" start="99"> </span><span class="numeric" start="100">2</span><span class="filter" start="101">]</span><span class="whitespace" start="102">&#xD;
                    </span><span class="op" start="124">else</span><span class="whitespace" start="128"> </span><span class="variable" start="129" select="quick">$tokens</span><span class="filter" start="136" pair-end="147" select="quick">[</span><span class="variable" start="137" select="quick">$index</span><span class="whitespace" start="143"> </span><span class="op" start="144">+</span><span class="whitespace" start="145"> </span><span class="numeric" start="146">1</span><span class="filter" start="147">]</span><span class="z">"</span><span id="wx7363" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7367" class="ec">&gt;</span></span><span class="txt">&#xD;
   </span><span class="ww" id="w7369"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span id="wx7371" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7375" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7379" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
 </span><span class="ww" id="w7381"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{com.qutoric.sketchpath.functions}rawTokens">loc:rawTokens</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
  </span><span class="ww" id="w7397"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?chunk">chunk</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx7411" class="sc">/&gt;</span></span><span class="txt">&#xD;
  </span><span class="ww" id="w7413"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z">&#xD;
   </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">(((-)?\d+)(\.)?(\d+([eE][\+\-]?)?\d*)?)|(\?)|(instance[\n\p{{Zs}}]+of)|(cast[\n\p{{Zs}}]+as)|(castable[\n\p{{Zs}}]+as)|(treat[\n\p{{Zs}}]+as)|((\$[\n\p{{Zs}}]*)?[\i\*][\p{{L}}\p{{Nd}}\.\-]*(:[\p{{L}}\p{{Nd}}\.\-\*]*)?(::)?:?)(\()?|(\.\.)|((-)?\d?\.\d*)|-|([&amp;lt;&amp;gt;!]=)|(&amp;gt;&amp;gt;|&amp;lt;&amp;lt;)|(//)|([\n\p{{Zs}}]+)|(\C)</span><span class="z">"</span><span class="z">&#xD;
   </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$chunk</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">&#xD;
   </span><span class="ww" id="w7429"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">&#xD;
    </span><span class="ww" id="w7433"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="1" pair-end="9" select="quick">string</span></a><span class="parenthesis">(</span><span class="context" start="8">.</span><span class="parenthesis" start="9">)</span><span class="z">"</span><span id="wx7444" class="sc">/&gt;</span></span><span class="txt">&#xD;
   </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx7448" class="ec">&gt;</span></span><span class="txt">&#xD;
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx7452" class="ec">&gt;</span></span><span class="txt">&#xD;
 </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7456" class="ec">&gt;</span></span><span class="txt">&#xD;
&#xD;
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:transform</span><span id="wx7460" class="ec">&gt;</span></span><span class="txt">&#xD;
</span></p></div></body></html>