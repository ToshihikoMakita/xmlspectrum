<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>common.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></head><body><div><p class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="enxsl">xsl:stylesheet</span><span class="z"> </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:db</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:doc</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://nwalsh.com/xsl/documentation/1.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/extension</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:fp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/extension/private</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:m</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/mode</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:mp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/mode/private</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:t</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/template</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:ext</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/extensions/xslt20</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">db doc f fp m t xs ext</span><span class="z">"</span><span class="z">
                </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">use.role.for.mediaobject</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">preferred.mediaobject.role</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">tex.math.in.alt</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">use.svg</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">graphic.default.extension</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:reference</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">info</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">title</span><span class="scx">&gt;</span><span class="txt">Common Templates Reference</span><span class="ez">&lt;/</span><span class="cl">title</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">author</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="en">personname</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="en">surname</span><span class="scx">&gt;</span><span class="txt">Walsh</span><span class="ez">&lt;/</span><span class="cl">surname</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="en">firstname</span><span class="scx">&gt;</span><span class="txt">Norman</span><span class="ez">&lt;/</span><span class="cl">firstname</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">personname</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">author</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">copyright</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">year</span><span class="scx">&gt;</span><span class="txt">2004</span><span class="ez">&lt;/</span><span class="cl">year</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">holder</span><span class="scx">&gt;</span><span class="txt">Norman Walsh</span><span class="ez">&lt;/</span><span class="cl">holder</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">copyright</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">info</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">partintro</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">section</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">title</span><span class="scx">&gt;</span><span class="txt">Introduction</span><span class="ez">&lt;/</span><span class="cl">title</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This is technical reference documentation for the DocBook XSL
Stylesheets; it documents (some of) the parameters, templates, and
other elements of the stylesheets.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This is not intended to be </span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">user</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt"> documentation.
It is provided for developers writing customization layers for the
stylesheets, and for anyone who's interested in </span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">how it
works</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Although I am trying to be thorough, this documentation is known
to be incomplete. Don't forget to read the source, too :-)</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">section</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">partintro</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:reference</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">person-name</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Formats a personal name</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template formats a personal name. It supports several styles
that may be specified with a </span><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">role</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt"> attribute
on the element (</span><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">personname</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt">, </span><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">author</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt">, </span><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">editor</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt">,
and </span><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">othercredit</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt">) or with the locale.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node containing the personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The formatted personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:person-name</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">personname</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="30" select="quick">(</span><span class="variable" start="5" select="quick">$node</span><span class="step" start="10">/</span><span class="axis" start="11">self::</span><span class="qname" start="17" select="quick">db:personname</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31">
                        </span><span class="op" start="56">then</span><span class="whitespace" start="60"> </span><span class="variable" start="61" select="quick">$node</span><span class="whitespace" start="66">
                        </span><span class="op" start="91">else</span><span class="whitespace" start="95"> </span><span class="variable" start="96" select="quick">$node</span><span class="step" start="101">/</span><span class="qname" start="102" select="quick">db:personname</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">style</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">role</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">role</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="107" select="quick">(</span><span class="variable" start="2" select="quick">$node</span><span class="step" start="7">/</span><span class="axis" start="8">parent::</span><span class="qname" start="16" select="quick">db:author</span><span class="whitespace" start="25"> </span><span class="op" start="26">or</span><span class="whitespace" start="28"> </span><span class="variable" start="29" select="quick">$node</span><span class="step" start="34">/</span><span class="axis" start="35">parent::</span><span class="qname" start="43" select="quick">db:editor</span><span class="whitespace" start="52">
                       </span><span class="op" start="76">or</span><span class="whitespace" start="78"> </span><span class="variable" start="79" select="quick">$node</span><span class="step" start="84">/</span><span class="axis" start="85">parent::</span><span class="qname" start="93" select="quick">db:othercredit</span><span class="parenthesis" start="107">)</span><span class="whitespace" start="108"> </span><span class="op" start="109">and</span><span class="whitespace" start="112"> </span><span class="variable" start="113" select="quick">$node</span><span class="step" start="118">/</span><span class="axis" start="119">parent::</span><span class="qname" start="127" select="quick">*</span><span class="step" start="128">/</span><span class="axis" start="129">@</span><span class="qname" start="130" select="quick">role</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="axis" start="7">parent::</span><span class="qname" start="15" select="quick">*</span><span class="step" start="16">/</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">role</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">gentext-template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">context</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">styles</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">person-name</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:orgname</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:orgname</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> $node/db:personname </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="18" select="quick">not</span><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$personname</span><span class="step" start="16">/</span><span class="qname" start="17" select="quick">*</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$personname</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$style</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">family-given</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:person-name-family-given</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$personname</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$style</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">last-first</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:person-name-last-first</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$personname</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:person-name-first-last</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$personname</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">person-name-family-given</span><span class="z">"</span><span class="z">
              </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Formats a personal name in the “family given” style</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template formats a personal name in the “family given” style.
It is generally called by </span><span class="es">&lt;</span><span class="en">function</span><span class="z"> </span><span class="atn">role</span><span class="atneq">=</span><span class="z">"</span><span class="av">template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">person-name</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt">
template.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node containing the personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The formatted personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:person-name-family-given</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm"> The family-given style applies a convention for identifying given </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> and family names in locales where it may be ambiguous </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">surname</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:surname</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$surname</span><span class="step" start="9">/</span><span class="node" start="10" pair-end="15" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:surname</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="parenthesis" start="22" pair-end="63" select="quick">(</span><span class="variable" start="23" select="quick">$node</span><span class="step" start="28">/</span><span class="qname" start="29" select="quick">db:firstname</span><span class="whitespace" start="41"> </span><span class="op" start="42">or</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$node</span><span class="step" start="50">/</span><span class="qname" start="51" select="quick">db:givenname</span><span class="parenthesis" start="63">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"> </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="39" select="quick">(</span><span class="variable" start="2" select="quick">$node</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">db:firstname</span><span class="op" start="20">|</span><span class="variable" start="21" select="quick">$node</span><span class="step" start="26">/</span><span class="qname" start="27" select="quick">db:givenname</span><span class="parenthesis" start="39">)</span><span class="filter" start="40" pair-end="42" select="quick">[</span><span class="numeric" start="41">1</span><span class="filter" start="42">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"> [FAMILY Given]</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:mode</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Mode for converting text to upper-case</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This mode is used to convert the text in a subtree to upper-case.
It returns a copy of the subtree with all </span><span class="es">&lt;</span><span class="en">code</span><span class="scx">&gt;</span><span class="txt">text()</span><span class="ez">&lt;/</span><span class="cl">code</span><span class="ec">&gt;</span><span class="txt"> nodes
converted to upper-case.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:mode</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="step" start="1">/</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="24" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="24">)</span><span class="op" start="25">|</span><span class="node" start="26" pair-end="34" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:to-uppercase</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="13" select="quick">upper-case</span><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">person-name-last-first</span><span class="z">"</span><span class="z">
              </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Formats a personal name in the “last, first” style</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template formats a personal name in the “last, first” style.
It is generally called by </span><span class="es">&lt;</span><span class="en">function</span><span class="z"> </span><span class="atn">role</span><span class="atneq">=</span><span class="z">"</span><span class="av">template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">person-name</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt">
template.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node containing the personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The formatted personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:person-name-last-first</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:surname</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:surname</span><span class="whitespace" start="17"> </span><span class="op" start="18">and</span><span class="whitespace" start="21"> </span><span class="parenthesis" start="22" pair-end="63" select="quick">(</span><span class="variable" start="23" select="quick">$node</span><span class="step" start="28">/</span><span class="qname" start="29" select="quick">db:firstname</span><span class="whitespace" start="41"> </span><span class="op" start="42">or</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$node</span><span class="step" start="50">/</span><span class="qname" start="51" select="quick">db:givenname</span><span class="parenthesis" start="63">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="39" select="quick">(</span><span class="variable" start="2" select="quick">$node</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">db:firstname</span><span class="op" start="20">|</span><span class="variable" start="21" select="quick">$node</span><span class="step" start="26">/</span><span class="qname" start="27" select="quick">db:givenname</span><span class="parenthesis" start="39">)</span><span class="filter" start="40" pair-end="42" select="quick">[</span><span class="numeric" start="41">1</span><span class="filter" start="42">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">person-name-first-last</span><span class="z">"</span><span class="z">
              </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Formats a personal name in the “first last” style</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template formats a personal name in the “first last” style.
It is generally called by </span><span class="es">&lt;</span><span class="en">function</span><span class="z"> </span><span class="atn">role</span><span class="atneq">=</span><span class="z">"</span><span class="av">template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">person-name</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt">
template.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node containing the personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The formatted personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:person-name-first-last</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:honorific</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:honorific</span><span class="filter" start="19" pair-end="21" select="quick">[</span><span class="numeric" start="20">1</span><span class="filter" start="21">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$punct.honorific</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:firstname</span><span class="whitespace" start="19"> </span><span class="op" start="20">or</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$node</span><span class="step" start="28">/</span><span class="qname" start="29" select="quick">db:givenname</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:honorific</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"> </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="39" select="quick">(</span><span class="variable" start="2" select="quick">$node</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">db:firstname</span><span class="op" start="20">|</span><span class="variable" start="21" select="quick">$node</span><span class="step" start="26">/</span><span class="qname" start="27" select="quick">db:givenname</span><span class="parenthesis" start="39">)</span><span class="filter" start="40" pair-end="42" select="quick">[</span><span class="numeric" start="41">1</span><span class="filter" start="42">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:othername</span><span class="whitespace" start="19"> </span><span class="op" start="20">and</span><span class="whitespace" start="23"> </span><span class="variable" start="24" select="quick">$author.othername.in.middle</span><span class="whitespace" start="51"> </span><span class="op" start="52">!=</span><span class="whitespace" start="54"> </span><span class="numeric" start="55">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:honorific</span><span class="whitespace" start="19"> </span><span class="op" start="20">or</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$node</span><span class="step" start="28">/</span><span class="qname" start="29" select="quick">db:firstname</span><span class="whitespace" start="41"> </span><span class="op" start="42">or</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$node</span><span class="step" start="50">/</span><span class="qname" start="51" select="quick">db:givenname</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"> </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:othername</span><span class="filter" start="19" pair-end="21" select="quick">[</span><span class="numeric" start="20">1</span><span class="filter" start="21">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:surname</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:honorific</span><span class="whitespace" start="19"> </span><span class="op" start="20">or</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$node</span><span class="step" start="28">/</span><span class="qname" start="29" select="quick">db:firstname</span><span class="whitespace" start="41"> </span><span class="op" start="42">or</span><span class="whitespace" start="44"> </span><span class="variable" start="45" select="quick">$node</span><span class="step" start="50">/</span><span class="qname" start="51" select="quick">db:givenname</span><span class="whitespace" start="63">
                  </span><span class="op" start="82">or</span><span class="whitespace" start="84"> </span><span class="parenthesis" start="85" pair-end="141" select="quick">(</span><span class="variable" start="86" select="quick">$node</span><span class="step" start="91">/</span><span class="qname" start="92" select="quick">db:othername</span><span class="whitespace" start="104"> </span><span class="op" start="105">and</span><span class="whitespace" start="108"> </span><span class="variable" start="109" select="quick">$author.othername.in.middle</span><span class="whitespace" start="136"> </span><span class="op" start="137">!=</span><span class="whitespace" start="139"> </span><span class="numeric" start="140">0</span><span class="parenthesis" start="141">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt"> </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:surname</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:lineage</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$node</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:lineage</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">person-name-list</span><span class="z">"</span><span class="z">
              </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Formats a list of personal names</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template formats a list of personal names, for example in
an </span><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">authorgroup</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The list of names is assumed to be in the current context node.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node containing the personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The formatted personal name.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:person-name-list</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> Return a formatted string representation of the contents of
       the current element. The current element must contain one or
       more AUTHORs, CORPAUTHORs, OTHERCREDITs, and/or EDITORs.

       John Doe
     or
       John Doe and Jane Doe
     or
       John Doe, Jane Doe, and A. Nonymous
  </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">person.list</span><span class="z">"</span><span class="z">
             </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:author</span><span class="op" start="10">|</span><span class="qname" start="11" select="quick">db:corpauthor</span><span class="op" start="24">|</span><span class="qname" start="25" select="quick">db:othercredit</span><span class="op" start="39">|</span><span class="qname" start="40" select="quick">db:editor</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">person.count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="19" select="quick">count</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$person.list</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$count</span><span class="whitespace" start="7"> </span><span class="qname" start="8" select="quick">&amp;</span><span class="op" start="9">gt</span><span class="qname" start="11" select="quick">;</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$person.count</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:person-name</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$person.list</span><span class="filter" start="13" pair-end="31" select="quick">[</span><span class="function" start="14" pair-end="23" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="23">)</span><span class="op" start="24">=</span><span class="variable" start="25" select="quick">$count</span><span class="filter" start="31">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">

      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$person.count</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">2</span><span class="whitespace" start="18"> </span><span class="op" start="19">and</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$count</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="numeric" start="32">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">gentext-template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">context</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">authorgroup</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">sep2</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$person.count</span><span class="whitespace" start="14"> </span><span class="qname" start="15" select="quick">&amp;</span><span class="op" start="16">gt</span><span class="qname" start="18" select="quick">;</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">2</span><span class="whitespace" start="21"> </span><span class="op" start="22">and</span><span class="whitespace" start="25"> </span><span class="variable" start="26" select="quick">$count</span><span class="op" start="32">+</span><span class="numeric" start="33">1</span><span class="whitespace" start="34"> </span><span class="op" start="35">=</span><span class="whitespace" start="36"> </span><span class="variable" start="37" select="quick">$person.count</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">gentext-template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">context</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">authorgroup</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">seplast</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$count</span><span class="whitespace" start="7"> </span><span class="qname" start="8" select="quick">&amp;</span><span class="op" start="9">lt</span><span class="qname" start="11" select="quick">;</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$person.count</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">gentext-template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">context</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">authorgroup</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">sep</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">

      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:person-name-list</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">person.list</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$person.list</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">person.count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$person.count</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">count</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$count</span><span class="op" start="7">+</span><span class="numeric" start="8">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:mode</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:number</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Mode for inserting element labels (numbers)</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This mode is used to insert numbers for numbered elements.
Any element processed in this mode should generate its number.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:mode</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:qandadiv</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:number</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">level</span><span class="atneq">=</span><span class="z">"</span><span class="av">multiple</span><span class="z">"</span><span class="z"> </span><span class="atn">from</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:qandaset</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">1.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:qandaentry</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:number</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">ancestor::</span><span class="qname" start="11" select="quick">db:qandadiv</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">level</span><span class="atneq">=</span><span class="z">"</span><span class="av">single</span><span class="z">"</span><span class="z"> </span><span class="atn">from</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:qandadiv</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">1.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">level</span><span class="atneq">=</span><span class="z">"</span><span class="av">single</span><span class="z">"</span><span class="z"> </span><span class="atn">from</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:qandaset</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">1.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:step</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:number</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">rest</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">recursive</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">format</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="30" select="quick">f:procedure-step-numeration</span><span class="parenthesis">(</span><span class="context" start="29">.</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">num</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$format</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">arabic</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:step</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$format</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">loweralpha</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:step</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">a</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$format</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">lowerroman</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:step</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">i</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$format</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">upperalpha</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:step</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">A</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$format</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">upperroman</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:step</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">I</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:step</span><span class="z">"</span><span class="z"> </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">i</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$recursive</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">0</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="axis" start="21">ancestor::</span><span class="qname" start="31" select="quick">db:step</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">ancestor::</span><span class="qname" start="11" select="quick">db:step</span><span class="filter" start="18" pair-end="20" select="quick">[</span><span class="numeric" start="19">1</span><span class="filter" start="20">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:number</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">rest</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="24" select="quick">concat</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">.</span><span class="op">'</span><span class="op" start="11">,</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$num</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$rest</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="19" select="quick">concat</span><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$num</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$rest</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:copyright-years</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Print a set of years with collapsed ranges</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template prints a list of year elements with consecutive
years printed as a range. In other words:</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">screen</span><span class="scx">&gt;</span><span class="txt"></span><span class="z">&lt;![CDATA[</span><span class="cd">&lt;year&gt;1992&lt;/year&gt;
&lt;year&gt;1993&lt;/year&gt;
&lt;year&gt;1994&lt;/year&gt;</span><span class="z">]]&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">screen</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">is printed </span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">1992-1994</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt">, whereas:</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">screen</span><span class="scx">&gt;</span><span class="txt"></span><span class="z">&lt;![CDATA[</span><span class="cd">&lt;year&gt;1992&lt;/year&gt;
&lt;year&gt;1994&lt;/year&gt;</span><span class="z">]]&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">screen</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">is printed </span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">1992, 1994</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template assumes that all the year elements contain only
decimal year numbers, that the elements are sorted in increasing
numerical order, that there are no duplicates, and that all the years
are expressed in full </span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">century+year</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt">
(</span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">1999</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt"> not </span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">99</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt">) notation.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">years</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The initial set of year elements.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">print.ranges</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If non-zero, multi-year ranges are collapsed. If zero, all years
are printed discretely.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">single.year.ranges</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If non-zero, two consecutive years will be printed as a range,
otherwise, they will be printed discretely. In other words, a single
year range is </span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">1991-1992</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt"> but discretely it's
</span><span class="es">&lt;</span><span class="en">quote</span><span class="scx">&gt;</span><span class="txt">1991, 1992</span><span class="ez">&lt;/</span><span class="cl">quote</span><span class="ec">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template returns the formatted list of years.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:copyright-years</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">years</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">print.ranges</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">single.year.ranges</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">firstyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">nextyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message terminate="no"&gt;
    &lt;xsl:text&gt;CY: &lt;/xsl:text&gt;
    &lt;xsl:value-of select="count($years)"/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:value-of select="$firstyear"/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:value-of select="$nextyear"/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:value-of select="$print.ranges"/&gt;
    &lt;xsl:text&gt;, &lt;/xsl:text&gt;
    &lt;xsl:value-of select="$single.year.ranges"/&gt;
    &lt;xsl:text&gt; (&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$years[1]"/&gt;
    &lt;xsl:text&gt;)&lt;/xsl:text&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$print.ranges</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">0</span><span class="whitespace" start="18"> </span><span class="op" start="19">and</span><span class="whitespace" start="22"> </span><span class="function" start="23" pair-end="36" select="quick">exists</span><span class="parenthesis">(</span><span class="variable" start="30" select="quick">$years</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="13" select="quick">count</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$years</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">titlepage.mode</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">titlepage.mode</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:copyright-years</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">years</span><span class="z">"</span><span class="z">
                            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="25" select="quick">[</span><span class="function" start="8" pair-end="17" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">print.ranges</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$print.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">single.year.ranges</span><span class="z">"</span><span class="z">
                            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$single.year.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="13" select="quick">count</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$years</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">lastyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nextyear</span><span class="whitespace" start="10"> </span><span class="op" start="11">-</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm"> there weren't any years at all </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$lastyear</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$single.year.ranges</span><span class="whitespace" start="20"> </span><span class="op" start="21">=</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">0</span><span class="whitespace" start="24">
                        </span><span class="op" start="49">and</span><span class="whitespace" start="52"> </span><span class="variable" start="53" select="quick">$lastyear</span><span class="whitespace" start="62"> </span><span class="op" start="63">=</span><span class="whitespace" start="64"> </span><span class="variable" start="65" select="quick">$firstyear</span><span class="whitespace" start="75"> </span><span class="op" start="76">+</span><span class="whitespace" start="77"> </span><span class="numeric" start="78">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$lastyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">-</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$lastyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:copyright-years</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">years</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="25" select="quick">[</span><span class="function" start="8" pair-end="17" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">firstyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nextyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="whitespace" start="10"> </span><span class="op" start="11">+</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">print.ranges</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$print.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">single.year.ranges</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$single.year.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nextyear</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$years</span><span class="filter" start="19" pair-end="21" select="quick">[</span><span class="numeric" start="20">1</span><span class="filter" start="21">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:copyright-years</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">years</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="25" select="quick">[</span><span class="function" start="8" pair-end="17" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">firstyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nextyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nextyear</span><span class="whitespace" start="10"> </span><span class="op" start="11">+</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">print.ranges</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$print.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">single.year.ranges</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$single.year.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> we have years left, but they aren't in the current range </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nextyear</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$firstyear</span><span class="whitespace" start="23"> </span><span class="op" start="24">+</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$single.year.ranges</span><span class="whitespace" start="20"> </span><span class="op" start="21">=</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">0</span><span class="whitespace" start="24">
                        </span><span class="op" start="49">and</span><span class="whitespace" start="52"> </span><span class="variable" start="53" select="quick">$nextyear</span><span class="whitespace" start="62"> </span><span class="op" start="63">=</span><span class="whitespace" start="64"> </span><span class="variable" start="65" select="quick">$firstyear</span><span class="whitespace" start="75"> </span><span class="op" start="76">+</span><span class="whitespace" start="77"> </span><span class="numeric" start="78">2</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nextyear</span><span class="whitespace" start="10"> </span><span class="op" start="11">-</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$firstyear</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">-</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nextyear</span><span class="whitespace" start="10"> </span><span class="op" start="11">-</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">, </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:copyright-years</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">years</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="25" select="quick">[</span><span class="function" start="8" pair-end="17" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">firstyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nextyear</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$years</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="whitespace" start="10"> </span><span class="op" start="11">+</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">print.ranges</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$print.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">single.year.ranges</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$single.year.ranges</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ====================================================================== </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:select-mediaobject</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Selects and processes an appropriate media object from a list</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template takes a list of media objects (usually the
children of a mediaobject or inlinemediaobject) and processes
the "right" object.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template relies on </span><span class="es">&lt;</span><span class="en">function</span><span class="scx">&gt;</span><span class="txt">f:select-mediaobject-index</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt">
to determine which object in the list is appropriate.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If no acceptable object is located, nothing happens.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">olist</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node list of potential objects to examine.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Calls &amp;lt;xsl:apply-templates&amp;gt; on the selected object.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:select-mediaobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">olist</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="filter" start="2" pair-end="43" select="quick">[</span><span class="function" start="3" pair-end="20" select="quick">not</span><span class="parenthesis">(</span><span class="axis" start="7">self::</span><span class="qname" start="13" select="quick">db:info</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">and</span><span class="whitespace" start="25"> </span><span class="function" start="26" pair-end="42" select="quick">not</span><span class="parenthesis">(</span><span class="axis" start="30">self::</span><span class="qname" start="36" select="quick">db:alt</span><span class="parenthesis" start="42">)</span><span class="filter" start="43">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">mediaobject.index</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="34" select="quick">f:select-mediaobject-index</span><span class="parenthesis">(</span><span class="variable" start="28" select="quick">$olist</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$mediaobject.index</span><span class="whitespace" start="19"> </span><span class="op" start="20">!=</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$olist</span><span class="filter" start="7" pair-end="39" select="quick">[</span><span class="function" start="8" pair-end="17" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">=</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$mediaobject.index</span><span class="filter" start="39">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ====================================================================== </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">f:select-mediaobject-index</span><span class="z">"</span><span class="z">
              </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Selects the position of the appropriate media object from a list</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This function takes a list of media objects (usually the
children of a mediaobject or inlinemediaobject) and determines
the "right" object. It returns the position of that object
to be used by the calling template.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If the global parameter
</span><span class="es">&lt;</span><span class="en">parameter</span><span class="scx">&gt;</span><span class="txt">use.role.for.mediaobject</span><span class="ez">&lt;/</span><span class="cl">parameter</span><span class="ec">&gt;</span><span class="txt"> is nonzero, then it
first checks for an object with a role attribute of the appropriate
value. It takes the first of those. Otherwise, it takes the first
acceptable object in the list.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template relies on a </span><span class="es">&lt;</span><span class="en">function</span><span class="scx">&gt;</span><span class="txt">f:is-acceptable-mediaobject</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt">
to determine if a given object is an acceptable graphic. The semantics
of media objects is that the first acceptable graphic should be used.
</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If no acceptable object is located, no index is returned.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">olist</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node list of potential objects to examine.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Returns the position of the selected object in the original list
or 0 if no object is selected.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">f:select-mediaobject-index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">olist</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> Test for objects preferred by role </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$use.role.for.mediaobject</span><span class="whitespace" start="26"> </span><span class="op" start="27">!=</span><span class="whitespace" start="29"> </span><span class="numeric" start="30">0</span><span class="whitespace" start="31">
                    </span><span class="op" start="52">and</span><span class="whitespace" start="55"> </span><span class="variable" start="56" select="quick">$preferred.mediaobject.role</span><span class="whitespace" start="83"> </span><span class="op" start="84">!=</span><span class="whitespace" start="86"> </span><span class="op">'</span><span class="literal" start="87"></span><span class="op">'</span><span class="whitespace" start="89">
                    </span><span class="op" start="110">and</span><span class="whitespace" start="113"> </span><span class="variable" start="114" select="quick">$olist</span><span class="filter" start="120" pair-end="156" select="quick">[</span><span class="axis" start="121">@</span><span class="qname" start="122" select="quick">role</span><span class="whitespace" start="126"> </span><span class="op" start="127">=</span><span class="whitespace" start="128"> </span><span class="variable" start="129" select="quick">$preferred.mediaobject.role</span><span class="filter" start="156">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">

      </span><span class="z">&lt;!--</span><span class="cm"> Get the first hit's position index </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$olist</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">role</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$preferred.mediaobject.role</span><span class="whitespace" start="36"> </span><span class="op" start="37">and</span><span class="whitespace" start="40">
                      </span><span class="function" start="63" pair-end="151" select="quick">not</span><span class="parenthesis">(</span><span class="axis" start="67">preceding-sibling::</span><span class="qname" start="86" select="quick">*</span><span class="whitespace" start="87">
                          </span><span class="filter" start="114" pair-end="150" select="quick">[</span><span class="axis" start="115">@</span><span class="qname" start="116" select="quick">role</span><span class="whitespace" start="120"> </span><span class="op" start="121">=</span><span class="whitespace" start="122"> </span><span class="variable" start="123" select="quick">$preferred.mediaobject.role</span><span class="filter" start="150">]</span><span class="parenthesis" start="151">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="10" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$use.role.for.mediaobject</span><span class="whitespace" start="26"> </span><span class="op" start="27">!=</span><span class="whitespace" start="29"> </span><span class="numeric" start="30">0</span><span class="whitespace" start="31">
                    </span><span class="op" start="52">and</span><span class="whitespace" start="55"> </span><span class="variable" start="56" select="quick">$olist</span><span class="filter" start="62" pair-end="94" select="quick">[</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">role</span><span class="whitespace" start="68"> </span><span class="op" start="69">=</span><span class="whitespace" start="70"> </span><span class="variable" start="71" select="quick">$stylesheet.result.type</span><span class="filter" start="94">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> Get the first hit's position index </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$olist</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">role</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$stylesheet.result.type</span><span class="whitespace" start="32"> </span><span class="op" start="33">and</span><span class="whitespace" start="36">
                      </span><span class="function" start="59" pair-end="143" select="quick">not</span><span class="parenthesis">(</span><span class="axis" start="63">preceding-sibling::</span><span class="qname" start="82" select="quick">*</span><span class="whitespace" start="83">
                          </span><span class="filter" start="110" pair-end="142" select="quick">[</span><span class="axis" start="111">@</span><span class="qname" start="112" select="quick">role</span><span class="whitespace" start="116"> </span><span class="op" start="117">=</span><span class="whitespace" start="118"> </span><span class="variable" start="119" select="quick">$stylesheet.result.type</span><span class="filter" start="142">]</span><span class="parenthesis" start="143">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="10" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

    </span><span class="z">&lt;!--</span><span class="cm"> Accept 'html' for $stylesheet.result.type = 'xhtml' </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$use.role.for.mediaobject</span><span class="whitespace" start="26"> </span><span class="op" start="27">!=</span><span class="whitespace" start="29"> </span><span class="numeric" start="30">0</span><span class="whitespace" start="31">
                    </span><span class="op" start="52">and</span><span class="whitespace" start="55"> </span><span class="variable" start="56" select="quick">$stylesheet.result.type</span><span class="whitespace" start="79"> </span><span class="op" start="80">=</span><span class="whitespace" start="81"> </span><span class="op">'</span><span class="literal" start="82">xhtml</span><span class="op">'</span><span class="whitespace" start="89">
                    </span><span class="op" start="110">and</span><span class="whitespace" start="113"> </span><span class="variable" start="114" select="quick">$olist</span><span class="filter" start="120" pair-end="135" select="quick">[</span><span class="axis" start="121">@</span><span class="qname" start="122" select="quick">role</span><span class="whitespace" start="126"> </span><span class="op" start="127">=</span><span class="whitespace" start="128"> </span><span class="op">'</span><span class="literal" start="129">html</span><span class="op">'</span><span class="filter" start="135">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> Get the first hit's position index </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$olist</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">role</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="op">'</span><span class="literal" start="9">html</span><span class="op">'</span><span class="whitespace" start="15"> </span><span class="op" start="16">and</span><span class="whitespace" start="19">
                      </span><span class="function" start="42" pair-end="82" select="quick">not</span><span class="parenthesis">(</span><span class="axis" start="46">preceding-sibling::</span><span class="qname" start="65" select="quick">*</span><span class="filter" start="66" pair-end="81" select="quick">[</span><span class="axis" start="67">@</span><span class="qname" start="68" select="quick">role</span><span class="whitespace" start="72"> </span><span class="op" start="73">=</span><span class="whitespace" start="74"> </span><span class="op">'</span><span class="literal" start="75">html</span><span class="op">'</span><span class="filter" start="81">]</span><span class="parenthesis" start="82">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="10" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="37" select="quick">fp:select-mediaobject-index</span><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$olist</span><span class="op" start="35">,</span><span class="numeric" start="36">1</span><span class="parenthesis" start="37">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">fp:select-mediaobject-index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">olist</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">count</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$count</span><span class="whitespace" start="7"> </span><span class="qname" start="8" select="quick">&amp;</span><span class="op" start="9">gt</span><span class="qname" start="11" select="quick">;</span><span class="whitespace" start="12"> </span><span class="function" start="13" pair-end="25" select="quick">count</span><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$olist</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">object</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$olist</span><span class="filter" start="7" pair-end="25" select="quick">[</span><span class="function" start="8" pair-end="17" select="quick">position</span><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="op" start="18">=</span><span class="variable" start="19" select="quick">$count</span><span class="filter" start="25">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

      </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">useobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="z">&lt;!--</span><span class="cm"> Phrase is used only for TeX Math when the output is FO </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="axis" start="9">self::</span><span class="qname" start="15" select="quick">db:textobject</span><span class="whitespace" start="28">
                          </span><span class="op" start="55">and</span><span class="whitespace" start="58"> </span><span class="variable" start="59" select="quick">$object</span><span class="step" start="66">/</span><span class="qname" start="67" select="quick">db:phrase</span><span class="whitespace" start="76">
                          </span><span class="op" start="103">and</span><span class="whitespace" start="106"> </span><span class="variable" start="107" select="quick">$object</span><span class="step" start="114">/</span><span class="axis" start="115">@</span><span class="qname" start="116" select="quick">role</span><span class="op" start="120">=</span><span class="op">'</span><span class="literal" start="121">tex</span><span class="op">'</span><span class="whitespace" start="126">
                          </span><span class="op" start="153">and</span><span class="whitespace" start="156"> </span><span class="variable" start="157" select="quick">$stylesheet.result.type</span><span class="whitespace" start="180"> </span><span class="op" start="181">=</span><span class="whitespace" start="182"> </span><span class="op">'</span><span class="literal" start="183">fo</span><span class="op">'</span><span class="whitespace" start="187">
                          </span><span class="op" start="214">and</span><span class="whitespace" start="217"> </span><span class="variable" start="218" select="quick">$tex.math.in.alt</span><span class="whitespace" start="234"> </span><span class="op" start="235">!=</span><span class="whitespace" start="237"> </span><span class="op">'</span><span class="literal" start="238"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

          </span><span class="z">&lt;!--</span><span class="cm"> Otherwise, phrase is never used </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="axis" start="9">self::</span><span class="qname" start="15" select="quick">db:textobject</span><span class="whitespace" start="28"> </span><span class="op" start="29">and</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$object</span><span class="step" start="40">/</span><span class="qname" start="41" select="quick">db:phrase</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

          </span><span class="z">&lt;!--</span><span class="cm"> The first textobject is a reasonable fallback </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="axis" start="9">self::</span><span class="qname" start="15" select="quick">db:textobject</span><span class="whitespace" start="28">
                          </span><span class="op" start="55">and</span><span class="whitespace" start="58"> </span><span class="variable" start="59" select="quick">$object</span><span class="filter" start="66" pair-end="95" select="quick">[</span><span class="function" start="67" pair-end="76" select="quick">not</span><span class="parenthesis">(</span><span class="axis" start="71">@</span><span class="qname" start="72" select="quick">role</span><span class="parenthesis" start="76">)</span><span class="whitespace" start="77"> </span><span class="op" start="78">or</span><span class="whitespace" start="80"> </span><span class="axis" start="81">@</span><span class="qname" start="82" select="quick">role</span><span class="whitespace" start="86"> </span><span class="op" start="87">!=</span><span class="whitespace" start="89"> </span><span class="op">'</span><span class="literal" start="90">tex</span><span class="op">'</span><span class="filter" start="95">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

          </span><span class="z">&lt;!--</span><span class="cm"> don't use graphic when output is FO, TeX Math is used
               and there is math in alt element </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="axis" start="9">ancestor::</span><span class="qname" start="19" select="quick">db:equation</span><span class="whitespace" start="30">
                          </span><span class="op" start="57">and</span><span class="whitespace" start="60"> </span><span class="variable" start="61" select="quick">$object</span><span class="step" start="68">/</span><span class="axis" start="69">ancestor::</span><span class="qname" start="79" select="quick">db:equation</span><span class="step" start="90">/</span><span class="qname" start="91" select="quick">db:alt</span><span class="filter" start="97" pair-end="109" select="quick">[</span><span class="axis" start="98">@</span><span class="qname" start="99" select="quick">role</span><span class="op" start="103">=</span><span class="op">'</span><span class="literal" start="104">tex</span><span class="op">'</span><span class="filter" start="109">]</span><span class="whitespace" start="110">
                          </span><span class="op" start="137">and</span><span class="whitespace" start="140"> </span><span class="variable" start="141" select="quick">$stylesheet.result.type</span><span class="whitespace" start="164"> </span><span class="op" start="165">=</span><span class="whitespace" start="166"> </span><span class="op">'</span><span class="literal" start="167">fo</span><span class="op">'</span><span class="whitespace" start="171">
                          </span><span class="op" start="198">and</span><span class="whitespace" start="201"> </span><span class="variable" start="202" select="quick">$tex.math.in.alt</span><span class="whitespace" start="218"> </span><span class="op" start="219">!=</span><span class="whitespace" start="221"> </span><span class="op">'</span><span class="literal" start="222"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

          </span><span class="z">&lt;!--</span><span class="cm"> If there's only one object, use it </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$count</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="whitespace" start="11"> </span><span class="op" start="12">and</span><span class="whitespace" start="15"> </span><span class="function" start="16" pair-end="28" select="quick">count</span><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$olist</span><span class="parenthesis" start="28">)</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="numeric" start="32">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

          </span><span class="z">&lt;!--</span><span class="cm"> Otherwise, see if this one is a useable graphic </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="z">&lt;!--</span><span class="cm"> peek inside imageobjectco to simplify the test </span><span class="z">--&gt;</span><span class="txt">
              </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="axis" start="9">self::</span><span class="qname" start="15" select="quick">db:imageobjectco</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">f:is-acceptable-mediaobject</span><span class="whitespace" start="28">
                                      </span><span class="parenthesis" start="67" pair-end="90" select="quick">(</span><span class="variable" start="68" select="quick">$object</span><span class="step" start="75">/</span><span class="qname" start="76" select="quick">db:imageobject</span><span class="parenthesis" start="90">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
              </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="36" select="quick">f:is-acceptable-mediaobject</span><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$object</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$useobject</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">0</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$count</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">

        </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="45" select="quick">fp:select-mediaobject-index</span><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$olist</span><span class="op" start="35">,</span><span class="whitespace" start="36"> </span><span class="variable" start="37" select="quick">$count</span><span class="op" start="43">+</span><span class="numeric" start="44">1</span><span class="parenthesis" start="45">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">f:is-acceptable-mediaobject</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Returns '1' if the specified media object is recognized.</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template examines a media object and returns '1' if the
object is recognized as a graphic.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">object</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The media object to consider.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">0 or 1</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">f:is-acceptable-mediaobject</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">object</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">filename</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="31" select="quick">f:mediaobject-filename</span><span class="parenthesis">(</span><span class="variable" start="24" select="quick">$object</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">ext</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="31" select="quick">f:filename-extension</span><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$filename</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">data</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="qname" start="9" select="quick">db:videodata</span><span class="whitespace" start="21">
                                    </span><span class="op" start="58">|</span><span class="variable" start="59" select="quick">$object</span><span class="step" start="66">/</span><span class="qname" start="67" select="quick">db:imagedata</span><span class="whitespace" start="79">
                                    </span><span class="op" start="116">|</span><span class="variable" start="117" select="quick">$object</span><span class="step" start="124">/</span><span class="qname" start="125" select="quick">db:audiodata</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">explicit-format</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="25" select="quick">lower-case</span><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$data</span><span class="step" start="17">/</span><span class="axis" start="18">@</span><span class="qname" start="19" select="quick">format</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">format</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns:svg</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2000/svg</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="21" select="quick">(</span><span class="variable" start="5" select="quick">$explicit-format</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22">
                        </span><span class="op" start="47">then</span><span class="whitespace" start="51"> </span><span class="variable" start="52" select="quick">$explicit-format</span><span class="whitespace" start="68">
                        </span><span class="op" start="93">else</span><span class="whitespace" start="97">
                          </span><span class="if" start="124">if</span><span class="whitespace" start="126"> </span><span class="parenthesis" start="127" pair-end="139" select="quick">(</span><span class="variable" start="128" select="quick">$data</span><span class="step" start="133">/</span><span class="qname" start="134" select="quick">svg:*</span><span class="parenthesis" start="139">)</span><span class="whitespace" start="140">
                          </span><span class="op" start="167">then</span><span class="whitespace" start="171"> </span><span class="op">'</span><span class="literal" start="172">svg</span><span class="op">'</span><span class="whitespace" start="177">
                          </span><span class="op" start="204">else</span><span class="whitespace" start="208"> </span><span class="op">'</span><span class="literal" start="209"></span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$use.svg</span><span class="whitespace" start="9"> </span><span class="op" start="10">=</span><span class="whitespace" start="11"> </span><span class="numeric" start="12">0</span><span class="whitespace" start="13"> </span><span class="op" start="14">and</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$format</span><span class="whitespace" start="25"> </span><span class="op" start="26">=</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">svg</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">xmlns:svg</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2000/svg</span><span class="z">"</span><span class="z">
              </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$use.svg</span><span class="whitespace" start="9"> </span><span class="op" start="10">!=</span><span class="whitespace" start="12"> </span><span class="numeric" start="13">0</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$format</span><span class="whitespace" start="26"> </span><span class="op" start="27">=</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">svg</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">1</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="35" select="quick">index-of</span><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$graphic.formats</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$format</span><span class="parenthesis" start="35">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">1</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="35" select="quick">index-of</span><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$graphic.extensions</span><span class="op" start="29">,</span><span class="whitespace" start="30"> </span><span class="variable" start="31" select="quick">$ext</span><span class="parenthesis" start="35">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">1</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">f:mediaobject-filename</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">object</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">data</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="qname" start="9" select="quick">db:videodata</span><span class="whitespace" start="21">
                                    </span><span class="op" start="58">|</span><span class="variable" start="59" select="quick">$object</span><span class="step" start="66">/</span><span class="qname" start="67" select="quick">db:imagedata</span><span class="whitespace" start="79">
                                    </span><span class="op" start="116">|</span><span class="variable" start="117" select="quick">$object</span><span class="step" start="124">/</span><span class="qname" start="125" select="quick">db:audiodata</span><span class="whitespace" start="137">
                                    </span><span class="op" start="174">|</span><span class="variable" start="175" select="quick">$object</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">filename</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$data</span><span class="filter" start="6" pair-end="15" select="quick">[</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">fileref</span><span class="filter" start="15">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$data</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">fileref</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$data</span><span class="filter" start="6" pair-end="17" select="quick">[</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">entityref</span><span class="filter" start="17">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$data</span><span class="step" start="6">/</span><span class="function" start="7" pair-end="43" select="quick">unparsed-entity-uri</span><span class="parenthesis">(</span><span class="variable" start="27" select="quick">$data</span><span class="step" start="32">/</span><span class="axis" start="33">@</span><span class="qname" start="34" select="quick">entityref</span><span class="parenthesis" start="43">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">real.ext</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="31" select="quick">f:filename-extension</span><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$filename</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">ext</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$real.ext</span><span class="whitespace" start="10"> </span><span class="op" start="11">!=</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$real.ext</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$graphic.default.extension</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$real.ext</span><span class="whitespace" start="10"> </span><span class="op" start="11">=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ext</span><span class="whitespace" start="5"> </span><span class="op" start="6">!=</span><span class="whitespace" start="8"> </span><span class="op">'</span><span class="literal" start="9"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$ext</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="40" select="quick">not</span><span class="parenthesis">(</span><span class="function" start="5" pair-end="39" select="quick">index-of</span><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$graphic.extensions</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$ext</span><span class="parenthesis" start="39">)</span><span class="parenthesis" start="40">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$graphic.default.extension</span><span class="whitespace" start="27"> </span><span class="op" start="28">!=</span><span class="whitespace" start="30"> </span><span class="op">'</span><span class="literal" start="31"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$graphic.default.extension</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">f:mediaobject-href</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">outdir</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="29" select="quick">function-available</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="20">ext:cwd</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">and</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$output.dir</span><span class="whitespace" start="46"> </span><span class="op" start="47">=</span><span class="whitespace" start="48"> </span><span class="op">'</span><span class="literal" start="49"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">use-when</span><span class="atneq">=</span><span class="z">"</span><span class="av">function-available('ext:cwd')</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="9" select="quick">ext:cwd</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">use-when</span><span class="atneq">=</span><span class="z">"</span><span class="av">not(function-available('ext:cwd'))</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$output.dir</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$output.dir</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:message&gt;
    &lt;xsl:text&gt;mediaobject-href: &lt;/xsl:text&gt;
    &lt;xsl:value-of select="$filename"/&gt;
    &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
    &lt;xsl:text&gt;against base uri: &lt;/xsl:text&gt;
    &lt;xsl:value-of select="$outdir"/&gt;
  &lt;/xsl:message&gt;
  </span><span class="z">--&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$outdir</span><span class="whitespace" start="8"> </span><span class="op" start="9">!=</span><span class="whitespace" start="11"> </span><span class="op">'</span><span class="literal" start="12"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="34" select="quick">f:relative-uri</span><span class="parenthesis">(</span><span class="variable" start="16" select="quick">$filename</span><span class="op" start="25">,</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$outdir</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">f:relative-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">absuri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">destdir</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">srcurl</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:strippath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="35" select="quick">(</span><span class="function" start="5" pair-end="34" select="quick">starts-with</span><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$absuri</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="op">'</span><span class="literal" start="26">file:/</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="parenthesis" start="35">)</span><span class="whitespace" start="36">
                              </span><span class="op" start="67">then</span><span class="whitespace" start="71"> </span><span class="function" start="72" pair-end="104" select="quick">substring-after</span><span class="parenthesis">(</span><span class="variable" start="88" select="quick">$absuri</span><span class="op" start="95">,</span><span class="whitespace" start="96"> </span><span class="op">'</span><span class="literal" start="97">file:</span><span class="op">'</span><span class="parenthesis" start="104">)</span><span class="whitespace" start="105">
                              </span><span class="op" start="136">else</span><span class="whitespace" start="140"> </span><span class="variable" start="141" select="quick">$absuri</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">srcurl.trimmed</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="42" select="quick">f:trim-common-uri-paths</span><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$srcurl</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$destdir</span><span class="parenthesis" start="42">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">destdir.trimmed</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="42" select="quick">f:trim-common-uri-paths</span><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$destdir</span><span class="op" start="33">,</span><span class="whitespace" start="34"> </span><span class="variable" start="35" select="quick">$srcurl</span><span class="parenthesis" start="42">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">depth</span><span class="z">"</span><span class="z">
                </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="47" select="quick">count</span><span class="parenthesis">(</span><span class="function" start="7" pair-end="37" select="quick">tokenize</span><span class="parenthesis">(</span><span class="variable" start="16" select="quick">$destdir.trimmed</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">/</span><span class="op">'</span><span class="parenthesis" start="37">)</span><span class="filter" start="38" pair-end="46" select="quick">[</span><span class="context" start="39">.</span><span class="whitespace" start="40"> </span><span class="op" start="41">ne</span><span class="whitespace" start="43"> </span><span class="op">'</span><span class="literal" start="44"></span><span class="op">'</span><span class="filter" start="46">]</span><span class="parenthesis" start="47">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$srcurl</span><span class="whitespace" start="8"> </span><span class="op" start="9">ne</span><span class="whitespace" start="11"> </span><span class="variable" start="12" select="quick">$srcurl.trimmed</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm"> common start of URLs was trimmed we have to 
           use ../ to reach proper level in directory structure </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="13" select="quick">(</span><span class="numeric" start="2">1</span><span class="whitespace" start="3"> </span><span class="op" start="4">to</span><span class="whitespace" start="6"> </span><span class="variable" start="7" select="quick">$depth</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">../</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span class="ec">&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">reluri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="43" select="quick">string-join</span><span class="parenthesis">(</span><span class="parenthesis" start="13" pair-end="38" select="quick">(</span><span class="variable" start="14" select="quick">$prefix</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$srcurl.trimmed</span><span class="parenthesis" start="38">)</span><span class="op" start="39">,</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41"></span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$reluri</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:xml-base-dirs</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">base.elem</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="z">&lt;!--</span><span class="cm"> Recursively resolve xml:base attributes </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$base.elem</span><span class="step" start="11">/</span><span class="axis" start="12">ancestor::</span><span class="qname" start="22" select="quick">*</span><span class="filter" start="23" pair-end="39" select="quick">[</span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">xml:base</span><span class="whitespace" start="33"> </span><span class="op" start="34">!=</span><span class="whitespace" start="36"> </span><span class="op">'</span><span class="literal" start="37"></span><span class="op">'</span><span class="filter" start="39">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:xml-base-dirs</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">base.elem</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$base.elem</span><span class="step" start="11">/</span><span class="axis" start="12">ancestor::</span><span class="qname" start="22" select="quick">*</span><span class="filter" start="23" pair-end="39" select="quick">[</span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">xml:base</span><span class="whitespace" start="33"> </span><span class="op" start="34">!=</span><span class="whitespace" start="36"> </span><span class="op">'</span><span class="literal" start="37"></span><span class="op">'</span><span class="filter" start="39">]</span><span class="filter" start="40" pair-end="42" select="quick">[</span><span class="numeric" start="41">1</span><span class="filter" start="42">]</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:getdir</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$base.elem</span><span class="step" start="11">/</span><span class="axis" start="12">@</span><span class="qname" start="13" select="quick">xml:base</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:strippath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> ./ can be ignored </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="28" select="quick">starts-with</span><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$filename</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">./</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:strippath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z">
          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="32" select="quick">substring-after</span><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$filename</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">./</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> Leading .. are not eliminated </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="29" select="quick">starts-with</span><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$filename</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">../</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">../</span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:strippath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="33" select="quick">substring-after</span><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$filename</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">../</span><span class="op">'</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="27" select="quick">contains</span><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$filename</span><span class="op" start="19">,</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">/../</span><span class="op">'</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:strippath</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:getdir</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z">
                            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="35" select="quick">substring-before</span><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$filename</span><span class="op" start="27">,</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">/../</span><span class="op">'</span><span class="parenthesis" start="35">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
          </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="34" select="quick">substring-after</span><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$filename</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">/../</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:getdir</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="24" select="quick">contains</span><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$filename</span><span class="op" start="19">,</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21">/</span><span class="op">'</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="32" select="quick">substring-before</span><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$filename</span><span class="op" start="27">,</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">/</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">/</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:getdir</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="31" select="quick">substring-after</span><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$filename</span><span class="op" start="26">,</span><span class="whitespace" start="27"> </span><span class="op">'</span><span class="literal" start="28">/</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:root-messages</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> nop </span><span class="z">--&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Returns an “id” attribute if appropriate</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template returns an attribute named “id” if the specified
node has an </span><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">id</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt">
(or </span><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">xml:id</span><span class="ez">&lt;/</span><span class="cl">tag</span><span class="ec">&gt;</span><span class="txt">) attribute or if the
</span><span class="es">&lt;</span><span class="en">parameter</span><span class="scx">&gt;</span><span class="txt">force</span><span class="ez">&lt;/</span><span class="cl">parameter</span><span class="ec">&gt;</span><span class="txt"> parameter is non-zero.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If an ID is generated, it's value is </span><span class="es">&lt;</span><span class="en">function</span><span class="scx">&gt;</span><span class="txt">f:node-id()</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt">.
</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">node</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The node for which an ID should be generated. It defaults to
the context item.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">force</span><span class="ez">&lt;/</span><span class="cl">term</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">To force an “id” attribute to be generated, even if the node does
not have an ID, make this parameter non-zero. It defaults to 0.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">listitem</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">An “id” attribute or nothing.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span class="ec">&gt;</span><span class="txt">

</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:id</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute(id)?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">force</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="13" select="quick">(</span><span class="variable" start="2" select="quick">$force</span><span class="whitespace" start="8"> </span><span class="op" start="9">!=</span><span class="whitespace" start="11"> </span><span class="numeric" start="12">0</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><span class="parenthesis" start="18" pair-end="45" select="quick">(</span><span class="variable" start="19" select="quick">$node</span><span class="step" start="24">/</span><span class="axis" start="25">@</span><span class="qname" start="26" select="quick">id</span><span class="whitespace" start="28"> </span><span class="op" start="29">or</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$node</span><span class="step" start="37">/</span><span class="axis" start="38">@</span><span class="qname" start="39" select="quick">xml:id</span><span class="parenthesis" start="45">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="16" select="quick">f:node-id</span><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$node</span><span class="parenthesis" start="16">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="z">&lt;!--</span><span class="cm"> ====================================================================== </span><span class="z">--&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:check-id-unique</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Warn users about references to non-unique IDs</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">check.id.unique-desc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If passed an ID in </span><span class="es">&lt;</span><span class="en">varname</span><span class="scx">&gt;</span><span class="txt">linkend</span><span class="ez">&lt;/</span><span class="cl">varname</span><span class="ec">&gt;</span><span class="txt">,
</span><span class="es">&lt;</span><span class="en">function</span><span class="scx">&gt;</span><span class="txt">t:check-id-unique</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt"> prints
a warning message to the user if either the ID does not exist or
the ID is not unique.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:check-id-unique</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">linkend</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linkend</span><span class="whitespace" start="9"> </span><span class="op" start="10">!=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">targets</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="18" select="quick">key</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="5">id</span><span class="op">'</span><span class="op" start="9">,</span><span class="variable" start="10" select="quick">$linkend</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

    </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="13" select="quick">not</span><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$targets</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">Error: no ID for constraint linkend: </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linkend</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">

    </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="15" select="quick">count</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$targets</span><span class="parenthesis" start="15">)</span><span class="whitespace" start="16"> </span><span class="qname" start="17" select="quick">&amp;</span><span class="op" start="18">gt</span><span class="qname" start="20" select="quick">;</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">Warning: multiple "IDs" for constraint linkend: </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linkend</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">.</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:check-idref-targets</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Warn users about incorrectly typed references</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">refdescription</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">check.idref.targets-desc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If passed an ID in </span><span class="es">&lt;</span><span class="en">varname</span><span class="scx">&gt;</span><span class="txt">linkend</span><span class="ez">&lt;/</span><span class="cl">varname</span><span class="ec">&gt;</span><span class="txt">,
</span><span class="es">&lt;</span><span class="en">function</span><span class="scx">&gt;</span><span class="txt">t:check-idref-targets</span><span class="ez">&lt;/</span><span class="cl">function</span><span class="ec">&gt;</span><span class="txt"> makes sure that the element
pointed to by the link is one of the elements listed in
</span><span class="es">&lt;</span><span class="en">varname</span><span class="scx">&gt;</span><span class="txt">element-list</span><span class="ez">&lt;/</span><span class="cl">varname</span><span class="ec">&gt;</span><span class="txt"> and warns the user otherwise.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The </span><span class="es">&lt;</span><span class="en">varname</span><span class="scx">&gt;</span><span class="txt">element-list</span><span class="ez">&lt;/</span><span class="cl">varname</span><span class="ec">&gt;</span><span class="txt"> is a list of QNames.</span><span class="ez">&lt;/</span><span class="cl">para</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname">t:check-idref-targets</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">linkend</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
  </span><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">element-list</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName*</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

  </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linkend</span><span class="whitespace" start="9"> </span><span class="op" start="10">!=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname">targets</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="18" select="quick">key</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="5">id</span><span class="op">'</span><span class="op" start="9">,</span><span class="variable" start="10" select="quick">$linkend</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">

    </span><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$targets</span><span class="whitespace" start="9">
                  </span><span class="op" start="28">and</span><span class="whitespace" start="31"> </span><span class="type" start="32">empty</span><span class="parenthesis">(</span><span class="function" start="38" pair-end="83" select="quick">index-of</span><span class="parenthesis">(</span><span class="variable" start="47" select="quick">$element-list</span><span class="op" start="60">,</span><span class="function" start="61" pair-end="82" select="quick">node-name</span><span class="parenthesis">(</span><span class="variable" start="71" select="quick">$targets</span><span class="filter" start="79" pair-end="81" select="quick">[</span><span class="numeric" start="80">1</span><span class="filter" start="81">]</span><span class="parenthesis" start="82">)</span><span class="parenthesis" start="83">)</span><span class="parenthesis" start="84">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">Error: linkend (</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linkend</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">) points to "</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="23" select="quick">local-name</span><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$targets</span><span class="filter" start="20" pair-end="22" select="quick">[</span><span class="numeric" start="21">1</span><span class="filter" start="22">]</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">" not (one of): </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span class="ec">&gt;</span><span class="txt">
        </span><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$element-list</span><span class="z">"</span><span class="z"> </span><span class="atn">separator</span><span class="atneq">=</span><span class="z">"</span><span class="av">, </span><span class="z">"</span><span class="sc">/&gt;</span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span class="ec">&gt;</span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span class="ec">&gt;</span><span class="txt">
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span class="ec">&gt;</span><span class="txt">

</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span class="ec">&gt;</span><span class="txt">
</span></p></div></body></html>