<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>verbatim-patch.xsl</title><link rel="stylesheet" type="text/css" href="../../../theme.css"></head><body><div><p class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="ww" id="w5"><span class="es">&lt;</span><a class="solar" href="../../../index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:db</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:doc</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://nwalsh.com/xsl/documentation/1.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/extension</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:fp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/extension</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:ghost</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook/ephemeral</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:h</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:m</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/mode</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:mp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/mode/private</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:t</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/template</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:tp</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/template/private</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:u</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://nwalsh.com/xsl/unittests#</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">db doc f fp ghost h m mp t tp u xs</span><span class="z">"</span><span class="z">
                </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  
  
  </span><span class="ww" id="w105"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}verbatim-patch-html">t:verbatim-patch-html</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w115"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?content">content</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx129" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w131"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?areas">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx145" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w147"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?everyNth">everyNth</span><span class="z">"</span><span class="z">  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">everyNth</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx168" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w170"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?width">width</span><span class="z">"</span><span class="z">     </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">width</span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx191" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w193"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padchar">padchar</span><span class="z">"</span><span class="z">   </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="28" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">padchar</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx214" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w216"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?separator">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="30" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">separator</span><span class="op">'</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx237" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w239"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?minlines">minlines</span><span class="z">"</span><span class="z">  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}lineNumbering" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:lineNumbering</span></a><span class="parenthesis">(</span><span class="context" start="17">.</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19">minlines</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx260" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w262"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-empty-tags">pl-empty-tags</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w278"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span id="wx292" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx296" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;
    &lt;EMPTY&gt;
    &lt;xsl:copy-of select="$pl-empty-tags"/&gt;
    &lt;/EMPTY&gt;
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w302"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-lb">pl-no-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w318"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-empty-tags</span><span class="z">"</span><span class="z">
                           </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span id="wx332" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx336" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;
    &lt;NOLB&gt;
    &lt;xsl:copy-of select="$pl-no-lb"/&gt;
    &lt;/NOLB&gt;
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w342"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-wrap-lb">pl-no-wrap-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w358"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w368"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="20" select="quick">xs:QName</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="10">ghost:br</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span id="wx387" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w389"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-lb</span><span class="z">"</span><span id="wx403" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx407" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx411" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;NOWRAPLB&lt;/xsl:message&gt;
    &lt;xsl:for-each select="$pl-no-wrap-lb"&gt;
    &lt;xsl:message&gt;&lt;xsl:sequence select="."/&gt;&lt;/xsl:message&gt;
    &lt;/xsl:for-each&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w417"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-lines">pl-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w433"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}wrap-lines" class="solar"><span class="tcall">tp:wrap-lines</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w443"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-wrap-lb</span><span class="z">"</span><span id="wx457" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx461" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx465" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;
    &lt;LINES&gt;
    &lt;xsl:copy-of select="$pl-lines"/&gt;
    &lt;/LINES&gt;
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w471"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-callouts">pl-callouts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w487"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-callouts</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w503"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="z">"</span><span id="wx517" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx521" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx525" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;
    &lt;PL-LINES&gt;
    &lt;xsl:copy-of select="$pl-callouts"/&gt;
    &lt;/PL-LINES&gt;
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w531"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-removed-lines">pl-removed-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w547"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w551"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$everyNth</span><span class="whitespace" start="10"> </span><span class="qname" start="11" select="quick">&amp;</span><span class="op" start="12">gt</span><span class="qname" start="14" select="quick">;</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">0</span><span class="whitespace" start="17">
                        </span><span class="op" start="33">and</span><span class="whitespace" start="36"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="37" pair-end="52" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="43" select="quick">$pl-lines</span><span class="parenthesis" start="52">)</span><span class="whitespace" start="53"> </span><span class="qname" start="54" select="quick">&amp;</span><span class="op" start="55">gt</span><span class="qname" start="57" select="quick">;</span><span class="op" start="58">=</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$minlines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w581"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-callouts</span><span class="z">"</span><span class="z">
                               </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-restore-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w597"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">everyNth</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$everyNth</span><span class="z">"</span><span id="wx611" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w613"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width</span><span class="z">"</span><span id="wx627" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w629"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx643" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w645"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">padchar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padchar</span><span class="z">"</span><span id="wx659" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w661"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx675" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx679" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx683" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w685"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w689"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-callouts</span><span class="z">"</span><span class="z">
                               </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-restore-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w705"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">everyNth</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx719" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w721"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width</span><span class="z">"</span><span id="wx735" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w737"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx751" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w753"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">padchar</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$padchar</span><span class="z">"</span><span id="wx767" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w769"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx783" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx787" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx791" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx795" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx799" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;
    &lt;REMOVEDLINES&gt;
    &lt;xsl:copy-of select="$pl-removed-lines"/&gt;
    &lt;/REMOVEDLINES&gt;
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> put the lines into a tree so that we can use preceding:: to look for ID values </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w809"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?content-tree">content-tree</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w825"><span class="es">&lt;</span><span class="en">irrelevant</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> expand any embedded ghost:co elements, as appropriate </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w833"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-removed-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w849"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">origpl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx863" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx867" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">irrelevant</span><span id="wx871" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx875" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w877"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result">result</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w893"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content-tree</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span id="wx907" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx911" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;
    &lt;RESULT&gt;
    &lt;xsl:sequence select="$result"/&gt;
    &lt;/RESULT&gt;
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> don't return the ghost:tree </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w921"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$result</span><span class="step" start="8">/</span><span class="node" start="9" pair-end="14" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span id="wx933" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx937" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w943"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:co</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w959"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xml:id</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w970"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xml:id</span><span class="op">}</span><span class="z">"</span><span id="wx981" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx985" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w987"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/callouts.xsl.html#t?{http://docbook.org/xslt/ns/template}callout-bug" class="solar"><span class="tcall">t:callout-bug</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w997"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">conum</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1007"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1011"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">number</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1022"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">number</span><span class="z">"</span><span id="wx1031" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1035" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1037"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1041"><span class="es">&lt;</span><span class="enxsl">xsl:number</span><span class="z"> </span><span class="atn">count</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:co</span><span class="z">"</span><span class="z">
                        </span><span class="atn">level</span><span class="atneq">=</span><span class="z">"</span><span class="av">any</span><span class="z">"</span><span class="z">
                        </span><span class="atn">from</span><span class="atneq">=</span><span class="z">"</span><span class="av">db:programlisting|db:screen|db:literallayout|db:synopsis</span><span class="z">"</span><span class="z">
                        </span><span class="atn">format</span><span class="atneq">=</span><span class="z">"</span><span class="av">1</span><span class="z">"</span><span id="wx1067" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1071" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1075" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span id="wx1079" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1083" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1087" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1089"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1105"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?origpl">origpl</span><span class="z">"</span><span id="wx1113" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1115"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1119"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx1128" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1130"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1140"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">origpl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$origpl</span><span class="z">"</span><span id="wx1154" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx1158" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx1162" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1166" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1168"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="op" start="35">|</span><span class="node" start="36" pair-end="41" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="z">
                </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:expand-ghost-co</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1194"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx1196" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1200" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm">
  &lt;xsl:template match="ghost:tree" mode="mp:remove-ghost-tree"&gt;
  &lt;xsl:apply-templates mode="mp:remove-ghost-tree"/&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="*" mode="mp:remove-ghost-tree"&gt;
  &lt;xsl:copy&gt;
  &lt;xsl:copy-of select="@*"/&gt;
  &lt;xsl:apply-templates mode="mp:remove-ghost-tree"/&gt;
  &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="comment()|processing-instruction()|text()"
  mode="mp:remove-ghost-tree"&gt;
  &lt;xsl:copy/&gt;
  &lt;/xsl:template&gt;
  </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w1214"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1230"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?id">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">id</span><span class="z">"</span><span id="wx1245" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1247"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">namespace</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="1" pair-end="16" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="context" start="15">.</span><span class="parenthesis" start="16">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1273"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="filter" start="3" pair-end="113" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="4" pair-end="10" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">id</span><span class="op">'</span><span class="whitespace" start="19">
                           </span><span class="op" start="48">and</span><span class="whitespace" start="51"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="52" pair-end="67" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="context" start="66">.</span><span class="parenthesis" start="67">)</span><span class="whitespace" start="68"> </span><span class="op" start="69">!=</span><span class="whitespace" start="71"> </span><span class="op">'</span><span class="literal" start="72">http://docbook.org/ns/docbook/ephemeral</span><span class="op">'</span><span class="filter" start="113">]</span><span class="z">"</span><span id="wx1307" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1309"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">id</span><span class="whitespace" start="4"> </span><span class="op" start="5">and</span><span class="whitespace" start="8"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="9" pair-end="36" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="13">preceding::</span><span class="qname" start="24" select="quick">*</span><span class="filter" start="25" pair-end="35" select="quick">[</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">id</span><span class="whitespace" start="29"> </span><span class="op" start="30">=</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$id</span><span class="filter" start="35">]</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1336"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$id</span><span class="z">"</span><span id="wx1350" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1354" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w1356"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span id="wx1364" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx1368" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1372" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1374"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="op" start="35">|</span><span class="node" start="36" pair-end="41" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="z">
                </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-cleanup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1400"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx1402" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1406" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w1412"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{http://docbook.org/xslt/ns/extension}lastLineNumber">f:lastLineNumber</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:decimal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1428"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?listing">listing</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx1442" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1444"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?startnum">startnum</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:decimal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1460"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1464"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$listing</span><span class="step" start="9">/</span><span class="axis" start="10">@</span><span class="qname" start="11" select="quick">continuation</span><span class="whitespace" start="23"> </span><span class="op" start="24">!=</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">continues</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1483"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx1491" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1495" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1497"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1501"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev">prev</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$listing</span><span class="step" start="9">/</span><span class="axis" start="10">preceding::</span><span class="qname" start="21" select="quick">*</span><span class="filter" start="22" pair-end="55" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="23" pair-end="34" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="context" start="33">.</span><span class="parenthesis" start="34">)</span><span class="op" start="35">=</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="36" pair-end="54" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="46" select="quick">$listing</span><span class="parenthesis" start="54">)</span><span class="filter" start="55">]</span><span class="filter" start="56" pair-end="58" select="quick">[</span><span class="numeric" start="57">1</span><span class="filter" start="58">]</span><span class="z">"</span><span id="wx1532" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1534"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1538"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$prev</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1551"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx1559" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1563" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1565"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1569"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}lastLineNumber" class="solar"><span class="function" start="1" pair-end="23" select="quick">f:lastLineNumber</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$prev</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx1580" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1584" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1588" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1592" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1596" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1600" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1602"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?expanded-text">expanded-text</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1618"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$listing</span><span class="step" start="9">/</span><span class="node" start="10" pair-end="15" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1632"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1636"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">self::</span><span class="qname" start="7" select="quick">db:inlinemediaobject</span><span class="whitespace" start="27">
                          </span><span class="op" start="31">and</span><span class="whitespace" start="34"> </span><span class="qname" start="35" select="quick">db:textobject</span><span class="step" start="48">/</span><span class="qname" start="49" select="quick">db:textdata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1653"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1661" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1665" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1667"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">self::</span><span class="qname" start="7" select="quick">db:textobject</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><span class="qname" start="25" select="quick">db:textdata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1682"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1690" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1694" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1696"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1700"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx1708" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1712" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1716" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx1720" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1724" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1726"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-empty-tags">pl-empty-tags</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1742"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$expanded-text</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span id="wx1756" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1760" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1762"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-lb">pl-no-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1778"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-empty-tags</span><span class="z">"</span><span class="z">
                           </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span id="wx1792" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1796" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1798"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-no-wrap-lb">pl-no-wrap-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1814"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1824"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="20" select="quick">xs:QName</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="10">ghost:br</span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="z">"</span><span id="wx1843" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1845"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-lb</span><span class="z">"</span><span id="wx1859" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1863" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1867" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1869"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pl-lines">pl-lines</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1885"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}wrap-lines" class="solar"><span class="tcall">tp:wrap-lines</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1895"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pl-no-wrap-lb</span><span class="z">"</span><span id="wx1909" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1913" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1917" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1919"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="16" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$pl-lines</span><span class="parenthesis" start="16">)</span><span class="z">"</span><span id="wx1930" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1934" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1936"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-restore-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1952"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?everyNth">everyNth</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1966" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1968"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?width">width</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1982" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1984"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?padchar">padchar</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1998" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2000"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?separator">separator</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2014" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2016"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?element">element</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2036" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2038"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?startnum">startnum</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:decimal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2054"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2058"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="27" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$element</span><span class="step" start="13">/</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">continuation</span><span class="parenthesis" start="27">)</span><span class="whitespace" start="28">
                        </span><span class="op" start="51">or</span><span class="whitespace" start="53"> </span><span class="variable" start="54" select="quick">$element</span><span class="step" start="62">/</span><span class="axis" start="63">@</span><span class="qname" start="64" select="quick">continuation</span><span class="whitespace" start="76"> </span><span class="op" start="77">!=</span><span class="whitespace" start="79"> </span><span class="op">'</span><span class="literal" start="80">continues</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2087"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx2095" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2099" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2101"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2105"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev">prev</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$element</span><span class="step" start="9">/</span><span class="axis" start="10">preceding::</span><span class="qname" start="21" select="quick">*</span><span class="filter" start="22" pair-end="55" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="23" pair-end="34" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="context" start="33">.</span><span class="parenthesis" start="34">)</span><span class="op" start="35">=</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="36" pair-end="54" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="46" select="quick">$element</span><span class="parenthesis" start="54">)</span><span class="filter" start="55">]</span><span class="filter" start="56" pair-end="58" select="quick">[</span><span class="numeric" start="57">1</span><span class="filter" start="58">]</span><span class="z">"</span><span id="wx2136" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2138"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2142"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$prev</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2155"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx2163" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2167" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2169"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2173"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}lastLineNumber" class="solar"><span class="function" start="1" pair-end="23" select="quick">f:lastLineNumber</span></a><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$prev</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx2184" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2188" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2192" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2196" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2200" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2204" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2206"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?linenumber">linenumber</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="1" pair-end="10" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">+</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$startnum</span><span class="z">"</span><span id="wx2226" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2228"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$everyNth</span><span class="whitespace" start="10"> </span><span class="qname" start="11" select="quick">&amp;</span><span class="op" start="12">gt</span><span class="qname" start="14" select="quick">;</span><span class="whitespace" start="15"> </span><span class="numeric" start="16">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2244"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2248"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linenumber</span><span class="whitespace" start="12"> </span><span class="op" start="13">=</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="whitespace" start="16">
                        </span><span class="op" start="25">or</span><span class="whitespace" start="27"> </span><span class="variable" start="28" select="quick">$linenumber</span><span class="whitespace" start="39"> </span><span class="op" start="40">mod</span><span class="whitespace" start="43"> </span><span class="variable" start="44" select="quick">$everyNth</span><span class="whitespace" start="53"> </span><span class="op" start="54">=</span><span class="whitespace" start="55"> </span><span class="numeric" start="56">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2274"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?numwidth">numwidth</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="34" select="quick">string-length</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="15" pair-end="33" select="quick">string</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$linenumber</span><span class="parenthesis" start="33">)</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx2294" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2296"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2306"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$numwidth</span><span class="whitespace" start="10"> </span><span class="qname" start="11" select="quick">&amp;</span><span class="op" start="12">lt</span><span class="qname" start="14" select="quick">;</span><span class="whitespace" start="15"> </span><span class="variable" start="16" select="quick">$width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2322"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pad" class="solar"><span class="function" start="1" pair-end="47" select="quick">f:pad</span></a><span class="parenthesis">(</span><span class="function" start="7" pair-end="36" select="quick">xs:integer</span><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$width</span><span class="whitespace" start="24"> </span><span class="op" start="25">-</span><span class="whitespace" start="26"> </span><span class="variable" start="27" select="quick">$numwidth</span><span class="parenthesis" start="36">)</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="variable" start="39" select="quick">$padchar</span><span class="parenthesis" start="47">)</span><span class="z">"</span><span id="wx2343" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2347" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2349"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$linenumber</span><span class="z">"</span><span id="wx2357" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2361" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2363"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2379"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber-separator</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2389"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx2397" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2401" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2405" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2409" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2411"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2415"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2425"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pad" class="solar"><span class="function" start="1" pair-end="23" select="quick">f:pad</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$width</span><span class="op" start="13">,</span><span class="whitespace" start="14"> </span><span class="variable" start="15" select="quick">$padchar</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx2439" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2443" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2445"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2461"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">linenumber-separator</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2471"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$separator</span><span class="z">"</span><span id="wx2479" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2483" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2487" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2491" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2495" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2499" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2501"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2505"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:end</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2515"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}restore-content" class="solar"><span class="tcall">t:restore-content</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2525"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx2541" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2545" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2549" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2551"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2555"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx2565" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2569" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2573" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2575"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="1" pair-end="10" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="qname" start="12" select="quick">&amp;</span><span class="op" start="13">lt</span><span class="qname" start="15" select="quick">;</span><span class="whitespace" start="16"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="17" pair-end="22" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2595"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">&amp;#10;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx2601" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2605" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2609" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w2615"><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:restore-content</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2631"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Restores content to empty elements.</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx2637" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2639"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2643"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template reverses the flattening process performed by
        the </span><span class="ww" id="w2647"><span class="es">&lt;</span><span class="en">code</span><span class="scx">&gt;</span><span class="txt">m:patch-empty-elements</span><span class="ez">&lt;/</span><span class="cl">code</span><span id="wx2653" class="ec">&gt;</span></span><span class="txt"> mode. It replaces pairs of
        empty elements and their corresponding </span><span class="ww" id="w2655"><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">ghost:end</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx2661" class="ec">&gt;</span></span><span class="txt">s with 
      an element that has content.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx2665" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx2669" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2671"><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2675"><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2679"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w2683"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">nodes</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx2689" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2691"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2695"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The sequence of nodes containing empty elements.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx2701" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx2705" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx2709" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span id="wx2713" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span id="wx2717" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2719"><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2723"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The nodes with content restored.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx2729" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span id="wx2733" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span id="wx2737" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w2739"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}restore-content">t:restore-content</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2749"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx2765" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2767"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?mark">mark</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="17" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">ghost:id</span><span class="filter" start="17">]</span><span class="filter" start="18" pair-end="20" select="quick">[</span><span class="numeric" start="19">1</span><span class="filter" start="20">]</span><span class="z">"</span><span id="wx2788" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> FIXME: I totally do not understand why straight-up node comparisons fail here.
    So I'm stepping back to comparing sequences of atomic values created
    with generate-id(). </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w2794"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2798"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="10" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$mark</span><span class="parenthesis" start="10">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2811"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx2819" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2823" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w2825"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2829"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?precmarkids">precmarkids</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$node" class="variable" start="5" select="quick">$node</span><span class="whitespace" start="10"> </span><span class="op" start="11">in</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$mark</span><span class="step" start="19">/</span><span class="axis" start="20">preceding-sibling::</span><span class="node" start="39" pair-end="44" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="44">)</span><span class="whitespace" start="45"> </span><span class="op" start="46">return</span><span class="whitespace" start="52"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="53" pair-end="70" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="variable" start="65" select="quick">$node</span><span class="parenthesis" start="70">)</span><span class="z">"</span><span id="wx2861" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2863"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="37" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="8" pair-end="21" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="context" start="20">.</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">=</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$precmarkids</span><span class="filter" start="37">]</span><span class="z">"</span><span id="wx2881" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2883"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?follmarkids">follmarkids</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$node" class="variable" start="5" select="quick">$node</span><span class="whitespace" start="10"> </span><span class="op" start="11">in</span><span class="whitespace" start="13"> </span><span class="parenthesis" start="14" pair-end="53" select="quick">(</span><span class="variable" start="15" select="quick">$mark</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$mark</span><span class="step" start="27">/</span><span class="axis" start="28">following-sibling::</span><span class="node" start="47" pair-end="52" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="52">)</span><span class="parenthesis" start="53">)</span><span class="whitespace" start="54"> </span><span class="op" start="55">return</span><span class="whitespace" start="61"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="62" pair-end="79" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="variable" start="74" select="quick">$node</span><span class="parenthesis" start="79">)</span><span class="z">"</span><span id="wx2920" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2922"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?rest">rest</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="37" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="8" pair-end="21" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="context" start="20">.</span><span class="parenthesis" start="21">)</span><span class="whitespace" start="22"> </span><span class="op" start="23">=</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$follmarkids</span><span class="filter" start="37">]</span><span class="z">"</span><span id="wx2946" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2948"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?id">id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$mark</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">ghost:id</span><span class="z">"</span><span id="wx2965" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2967"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?end">end</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$rest</span><span class="filter" start="6" pair-end="34" select="quick">[</span><span class="axis" start="7">self::</span><span class="qname" start="13" select="quick">ghost:end</span><span class="filter" start="22" pair-end="33" select="quick">[</span><span class="axis" start="23">@</span><span class="qname" start="24" select="quick">idref</span><span class="op" start="29">=</span><span class="variable" start="30" select="quick">$id</span><span class="filter" start="33">]</span><span class="filter" start="34">]</span><span class="z">"</span><span id="wx2991" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="z">&lt;!--</span><span class="cm">
        &lt;xsl:message&gt;
        &lt;xsl:text&gt;Restore &lt;/xsl:text&gt;
        &lt;xsl:value-of select="$id"/&gt;
        &lt;xsl:text&gt;, &lt;/xsl:text&gt;
        &lt;xsl:value-of select="count($end)"/&gt;
        &lt;/xsl:message&gt;
        </span><span class="z">--&gt;</span><span class="txt">
        
        </span><span class="ww" id="w2997"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?endpos">endpos</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}find-node-in-sequence" class="solar"><span class="function" start="1" pair-end="39" select="quick">f:find-node-in-sequence</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$rest</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$end</span><span class="op" start="36">,</span><span class="whitespace" start="37"> </span><span class="numeric" start="38">2</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx3020" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3022"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="11" select="quick">name</span></a><span class="parenthesis">(</span><span class="variable" start="6" select="quick">$mark</span><span class="parenthesis" start="11">)</span><span class="op">}</span><span class="z">"</span><span class="z">
                     </span><span class="atn">namespace</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="1" pair-end="20" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$mark</span><span class="parenthesis" start="20">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3048"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$mark</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">*</span><span class="z">"</span><span id="wx3059" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3061"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}restore-content" class="solar"><span class="tcall">t:restore-content</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3071"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z">
                            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function" start="1" pair-end="34" select="quick">subsequence</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$rest</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="numeric" start="20">2</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$endpos</span><span class="whitespace" start="30"> </span><span class="op" start="31">-</span><span class="whitespace" start="32"> </span><span class="numeric" start="33">2</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx3098" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3102" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx3106" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3108"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}restore-content" class="solar"><span class="tcall">t:restore-content</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3118"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-subsequence" class="solar"><span class="function" start="1" pair-end="29" select="quick">subsequence</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$rest</span><span class="op" start="18">,</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$endpos</span><span class="op" start="27">+</span><span class="numeric" start="28">1</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx3140" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3144" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3148" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3152" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3156" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w3162"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-callouts</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3178"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?areas">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3192" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3194"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?linenumber">linenumber</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="1" pair-end="10" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="10">)</span><span class="z">"</span><span id="wx3210" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3212"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3216"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="33" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">ghost:line</span><span class="whitespace" start="19"> </span><span class="op" start="20">=</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$linenumber</span><span class="filter" start="33">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3234"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallouts" class="solar"><span class="tcall">tp:addcallouts</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3244"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="33" select="quick">[</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">ghost:line</span><span class="whitespace" start="19"> </span><span class="op" start="20">=</span><span class="whitespace" start="21"> </span><span class="variable" start="22" select="quick">$linenumber</span><span class="filter" start="33">]</span><span class="z">"</span><span id="wx3266" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3268"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3282" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3286" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3290" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3292"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3296"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx3304" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3308" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3312" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3316" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3318"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}addcallouts">tp:addcallouts</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3328"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?areas">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(db:area)*</span><span class="z">"</span><span id="wx3342" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3344"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?line">line</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)</span><span class="z">"</span><span id="wx3358" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3360"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?newline">newline</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(ghost:line)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3376"><span class="es">&lt;</span><span class="en">ghost:line</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3380"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3390"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span id="wx3407" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3409"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$line</span><span class="step" start="6">/</span><span class="node" start="7" pair-end="12" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span id="wx3427" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3431" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">ghost:line</span><span id="wx3435" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3439" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3441"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3445"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="13" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$areas</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="numeric" start="17">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3462"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newline</span><span class="z">"</span><span id="wx3470" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3474" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3476"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3480"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallouts" class="solar"><span class="tcall">tp:addcallouts</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3490"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">areas</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$areas</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx3515" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3517"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$newline</span><span class="z">"</span><span id="wx3531" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3535" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3539" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3543" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3547" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3549"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}addcallout">tp:addcallout</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3559"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?area">area</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(db:area)</span><span class="z">"</span><span id="wx3573" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3575"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx3589" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3591"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?pos">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx3611" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3613"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3617"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="11" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$nodes</span><span class="parenthesis" start="11">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3630"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="whitespace" start="5"> </span><span class="qname" start="6" select="quick">&amp;</span><span class="op" start="7">lt</span><span class="qname" start="9" select="quick">;</span><span class="whitespace" start="10"> </span><span class="variable" start="11" select="quick">$area</span><span class="step" start="16">/</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">ghost:col</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3649"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pad" class="solar"><span class="function" start="1" pair-end="47" select="quick">f:pad</span></a><span class="parenthesis">(</span><span class="function" start="7" pair-end="34" select="quick">xs:integer</span><span class="parenthesis">(</span><span class="variable" start="18" select="quick">$area</span><span class="step" start="23">/</span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">ghost:col</span><span class="parenthesis" start="34">)</span><span class="whitespace" start="35"> </span><span class="op" start="36">-</span><span class="whitespace" start="37"> </span><span class="variable" start="38" select="quick">$pos</span><span class="op" start="42">,</span><span class="whitespace" start="43"> </span><span class="op">'</span><span class="literal" start="44"> </span><span class="op">'</span><span class="parenthesis" start="47">)</span><span class="z">"</span><span id="wx3675" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3677"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:insert-callout</span><span class="z">"</span><span id="wx3691" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3695" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3699" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3701"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="whitespace" start="10"> </span><span class="type-op" start="11">instance of</span><span class="whitespace" start="22"> </span><span class="node-type" start="23" pair-end="28">text</span><span class="parenthesis">(</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3720"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3724"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="whitespace" start="5"> </span><span class="op" start="6">=</span><span class="whitespace" start="7"> </span><span class="variable" start="8" select="quick">$area</span><span class="step" start="13">/</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">ghost:col</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3741"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:insert-callout</span><span class="z">"</span><span id="wx3755" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3757"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx3765" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3769" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3771"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="24" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$nodes</span><span class="filter" start="21" pair-end="23" select="quick">[</span><span class="numeric" start="22">1</span><span class="filter" start="23">]</span><span class="parenthesis" start="24">)</span><span class="whitespace" start="25"> </span><span class="op" start="26">=</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">1</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3791"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span id="wx3802" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3804"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3814"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span id="wx3828" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3830"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx3855" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3857"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="op" start="5">+</span><span class="numeric" start="6">1</span><span class="z">"</span><span id="wx3873" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3877" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3881" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3883"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3887"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="26" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$nodes</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">1</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="numeric" start="25">1</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx3907" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3909"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?rest">rest</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">text()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3925"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="23" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$nodes</span><span class="filter" start="17" pair-end="19" select="quick">[</span><span class="numeric" start="18">1</span><span class="filter" start="19">]</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">2</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx3942" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3946" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3948"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3958"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span id="wx3972" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3974"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z">
                              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="34" select="quick">(</span><span class="variable" start="2" select="quick">$rest</span><span class="op" start="7">,</span><span class="whitespace" start="8"> </span><span class="variable" start="9" select="quick">$nodes</span><span class="filter" start="15" pair-end="33" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="16" pair-end="25" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="25">)</span><span class="whitespace" start="26"> </span><span class="qname" start="27" select="quick">&amp;</span><span class="op" start="28">gt</span><span class="qname" start="30" select="quick">;</span><span class="whitespace" start="31"> </span><span class="numeric" start="32">1</span><span class="filter" start="33">]</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx4004" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w4006"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="op" start="5">+</span><span class="numeric" start="6">1</span><span class="z">"</span><span id="wx4022" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4026" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4030" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4034" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4038" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4040"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4044"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span id="wx4055" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4057"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}addcallout" class="solar"><span class="tcall">tp:addcallout</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4067"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">area</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$area</span><span class="z">"</span><span id="wx4081" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4083"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx4108" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4110"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">pos</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$pos</span><span class="z">"</span><span id="wx4124" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4128" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4132" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4136" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4140" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4142"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:area</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:insert-callout</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4158"><span class="es">&lt;</span><span class="en">ghost:co</span><span class="z"> </span><span class="atn">number</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">ghost:number</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">xml:id</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xml:id</span><span class="op">}</span><span class="z">"</span><span id="wx4178" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4182" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w4188"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}wrap-lines">tp:wrap-lines</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4198"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx4218" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4220"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?br">br</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4236"><span class="es">&lt;</span><span class="en">ghost:br</span><span id="wx4238" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4242" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4244"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?wrapnodes">wrapnodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4260"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> FIXME: this is where f:verbatim-trim-blink-lines() should be called,
        but sometimes there's no context item. </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w4268"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="1" pair-end="34" select="quick">string</span></a><span class="parenthesis">(</span><a href="../../../xslt/base/html/param.xsl.html#v?verbatim.trim.blank.lines" class="solar"><span class="variable" start="8" select="quick">$verbatim.trim.blank.lines</span></a><span class="parenthesis" start="34">)</span><span class="whitespace" start="35"> </span><span class="op" start="36">!=</span><span class="whitespace" start="38"> </span><span class="op">'</span><span class="literal" start="39">0</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4287"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}trim-trailing-br" class="solar"><span class="function" start="1" pair-end="27" select="quick">fp:trim-trailing-br</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$nodes</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx4298" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4302" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4304"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4308"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4312"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="14" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="8" pair-end="13" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="filter" start="14">]</span><span class="filter" start="15" pair-end="30" select="quick">[</span><span class="axis" start="16">self::</span><span class="qname" start="22" select="quick">ghost:br</span><span class="filter" start="30">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="z">&lt;!--</span><span class="cm"> because group-by will not form a group after the last one </span><span class="z">--&gt;</span><span class="txt">
              </span><span class="ww" id="w4335"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="13" select="quick">(</span><span class="variable" start="2" select="quick">$nodes</span><span class="op" start="8">,</span><span class="whitespace" start="9"> </span><span class="variable" start="10" select="quick">$br</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx4348" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4352" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w4354"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w4358"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx4366" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4370" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4374" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4378" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4382" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx4386" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4388"><span class="es">&lt;</span><span class="enxsl">xsl:for-each-group</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$wrapnodes</span><span class="z">"</span><span class="z"> </span><span class="atn">group-ending-with</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:br</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4404"><span class="es">&lt;</span><span class="en">ghost:line</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4408"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-current-group" class="solar"><span class="function" start="1" pair-end="15" select="quick">current-group</span></a><span class="parenthesis">(</span><span class="parenthesis" start="15">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4420"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="19" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">self::</span><span class="qname" start="11" select="quick">ghost:br</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4434"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx4442" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4446" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx4450" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">ghost:line</span><span id="wx4454" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each-group</span><span id="wx4458" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx4462" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w4468"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{http://docbook.org/xslt/ns/extension}trim-trailing-br">fp:trim-trailing-br</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4484"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?nodes">nodes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx4498" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4500"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4504"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="filter" start="7" pair-end="14" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="8" pair-end="13" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="filter" start="14">]</span><span class="filter" start="15" pair-end="30" select="quick">[</span><span class="axis" start="16">self::</span><span class="qname" start="22" select="quick">ghost:br</span><span class="filter" start="30">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4523"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#f?{http://docbook.org/xslt/ns/extension}trim-trailing-br" class="solar"><span class="function" start="1" pair-end="49" select="quick">fp:trim-trailing-br</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$nodes</span><span class="filter" start="27" pair-end="48" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="28" pair-end="37" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="37">)</span><span class="qname" start="38" select="quick">&amp;</span><span class="op" start="39">lt</span><span class="qname" start="41" select="quick">;</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="42" pair-end="47" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="47">)</span><span class="filter" start="48">]</span><span class="parenthesis" start="49">)</span><span class="z">"</span><span id="wx4545" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4549" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4551"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4555"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$nodes</span><span class="z">"</span><span id="wx4563" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4567" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4571" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx4575" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w4581"><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4597"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Unwraps an element with a particular name</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx4603" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4605"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4609"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This template takes a sequence of nodes. It traverses that sequence
        making sure that any element with the specified name occurs at the top-most
        level of the sequence: it closes all open elements that the named element
        is nested within, outputs the named element, then reopens all the elements
      that it had been nested within.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4615" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx4619" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4621"><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4625"><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4629"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4633"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">unwrap</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx4639" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4641"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4645"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The name of the element to unwrap.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4651" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx4655" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx4659" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4661"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4665"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">content</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx4671" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4673"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4677"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The sequence of nodes.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4683" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx4687" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx4691" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4693"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="z"> </span><span class="atn">role</span><span class="atneq">=</span><span class="z">"</span><span class="av">private</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w4703"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">stack</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx4709" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4711"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4715"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The stack of currently open elements.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4721" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx4725" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx4729" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span id="wx4733" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span id="wx4737" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4739"><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4743"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The original content sequence modified so that all elements named
        </span><span class="ww" id="w4747"><span class="es">&lt;</span><span class="en">parameter</span><span class="scx">&gt;</span><span class="txt">unwrap</span><span class="ez">&lt;/</span><span class="cl">parameter</span><span id="wx4753" class="ec">&gt;</span></span><span class="txt"> are at the top level.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx4757" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span id="wx4761" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span id="wx4765" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w4767"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}unwrap">t:unwrap</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w4777"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?unwrap">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName</span><span class="z">"</span><span id="wx4791" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4793"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?content">content</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span id="wx4807" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w4809"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx4830" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4832"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4836"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="13" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$content</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx4847" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4849"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="whitespace" start="12"> </span><span class="type-op" start="13">instance of</span><span class="whitespace" start="24"> </span><span class="node-type" start="25" pair-end="33">element</span><span class="parenthesis">(</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34">
                      </span><span class="op" start="55">and</span><span class="whitespace" start="58"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="59" pair-end="80" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="69" select="quick">$content</span><span class="filter" start="77" pair-end="79" select="quick">[</span><span class="numeric" start="78">1</span><span class="filter" start="79">]</span><span class="parenthesis" start="80">)</span><span class="whitespace" start="81"> </span><span class="op" start="82">=</span><span class="whitespace" start="83"> </span><span class="variable" start="84" select="quick">$unwrap</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4882"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}close-stack" class="solar"><span class="tcall">tp:close-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4892"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx4906" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4910" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4912"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx4923" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4925"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}open-stack" class="solar"><span class="tcall">tp:open-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4935"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx4949" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx4953" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w4955"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4965"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx4979" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4981"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5006" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5008"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx5022" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5026" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5030" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5032"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="filter" start="12" pair-end="28" select="quick">[</span><span class="axis" start="13">self::</span><span class="qname" start="19" select="quick">ghost:end</span><span class="filter" start="28">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5049"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx5060" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5062"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5072"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx5086" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5088"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5113" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5115"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="30" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">lt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="24" pair-end="29" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="29">)</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx5142" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5146" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5150" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5152"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="whitespace" start="12"> </span><span class="type-op" start="13">instance of</span><span class="whitespace" start="24"> </span><span class="node-type" start="25" pair-end="33">element</span><span class="parenthesis">(</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5171"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx5182" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5184"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5194"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx5208" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5210"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5235" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5237"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="21" select="quick">(</span><span class="variable" start="2" select="quick">$stack</span><span class="op" start="8">,</span><span class="whitespace" start="9"> </span><span class="variable" start="10" select="quick">$content</span><span class="filter" start="18" pair-end="20" select="quick">[</span><span class="numeric" start="19">1</span><span class="filter" start="20">]</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx5259" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5263" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5267" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5269"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5273"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="11" select="quick">[</span><span class="numeric" start="10">1</span><span class="filter" start="11">]</span><span class="z">"</span><span id="wx5284" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5286"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template}unwrap" class="solar"><span class="tcall">t:unwrap</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5296"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">unwrap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$unwrap</span><span class="z">"</span><span id="wx5310" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5312"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">content</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$content</span><span class="filter" start="9" pair-end="27" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="10" pair-end="19" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">&amp;</span><span class="op" start="22">gt</span><span class="qname" start="24" select="quick">;</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">1</span><span class="filter" start="27">]</span><span class="z">"</span><span id="wx5337" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w5339"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span id="wx5353" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5357" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5361" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5365" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5369" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5371"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}close-stack">tp:close-stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5381"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx5402" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5404"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5414"><span class="es">&lt;</span><span class="en">ghost:end</span><span class="z"> </span><span class="atn">idref</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="14" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="8" pair-end="13" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="filter" start="14">]</span><span class="step" start="15">/</span><span class="axis" start="16">@</span><span class="qname" start="17" select="quick">ghost:id</span><span class="op">}</span><span class="z">"</span><span id="wx5432" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="z">&lt;!--</span><span class="cm">
      &lt;xsl:message&gt;
      &lt;xsl:text&gt;close: &lt;/xsl:text&gt;
      &lt;xsl:value-of select="$stack[last()]/@ghost:id"/&gt;
      &lt;/xsl:message&gt;
      </span><span class="z">--&gt;</span><span class="txt">
      </span><span class="ww" id="w5438"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}close-stack" class="solar"><span class="tcall">tp:close-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5448"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="30" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">lt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="24" pair-end="29" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="29">)</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx5475" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5479" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5483" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5487" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5489"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}open-stack">tp:open-stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5499"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx5520" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5522"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5532"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="9" select="quick">[</span><span class="numeric" start="8">1</span><span class="filter" start="9">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:stack-copy</span><span class="z">"</span><span id="wx5549" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5551"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/verbatim-patch.xsl.html#t?{http://docbook.org/xslt/ns/template/private}open-stack" class="solar"><span class="tcall">tp:open-stack</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5561"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="filter" start="7" pair-end="25" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="qname" start="19" select="quick">&amp;</span><span class="op" start="20">gt</span><span class="qname" start="22" select="quick">;</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">1</span><span class="filter" start="25">]</span><span class="z">"</span><span id="wx5586" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx5590" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5594" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5598" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5600"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:stack-copy</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5616"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5620"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx5629" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5631"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:copy</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">yes</span><span class="op">'</span><span class="z">"</span><span id="wx5647" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx5651" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5655" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5657"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template/private}show-stack">tp:show-stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5667"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?stack">stack</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx5688" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5690"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5694"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">STACK[</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5700" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5702"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="13" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$stack</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx5713" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5715"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">]</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5721" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx5725" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5727"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$stack</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5737"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5741"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">...</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5747" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5749"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="7" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="6">.</span><span class="parenthesis" start="7">)</span><span class="z">"</span><span id="wx5760" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5762"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">,</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5768" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5770"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">ghost:id</span><span class="z">"</span><span id="wx5779" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx5783" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5787" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5791" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w5797"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5819"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5823"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx5832" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5834"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span id="wx5842" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx5846" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5850" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5852"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z">
                </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> Ok, there's a bug in MarkLogic server V4.2-1 that coalesces the nodes returned
    by xsl:analyze-string into a single node. Let's work around that. </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w5880"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5884"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-system-property" class="solar"><span class="function" start="1" pair-end="29" select="quick">system-property</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="17">xsl:vendor</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30"> </span><span class="op" start="31">=</span><span class="whitespace" start="32"> </span><span class="op">'</span><span class="literal" start="33">MarkLogic Corporation</span><span class="op">'</span><span class="whitespace" start="56">
                      </span><span class="op" start="77">and</span><span class="whitespace" start="80"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-system-property" class="solar"><span class="function" start="81" pair-end="118" select="quick">system-property</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="97">xsl:product-version</span><span class="op">'</span><span class="parenthesis" start="118">)</span><span class="whitespace" start="119"> </span><span class="op" start="120">=</span><span class="whitespace" start="121"> </span><span class="op">'</span><span class="literal" start="122">4.2-1</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5920"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parts">parts</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">item()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5936"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\n</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5952"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w5956"><span class="es">&lt;</span><span class="en">ghost:br</span><span id="wx5958" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx5962" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w5964"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w5968"><span class="es">&lt;</span><span class="en">ghost:x</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w5972"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx5980" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">ghost:x</span><span id="wx5984" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx5988" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx5992" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx5996" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5998"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$parts</span><span class="step" start="7">/</span><span class="node" start="8" pair-end="13" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6012"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6016"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">self::</span><span class="qname" start="7" select="quick">ghost:br</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w6027"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx6035" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6039" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w6041"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w6045"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="step" start="2">/</span><span class="node" start="3" pair-end="8" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="8">)</span><span class="z">"</span><span id="wx6057" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6061" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6065" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx6069" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6073" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6075"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6079"><span class="es">&lt;</span><span class="enxsl">xsl:analyze-string</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span class="z"> </span><span class="atn">regex</span><span class="atneq">=</span><span class="z">"</span><span class="av">\n</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6095"><span class="es">&lt;</span><span class="enxsl">xsl:matching-substring</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6099"><span class="es">&lt;</span><span class="en">ghost:br</span><span id="wx6101" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:matching-substring</span><span id="wx6105" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6107"><span class="es">&lt;</span><span class="enxsl">xsl:non-matching-substring</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6111"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx6119" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:non-matching-substring</span><span id="wx6123" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:analyze-string</span><span id="wx6127" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6131" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6135" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6139" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6141"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z">
                </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">mp:pl-no-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6169"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx6171" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6175" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w6181"><span class="es">&lt;</span><span class="en">doc:mode</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6197"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Make all elements empty</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx6203" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6205"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6209"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This mode is used to completely flatten all nesting in a tree.
        Every start tag is replaced with an empty tag that has a
        </span><span class="ww" id="w6213"><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">ghost:id</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6225" class="ec">&gt;</span></span><span class="txt"> attribute. Every end tag is
        replaced with an empty </span><span class="ww" id="w6227"><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">ghost:end</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6233" class="ec">&gt;</span></span><span class="txt"> element that has an 
        </span><span class="ww" id="w6235"><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">idref</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6247" class="ec">&gt;</span></span><span class="txt"> attribute pointing to the
        appropriate </span><span class="ww" id="w6249"><span class="es">&lt;</span><span class="en">tag</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">ghost:id</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx6261" class="ec">&gt;</span></span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx6265" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w6267"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">To reverse the process, see
        </span><span class="ww" id="w6271"><span class="es">&lt;</span><span class="en">function</span><span class="z"> </span><span class="atn">role</span><span class="atneq">=</span><span class="z">"</span><span class="av">named-template</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">t:restore-content</span><span class="ez">&lt;/</span><span class="cl">function</span><span id="wx6283" class="ec">&gt;</span></span><span class="txt">.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx6287" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx6291" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">doc:mode</span><span id="wx6295" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6297"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6313"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="1" pair-end="7" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="6">.</span><span class="parenthesis" start="7">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">namespace</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri" class="solar"><span class="function" start="1" pair-end="16" select="quick">namespace-uri</span></a><span class="parenthesis">(</span><span class="context" start="15">.</span><span class="parenthesis" start="16">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6339"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx6348" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6350"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="1" pair-end="13" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx6366" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx6370" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6372"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span id="wx6380" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w6382"><span class="es">&lt;</span><span class="en">ghost:end</span><span class="z"> </span><span class="atn">idref</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="1" pair-end="13" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span id="wx6394" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6398" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6400"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="op" start="35">|</span><span class="node" start="36" pair-end="41" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="41">)</span><span class="z">"</span><span class="z">
                </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:patch-empty-elements</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6426"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx6428" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6432" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w6438"><span class="es">&lt;</span><span class="en">doc:mode</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6454"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Remove all newlines</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx6460" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6462"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6466"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This mode is used to remove newlines from text content.
        This is necessary in verbatim processing of elements such as
        footnote because, although line breaks are significant in a verbatim
        environment, they are not significant in the content of a footnote
      in a verbatim environment.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx6472" class="ec">&gt;</span></span><span class="txt">
      
    </span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx6476" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">doc:mode</span><span id="wx6480" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6482"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6498"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6502"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx6511" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6513"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span id="wx6521" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:copy</span><span id="wx6525" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6529" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6531"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="6" select="quick">text</span><span class="parenthesis">(</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span class="z">
                </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6549"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="22" select="quick">replace</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="op" start="10">,</span><span class="op">'</span><span class="literal" start="11">&amp;#10;</span><span class="op">'</span><span class="op" start="18">,</span><span class="op">'</span><span class="literal" start="19"> </span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span id="wx6568" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6572" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6574"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="node" start="1" pair-end="9" select="quick">comment</span><span class="parenthesis">(</span><span class="parenthesis" start="9">)</span><span class="op" start="10">|</span><span class="node" start="11" pair-end="34" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span class="z">
                </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">m:remove-lb</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6596"><span class="es">&lt;</span><span class="enxsl">xsl:copy</span><span id="wx6598" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6602" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w6608"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:areaspec</span><span class="op" start="12">|</span><span class="qname" start="13" select="quick">db:areaset</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6620"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx6622" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6626" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6628"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:areaspec</span><span class="step" start="12">/</span><span class="qname" start="13" select="quick">db:area</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6640"><span class="es">&lt;</span><span class="en">db:area</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6644"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="filter" start="3" pair-end="23" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="4" pair-end="10" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">coords</span><span class="op">'</span><span class="filter" start="23">]</span><span class="z">"</span><span id="wx6665" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6667"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="73" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="2" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">units</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13">
                    </span><span class="op" start="19">or</span><span class="whitespace" start="21"> </span><span class="axis" start="22">@</span><span class="qname" start="23" select="quick">units</span><span class="op" start="28">=</span><span class="op">'</span><span class="literal" start="29">linecolumn</span><span class="op">'</span><span class="whitespace" start="41">
                    </span><span class="op" start="47">or</span><span class="whitespace" start="49"> </span><span class="axis" start="50">@</span><span class="qname" start="51" select="quick">units</span><span class="op" start="56">=</span><span class="op">'</span><span class="literal" start="57">linecolumnpair</span><span class="op">'</span><span class="parenthesis" start="73">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6701"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6705"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="44" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="5" pair-end="43" select="quick">contains</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="14" pair-end="37" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">coords</span><span class="parenthesis" start="37">)</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="op">'</span><span class="literal" start="40"> </span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6730"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="1" pair-end="24" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">coords</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx6748" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w6750"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?callout.defaultcolumn" class="solar"><span class="variable" start="1" select="quick">$callout.defaultcolumn</span></a><span class="z">"</span><span id="wx6764" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6768" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6770"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6774"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?toks">toks</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="39" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="10" pair-end="33" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">coords</span><span class="parenthesis" start="33">)</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="op">'</span><span class="literal" start="36"> </span><span class="op">'</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx6800" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w6802"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">1</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx6819" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w6821"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">2</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx6838" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6842" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6846" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6850" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6852"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:number</span><span class="z">"</span><span class="z">
                     </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="97" select="quick">count</span></a><span class="parenthesis">(</span><span class="axis" start="7">preceding-sibling::</span><span class="qname" start="26" select="quick">db:area</span><span class="whitespace" start="33">
                             </span><span class="op" start="67">|</span><span class="axis" start="68">preceding-sibling::</span><span class="qname" start="87" select="quick">db:areaset</span><span class="parenthesis" start="97">)</span><span class="quantifier" start="98">+</span><span class="numeric" start="99">1</span><span class="z">"</span><span id="wx6876" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">db:area</span><span id="wx6880" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6884" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6886"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:areaset</span><span class="step" start="11">/</span><span class="qname" start="12" select="quick">db:area</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6898"><span class="es">&lt;</span><span class="en">db:area</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6902"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="filter" start="3" pair-end="23" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-name" class="solar"><span class="function" start="4" pair-end="10" select="quick">name</span></a><span class="parenthesis">(</span><span class="context" start="9">.</span><span class="parenthesis" start="10">)</span><span class="whitespace" start="11"> </span><span class="op" start="12">!=</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">coords</span><span class="op">'</span><span class="filter" start="23">]</span><span class="z">"</span><span id="wx6923" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w6925"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="31" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">preceding-sibling::</span><span class="qname" start="24" select="quick">db:area</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6939"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xml:id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">parent::</span><span class="qname" start="9" select="quick">db:areaset</span><span class="step" start="19">/</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">xml:id</span><span class="z">"</span><span id="wx6957" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6961" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w6963"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="73" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="2" pair-end="12" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="6">@</span><span class="qname" start="7" select="quick">units</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13">
                    </span><span class="op" start="19">or</span><span class="whitespace" start="21"> </span><span class="axis" start="22">@</span><span class="qname" start="23" select="quick">units</span><span class="op" start="28">=</span><span class="op">'</span><span class="literal" start="29">linecolumn</span><span class="op">'</span><span class="whitespace" start="41">
                    </span><span class="op" start="47">or</span><span class="whitespace" start="49"> </span><span class="axis" start="50">@</span><span class="qname" start="51" select="quick">units</span><span class="op" start="56">=</span><span class="op">'</span><span class="literal" start="57">linecolumnpair</span><span class="op">'</span><span class="parenthesis" start="73">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6997"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7001"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="44" select="quick">not</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="5" pair-end="43" select="quick">contains</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="14" pair-end="37" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">coords</span><span class="parenthesis" start="37">)</span><span class="op" start="38">,</span><span class="whitespace" start="39"> </span><span class="op">'</span><span class="literal" start="40"> </span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="parenthesis" start="44">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7026"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="1" pair-end="24" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">coords</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx7044" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w7046"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?callout.defaultcolumn" class="solar"><span class="variable" start="1" select="quick">$callout.defaultcolumn</span></a><span class="z">"</span><span id="wx7060" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7064" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7066"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7070"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?toks">toks</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="39" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="10" pair-end="33" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">coords</span><span class="parenthesis" start="33">)</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="op">'</span><span class="literal" start="36"> </span><span class="op">'</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx7096" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w7098"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:line</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">1</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx7115" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w7117"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:col</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$toks</span><span class="filter" start="6" pair-end="8" select="quick">[</span><span class="numeric" start="7">2</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx7134" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7138" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7142" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7146" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7148"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">ghost:number</span><span class="z">"</span><span class="z">
                     </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="131" select="quick">count</span></a><span class="parenthesis">(</span><span class="axis" start="7">parent::</span><span class="qname" start="15" select="quick">db:areaset</span><span class="step" start="25">/</span><span class="axis" start="26">preceding-sibling::</span><span class="qname" start="45" select="quick">db:area</span><span class="whitespace" start="52">
                             </span><span class="op" start="82">|</span><span class="axis" start="83">parent::</span><span class="qname" start="91" select="quick">db:areaset</span><span class="step" start="101">/</span><span class="axis" start="102">preceding-sibling::</span><span class="qname" start="121" select="quick">db:areaset</span><span class="parenthesis" start="131">)</span><span class="whitespace" start="132">
                             </span><span class="op" start="139">+</span><span class="whitespace" start="140"> </span><span class="numeric" start="141">1</span><span class="z">"</span><span id="wx7180" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">db:area</span><span id="wx7184" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7188" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx7192" class="ec">&gt;</span></span><span class="txt">
</span></p></div></body></html>