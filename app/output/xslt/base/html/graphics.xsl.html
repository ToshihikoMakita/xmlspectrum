<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>graphics.xsl</title><link rel="stylesheet" type="text/css" href="../../../theme.css"></head><body><div><p class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="ww" id="w5"><span class="es">&lt;</span><a class="solar" href="../../../index.html"><span class="enxsl" id="e?{http://www.w3.org/1999/XSL/Transform}stylesheet">xsl:stylesheet</span></a><span class="z"> </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:db</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:doc</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://nwalsh.com/xsl/documentation/1.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/extension</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:ghost</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook/ephemeral</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:h</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/xhtml</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:m</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/mode</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:t</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/xslt/ns/template</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:u</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://nwalsh.com/xsl/unittests#</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xlink</span><span class="atneq">=</span><span class="z">'</span><span class="av">http://www.w3.org/1999/xlink</span><span class="z">'</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:ext</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/extensions/xslt20</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">db doc f ghost h m t u xlink xs ext</span><span class="z">"</span><span class="z">
                </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  
  </span><span class="ww" id="w99"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?output.dir">output.dir</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx115" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w121"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:screenshot</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w131"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/formal.xsl.html#t?{http://docbook.org/xslt/ns/template}semiformal-object" class="solar"><span class="tcall">t:semiformal-object</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w141"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx158" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w160"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">object</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w176"><span class="es">&lt;</span><span class="en">div</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w191"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#t?{http://docbook.org/xslt/ns/template}id" class="solar"><span class="tcall">t:id</span></a><span class="z">"</span><span id="wx199" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w201"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/html.xsl.html#t?class" class="solar"><span class="tcall">class</span></a><span class="z">"</span><span id="wx209" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w211"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx213" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx217" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span id="wx221" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx225" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx229" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w235"><span class="es">&lt;</span><span class="en">doc:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">t:process-image</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://docbook.org/ns/docbook</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w251"><span class="es">&lt;</span><span class="en">refpurpose</span><span class="scx">&gt;</span><span class="txt">Process an image</span><span class="ez">&lt;/</span><span class="cl">refpurpose</span><span id="wx257" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w259"><span class="es">&lt;</span><span class="en">refdescription</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w263"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The HTML </span><span class="ww" id="w267"><span class="es">&lt;</span><span class="en">tag</span><span class="scx">&gt;</span><span class="txt">img</span><span class="ez">&lt;/</span><span class="cl">tag</span><span id="wx273" class="ec">&gt;</span></span><span class="txt"> element only supports the notion of
        content-area scaling; it doesn't support the distinction between a
        content-area and a viewport-area, so we have to make some compromises.
      </span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx277" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w279"><span class="es">&lt;</span><span class="en">orderedlist</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w283"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w287"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If only the content-area is specified, everything is fine. (If
          you ask for a three inch image, that's what you'll get.)</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx293" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx297" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w299"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w303"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If only the viewport-area is provided:</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx309" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w311"><span class="es">&lt;</span><span class="en">itemizedlist</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w315"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w319"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If scalefit=1, treat it as both the content-area and the
                viewport-area. (If you ask for an image in a five inch area, we'll
              make the image five inches to fill that area.)</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx325" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx329" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w331"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w335"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If scalefit=0, ignore the viewport-area specification.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx341" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx345" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">itemizedlist</span><span id="wx349" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w351"><span class="es">&lt;</span><span class="en">note</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w355"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">This is not quite the right semantic and has the additional
              problem that it can result in anamorphic scaling, which scalefit
            should never cause.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx361" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">note</span><span id="wx365" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx369" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w371"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w375"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If both the content-area and the viewport-area is specified on a
            graphic element, ignore the viewport-area. (If you ask for a three
            inch image in a five inch area, we'll assume it's better to give you a
            three inch image in an unspecified area than a five inch image in a
          five inch area.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx381" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx385" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">orderedlist</span><span id="wx389" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w391"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Relative units also cause problems. As a general rule, the
        stylesheets are operating too early and too loosely coupled with the
        rendering engine to know things like the current font size or the
      actual dimensions of an image. Therefore:</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx397" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w399"><span class="es">&lt;</span><span class="en">orderedlist</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w403"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w407"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">We use a fixed size for pixels, $pixels.per.inch</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx413" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx417" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w419"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w423"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">We use a fixed size for "em"s, $points.per.em</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx429" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx433" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">orderedlist</span><span id="wx437" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w439"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Percentages are problematic. In the following discussion, we speak
        of width and contentwidth, but the same issues apply to depth and
      contentdepth</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx445" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w447"><span class="es">&lt;</span><span class="en">orderedlist</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w451"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w455"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">A width of 50% means "half of the available space for the
            image." That's fine. But note that in HTML, this is a dynamic property
            and the image size will vary if the browser window is resized.
          </span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx461" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx465" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w467"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w471"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">A contentwidth of 50% means "half of the actual image width".
            But the stylesheets have no way to assess the image's actual size.
            Treating this as a width of 50% is one possibility, but it produces
            behavior (dynamic scaling) that seems entirely out of character with
          the meaning.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx477" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w479"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Instead, the stylesheets define a $nominal.image.width and
            convert percentages to actual values based on that nominal size.
          </span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx485" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx489" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">orderedlist</span><span id="wx493" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w495"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Scale can be problematic. Scale applies to the contentwidth, so
        a scale of 50 when a contentwidth is not specified is analagous to a
        width of 50%. (If a contentwidth is specified, the scaling factor can
      be applied to that value and no problem exists.)</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx501" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w503"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">If scale is specified but contentwidth is not supplied, the
        nominal.image.width is used to calculate a base size
      for scaling.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx509" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w511"><span class="es">&lt;</span><span class="en">warning</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w515"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">As a consequence of these decisions, unless the aspect ratio of
          your image happens to be exactly the same as (nominal width / nominal
          height), specifying contentwidth="50%" and contentdepth="50%" is NOT
        going to scale the way you expect (or really, the way it should).</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx521" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w523"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Don't do that. In fact, a percentage value is not recommended
        for content size at all. Use scale instead.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx529" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">warning</span><span id="wx533" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w535"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Finally, align and valign are troublesome. Horizontal alignment
        is now supported by wrapping the image in a
        </span><span class="ww" id="w539"><span class="es">&lt;</span><span class="en">code</span><span class="scx">&gt;</span><span class="txt">&amp;lt;div align="{@align}"&amp;gt;</span><span class="ez">&lt;/</span><span class="cl">code</span><span id="wx545" class="ec">&gt;</span></span><span class="txt"> (in
        block contexts!). I can't think of anything (practical) to do about
      vertical alignment.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx549" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refdescription</span><span id="wx553" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w555"><span class="es">&lt;</span><span class="en">refparameter</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w559"><span class="es">&lt;</span><span class="en">variablelist</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w563"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w567"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">tag</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx573" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w575"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w579"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The name of the HTML element to create (img, object, etc.).
            </span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx585" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx589" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx593" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w595"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w599"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">alt</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx605" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w607"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w611"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">The alt text.
            </span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx617" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx621" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx625" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w627"><span class="es">&lt;</span><span class="en">varlistentry</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w631"><span class="es">&lt;</span><span class="en">term</span><span class="scx">&gt;</span><span class="txt">longdesc</span><span class="ez">&lt;/</span><span class="cl">term</span><span id="wx637" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w639"><span class="es">&lt;</span><span class="en">listitem</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w643"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">A pointer to the long description (textobject) for this element.
            </span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx649" class="ec">&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">listitem</span><span id="wx653" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">varlistentry</span><span id="wx657" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">variablelist</span><span id="wx661" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refparameter</span><span id="wx665" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w667"><span class="es">&lt;</span><span class="en">refreturn</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w671"><span class="es">&lt;</span><span class="en">para</span><span class="scx">&gt;</span><span class="txt">Markup for the image.</span><span class="ez">&lt;/</span><span class="cl">para</span><span id="wx677" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">refreturn</span><span id="wx681" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="cl">doc:template</span><span id="wx685" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w687"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}image-properties">t:image-properties</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w703"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?image">image</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">required</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx723" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w725"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">use-when</span><span class="atneq">=</span><span class="z">"</span><span class="av">function-available('ext:image-properties')</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#f?{http://docbook.org/extensions/xslt20}image-properties" class="solar"><span class="function" start="1" pair-end="28" select="quick">ext:image-properties</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$image</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx742" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w744"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="z"> </span><span class="atn">use-when</span><span class="atneq">=</span><span class="z">"</span><span class="av">not(function-available('ext:image-properties'))</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w754"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">Cannot read image properties for </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx760" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w762"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$image</span><span class="z">"</span><span id="wx770" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w772"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">. (No extension)</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx778" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx782" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w784"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">use-when</span><span class="atneq">=</span><span class="z">"</span><span class="av">not(function-available('ext:image-properties'))</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx799" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx803" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w805"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">use-when</span><span class="atneq">=</span><span class="z">"</span><span class="av">function-available('magick:wand')</span><span class="z">"</span><span class="z">
                </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{http://docbook.org/extensions/xslt20}image-properties">ext:image-properties</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:magick</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://marklogic.com/magick</span><span class="z">"</span><span class="z">
                </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:unsignedLong*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w833"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?image">image</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx847" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w849"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?wand">wand</span><span class="z">"</span><span class="z">       </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="13" select="quick">magick:wand</span><span class="parenthesis">(</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span id="wx865" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w867"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?image-wand">image-wand</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="36" select="quick">magick:read-image</span><span class="parenthesis">(</span><span class="variable" start="19" select="quick">$wand</span><span class="op" start="24">,</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function" start="25" pair-end="35" select="quick">doc</span></a><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$image</span><span class="parenthesis" start="35">)</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx889" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w891"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="75" select="quick">(</span><span class="function" start="2" pair-end="36" select="quick">magick:get-image-width</span><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$image-wand</span><span class="parenthesis" start="36">)</span><span class="op" start="37">,</span><span class="whitespace" start="38"> </span><span class="function" start="39" pair-end="74" select="quick">magick:get-image-height</span><span class="parenthesis">(</span><span class="variable" start="63" select="quick">$image-wand</span><span class="parenthesis" start="74">)</span><span class="parenthesis" start="75">)</span><span class="z">"</span><span id="wx910" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx914" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w916"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}process-image">t:process-image</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> When this template is called, the current node should be  </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> a graphic, inlinegraphic, imagedata, or videodata. All    </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> those elements have the same set of attributes, so we can </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> handle them all in one place.                             </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w942"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tag">tag</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">img</span><span class="op">'</span><span class="z">"</span><span id="wx958" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w960"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?alt">alt</span><span class="z">"</span><span id="wx968" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w970"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?longdesc">longdesc</span><span class="z">"</span><span id="wx978" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w980"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?tag-attributes">tag-attributes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">attribute()*</span><span class="z">"</span><span id="wx994" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w996"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?format">format</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns:svg</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2000/svg</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="12" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">format</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13"> </span><span class="op" start="14">then</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-string" class="solar"><span class="function" start="19" pair-end="33" select="quick">string</span></a><span class="parenthesis">(</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">format</span><span class="parenthesis" start="33">)</span><span class="whitespace" start="34">
                          </span><span class="op" start="59">else</span><span class="whitespace" start="63"> </span><span class="if" start="64">if</span><span class="whitespace" start="66"> </span><span class="parenthesis" start="67" pair-end="73" select="quick">(</span><span class="qname" start="68" select="quick">svg:*</span><span class="parenthesis" start="73">)</span><span class="whitespace" start="74"> </span><span class="op" start="75">then</span><span class="whitespace" start="79"> </span><span class="op">'</span><span class="literal" start="80">svg</span><span class="op">'</span><span class="whitespace" start="85">
                          </span><span class="op" start="110">else</span><span class="whitespace" start="114"> </span><span class="op">'</span><span class="literal" start="115"></span><span class="op">'</span><span class="z">"</span><span id="wx1049" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1051"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?width-units">width-units</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1061"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1065"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1081" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1083"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1094"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-units" class="solar"><span class="function" start="1" pair-end="22" select="quick">f:length-units</span></a><span class="parenthesis">(</span><span class="axis" start="16">@</span><span class="qname" start="17" select="quick">width</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span id="wx1106" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1110" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1112"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="11" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">depth</span><span class="parenthesis" start="11">)</span><span class="whitespace" start="12"> </span><span class="op" start="13">and</span><span class="whitespace" start="16"> </span><a href="../../../xslt/base/html/param.xsl.html#v?default.image.width" class="solar"><span class="variable" start="17" select="quick">$default.image.width</span></a><span class="whitespace" start="37"> </span><span class="op" start="38">!=</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1136"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-units" class="solar"><span class="function" start="1" pair-end="36" select="quick">f:length-units</span></a><span class="parenthesis">(</span><a href="../../../xslt/base/html/param.xsl.html#v?default.image.width" class="solar"><span class="variable" start="16" select="quick">$default.image.width</span></a><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx1147" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1151" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1155" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1159" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1161"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?width">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1171"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1175"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1191" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1193"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1204"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1208"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width-units</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">%</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1224"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">width</span><span class="z">"</span><span id="wx1233" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1237" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1239"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1243"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-spec" class="solar"><span class="function" start="1" pair-end="21" select="quick">f:length-spec</span></a><span class="parenthesis">(</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">width</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx1255" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1259" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1263" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1267" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1269"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="1" pair-end="11" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">depth</span><span class="parenthesis" start="11">)</span><span class="whitespace" start="12"> </span><span class="op" start="13">and</span><span class="whitespace" start="16"> </span><a href="../../../xslt/base/html/param.xsl.html#v?default.image.width" class="solar"><span class="variable" start="17" select="quick">$default.image.width</span></a><span class="whitespace" start="37"> </span><span class="op" start="38">!=</span><span class="whitespace" start="40"> </span><span class="op">'</span><span class="literal" start="41"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1293"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?default.image.width" class="solar"><span class="variable" start="1" select="quick">$default.image.width</span></a><span class="z">"</span><span id="wx1301" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1305" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1309" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1313" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1315"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scalefit">scalefit</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1325"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1329"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1345" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1347"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">contentwidth</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><span class="axis" start="18">@</span><span class="qname" start="19" select="quick">contentdepth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1365" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1367"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">scale</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1380" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1382"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">scalefit</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1393"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">scalefit</span><span class="z">"</span><span id="wx1402" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1406" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1408"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width</span><span class="whitespace" start="7"> </span><span class="op" start="8">!=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11"></span><span class="op">'</span><span class="whitespace" start="13"> </span><span class="op" start="14">or</span><span class="whitespace" start="16"> </span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">depth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">1</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1431" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1433"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1439" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1443" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1447" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1449"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scale">scale</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1459"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1463"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">1.0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1479" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1481"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">scale</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1492"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">scale</span><span class="whitespace" start="7"> </span><span class="op" start="8">div</span><span class="whitespace" start="11"> </span><span class="numeric" start="12">100.0</span><span class="z">"</span><span id="wx1505" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1509" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1511"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">1.0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1517" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1521" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1525" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;&lt;xsl:copy-of select="."/&gt;&lt;/xsl:message&gt;
    &lt;xsl:message&gt;
    &lt;xsl:value-of select="$ignore.image.scaling"/&gt;,
    &lt;xsl:value-of select="$width-units"/&gt;,
    &lt;xsl:value-of select="@width"/&gt;,
    &lt;xsl:value-of select="if (@width) then f:length-spec(@width) else '!@width'"/&gt;,
    &lt;xsl:value-of select="$default.image.width"/&gt;,
    &lt;xsl:value-of select="$scalefit"/&gt;,
    &lt;xsl:value-of select="$scale"/&gt;,
    &lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> imagedata, videodata, audiodata </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w1535"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?filename">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#f?{http://docbook.org/xslt/ns/extension}mediaobject-filename" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:mediaobject-filename</span></a><span class="parenthesis">(</span><span class="context" start="24">..</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx1552" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1554"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?imageproperties">imageproperties</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1570"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="whitespace" start="10"> </span><span class="op" start="11">!=</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1586"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}image-properties" class="solar"><span class="tcall">t:image-properties</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1596"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">image</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$filename</span><span class="z">"</span><span id="wx1610" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1614" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1618" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1622" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1624"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?intrinsicwidth">intrinsicwidth</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="29" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="28" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$imageproperties</span><span class="parenthesis" start="28">)</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30">
                          </span><span class="op" start="55">then</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$imageproperties</span><span class="filter" start="76" pair-end="78" select="quick">[</span><span class="numeric" start="77">1</span><span class="filter" start="78">]</span><span class="whitespace" start="79">
                          </span><span class="op" start="104">else</span><span class="whitespace" start="108"> </span><a href="../../../xslt/base/html/param.xsl.html#v?nominal.image.width" class="solar"><span class="variable" start="109" select="quick">$nominal.image.width</span></a><span class="z">"</span><span id="wx1656" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1658"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?intrinsicdepth">intrinsicdepth</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="29" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="5" pair-end="28" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$imageproperties</span><span class="parenthesis" start="28">)</span><span class="parenthesis" start="29">)</span><span class="whitespace" start="30">
                          </span><span class="op" start="55">then</span><span class="whitespace" start="59"> </span><span class="variable" start="60" select="quick">$imageproperties</span><span class="filter" start="76" pair-end="78" select="quick">[</span><span class="numeric" start="77">2</span><span class="filter" start="78">]</span><span class="whitespace" start="79">
                          </span><span class="op" start="104">else</span><span class="whitespace" start="108"> </span><a href="../../../xslt/base/html/param.xsl.html#v?nominal.image.depth" class="solar"><span class="variable" start="109" select="quick">$nominal.image.depth</span></a><span class="z">"</span><span id="wx1690" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1692"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?contentwidth">contentwidth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1702"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1706"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1722" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1724"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">contentwidth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1735"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?units">units</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1745"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-units" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:length-units</span></a><span class="parenthesis">(</span><span class="axis" start="16">@</span><span class="qname" start="17" select="quick">contentwidth</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx1757" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1761" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w1763"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1767"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$units</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">%</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1783"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?cmagnitude">cmagnitude</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w1793"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-magnitude" class="solar"><span class="function" start="1" pair-end="33" select="quick">f:length-magnitude</span></a><span class="parenthesis">(</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">contentwidth</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span id="wx1805" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1809" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w1811"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$intrinsicwidth</span><span class="whitespace" start="16"> </span><span class="op" start="17">*</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$cmagnitude</span><span class="whitespace" start="30"> </span><span class="op" start="31">div</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">100.0</span><span class="z">"</span><span id="wx1827" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w1829"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">px</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx1835" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1839" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1841"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1845"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-spec" class="solar"><span class="function" start="1" pair-end="28" select="quick">f:length-spec</span></a><span class="parenthesis">(</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">contentwidth</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx1857" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1861" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1865" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1869" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1871"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1875"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$intrinsicwidth</span><span class="z">"</span><span id="wx1883" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1885"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">px</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx1891" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1895" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1899" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1903" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1905"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scaled.contentwidth">scaled.contentwidth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1915"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$contentwidth</span><span class="whitespace" start="14"> </span><span class="op" start="15">!=</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1931"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?cwidth.in.points">cwidth.in.points</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-in-points" class="solar"><span class="function" start="1" pair-end="48" select="quick">f:length-in-points</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$contentwidth</span><span class="op" start="33">,</span><a href="../../../xslt/base/html/param.xsl.html#v?points.per.em" class="solar"><span class="variable" start="34" select="quick">$points.per.em</span></a><span class="parenthesis" start="48">)</span><span class="z">"</span><span id="wx1950" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w1952"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$cwidth.in.points</span><span class="whitespace" start="18"> </span><span class="op" start="19">div</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">72.0</span><span class="whitespace" start="27">
                              </span><span class="op" start="56">*</span><span class="whitespace" start="57"> </span><a href="../../../xslt/base/html/param.xsl.html#v?pixels.per.inch" class="solar"><span class="variable" start="58" select="quick">$pixels.per.inch</span></a><span class="whitespace" start="74"> </span><span class="op" start="75">*</span><span class="whitespace" start="76"> </span><span class="variable" start="77" select="quick">$scale</span><span class="z">"</span><span id="wx1972" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1976" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1980" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1982"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?html.width">html.width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1992"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1996"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2012" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2014"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width-units</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">%</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2030"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width</span><span class="z">"</span><span id="wx2038" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2042" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2044"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$width</span><span class="whitespace" start="7"> </span><span class="op" start="8">!=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2060"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?width.in.points">width.in.points</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-in-points" class="solar"><span class="function" start="1" pair-end="41" select="quick">f:length-in-points</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$width</span><span class="op" start="26">,</span><a href="../../../xslt/base/html/param.xsl.html#v?points.per.em" class="solar"><span class="variable" start="27" select="quick">$points.per.em</span></a><span class="parenthesis" start="41">)</span><span class="z">"</span><span id="wx2079" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2081"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-round" class="solar"><span class="function" start="1" pair-end="53" select="quick">round</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$width.in.points</span><span class="whitespace" start="23"> </span><span class="op" start="24">*</span><span class="whitespace" start="25"> </span><span class="parenthesis" start="26" pair-end="52" select="quick">(</span><a href="../../../xslt/base/html/param.xsl.html#v?pixels.per.inch" class="solar"><span class="variable" start="27" select="quick">$pixels.per.inch</span></a><span class="whitespace" start="43"> </span><span class="op" start="44">div</span><span class="whitespace" start="47"> </span><span class="numeric" start="48">72.0</span><span class="parenthesis" start="52">)</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx2102" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2106" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2108"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2114" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2118" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2122" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2124"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?contentdepth">contentdepth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2134"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2138"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2154" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2156"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">contentdepth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2167"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?units">units</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-units" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:length-units</span></a><span class="parenthesis">(</span><span class="axis" start="16">@</span><span class="qname" start="17" select="quick">contentdepth</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx2185" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w2187"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2191"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$units</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">%</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2207"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?cmagnitude">cmagnitude</span><span class="z">"</span><span class="z">
                            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-magnitude" class="solar"><span class="function" start="1" pair-end="33" select="quick">f:length-magnitude</span></a><span class="parenthesis">(</span><span class="axis" start="20">@</span><span class="qname" start="21" select="quick">contentdepth</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span id="wx2225" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2227"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$intrinsicdepth</span><span class="whitespace" start="16"> </span><span class="op" start="17">*</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$cmagnitude</span><span class="whitespace" start="30"> </span><span class="op" start="31">div</span><span class="whitespace" start="34"> </span><span class="numeric" start="35">100.0</span><span class="z">"</span><span id="wx2243" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w2245"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">px</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx2251" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2255" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2257"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2261"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-spec" class="solar"><span class="function" start="1" pair-end="28" select="quick">f:length-spec</span></a><span class="parenthesis">(</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">contentdepth</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx2273" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2277" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2281" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2285" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2287"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2291"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$intrinsicdepth</span><span class="z">"</span><span id="wx2299" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2301"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">px</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx2307" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2311" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2315" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2319" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2321"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scaled.contentdepth">scaled.contentdepth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2331"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$contentdepth</span><span class="whitespace" start="14"> </span><span class="op" start="15">!=</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2347"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?cdepth.in.points">cdepth.in.points</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-in-points" class="solar"><span class="function" start="1" pair-end="48" select="quick">f:length-in-points</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$contentdepth</span><span class="op" start="33">,</span><a href="../../../xslt/base/html/param.xsl.html#v?points.per.em" class="solar"><span class="variable" start="34" select="quick">$points.per.em</span></a><span class="parenthesis" start="48">)</span><span class="z">"</span><span id="wx2366" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2368"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$cdepth.in.points</span><span class="whitespace" start="18"> </span><span class="op" start="19">div</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">72.0</span><span class="whitespace" start="27">
                              </span><span class="op" start="56">*</span><span class="whitespace" start="57"> </span><a href="../../../xslt/base/html/param.xsl.html#v?pixels.per.inch" class="solar"><span class="variable" start="58" select="quick">$pixels.per.inch</span></a><span class="whitespace" start="74"> </span><span class="op" start="75">*</span><span class="whitespace" start="76"> </span><span class="variable" start="77" select="quick">$scale</span><span class="z">"</span><span id="wx2388" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2392" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2396" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2398"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?depth-units">depth-units</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2408"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">depth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2419"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-units" class="solar"><span class="function" start="1" pair-end="22" select="quick">f:length-units</span></a><span class="parenthesis">(</span><span class="axis" start="16">@</span><span class="qname" start="17" select="quick">depth</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span id="wx2431" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2435" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2439" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2441"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?depth">depth</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2457"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2461"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">depth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2472"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2476"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$depth-units</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">%</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2492"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">depth</span><span class="z">"</span><span id="wx2501" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2505" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2507"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2511"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-spec" class="solar"><span class="function" start="1" pair-end="21" select="quick">f:length-spec</span></a><span class="parenthesis">(</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">depth</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx2523" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2527" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2531" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2535" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2537"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2541"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx2551" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2555" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2559" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2563" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2565"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?html.depth">html.depth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2575"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2579"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2595" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2597"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$depth-units</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">%</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2613"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$depth</span><span class="z">"</span><span id="wx2621" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2625" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2627"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">depth</span><span class="whitespace" start="7"> </span><span class="op" start="8">and</span><span class="whitespace" start="11"> </span><span class="axis" start="12">@</span><span class="qname" start="13" select="quick">depth</span><span class="whitespace" start="18"> </span><span class="op" start="19">!=</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2649"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?depth.in.points">depth.in.points</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}length-in-points" class="solar"><span class="function" start="1" pair-end="41" select="quick">f:length-in-points</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$depth</span><span class="op" start="26">,</span><a href="../../../xslt/base/html/param.xsl.html#v?points.per.em" class="solar"><span class="variable" start="27" select="quick">$points.per.em</span></a><span class="parenthesis" start="41">)</span><span class="z">"</span><span id="wx2668" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2670"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-round" class="solar"><span class="function" start="1" pair-end="87" select="quick">round</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$depth.in.points</span><span class="whitespace" start="23"> </span><span class="op" start="24">div</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">72.0</span><span class="whitespace" start="32">
                                </span><span class="op" start="69">*</span><span class="whitespace" start="70"> </span><a href="../../../xslt/base/html/param.xsl.html#v?pixels.per.inch" class="solar"><span class="variable" start="71" select="quick">$pixels.per.inch</span></a><span class="parenthesis" start="87">)</span><span class="z">"</span><span id="wx2689" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2693" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2695"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2701" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2705" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2709" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2711"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?viewport">viewport</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2721"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2725"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?ignore.image.scaling" class="solar"><span class="variable" start="1" select="quick">$ignore.image.scaling</span></a><span class="whitespace" start="22"> </span><span class="op" start="23">!=</span><span class="whitespace" start="25"> </span><span class="numeric" start="26">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2741" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2743"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">ancestor::</span><span class="qname" start="11" select="quick">db:inlinemediaobject</span><span class="whitespace" start="31">
                        </span><span class="op" start="54">or</span><span class="whitespace" start="56"> </span><span class="axis" start="57">ancestor::</span><span class="qname" start="67" select="quick">db:inlineequation</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">0</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2761" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2763"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2767"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?make.graphic.viewport" class="solar"><span class="variable" start="1" select="quick">$make.graphic.viewport</span></a><span class="z">"</span><span id="wx2775" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2779" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2783" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2787" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;xsl:message&gt;=====================================
    scale: &lt;xsl:value-of select="$scale"/&gt;, &lt;xsl:value-of select="$scalefit"/&gt;
    @contentwidth &lt;xsl:value-of select="@contentwidth"/&gt;
    $contentwidth &lt;xsl:value-of select="$contentwidth"/&gt;
    scaled.contentwidth: &lt;xsl:value-of select="$scaled.contentwidth"/&gt;
    @width: &lt;xsl:value-of select="@width"/&gt;
    width: &lt;xsl:value-of select="$width"/&gt;
    html.width: &lt;xsl:value-of select="$html.width"/&gt;
    @contentdepth &lt;xsl:value-of select="@contentdepth"/&gt;
    $contentdepth &lt;xsl:value-of select="$contentdepth"/&gt;
    scaled.contentdepth: &lt;xsl:value-of select="$scaled.contentdepth"/&gt;
    @depth: &lt;xsl:value-of select="@depth"/&gt;
    depth: &lt;xsl:value-of select="$depth"/&gt;
    html.depth: &lt;xsl:value-of select="$html.depth"/&gt;
    align: &lt;xsl:value-of select="@align"/&gt;
    valign: &lt;xsl:value-of select="@valign"/&gt;&lt;/xsl:message&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    
    </span><span class="ww" id="w2793"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scaled">scaled</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">width</span><span class="op" start="7">|</span><span class="axis" start="8">@</span><span class="qname" start="9" select="quick">depth</span><span class="op" start="14">|</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">contentwidth</span><span class="op" start="28">|</span><span class="axis" start="29">@</span><span class="qname" start="30" select="quick">contentdepth</span><span class="whitespace" start="42">
                          </span><span class="op" start="67">|</span><span class="axis" start="68">@</span><span class="qname" start="69" select="quick">scale</span><span class="op" start="74">|</span><span class="axis" start="75">@</span><span class="qname" start="76" select="quick">scalefit</span><span class="z">"</span><span id="wx2824" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2826"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href">href</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#f?{http://docbook.org/xslt/ns/extension}mediaobject-href" class="solar"><span class="function" start="1" pair-end="29" select="quick">f:mediaobject-href</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$filename</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span id="wx2843" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2845"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?img">img</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2855"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> attempt to handle audio data </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w2863"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">self::</span><span class="qname" start="7" select="quick">db:audiodata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2874"><span class="es">&lt;</span><span class="en">object</span><span class="z"> </span><span class="atn">data</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$href</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm"> this is a complete hack; DocBook needs more markup </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="ww" id="w2890"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">condition</span><span class="whitespace" start="11"> </span><span class="op" start="12">=</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14">hidden</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2907"><span class="es">&lt;</span><span class="en">param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">hidden</span><span class="z">"</span><span class="z"> </span><span class="atn">value</span><span class="atneq">=</span><span class="z">"</span><span class="av">true</span><span class="z">"</span><span id="wx2921" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2925" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w2927"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">role</span><span class="whitespace" start="6"> </span><span class="op" start="7">=</span><span class="whitespace" start="8"> </span><span class="op">'</span><span class="literal" start="9">autostart</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w2944"><span class="es">&lt;</span><span class="en">param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">autostart</span><span class="z">"</span><span class="z"> </span><span class="atn">value</span><span class="atneq">=</span><span class="z">"</span><span class="av">true</span><span class="z">"</span><span id="wx2958" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2962" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">object</span><span id="wx2966" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2970" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2972"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">xmlns:svg</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2000/svg</span><span class="z">"</span><span class="z">
                  </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$format</span><span class="whitespace" start="8"> </span><span class="op" start="9">=</span><span class="whitespace" start="10"> </span><span class="op">'</span><span class="literal" start="11">svg</span><span class="op">'</span><span class="whitespace" start="16"> </span><span class="op" start="17">and</span><span class="whitespace" start="20"> </span><span class="qname" start="21" select="quick">svg:*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2998"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx3000" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3004" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w3006"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-lower-case" class="solar"><span class="function" start="1" pair-end="19" select="quick">lower-case</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$format</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">=</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">svg</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3025"><span class="es">&lt;</span><span class="en">object</span><span class="z"> </span><span class="atn">data</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$href</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">image/svg+xml</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3043"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}process-image-attributes" class="solar"><span class="tcall">t:process-image-attributes</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3053"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">alt</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$alt</span><span class="z">"</span><span id="wx3067" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3069"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html.depth</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.depth</span><span class="z">"</span><span id="wx3083" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3085"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html.width</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="z">"</span><span id="wx3099" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3101"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">longdesc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$longdesc</span><span class="z">"</span><span id="wx3115" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3117"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scale</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scale</span><span class="z">"</span><span id="wx3131" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3133"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scalefit</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scalefit</span><span class="z">"</span><span id="wx3147" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3149"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scaled.contentdepth</span><span class="z">"</span><span class="z">
                              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentdepth</span><span class="z">"</span><span id="wx3163" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3165"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scaled.contentwidth</span><span class="z">"</span><span class="z">
                              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentwidth</span><span class="z">"</span><span id="wx3179" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3181"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">viewport</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$viewport</span><span class="z">"</span><span id="wx3195" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3199" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3201"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="whitespace" start="7"> </span><span class="op" start="8">and</span><span class="whitespace" start="11"> </span><span class="axis" start="12">@</span><span class="qname" start="13" select="quick">align</span><span class="whitespace" start="18"> </span><span class="op" start="19">!=</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">center</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3223"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">align</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="z">"</span><span id="wx3238" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3242" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3244"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?use.embed.for.svg" class="solar"><span class="variable" start="1" select="quick">$use.embed.for.svg</span></a><span class="whitespace" start="19"> </span><span class="op" start="20">!=</span><span class="whitespace" start="22"> </span><span class="numeric" start="23">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3258"><span class="es">&lt;</span><span class="en">embed</span><span class="z"> </span><span class="atn">src</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$href</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">image/svg+xml</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w3276"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}process-image-attributes" class="solar"><span class="tcall">t:process-image-attributes</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w3286"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">alt</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$alt</span><span class="z">"</span><span id="wx3300" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3302"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html.depth</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.depth</span><span class="z">"</span><span id="wx3316" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3318"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html.width</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="z">"</span><span id="wx3332" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3334"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">longdesc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$longdesc</span><span class="z">"</span><span id="wx3348" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3350"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scale</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scale</span><span class="z">"</span><span id="wx3364" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3366"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scalefit</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scalefit</span><span class="z">"</span><span id="wx3380" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3382"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scaled.contentdepth</span><span class="z">"</span><span class="z">
                                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentdepth</span><span class="z">"</span><span id="wx3396" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3398"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scaled.contentwidth</span><span class="z">"</span><span class="z">
                                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentwidth</span><span class="z">"</span><span id="wx3412" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3414"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">viewport</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$viewport</span><span class="z">"</span><span id="wx3428" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3432" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="cl">embed</span><span id="wx3436" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3440" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">object</span><span id="wx3444" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3448" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3450"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3454"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$tag</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3466"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tag-attributes</span><span class="z">"</span><span id="wx3474" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w3476"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tag</span><span class="whitespace" start="5"> </span><span class="op" start="6">=</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">img</span><span class="op">'</span><span class="whitespace" start="13"> </span><span class="op" start="14">and</span><span class="whitespace" start="17"> </span><span class="axis" start="18">ancestor::</span><span class="qname" start="28" select="quick">db:imageobjectco</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3497"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w3501"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="z">&lt;!--</span><span class="cm"> It might be possible to handle some scaling; needs </span><span class="z">--&gt;</span><span class="txt">
                  </span><span class="z">&lt;!--</span><span class="cm"> more investigation </span><span class="z">--&gt;</span><span class="txt">
                  </span><span class="ww" id="w3519"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w3523"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">Warning: imagemaps not supported </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx3529" class="ec">&gt;</span></span><span class="txt">
                    </span><span class="ww" id="w3531"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">on scaled images</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx3537" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx3541" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3545" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w3547"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$imageproperties</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w3560"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w3564"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">Warning: imagemaps require image </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx3570" class="ec">&gt;</span></span><span class="txt">
                    </span><span class="ww" id="w3572"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">intrinsics extension</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx3578" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx3582" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3586" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w3588"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w3592"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">border</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">0</span><span class="z">"</span><span id="wx3606" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3608"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">usemap</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="55" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">#</span><span class="op">'</span><span class="op" start="11">,</span><a href="../../../xslt/base/html/graphics.xsl.html#f?{http://docbook.org/xslt/ns/extension}imagemap-name" class="solar"><span class="function" start="12" pair-end="54" select="quick">f:imagemap-name</span></a><span class="parenthesis">(</span><span class="axis" start="28">ancestor::</span><span class="qname" start="38" select="quick">db:imageobjectco</span><span class="parenthesis" start="54">)</span><span class="parenthesis" start="55">)</span><span class="z">"</span><span id="wx3633" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3637" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3641" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3645" class="ec">&gt;</span></span><span class="txt">
            
            </span><span class="ww" id="w3647"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">src</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$href</span><span class="z">"</span><span id="wx3661" class="sc">/&gt;</span></span><span class="txt">
            
            </span><span class="ww" id="w3663"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3674"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">align</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w3684"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w3688"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">center</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">middle</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3707" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3709"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w3713"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="z">"</span><span id="wx3722" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3726" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3730" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx3734" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx3738" class="ec">&gt;</span></span><span class="txt">
            
            </span><span class="ww" id="w3740"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}process-image-attributes" class="solar"><span class="tcall">t:process-image-attributes</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w3750"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">alt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w3760"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w3764"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$alt</span><span class="whitespace" start="5"> </span><span class="op" start="6">!=</span><span class="whitespace" start="8"> </span><span class="op">'</span><span class="literal" start="9"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w3780"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$alt</span><span class="z">"</span><span id="wx3788" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3792" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w3794"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">ancestor::</span><span class="qname" start="11" select="quick">db:figure</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w3805"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="1" pair-end="53" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="17">ancestor::</span><span class="qname" start="27" select="quick">db:figure</span><span class="step" start="36">/</span><span class="qname" start="37" select="quick">db:info</span><span class="step" start="44">/</span><span class="qname" start="45" select="quick">db:title</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx3821" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3825" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3829" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span id="wx3833" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3835"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html.depth</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.depth</span><span class="z">"</span><span id="wx3849" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3851"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">html.width</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="z">"</span><span id="wx3865" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3867"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">longdesc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$longdesc</span><span class="z">"</span><span id="wx3881" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3883"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scale</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scale</span><span class="z">"</span><span id="wx3897" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3899"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scalefit</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scalefit</span><span class="z">"</span><span id="wx3913" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3915"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scaled.contentdepth</span><span class="z">"</span><span class="z">
                              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentdepth</span><span class="z">"</span><span id="wx3929" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3931"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">scaled.contentwidth</span><span class="z">"</span><span class="z">
                              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentwidth</span><span class="z">"</span><span id="wx3945" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w3947"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">viewport</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$viewport</span><span class="z">"</span><span id="wx3961" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx3965" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx3969" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3973" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3977" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx3981" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3983"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?bgcolor">bgcolor</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pi" class="solar"><span class="function" start="1" pair-end="104" select="quick">f:pi</span></a><span class="parenthesis">(</span><span class="axis" start="6">ancestor-or-self::</span><span class="qname" start="24" select="quick">db:imageobject</span><span class="step" start="38">/</span><span class="node" start="39" pair-end="70" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="62">dbhtml</span><span class="op">'</span><span class="parenthesis" start="70">)</span><span class="op" start="71">,</span><span class="whitespace" start="72">
                          </span><span class="op">'</span><span class="literal" start="86">background-color</span><span class="op">'</span><span class="parenthesis" start="104">)</span><span class="z">"</span><span id="wx4013" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4015"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?use.viewport">use.viewport</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$viewport</span><span class="whitespace" start="10"> </span><span class="op" start="11">!=</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="whitespace" start="15">
                          </span><span class="op" start="40">and</span><span class="whitespace" start="43"> </span><span class="parenthesis" start="44" pair-end="225" select="quick">(</span><span class="variable" start="45" select="quick">$html.width</span><span class="whitespace" start="56"> </span><span class="op" start="57">!=</span><span class="whitespace" start="59"> </span><span class="op">'</span><span class="literal" start="60"></span><span class="op">'</span><span class="whitespace" start="62">
                          </span><span class="op" start="92">or</span><span class="whitespace" start="94"> </span><span class="parenthesis" start="95" pair-end="137" select="quick">(</span><span class="variable" start="96" select="quick">$html.depth</span><span class="whitespace" start="107"> </span><span class="op" start="108">!=</span><span class="whitespace" start="110"> </span><span class="op">'</span><span class="literal" start="111"></span><span class="op">'</span><span class="whitespace" start="113"> </span><span class="op" start="114">and</span><span class="whitespace" start="117"> </span><span class="variable" start="118" select="quick">$depth-units</span><span class="whitespace" start="130"> </span><span class="op" start="131">!=</span><span class="whitespace" start="133"> </span><span class="op">'</span><span class="literal" start="134">%</span><span class="op">'</span><span class="parenthesis" start="137">)</span><span class="whitespace" start="138">
                          </span><span class="op" start="168">or</span><span class="whitespace" start="170"> </span><span class="variable" start="171" select="quick">$bgcolor</span><span class="whitespace" start="179"> </span><span class="op" start="180">!=</span><span class="whitespace" start="182"> </span><span class="op">'</span><span class="literal" start="183"></span><span class="op">'</span><span class="whitespace" start="185">
                          </span><span class="op" start="215">or</span><span class="whitespace" start="217"> </span><span class="axis" start="218">@</span><span class="qname" start="219" select="quick">valign</span><span class="parenthesis" start="225">)</span><span class="z">"</span><span id="wx4082" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4084"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4088"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$use.viewport</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4098"><span class="es">&lt;</span><span class="en">table</span><span class="z"> </span><span class="atn">border</span><span class="atneq">=</span><span class="z">"</span><span class="av">0</span><span class="z">"</span><span class="z"> </span><span class="atn">summary</span><span class="atneq">=</span><span class="z">"</span><span class="av">Manufactured viewport for HTML image</span><span class="z">"</span><span class="z">
               </span><span class="atn">cellspacing</span><span class="atneq">=</span><span class="z">"</span><span class="av">0</span><span class="z">"</span><span class="z"> </span><span class="atn">cellpadding</span><span class="atneq">=</span><span class="z">"</span><span class="av">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4126"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="whitespace" start="12"> </span><span class="op" start="13">!=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4142"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w4152"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="z">"</span><span id="wx4160" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx4164" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4168" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w4170"><span class="es">&lt;</span><span class="en">tr</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4174"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.depth</span><span class="whitespace" start="12"> </span><span class="op" start="13">!=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="whitespace" start="18"> </span><span class="op" start="19">and</span><span class="whitespace" start="22"> </span><span class="variable" start="23" select="quick">$depth-units</span><span class="whitespace" start="35"> </span><span class="op" start="36">!=</span><span class="whitespace" start="38"> </span><span class="op">'</span><span class="literal" start="39">%</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="z">&lt;!--</span><span class="cm"> don't do this for percentages because browsers get confused </span><span class="z">--&gt;</span><span class="txt">
              </span><span class="ww" id="w4204"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w4214"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">height: </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4220" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w4222"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.depth</span><span class="z">"</span><span id="wx4230" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ww" id="w4232"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">px</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4238" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx4242" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4246" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w4248"><span class="es">&lt;</span><span class="en">td</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w4252"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$bgcolor</span><span class="whitespace" start="9"> </span><span class="op" start="10">!=</span><span class="whitespace" start="12"> </span><span class="op">'</span><span class="literal" start="13"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w4268"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">style</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4278"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">background-color: </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4284" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4286"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$bgcolor</span><span class="z">"</span><span id="wx4294" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx4298" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4302" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w4304"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w4315"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">align</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4325"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="z">"</span><span id="wx4334" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx4338" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4342" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w4344"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">valign</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w4355"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">valign</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4365"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">valign</span><span class="z">"</span><span id="wx4374" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx4378" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4382" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w4384"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$img</span><span class="z">"</span><span id="wx4392" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">td</span><span id="wx4396" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">tr</span><span id="wx4400" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">table</span><span id="wx4404" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4408" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w4410"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4414"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$img</span><span class="z">"</span><span id="wx4422" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx4426" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4430" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w4432"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$tag</span><span class="whitespace" start="5"> </span><span class="op" start="6">=</span><span class="whitespace" start="7"> </span><span class="op">'</span><span class="literal" start="8">img</span><span class="op">'</span><span class="whitespace" start="13">
                  </span><span class="op" start="30">and</span><span class="whitespace" start="33"> </span><span class="axis" start="34">ancestor::</span><span class="qname" start="44" select="quick">db:imageobjectco</span><span class="whitespace" start="60">
                  </span><span class="op" start="77">and</span><span class="whitespace" start="80"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="81" pair-end="92" select="quick">not</span></a><span class="parenthesis">(</span><span class="variable" start="85" select="quick">$scaled</span><span class="parenthesis" start="92">)</span><span class="whitespace" start="93">
                  </span><span class="op" start="110">and</span><span class="whitespace" start="113"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="114" pair-end="137" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="121" select="quick">$imageproperties</span><span class="parenthesis" start="137">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w4467"><span class="es">&lt;</span><span class="en">map</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="../../../xslt/base/html/graphics.xsl.html#f?{http://docbook.org/xslt/ns/extension}imagemap-name" class="solar"><span class="function" start="1" pair-end="43" select="quick">f:imagemap-name</span></a><span class="parenthesis">(</span><span class="axis" start="17">ancestor::</span><span class="qname" start="27" select="quick">db:imageobjectco</span><span class="parenthesis" start="43">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w4483"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">ancestor::</span><span class="qname" start="11" select="quick">db:imageobjectco</span><span class="step" start="27">/</span><span class="qname" start="28" select="quick">db:areaspec</span><span class="step" start="39">//</span><span class="qname" start="41" select="quick">db:area</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w4498"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?units">units</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z">
                        </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="11" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">units</span><span class="parenthesis" start="11">)</span><span class="whitespace" start="12"> </span><span class="op" start="13">then</span><span class="whitespace" start="17"> </span><span class="axis" start="18">@</span><span class="qname" start="19" select="quick">units</span><span class="whitespace" start="24">
                                </span><span class="op" start="55">else</span><span class="whitespace" start="59"> </span><span class="if" start="60">if</span><span class="whitespace" start="62"> </span><span class="parenthesis" start="63" pair-end="73" select="quick">(</span><span class="context" start="64">..</span><span class="step" start="66">/</span><span class="axis" start="67">@</span><span class="qname" start="68" select="quick">units</span><span class="parenthesis" start="73">)</span><span class="whitespace" start="74"> </span><span class="op" start="75">then</span><span class="whitespace" start="79"> </span><span class="context" start="80">..</span><span class="step" start="82">/</span><span class="axis" start="83">@</span><span class="qname" start="84" select="quick">units</span><span class="whitespace" start="89">
                                </span><span class="op" start="125">else</span><span class="whitespace" start="129"> </span><span class="op">'</span><span class="literal" start="130">calspair</span><span class="op">'</span><span class="z">"</span><span id="wx4552" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w4554"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w4558"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$units</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">calspair</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w4574"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?coords">coords</span><span class="z">"</span><span class="z">
                            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="87" select="quick">tokenize</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="10" pair-end="33" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="26">@</span><span class="qname" start="27" select="quick">coords</span><span class="parenthesis" start="33">)</span><span class="op" start="34">,</span><span class="whitespace" start="35">
                                    </span><span class="op">'</span><span class="literal" start="79">[\s,]+</span><span class="op">'</span><span class="parenthesis" start="87">)</span><span class="z">"</span><span id="wx4600" class="sc">/&gt;</span></span><span class="txt">
              
              </span><span class="ww" id="w4602"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?x1p">x1p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="22" select="quick">xs:decimal</span><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$coords</span><span class="filter" start="19" pair-end="21" select="quick">[</span><span class="numeric" start="20">1</span><span class="filter" start="21">]</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">div</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">100.0</span><span class="z">"</span><span id="wx4626" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w4628"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?y1p">y1p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="22" select="quick">xs:decimal</span><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$coords</span><span class="filter" start="19" pair-end="21" select="quick">[</span><span class="numeric" start="20">2</span><span class="filter" start="21">]</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">div</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">100.0</span><span class="z">"</span><span id="wx4652" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w4654"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?x2p">x2p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="22" select="quick">xs:decimal</span><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$coords</span><span class="filter" start="19" pair-end="21" select="quick">[</span><span class="numeric" start="20">3</span><span class="filter" start="21">]</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">div</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">100.0</span><span class="z">"</span><span id="wx4678" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w4680"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?y2p">y2p</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="22" select="quick">xs:decimal</span><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$coords</span><span class="filter" start="19" pair-end="21" select="quick">[</span><span class="numeric" start="20">4</span><span class="filter" start="21">]</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">div</span><span class="whitespace" start="27"> </span><span class="numeric" start="28">100.0</span><span class="z">"</span><span id="wx4704" class="sc">/&gt;</span></span><span class="txt">
              
              </span><span class="ww" id="w4706"><span class="es">&lt;</span><span class="en">area</span><span class="z"> </span><span class="atn">shape</span><span class="atneq">=</span><span class="z">"</span><span class="av">rect</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w4716"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4720"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">linkends</span><span class="whitespace" start="10">
                                  </span><span class="op" start="43">or</span><span class="whitespace" start="45"> </span><span class="parenthesis" start="46" pair-end="82" select="quick">(</span><span class="axis" start="47">parent::</span><span class="qname" start="55" select="quick">db:areaset</span><span class="whitespace" start="65"> </span><span class="op" start="66">and</span><span class="whitespace" start="69"> </span><span class="context" start="70">..</span><span class="step" start="72">/</span><span class="axis" start="73">@</span><span class="qname" start="74" select="quick">linkends</span><span class="parenthesis" start="82">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w4745"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?idrefs">idrefs</span><span class="z">"</span><span class="z">
                                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="14" select="quick">(</span><span class="axis" start="5">@</span><span class="qname" start="6" select="quick">linkends</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15">
                                          </span><span class="op" start="56">then</span><span class="whitespace" start="60"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="61" pair-end="86" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="axis" start="77">@</span><span class="qname" start="78" select="quick">linkends</span><span class="parenthesis" start="86">)</span><span class="whitespace" start="87">
                                          </span><span class="op" start="128">else</span><span class="whitespace" start="132"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-normalize-space" class="solar"><span class="function" start="133" pair-end="161" select="quick">normalize-space</span></a><span class="parenthesis">(</span><span class="context" start="149">..</span><span class="step" start="151">/</span><span class="axis" start="152">@</span><span class="qname" start="153" select="quick">linkends</span><span class="parenthesis" start="161">)</span><span class="z">"</span><span id="wx4782" class="sc">/&gt;</span></span><span class="txt">
                    
                    </span><span class="ww" id="w4784"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?target">target</span><span class="z">"</span><span class="z">
                                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-key" class="solar"><span class="function" start="1" pair-end="36" select="quick">key</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="5">id</span><span class="op">'</span><span class="op" start="9">,</span><span class="whitespace" start="10"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="11" pair-end="35" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="20" select="quick">$idrefs</span><span class="op" start="27">,</span><span class="whitespace" start="28"> </span><span class="op">'</span><span class="literal" start="29">[\s]</span><span class="op">'</span><span class="parenthesis" start="35">)</span><span class="parenthesis" start="36">)</span><span class="whitespace" start="37">
                                          </span><span class="filter" start="72" pair-end="74" select="quick">[</span><span class="numeric" start="73">1</span><span class="filter" start="74">]</span><span class="z">"</span><span id="wx4818" class="sc">/&gt;</span></span><span class="txt">
                    
                    </span><span class="ww" id="w4820"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$target</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                      </span><span class="ww" id="w4830"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">href</span><span class="z">"</span><span class="z">
                                     </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/html.xsl.html#f?{http://docbook.org/xslt/ns/extension}href" class="solar"><span class="function" start="1" pair-end="17" select="quick">f:href</span></a><span class="parenthesis">(</span><span class="step" start="8">/</span><span class="op" start="9">,</span><span class="variable" start="10" select="quick">$target</span><span class="parenthesis" start="17">)</span><span class="z">"</span><span id="wx4849" class="sc">/&gt;</span></span><span class="txt">
                    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx4853" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4857" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4859"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xlink:href</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                    </span><span class="ww" id="w4870"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">href</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">xlink:href</span><span class="z">"</span><span id="wx4885" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx4889" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx4893" class="ec">&gt;</span></span><span class="txt">
                
                </span><span class="ww" id="w4895"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">coords</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w4905"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-round" class="solar"><span class="function" start="1" pair-end="39" select="quick">round</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$x1p</span><span class="whitespace" start="11"> </span><span class="op" start="12">*</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$intrinsicwidth</span><span class="whitespace" start="29"> </span><span class="op" start="30">div</span><span class="whitespace" start="33"> </span><span class="numeric" start="34">100.0</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx4924" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4926"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">,</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4932" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4934"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-round" class="solar"><span class="function" start="1" pair-end="99" select="quick">round</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$intrinsicdepth</span><span class="whitespace" start="22">
                                        </span><span class="op" start="63">-</span><span class="whitespace" start="64"> </span><span class="parenthesis" start="65" pair-end="98" select="quick">(</span><span class="variable" start="66" select="quick">$y1p</span><span class="whitespace" start="70"> </span><span class="op" start="71">*</span><span class="whitespace" start="72"> </span><span class="variable" start="73" select="quick">$intrinsicdepth</span><span class="whitespace" start="88"> </span><span class="op" start="89">div</span><span class="whitespace" start="92"> </span><span class="numeric" start="93">100.0</span><span class="parenthesis" start="98">)</span><span class="parenthesis" start="99">)</span><span class="z">"</span><span id="wx4959" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4961"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">,</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4967" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4969"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-round" class="solar"><span class="function" start="1" pair-end="39" select="quick">round</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$x2p</span><span class="whitespace" start="11"> </span><span class="op" start="12">*</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$intrinsicwidth</span><span class="whitespace" start="29"> </span><span class="op" start="30">div</span><span class="whitespace" start="33"> </span><span class="numeric" start="34">100.0</span><span class="parenthesis" start="39">)</span><span class="z">"</span><span id="wx4988" class="sc">/&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4990"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">,</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx4996" class="ec">&gt;</span></span><span class="txt">
                  </span><span class="ww" id="w4998"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-round" class="solar"><span class="function" start="1" pair-end="99" select="quick">round</span></a><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$intrinsicdepth</span><span class="whitespace" start="22">
                                        </span><span class="op" start="63">-</span><span class="whitespace" start="64"> </span><span class="parenthesis" start="65" pair-end="98" select="quick">(</span><span class="variable" start="66" select="quick">$y2p</span><span class="whitespace" start="70"> </span><span class="op" start="71">*</span><span class="whitespace" start="72"> </span><span class="variable" start="73" select="quick">$intrinsicdepth</span><span class="whitespace" start="88"> </span><span class="op" start="89">div</span><span class="whitespace" start="92"> </span><span class="numeric" start="93">100.0</span><span class="parenthesis" start="98">)</span><span class="parenthesis" start="99">)</span><span class="z">"</span><span id="wx5023" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5027" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="cl">area</span><span id="wx5031" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5035" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ww" id="w5037"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w5041"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w5045"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">Warning: only calspair supported </span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5051" class="ec">&gt;</span></span><span class="txt">
                </span><span class="ww" id="w5053"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">in imageobjectco</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx5059" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx5063" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5067" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5071" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx5075" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">map</span><span id="wx5079" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5083" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx5087" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5089"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{http://docbook.org/xslt/ns/extension}imagemap-name">f:imagemap-name</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5105"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?ioco">ioco</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element(db:imageobjectco)</span><span class="z">"</span><span id="wx5119" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> this whole test for mapid exists almost exclusively to make the xspec tests
    pass. It's probably overkill, but it might come in useful I suppose </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w5125"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5129"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="61" select="quick">exists</span></a><span class="parenthesis">(</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pi" class="solar"><span class="function" start="8" pair-end="60" select="quick">f:pi</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$ioco</span><span class="step" start="18">/</span><span class="node" start="19" pair-end="50" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="42">dbhtml</span><span class="op">'</span><span class="parenthesis" start="50">)</span><span class="op" start="51">,</span><span class="whitespace" start="52"> </span><span class="op">'</span><span class="literal" start="53">mapid</span><span class="op">'</span><span class="parenthesis" start="60">)</span><span class="parenthesis" start="61">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5157"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z">
            </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}pi" class="solar"><span class="function" start="1" pair-end="53" select="quick">f:pi</span></a><span class="parenthesis">(</span><span class="variable" start="6" select="quick">$ioco</span><span class="step" start="11">/</span><span class="node" start="12" pair-end="43" select="quick">processing-instruction</span><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="35">dbhtml</span><span class="op">'</span><span class="parenthesis" start="43">)</span><span class="op" start="44">,</span><span class="whitespace" start="45"> </span><span class="op">'</span><span class="literal" start="46">mapid</span><span class="op">'</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx5180" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5184" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w5186"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5190"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-generate-id" class="solar"><span class="function" start="1" pair-end="18" select="quick">generate-id</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$ioco</span><span class="parenthesis" start="18">)</span><span class="z">"</span><span id="wx5201" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5205" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5209" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx5213" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w5215"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}process-image-attributes">t:process-image-attributes</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w5225"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?alt">alt</span><span class="z">"</span><span id="wx5233" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5235"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?html.width">html.width</span><span class="z">"</span><span id="wx5243" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5245"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?html.depth">html.depth</span><span class="z">"</span><span id="wx5253" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5255"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?longdesc">longdesc</span><span class="z">"</span><span id="wx5263" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5265"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scale">scale</span><span class="z">"</span><span id="wx5273" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5275"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scalefit">scalefit</span><span class="z">"</span><span id="wx5283" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5285"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scaled.contentdepth">scaled.contentdepth</span><span class="z">"</span><span id="wx5293" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5295"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?scaled.contentwidth">scaled.contentwidth</span><span class="z">"</span><span id="wx5303" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w5305"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?viewport">viewport</span><span class="z">"</span><span id="wx5313" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5315"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5319"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">contentwidth</span><span class="whitespace" start="14"> </span><span class="op" start="15">or</span><span class="whitespace" start="17"> </span><span class="axis" start="18">@</span><span class="qname" start="19" select="quick">contentdepth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> ignore @width/@depth, @scale, and @scalefit if specified </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w5339"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">contentwidth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5350"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5360"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentwidth</span><span class="z">"</span><span id="wx5368" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5372" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5376" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w5378"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">contentdepth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5389"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">height</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5399"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentdepth</span><span class="z">"</span><span id="wx5407" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5411" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5415" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5419" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w5421"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-number" class="solar"><span class="function" start="1" pair-end="14" select="quick">number</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$scale</span><span class="parenthesis" start="14">)</span><span class="whitespace" start="15"> </span><span class="op" start="16">!=</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">1.0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> scaling is always uniform, we only have to specify one dimension </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> ignore @scalefit if specified </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w5446"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5456"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentwidth</span><span class="z">"</span><span id="wx5464" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5468" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5472" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w5474"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scalefit</span><span class="whitespace" start="10"> </span><span class="op" start="11">!=</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5488"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w5492"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="1" pair-end="26" select="quick">contains</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$html.width</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">%</span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5510"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w5514"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$viewport</span><span class="whitespace" start="10"> </span><span class="op" start="11">!=</span><span class="whitespace" start="13"> </span><span class="numeric" start="14">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="z">&lt;!--</span><span class="cm"> The *viewport* will be scaled, so use 100% here! </span><span class="z">--&gt;</span><span class="txt">
                </span><span class="ww" id="w5532"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w5542"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">100%</span><span class="op">'</span><span class="z">"</span><span id="wx5552" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5556" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5560" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w5562"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w5566"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w5576"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="z">"</span><span id="wx5584" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5588" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5592" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5596" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5600" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w5602"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-contains" class="solar"><span class="function" start="1" pair-end="26" select="quick">contains</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$html.depth</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">%</span><span class="op">'</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm"> HTML doesn't deal with this case very well...do nothing </span><span class="z">--&gt;</span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5626" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w5628"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentwidth</span><span class="whitespace" start="21"> </span><span class="op" start="22">!=</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25"></span><span class="op">'</span><span class="whitespace" start="27"> </span><span class="op" start="28">and</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$html.width</span><span class="whitespace" start="43"> </span><span class="op" start="44">!=</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47"></span><span class="op">'</span><span class="whitespace" start="49">
                          </span><span class="op" start="74">and</span><span class="whitespace" start="77"> </span><span class="variable" start="78" select="quick">$scaled.contentdepth</span><span class="whitespace" start="98"> </span><span class="op" start="99">!=</span><span class="whitespace" start="101"> </span><span class="op">'</span><span class="literal" start="102"></span><span class="op">'</span><span class="whitespace" start="104"> </span><span class="op" start="105">and</span><span class="whitespace" start="108"> </span><span class="variable" start="109" select="quick">$html.depth</span><span class="whitespace" start="120"> </span><span class="op" start="121">!=</span><span class="whitespace" start="123"> </span><span class="op">'</span><span class="literal" start="124"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm"> scalefit should not be anamorphic; figure out which direction </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="z">&lt;!--</span><span class="cm"> has the limiting scale factor and scale in that direction </span><span class="z">--&gt;</span><span class="txt">
            </span><span class="ww" id="w5682"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w5686"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="whitespace" start="12"> </span><span class="op" start="13">div</span><span class="whitespace" start="16"> </span><span class="variable" start="17" select="quick">$scaled.contentwidth</span><span class="whitespace" start="37"> </span><span class="qname" start="38" select="quick">&amp;</span><span class="op" start="39">gt</span><span class="qname" start="41" select="quick">;</span><span class="whitespace" start="42">
                              </span><span class="variable" start="71" select="quick">$html.depth</span><span class="whitespace" start="82"> </span><span class="op" start="83">div</span><span class="whitespace" start="86"> </span><span class="variable" start="87" select="quick">$scaled.contentdepth</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w5710"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">height</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w5720"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.depth</span><span class="z">"</span><span id="wx5728" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5732" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5736" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w5738"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w5742"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                  </span><span class="ww" id="w5752"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="z">"</span><span id="wx5760" class="sc">/&gt;</span></span><span class="txt">
                </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5764" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx5768" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5772" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5776" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w5778"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentwidth</span><span class="whitespace" start="21"> </span><span class="op" start="22">!=</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25"></span><span class="op">'</span><span class="whitespace" start="27"> </span><span class="op" start="28">and</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$html.width</span><span class="whitespace" start="43"> </span><span class="op" start="44">!=</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5804"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">width</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w5814"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.width</span><span class="z">"</span><span id="wx5822" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5826" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5830" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w5832"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$scaled.contentdepth</span><span class="whitespace" start="21"> </span><span class="op" start="22">!=</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25"></span><span class="op">'</span><span class="whitespace" start="27"> </span><span class="op" start="28">and</span><span class="whitespace" start="31"> </span><span class="variable" start="32" select="quick">$html.depth</span><span class="whitespace" start="43"> </span><span class="op" start="44">!=</span><span class="whitespace" start="46"> </span><span class="op">'</span><span class="literal" start="47"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w5858"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">height</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w5868"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$html.depth</span><span class="z">"</span><span id="wx5876" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5880" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5884" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5888" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx5892" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx5896" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5898"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$alt</span><span class="whitespace" start="5"> </span><span class="op" start="6">!=</span><span class="whitespace" start="8"> </span><span class="op">'</span><span class="literal" start="9"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5914"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">alt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5924"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$alt</span><span class="z">"</span><span id="wx5932" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5936" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5940" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5942"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$longdesc</span><span class="whitespace" start="10"> </span><span class="op" start="11">!=</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w5958"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">longdesc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w5968"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$longdesc</span><span class="z">"</span><span id="wx5976" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx5980" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx5984" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w5986"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="whitespace" start="7"> </span><span class="op" start="8">and</span><span class="whitespace" start="11"> </span><span class="variable" start="12" select="quick">$viewport</span><span class="whitespace" start="21"> </span><span class="op" start="22">=</span><span class="whitespace" start="23"> </span><span class="numeric" start="24">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6005"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">align</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6015"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6019"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="whitespace" start="7"> </span><span class="op" start="8">=</span><span class="whitespace" start="9"> </span><span class="op">'</span><span class="literal" start="10">center</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">middle</span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6038" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6040"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6044"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">align</span><span class="z">"</span><span id="wx6053" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6057" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6061" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:attribute</span><span id="wx6065" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6069" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6073" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w6079"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:mediaobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6089"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?olist">olist</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="filter" start="2" pair-end="43" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="3" pair-end="20" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="7">self::</span><span class="qname" start="13" select="quick">db:info</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">and</span><span class="whitespace" start="25"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="26" pair-end="42" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="30">self::</span><span class="qname" start="36" select="quick">db:alt</span><span class="parenthesis" start="42">)</span><span class="filter" start="43">]</span><span class="z">"</span><span id="wx6118" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6120"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?object.index">object.index</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#f?{http://docbook.org/xslt/ns/extension}select-mediaobject-index" class="solar"><span class="function" start="1" pair-end="34" select="quick">f:select-mediaobject-index</span></a><span class="parenthesis">(</span><span class="variable" start="28" select="quick">$olist</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx6137" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6139"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?object">object</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$olist</span><span class="filter" start="7" pair-end="34" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-position" class="solar"><span class="function" start="8" pair-end="17" select="quick">position</span></a><span class="parenthesis">(</span><span class="parenthesis" start="17">)</span><span class="whitespace" start="18"> </span><span class="op" start="19">=</span><span class="whitespace" start="20"> </span><span class="variable" start="21" select="quick">$object.index</span><span class="filter" start="34">]</span><span class="z">"</span><span id="wx6162" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6164"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?center">center</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="32" select="quick">(</span><span class="variable" start="5" select="quick">$object</span><span class="step" start="12">/</span><span class="qname" start="13" select="quick">*</span><span class="step" start="14">/</span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">align</span><span class="whitespace" start="21"> </span><span class="op" start="22">=</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">center</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="whitespace" start="33"> </span><span class="op" start="34">then</span><span class="whitespace" start="38"> </span><span class="op">'</span><span class="literal" start="39">centerimg</span><span class="op">'</span><span class="whitespace" start="50"> </span><span class="op" start="51">else</span><span class="whitespace" start="55"> </span><span class="parenthesis" start="56" pair-end="57" select="quick">(</span><span class="parenthesis" start="57">)</span><span class="z">"</span><span id="wx6204" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> hack </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w6210"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6214"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="step" start="8">/</span><span class="axis" start="9">self::</span><span class="qname" start="15" select="quick">db:audioobject</span><span class="whitespace" start="29">
                      </span><span class="op" start="50">and</span><span class="whitespace" start="53"> </span><span class="variable" start="54" select="quick">$object</span><span class="step" start="61">/</span><span class="qname" start="62" select="quick">db:audiodata</span><span class="step" start="74">/</span><span class="axis" start="75">@</span><span class="qname" start="76" select="quick">condition</span><span class="op" start="85">=</span><span class="op">'</span><span class="literal" start="86">hidden</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> don't output a div wrapper </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w6244"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="z">"</span><span id="wx6252" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6256" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6258"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6262"><span class="es">&lt;</span><span class="en">div</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6266"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#t?{http://docbook.org/xslt/ns/template}id" class="solar"><span class="tcall">t:id</span></a><span class="z">"</span><span id="wx6274" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6276"><span class="es">&lt;</span><span class="enxsl">xsl:attribute</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">class</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="1" pair-end="49" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="parenthesis" start="13" pair-end="43" select="quick">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="14" pair-end="26" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="25">.</span><span class="parenthesis" start="26">)</span><span class="op" start="27">,</span><span class="whitespace" start="28"> </span><span class="axis" start="29">@</span><span class="qname" start="30" select="quick">role</span><span class="op" start="34">,</span><span class="whitespace" start="35"> </span><span class="variable" start="36" select="quick">$center</span><span class="parenthesis" start="43">)</span><span class="op" start="44">,</span><span class="whitespace" start="45"> </span><span class="op">'</span><span class="literal" start="46"> </span><span class="op">'</span><span class="parenthesis" start="49">)</span><span class="z">"</span><span id="wx6310" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6312"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?html.longdesc" class="solar"><span class="variable" start="1" select="quick">$html.longdesc</span></a><span class="whitespace" start="15"> </span><span class="op" start="16">!=</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">0</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><a href="../../../xslt/base/html/param.xsl.html#v?html.longdesc.link" class="solar"><span class="variable" start="25" select="quick">$html.longdesc.link</span></a><span class="whitespace" start="44"> </span><span class="op" start="45">!=</span><span class="whitespace" start="47"> </span><span class="numeric" start="48">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6334"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}longdesc-link" class="solar"><span class="tcall">t:longdesc-link</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w6344"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">textobject</span><span class="z">"</span><span class="z">
                              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:textobject</span><span class="filter" start="14" pair-end="29" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="15" pair-end="28" select="quick">not</span></a><span class="parenthesis">(</span><span class="qname" start="19" select="quick">db:phrase</span><span class="parenthesis" start="28">)</span><span class="filter" start="29">]</span><span class="filter" start="30" pair-end="32" select="quick">[</span><span class="numeric" start="31">1</span><span class="filter" start="32">]</span><span class="z">"</span><span id="wx6367" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx6371" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx6375" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6377"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$object</span><span class="z">"</span><span id="wx6385" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6387"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:caption</span><span class="z">"</span><span id="wx6395" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx6399" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6403" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6407" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6411" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6413"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:inlinemediaobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6423"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6438"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#t?{http://docbook.org/xslt/ns/template}id" class="solar"><span class="tcall">t:id</span></a><span class="z">"</span><span id="wx6446" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6448"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/html.xsl.html#t?class" class="solar"><span class="tcall">class</span></a><span class="z">"</span><span id="wx6456" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6458"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#t?{http://docbook.org/xslt/ns/template}select-mediaobject" class="solar"><span class="tcall">t:select-mediaobject</span></a><span class="z">"</span><span id="wx6466" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx6470" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6474" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6476"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:programlisting</span><span class="step" start="18">/</span><span class="qname" start="19" select="quick">db:inlinemediaobject</span><span class="whitespace" start="39">
                       </span><span class="op" start="61">|</span><span class="qname" start="62" select="quick">db:screen</span><span class="step" start="71">/</span><span class="qname" start="72" select="quick">db:inlinemediaobject</span><span class="z">"</span><span class="z"> </span><span class="atn">priority</span><span class="atneq">=</span><span class="z">"</span><span class="av">2</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="z">&lt;!--</span><span class="cm"> the additional span causes problems in some cases </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w6503"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#t?{http://docbook.org/xslt/ns/template}select-mediaobject" class="solar"><span class="tcall">t:select-mediaobject</span></a><span class="z">"</span><span id="wx6511" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6515" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w6521"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:imageobjectco</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6531"><span class="es">&lt;</span><span class="en">div</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6546"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#t?{http://docbook.org/xslt/ns/template}id" class="solar"><span class="tcall">t:id</span></a><span class="z">"</span><span id="wx6554" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6556"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/html.xsl.html#t?class" class="solar"><span class="tcall">class</span></a><span class="z">"</span><span id="wx6564" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6566"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:imageobject</span><span class="z">"</span><span id="wx6574" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6576"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:calloutlist</span><span class="z">"</span><span id="wx6584" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx6588" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6592" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6594"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:imageobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6604"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6608"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">xmlns:svg</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2000/svg</span><span class="z">"</span><span class="z">
                </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">svg:*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6624"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx6626" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6630" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w6632"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6636"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:imagedata</span><span class="z">"</span><span id="wx6644" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6648" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6652" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6656" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6658"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:imagedata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6668"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?filename">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#f?{http://docbook.org/xslt/ns/extension}mediaobject-filename" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:mediaobject-filename</span></a><span class="parenthesis">(</span><span class="context" start="24">..</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx6685" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w6687"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w6691"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">format</span><span class="op" start="8">=</span><span class="op">'</span><span class="literal" start="9">linespecific</span><span class="op">'</span><span class="whitespace" start="23"> </span><span class="op" start="24">and</span><span class="whitespace" start="27"> </span><a href="../../../xslt/base/html/param.xsl.html#v?textdata.default.encoding" class="solar"><span class="variable" start="28" select="quick">$textdata.default.encoding</span></a><span class="whitespace" start="54"> </span><span class="op" start="55">!=</span><span class="whitespace" start="57"> </span><span class="op">'</span><span class="literal" start="58"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6716"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text" class="solar"><span class="function" start="1" pair-end="94" select="quick">unparsed-text</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$filename</span><span class="op" start="24">,</span><span class="whitespace" start="25">
                              </span><a href="../../../xslt/base/html/param.xsl.html#v?textdata.default.encoding" class="solar"><span class="variable" start="68" select="quick">$textdata.default.encoding</span></a><span class="parenthesis" start="94">)</span><span class="z">"</span><span id="wx6730" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6734" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w6736"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">format</span><span class="op" start="8">=</span><span class="op">'</span><span class="literal" start="9">linespecific</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6751"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text" class="solar"><span class="function" start="1" pair-end="24" select="quick">unparsed-text</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$filename</span><span class="parenthesis" start="24">)</span><span class="z">"</span><span id="wx6762" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6766" class="ec">&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w6768"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w6772"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?longdesc.uri">longdesc.uri</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#f?{http://docbook.org/xslt/ns/extension}longdesc-uri" class="solar"><span class="function" start="1" pair-end="50" select="quick">f:longdesc-uri</span></a><span class="parenthesis">(</span><span class="axis" start="16">ancestor::</span><span class="qname" start="26" select="quick">db:imageobject</span><span class="step" start="40">/</span><span class="axis" start="41">parent::</span><span class="qname" start="49" select="quick">*</span><span class="parenthesis" start="50">)</span><span class="z">"</span><span id="wx6793" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w6795"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?phrases">phrases</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">..</span><span class="step" start="3">/</span><span class="context" start="4">..</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:textobject</span><span class="filter" start="20" pair-end="30" select="quick">[</span><span class="qname" start="21" select="quick">db:phrase</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx6816" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w6818"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?normalphrases">normalphrases</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$phrases</span><span class="filter" start="9" pair-end="38" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="10" pair-end="19" select="quick">not</span></a><span class="parenthesis">(</span><span class="axis" start="14">@</span><span class="qname" start="15" select="quick">role</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">or</span><span class="whitespace" start="23"> </span><span class="axis" start="24">@</span><span class="qname" start="25" select="quick">role</span><span class="whitespace" start="29"> </span><span class="op" start="30">!=</span><span class="whitespace" start="32"> </span><span class="op">'</span><span class="literal" start="33">tex</span><span class="op">'</span><span class="filter" start="38">]</span><span class="z">"</span><span id="wx6850" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w6852"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}process-image" class="solar"><span class="tcall">t:process-image</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w6862"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">alt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w6872"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w6876"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">..</span><span class="step" start="3">/</span><span class="context" start="4">..</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:alt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w6890"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">..</span><span class="step" start="3">/</span><span class="context" start="4">..</span><span class="step" start="6">/</span><span class="qname" start="7" select="quick">db:alt</span><span class="z">"</span><span id="wx6902" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx6906" class="ec">&gt;</span></span><span class="txt">
              </span><span class="ww" id="w6908"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w6912"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$normalphrases</span><span class="filter" start="15" pair-end="17" select="quick">[</span><span class="numeric" start="16">1</span><span class="filter" start="17">]</span><span class="z">"</span><span id="wx6923" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6927" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6931" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span id="wx6935" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w6937"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">longdesc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$longdesc.uri</span><span class="z">"</span><span id="wx6951" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx6955" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx6959" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx6963" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6967" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w6973"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:videoobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w6983"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:videodata</span><span class="z">"</span><span id="wx6991" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx6995" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w6997"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:videodata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7007"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}process-image" class="solar"><span class="tcall">t:process-image</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7017"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">tag</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">embed</span><span class="op">'</span><span class="z">"</span><span id="wx7033" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7035"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">alt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w7045"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="31" select="quick">(</span><span class="context" start="2">..</span><span class="step" start="4">/</span><span class="context" start="5">..</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">db:textobject</span><span class="step" start="21">/</span><span class="qname" start="22" select="quick">db:phrase</span><span class="parenthesis" start="31">)</span><span class="filter" start="32" pair-end="34" select="quick">[</span><span class="numeric" start="33">1</span><span class="filter" start="34">]</span><span class="z">"</span><span id="wx7064" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span id="wx7068" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx7072" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7076" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w7082"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:audioobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7092"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:audiodata</span><span class="z">"</span><span id="wx7100" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7104" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w7106"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:audiodata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7116"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#t?{http://docbook.org/xslt/ns/template}process-image" class="solar"><span class="tcall">t:process-image</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7126"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">alt</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w7136"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="31" select="quick">(</span><span class="context" start="2">..</span><span class="step" start="4">/</span><span class="context" start="5">..</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">db:textobject</span><span class="step" start="21">/</span><span class="qname" start="22" select="quick">db:phrase</span><span class="parenthesis" start="31">)</span><span class="filter" start="32" pair-end="34" select="quick">[</span><span class="numeric" start="33">1</span><span class="filter" start="34">]</span><span class="z">"</span><span id="wx7155" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:with-param</span><span id="wx7159" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx7163" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7167" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w7173"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:textobject</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7183"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx7185" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7189" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w7191"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:textdata</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7201"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?filename">filename</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7211"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w7215"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">entityref</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7226"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-entity-uri" class="solar"><span class="function" start="1" pair-end="31" select="quick">unparsed-entity-uri</span></a><span class="parenthesis">(</span><span class="axis" start="21">@</span><span class="qname" start="22" select="quick">entityref</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span id="wx7238" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7242" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7244"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7248"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">fileref</span><span class="z">"</span><span id="wx7257" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7261" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7265" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx7269" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w7271"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?encoding">encoding</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7281"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w7285"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">encoding</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7296"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">encoding</span><span class="z">"</span><span id="wx7305" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7309" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7311"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7315"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?textdata.default.encoding" class="solar"><span class="variable" start="1" select="quick">$textdata.default.encoding</span></a><span class="z">"</span><span id="wx7323" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7327" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7331" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx7335" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w7337"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="19" select="quick">(</span><span class="variable" start="5" select="quick">$encoding</span><span class="whitespace" start="14"> </span><span class="op" start="15">=</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17"></span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20">
                          </span><span class="op" start="45">then</span><span class="whitespace" start="49"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text" class="solar"><span class="function" start="50" pair-end="73" select="quick">unparsed-text</span></a><span class="parenthesis">(</span><span class="variable" start="64" select="quick">$filename</span><span class="parenthesis" start="73">)</span><span class="whitespace" start="74">
                          </span><span class="op" start="99">else</span><span class="whitespace" start="103"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text" class="solar"><span class="function" start="104" pair-end="138" select="quick">unparsed-text</span></a><span class="parenthesis">(</span><span class="variable" start="118" select="quick">$filename</span><span class="op" start="127">,</span><span class="whitespace" start="128"> </span><span class="variable" start="129" select="quick">$encoding</span><span class="parenthesis" start="138">)</span><span class="z">"</span><span id="wx7372" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7376" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w7382"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">db:caption</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7392"><span class="es">&lt;</span><span class="en">div</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7407"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/common.xsl.html#t?{http://docbook.org/xslt/ns/template}id" class="solar"><span class="tcall">t:id</span></a><span class="z">"</span><span id="wx7415" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7417"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/html.xsl.html#t?class" class="solar"><span class="tcall">class</span></a><span class="z">"</span><span id="wx7425" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7427"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx7429" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx7433" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7437" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ==================================================================== </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm"> "Support" for SVG </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w7447"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">svg:*</span><span class="z">"</span><span class="z"> </span><span class="atn">xmlns:svg</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2000/svg</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7463"><span class="es">&lt;</span><span class="enxsl">xsl:element</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-local-name" class="solar"><span class="function" start="1" pair-end="13" select="quick">local-name</span></a><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">namespace</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2000/svg</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7484"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">*</span><span class="z">"</span><span id="wx7493" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7495"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span id="wx7497" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:element</span><span id="wx7501" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7505" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> Resolve xml:base attributes </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w7511"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">fileref</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7522"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7526"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="19" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="context" start="13">.</span><span class="op" start="14">,</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">/</span><span class="op">'</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> special case: if it's absolute w/o a scheme, leave it alone </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w7548"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx7556" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7560" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7562"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w7566"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?absuri">absuri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-resolve-uri" class="solar"><span class="function" start="1" pair-end="26" select="quick">resolve-uri</span></a><span class="parenthesis">(</span><span class="context" start="13">.</span><span class="op" start="14">,</span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function" start="15" pair-end="25" select="quick">base-uri</span></a><span class="parenthesis">(</span><span class="context" start="24">.</span><span class="parenthesis" start="25">)</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx7588" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7590"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7594"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="31" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$absuri</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">file://</span><span class="op">'</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7612"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function" start="1" pair-end="34" select="quick">substring-after</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$absuri</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="op">'</span><span class="literal" start="26">file:/</span><span class="op">'</span><span class="parenthesis" start="34">)</span><span class="z">"</span><span id="wx7628" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7632" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7634"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-starts-with" class="solar"><span class="function" start="1" pair-end="30" select="quick">starts-with</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$absuri</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">file:/</span><span class="op">'</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7652"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function" start="1" pair-end="33" select="quick">substring-after</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$absuri</span><span class="op" start="24">,</span><span class="whitespace" start="25"> </span><span class="op">'</span><span class="literal" start="26">file:</span><span class="op">'</span><span class="parenthesis" start="33">)</span><span class="z">"</span><span id="wx7668" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7672" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7674"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7678"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$absuri</span><span class="z">"</span><span id="wx7686" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7690" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7694" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7698" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7702" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx7706" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> ============================================================ </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w7712"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{http://docbook.org/xslt/ns/extension}longdesc-uri">f:longdesc-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string?</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7728"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?node">node</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx7742" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w7744"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="13" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$node</span><span class="parenthesis" start="13">)</span><span class="whitespace" start="14"> </span><span class="op" start="15">and</span><span class="whitespace" start="18"> </span><a href="../../../xslt/base/html/param.xsl.html#v?html.longdesc" class="solar"><span class="variable" start="19" select="quick">$html.longdesc</span></a><span class="whitespace" start="33"> </span><span class="op" start="34">!=</span><span class="whitespace" start="36"> </span><span class="numeric" start="37">0</span><span class="whitespace" start="38">
                  </span><span class="op" start="55">and</span><span class="whitespace" start="58"> </span><span class="variable" start="59" select="quick">$node</span><span class="step" start="64">/</span><span class="qname" start="65" select="quick">db:textobject</span><span class="filter" start="78" pair-end="93" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="79" pair-end="92" select="quick">not</span></a><span class="parenthesis">(</span><span class="qname" start="83" select="quick">db:phrase</span><span class="parenthesis" start="92">)</span><span class="filter" start="93">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7777"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?image-id">image-id</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}node-id" class="solar"><span class="function" start="1" pair-end="16" select="quick">f:node-id</span></a><span class="parenthesis">(</span><span class="variable" start="11" select="quick">$node</span><span class="parenthesis" start="16">)</span><span class="z">"</span><span id="wx7794" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7796"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?dbhtml.dir">dbhtml.dir</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/pi.xsl.html#f?{http://docbook.org/xslt/ns/extension}dbhtml-dir" class="solar"><span class="function" start="1" pair-end="19" select="quick">f:dbhtml-dir</span></a><span class="parenthesis">(</span><span class="variable" start="14" select="quick">$node</span><span class="parenthesis" start="19">)</span><span class="z">"</span><span id="wx7813" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w7815"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w7819"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w7823"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$dbhtml.dir</span><span class="whitespace" start="12"> </span><span class="op" start="13">!=</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7839"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$dbhtml.dir</span><span class="z">"</span><span id="wx7847" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx7851" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w7853"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w7857"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?base.dir" class="solar"><span class="variable" start="1" select="quick">$base.dir</span></a><span class="z">"</span><span id="wx7865" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx7869" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx7873" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w7875"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="33" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">ld-</span><span class="op">'</span><span class="op" start="13">,</span><span class="variable" start="14" select="quick">$image-id</span><span class="op" start="23">,</span><a href="../../../xslt/base/html/param.xsl.html#v?html.ext" class="solar"><span class="variable" start="24" select="quick">$html.ext</span></a><span class="parenthesis" start="33">)</span><span class="z">"</span><span id="wx7892" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:value-of</span><span id="wx7896" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx7900" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx7904" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w7906"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}longdesc-link">t:longdesc-link</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w7916"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?textobject">textobject</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()?</span><span class="z">"</span><span id="wx7930" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w7932"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="19" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$textobject</span><span class="parenthesis" start="19">)</span><span class="whitespace" start="20"> </span><span class="op" start="21">and</span><span class="whitespace" start="24"> </span><a href="../../../xslt/base/html/param.xsl.html#v?html.longdesc" class="solar"><span class="variable" start="25" select="quick">$html.longdesc</span></a><span class="whitespace" start="39"> </span><span class="op" start="40">!=</span><span class="whitespace" start="42"> </span><span class="numeric" start="43">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w7953"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?this.uri">this.uri</span><span class="z">"</span><span class="z">
                    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="49" select="quick">concat</span></a><span class="parenthesis">(</span><a href="../../../xslt/base/html/param.xsl.html#v?base.dir" class="solar"><span class="variable" start="8" select="quick">$base.dir</span></a><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><a href="../../../xslt/base/html/html.xsl.html#f?{http://docbook.org/xslt/ns/extension}href-target-uri" class="solar"><span class="function" start="19" pair-end="48" select="quick">f:href-target-uri</span></a><span class="parenthesis">(</span><span class="variable" start="37" select="quick">$textobject</span><span class="parenthesis" start="48">)</span><span class="parenthesis" start="49">)</span><span class="z">"</span><span id="wx7976" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w7978"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?href.to">href.to</span><span class="z">"</span><span class="z">
                    </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/common/functions.xsl.html#f?{http://docbook.org/xslt/ns/extension}trim-common-uri-paths" class="solar"><span class="function" start="1" pair-end="113" select="quick">f:trim-common-uri-paths</span></a><span class="parenthesis">(</span><a href="../../../xslt/base/html/graphics.xsl.html#f?{http://docbook.org/xslt/ns/extension}longdesc-uri" class="solar"><span class="function" start="25" pair-end="51" select="quick">f:longdesc-uri</span></a><span class="parenthesis">(</span><span class="variable" start="40" select="quick">$textobject</span><span class="parenthesis" start="51">)</span><span class="op" start="52">,</span><span class="whitespace" start="53">
                            </span><span class="variable" start="104" select="quick">$this.uri</span><span class="parenthesis" start="113">)</span><span class="z">"</span><span id="wx8001" class="sc">/&gt;</span></span><span class="txt">
      
      </span><span class="ww" id="w8003"><span class="es">&lt;</span><span class="en">div</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">longdesc-link</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w8013"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">[</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx8019" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w8021"><span class="es">&lt;</span><span class="en">a</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$href.to</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">target</span><span class="atneq">=</span><span class="z">"</span><span class="av">longdesc</span><span class="z">"</span><span class="z">
           </span><span class="atn">title</span><span class="atneq">=</span><span class="z">"</span><span class="av">Link to long description</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">D</span><span class="ez">&lt;/</span><span class="cl">a</span><span id="wx8047" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w8049"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="scx">&gt;</span><span class="txt">]</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx8055" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx8059" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8063" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx8067" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w8069"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?{http://docbook.org/xslt/ns/template}write-longdesc">t:write-longdesc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w8079"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?mediaobject">mediaobject</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx8093" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w8095"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?firsttext">firsttext</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$mediaobject</span><span class="step" start="13">/</span><span class="qname" start="14" select="quick">db:textobject</span><span class="filter" start="27" pair-end="42" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="28" pair-end="41" select="quick">not</span></a><span class="parenthesis">(</span><span class="qname" start="32" select="quick">db:phrase</span><span class="parenthesis" start="41">)</span><span class="filter" start="42">]</span><span class="filter" start="43" pair-end="45" select="quick">[</span><span class="numeric" start="44">1</span><span class="filter" start="45">]</span><span class="z">"</span><span id="wx8120" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8122"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?filename">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/graphics.xsl.html#f?{http://docbook.org/xslt/ns/extension}longdesc-uri" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:longdesc-uri</span></a><span class="parenthesis">(</span><span class="variable" start="16" select="quick">$firsttext</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx8139" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w8141"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/param.xsl.html#v?html.longdesc" class="solar"><span class="variable" start="1" select="quick">$html.longdesc</span></a><span class="whitespace" start="15"> </span><span class="op" start="16">!=</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">0</span><span class="whitespace" start="20">
                  </span><span class="op" start="37">and</span><span class="whitespace" start="40"> </span><span class="variable" start="41" select="quick">$mediaobject</span><span class="step" start="53">/</span><span class="qname" start="54" select="quick">db:textobject</span><span class="filter" start="67" pair-end="82" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="68" pair-end="81" select="quick">not</span></a><span class="parenthesis">(</span><span class="qname" start="72" select="quick">db:phrase</span><span class="parenthesis" start="81">)</span><span class="filter" start="82">]</span><span class="whitespace" start="83">
                  </span><span class="op" start="100">and</span><span class="whitespace" start="103"> </span><span class="variable" start="104" select="quick">$filename</span><span class="whitespace" start="113"> </span><span class="op" start="114">!=</span><span class="whitespace" start="116"> </span><span class="op">'</span><span class="literal" start="117"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      
      </span><span class="ww" id="w8177"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$filename</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">xhtml</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w8195"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/html.xsl.html#t?{http://docbook.org/xslt/ns/template}user-preroot" class="solar"><span class="tcall">t:user-preroot</span></a><span class="z">"</span><span id="wx8203" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w8205"><span class="es">&lt;</span><span class="en">html</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w8209"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="../../../xslt/base/html/html.xsl.html#t?{http://docbook.org/xslt/ns/template}head" class="solar"><span class="tcall">t:head</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w8219"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">node</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="context" start="1">.</span><span class="z">"</span><span id="wx8233" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx8237" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w8239"><span class="es">&lt;</span><span class="en">body</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w8243"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$mediaobject</span><span class="step" start="13">/</span><span class="qname" start="14" select="quick">db:textobject</span><span class="filter" start="27" pair-end="42" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="28" pair-end="41" select="quick">not</span></a><span class="parenthesis">(</span><span class="qname" start="32" select="quick">db:phrase</span><span class="parenthesis" start="41">)</span><span class="filter" start="42">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w8261"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">*</span><span class="z">"</span><span id="wx8269" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx8273" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">body</span><span id="wx8277" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">html</span><span id="wx8281" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx8285" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx8289" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx8293" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx8297" class="ec">&gt;</span></span><span class="txt">
</span></p></div></body></html>