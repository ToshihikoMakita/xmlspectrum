<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>highlight-file.xsl</title><link rel="stylesheet" type="text/css" href="theme.css"></head><body><div><p class="spectrum"><span class="z">&lt;?</span><span class="pi">xml version="1.0" encoding="utf-8"</span><span class="z">?&gt;</span><span class="txt">
</span><span class="z">&lt;!--</span><span class="cm">
A frontend for XMLSpectrum by Phil Fearon Qutoric Limited 2012 (c)

http://qutoric.com
License: Apache 2.0 http://www.apache.org/licenses/LICENSE-2.0.html

Purpose: Syntax highlighter for XPath (text), XML, XSLT and XSD 1.1 file formats

Description:

A sample XSLT stylesheet that exploits xmlspectrum.xsl

Takes the input file specified in the sourcepath XSLT parameter and generates an
HTML output file ( plus also include/import files if link-names=yes ) and a CSS file.

The input file may be 1 of 4 types:

1. XSLT 1.0 or 2.0
2. XSD 1.0 or 1.1
3. Generic XML
4. Plain-text XPath

Note that this file interface is a simple wrapper for xmlspectrum.xsl. This front-end
will auto-detect whether the file is XSLT, XSD or XPath based on well-formedness and
namespaces. If you're converting XML samples that are not well-formed or contained within
other XML you can code your own interface XSLT.

Dependencies:

1. xmlspectrum.xsl

Usage:

initial-template: 'main'
source-xml: (not used)
xsl parameters:
    sourcepath:  path or URI for source file
    light-theme: (yes|no) [Default:'no'] sets light/dark theme
    link-names:  (yes|no) [Default:'no']
                 processes all linked xsl files and adds hrefs
                 for variables, functions, parameters and named templates
    css-path:    (path for output CSS)

Sample transform using Saxon-HE/Java on command-line (unbroken line):

java -cp "C:\Program Files (x86)\Saxon\saxon9he.jar" net.sf.saxon.Transform -t -it:main
-xsl:xsl/highlight-file.xsl sourcepath=../samples/xpathcolorer-x.xsl

</span><span class="z">--&gt;</span><span class="txt">

</span><span class="ww" id="w9"><span class="es">&lt;</span><span class="enxsl">xsl:stylesheet</span><span class="z"> </span><span class="atn">version</span><span class="atneq">=</span><span class="z">"</span><span class="av">2.0</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xsl</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/1999/XSL/Transform</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:xs</span><span class="atneq">=</span><span class="z">"</span><span class="av">http://www.w3.org/2001/XMLSchema</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:loc</span><span class="atneq">=</span><span class="z">"</span><span class="av">com.qutoric.sketchpath.functions</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:css</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-defs.com</span><span class="z">"</span><span class="z">
                </span><span class="atn">exclude-result-prefixes</span><span class="atneq">=</span><span class="z">"</span><span class="av">loc f xs css</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns</span><span class="atneq">=</span><span class="z">"</span><span class="z">"</span><span class="z">
                </span><span class="atn">xmlns:f</span><span class="atneq">=</span><span class="z">"</span><span class="av">internal</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
  
  </span><span class="ww" id="w60"><span class="es">&lt;</span><span class="enxsl">xsl:import</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html" class="solar"><span class="href">xmlspectrum.xsl</span></a><span class="z">"</span><span id="wx68" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w70"><span class="es">&lt;</span><span class="enxsl">xsl:output</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx78" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w80"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?sourcepath">sourcepath</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx102" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="z">&lt;!--</span><span class="cm">  by default - rely on original indentation </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w108"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent">indent</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">-1</span><span class="op">'</span><span class="z">"</span><span id="wx130" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w132"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?light-theme">light-theme</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">no</span><span class="op">'</span><span class="z">"</span><span id="wx148" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w150"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-path">css-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1"></span><span class="op">'</span><span class="z">"</span><span id="wx166" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w168"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?auto-trim">auto-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">no</span><span class="op">'</span><span class="z">"</span><span id="wx184" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w186"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?link-names">link-names</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">no</span><span class="op">'</span><span class="z">"</span><span id="wx202" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm"> note: set this to a proxy server storing the W3C resource to avoid
             excessive calls to the W3C server
   </span><span class="z">--&gt;</span><span class="txt">
  </span><span class="ww" id="w208"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?w3c-xpath-functions-uri">w3c-xpath-functions-uri</span><span class="z">"</span><span class="z">
             </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">http://www.w3.org/TR/xpath-functions/</span><span class="op">'</span><span class="z">"</span><span id="wx224" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w226"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-trim">do-trim</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?auto-trim" class="solar"><span class="variable" start="1" select="quick">$auto-trim</span></a><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="op">'</span><span class="literal" start="15">yes</span><span class="op">'</span><span class="z">"</span><span id="wx246" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w248"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?do-link">do-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?link-names" class="solar"><span class="variable" start="1" select="quick">$link-names</span></a><span class="whitespace" start="12"> </span><span class="op" start="13">eq</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">yes</span><span class="op">'</span><span class="z">"</span><span id="wx268" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w270"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent-size">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="19" select="quick">xs:integer</span><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?indent" class="solar"><span class="variable" start="12" select="quick">$indent</span></a><span class="parenthesis" start="19">)</span><span class="z">"</span><span id="wx287" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ww" id="w289"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-name">css-name</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">theme.css</span><span class="op">'</span><span class="z">"</span><span id="wx305" class="sc">/&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w307"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?main">main</span><span class="z">"</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="step" start="1">/</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w323"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?sourceuri">sourceuri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?sourcepath" class="solar"><span class="variable" start="1" select="quick">$sourcepath</span></a><span class="z">"</span><span id="wx337" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w339"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xsl-xmlns">xsl-xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">http://www.w3.org/1999/XSL/Transform</span><span class="op">'</span><span class="z">"</span><span id="wx355" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w357"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xsd-xmlns">xsd-xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">http://www.w3.org/2001/XMLSchema</span><span class="op">'</span><span class="z">"</span><span id="wx373" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm"> if windows OS, convert path to URI </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w379"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?corrected-uri">corrected-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-replace" class="solar"><span class="function" start="1" pair-end="28" select="quick">replace</span></a><span class="parenthesis">(</span><span class="variable" start="9" select="quick">$sourceuri</span><span class="op" start="19">,</span><span class="op">'</span><span class="literal" start="20">\\</span><span class="op">'</span><span class="op" start="24">,</span><span class="op">'</span><span class="literal" start="25">/</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx404" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w406"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xml">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc-available" class="solar"><span class="function" start="1" pair-end="29" select="quick">doc-available</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$corrected-uri</span><span class="parenthesis" start="29">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx429" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w431"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-element">root-element</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="12" select="quick">(</span><span class="variable" start="5" select="quick">$is-xml</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13"> </span><span class="op" start="14">then</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function" start="19" pair-end="37" select="quick">doc</span></a><span class="parenthesis">(</span><span class="variable" start="23" select="quick">$corrected-uri</span><span class="parenthesis" start="37">)</span><span class="step" start="38">/</span><span class="qname" start="39" select="quick">*</span><span class="whitespace" start="40"> </span><span class="qname" start="41" select="quick">else</span><span class="whitespace" start="45"> </span><span class="parenthesis" start="46" pair-end="47" select="quick">(</span><span class="parenthesis" start="47">)</span><span class="z">"</span><span id="wx463" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w465"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-qname">root-qname</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="12" select="quick">(</span><span class="variable" start="5" select="quick">$is-xml</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13"> </span><span class="op" start="14">then</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="19" pair-end="42" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$root-element</span><span class="parenthesis" start="42">)</span><span class="whitespace" start="43"> </span><span class="op" start="44">else</span><span class="whitespace" start="48"> </span><span class="parenthesis" start="49" pair-end="50" select="quick">(</span><span class="parenthesis" start="50">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:QName?</span><span class="z">"</span><span id="wx501" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w503"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="12" select="quick">(</span><span class="variable" start="5" select="quick">$is-xml</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13"> 
                                             </span><span class="op" start="15">then</span><span class="whitespace" start="19"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function" start="20" pair-end="49" select="quick">prefix-from-QName</span></a><span class="parenthesis">(</span><span class="variable" start="38" select="quick">$root-qname</span><span class="parenthesis" start="49">)</span><span class="whitespace" start="50"> 
                                             </span><span class="op" start="52">else</span><span class="whitespace" start="56"> </span><span class="parenthesis" start="57" pair-end="58" select="quick">(</span><span class="parenthesis" start="58">)</span><span class="z">"</span><span id="wx533" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w535"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-namespace">root-namespace</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="12" select="quick">(</span><span class="variable" start="5" select="quick">$is-xml</span><span class="parenthesis" start="12">)</span><span class="whitespace" start="13"> </span><span class="op" start="14">then</span><span class="whitespace" start="18"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-from-QName" class="solar"><span class="function" start="19" pair-end="55" select="quick">namespace-uri-from-QName</span></a><span class="parenthesis">(</span><span class="variable" start="44" select="quick">$root-qname</span><span class="parenthesis" start="55">)</span><span class="whitespace" start="56"> </span><span class="op" start="57">else</span><span class="whitespace" start="61"> </span><span class="parenthesis" start="62" pair-end="63" select="quick">(</span><span class="parenthesis" start="63">)</span><span class="z">"</span><span id="wx565" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w567"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$root-namespace</span><span class="whitespace" start="16"> </span><span class="op" start="17">eq</span><span class="whitespace" start="19"> </span><span class="variable" start="20" select="quick">$xsl-xmlns</span><span class="z">"</span><span id="wx591" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w593"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w597"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xsl</span><span class="whitespace" start="8"> </span><span class="op" start="9">and</span><span class="whitespace" start="12"> </span><a href="highlight-file.xsl.html#v?do-link" class="solar"><span class="variable" start="13" select="quick">$do-link</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        
        </span><span class="ww" id="w611"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-files">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function" start="1" pair-end="68" select="quick">f:get-all-files</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-resolve-uri" class="solar"><span class="function" start="17" pair-end="62" select="quick">resolve-uri</span></a><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$corrected-uri</span><span class="op" start="43">,</span><span class="whitespace" start="44"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-static-base-uri" class="solar"><span class="function" start="45" pair-end="61" select="quick">static-base-uri</span></a><span class="parenthesis">(</span><span class="parenthesis" start="61">)</span><span class="parenthesis" start="62">)</span><span class="op" start="63">,</span><span class="whitespace" start="64"> </span><span class="parenthesis" start="65" pair-end="66" select="quick">(</span><span class="parenthesis" start="66">)</span><span class="whitespace" start="67"> </span><span class="parenthesis" start="68">)</span><span class="z">"</span><span id="wx647" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w649"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-path">root-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w665"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-common-root" class="solar"><span class="tcall">get-common-root</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w675"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx695" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w697"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx711" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w713"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="2" select="quick">(</span><span class="parenthesis" start="2">)</span><span class="z">"</span><span id="wx728" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx732" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx736" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w738"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?joined-path">joined-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="1" pair-end="28" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$root-path</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">/</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx760" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w762"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-length">root-length</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-string-length" class="solar"><span class="function" start="1" pair-end="27" select="quick">string-length</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$joined-path</span><span class="parenthesis" start="27">)</span><span class="whitespace" start="28"> </span><span class="op" start="29">+</span><span class="whitespace" start="30"> </span><span class="numeric" start="31">1</span><span class="z">"</span><span id="wx783" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w785"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w801"><span class="es">&lt;</span><span class="en">globals</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w805"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$all-files</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w815"><span class="es">&lt;</span><span class="en">file</span><span class="z"> </span><span class="atn">path</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="1" pair-end="30" select="quick">substring</span></a><span class="parenthesis">(</span><span class="context" start="11">.</span><span class="op" start="12">,</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$root-length</span><span class="whitespace" start="26"> </span><span class="op" start="27">+</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">1</span><span class="parenthesis" start="30">)</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
                </span><span class="ww" id="w837"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-globals" class="solar"><span class="function" start="1" pair-end="16" select="quick">f:get-globals</span></a><span class="parenthesis">(</span><span class="context" start="15">.</span><span class="parenthesis" start="16">)</span><span class="z">"</span><span id="wx848" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ez">&lt;/</span><span class="cl">file</span><span id="wx852" class="ec">&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx856" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">globals</span><span id="wx860" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx864" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w866"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$globals</span><span class="z">"</span><span id="wx874" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w876"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$globals</span><span class="step" start="9">/</span><span class="qname" start="10" select="quick">file</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          
          </span><span class="ww" id="w888"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w892"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">tokenizing</span><span class="op">'</span><span class="op" start="13">,</span><span class="whitespace" start="14"> </span><span class="axis" start="15">@</span><span class="qname" start="16" select="quick">path</span><span class="op" start="20">,</span><span class="whitespace" start="21"> </span><span class="op">'</span><span class="literal" start="22">...</span><span class="op">'</span><span class="z">"</span><span id="wx911" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx915" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w917"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-spans">all-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w933"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w943"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">path</span><span class="z">"</span><span id="wx958" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w960"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx980" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w982"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx1002" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w1004"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable" start="1" select="quick">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1024" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w1026"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">doc-prefix</span><span class="z">"</span><span id="wx1040" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1044" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1048" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w1050"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1054"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">processing</span><span class="op">'</span><span class="op" start="13">,</span><span class="whitespace" start="14"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="15" pair-end="31" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="21" select="quick">$all-spans</span><span class="parenthesis" start="31">)</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="op">'</span><span class="literal" start="34">tokens for</span><span class="op">'</span><span class="op" start="46">,</span><span class="whitespace" start="47"> </span><span class="axis" start="48">@</span><span class="qname" start="49" select="quick">path</span><span class="z">"</span><span id="wx1079" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx1083" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w1085"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-xmlns" class="solar"><span class="function" start="1" pair-end="23" select="quick">f:get-xmlns</span></a><span class="parenthesis">(</span><span class="variable" start="13" select="quick">$all-spans</span><span class="parenthesis" start="23">)</span><span class="z">"</span><span id="wx1108" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w1110"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1126"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="ww" id="w1136"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z">
                              </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$all-spans</span><span class="z">"</span><span id="wx1162" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w1164"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$globals</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx1190" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w1192"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span id="wx1218" class="sc">/&gt;</span></span><span class="txt">
              </span><span class="ww" id="w1220"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="z">"</span><span id="wx1234" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1238" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1242" class="ec">&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w1244"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-link">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><a href="highlight-file.xsl.html#v?css-path" class="solar"><span class="variable" start="5" select="quick">$css-path</span></a><span class="whitespace" start="14"> </span><span class="op" start="15">eq</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18"></span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26">
                                                    </span><a href="highlight-file.xsl.html#f?{internal}get-relative-path" class="solar"><span class="function" start="31" pair-end="56" select="quick">f:get-relative-path</span></a><span class="parenthesis">(</span><span class="axis" start="51">@</span><span class="qname" start="52" select="quick">path</span><span class="parenthesis" start="56">)</span><span class="whitespace" start="57">
                                                </span><span class="op" start="58">else</span><span class="whitespace" start="62"> </span><a href="highlight-file.xsl.html#v?css-path" class="solar"><span class="variable" start="63" select="quick">$css-path</span></a><span class="z">"</span><span id="wx1280" class="sc">/&gt;</span></span><span class="txt">
          
          </span><span class="ww" id="w1282"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?output-html-doc" class="solar"><span class="tcall">output-html-doc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1292"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="z">"</span><span id="wx1306" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1308"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="axis" start="1">@</span><span class="qname" start="2" select="quick">path</span><span class="z">"</span><span id="wx1323" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1325"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$css-link</span><span class="z">"</span><span id="wx1339" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1343" class="ec">&gt;</span></span><span class="txt">
          
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx1347" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx1351" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1353"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1357"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result-spans">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1373"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-result-spans" class="solar"><span class="tcall">get-result-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w1383"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$corrected-uri</span><span class="z">"</span><span id="wx1397" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1399"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx1419" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1421"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx1441" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1443"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable" start="1" select="quick">$indent-size</span></a><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1463" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ww" id="w1465"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">root-prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$root-prefix</span><span class="z">"</span><span id="wx1479" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1483" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx1487" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w1489"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function" start="1" pair-end="31" select="quick">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$corrected-uri</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span id="wx1506" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w1508"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?output-html-doc" class="solar"><span class="tcall">output-html-doc</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w1518"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$result-spans</span><span class="z">"</span><span id="wx1532" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1534"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">filename</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$file-only</span><span class="z">"</span><span id="wx1548" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w1550"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">css-link</span><span class="z">"</span><span class="z">
                          </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="20" select="quick">(</span><a href="highlight-file.xsl.html#v?css-path" class="solar"><span class="variable" start="5" select="quick">$css-path</span></a><span class="whitespace" start="14"> </span><span class="op" start="15">eq</span><span class="whitespace" start="17"> </span><span class="op">'</span><span class="literal" start="18"></span><span class="op">'</span><span class="parenthesis" start="20">)</span><span class="whitespace" start="21"> </span><span class="op" start="22">then</span><span class="whitespace" start="26"> 
                                  </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable" start="28" select="quick">$css-name</span></a><span class="whitespace" start="37">
                                  </span><span class="op" start="38">else</span><span class="whitespace" start="42"> </span><a href="highlight-file.xsl.html#v?css-path" class="solar"><span class="variable" start="43" select="quick">$css-path</span></a><span class="z">"</span><span id="wx1582" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx1586" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx1590" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx1594" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1596"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#v?css-path" class="solar"><span class="variable" start="1" select="quick">$css-path</span></a><span class="whitespace" start="10"> </span><span class="op" start="11">eq</span><span class="whitespace" start="13"> </span><span class="op">'</span><span class="literal" start="14"></span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1612"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="28" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">output/</span><span class="op">'</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable" start="19" select="quick">$css-name</span></a><span class="parenthesis" start="28">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">text</span><span class="z">"</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1644"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}get-css" class="solar"><span class="function" start="1" pair-end="32" select="quick">f:get-css</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?light-theme" class="solar"><span class="variable" start="11" select="quick">$light-theme</span></a><span class="whitespace" start="23"> </span><span class="op" start="24">eq</span><span class="whitespace" start="26"> </span><span class="op">'</span><span class="literal" start="27">yes</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx1661" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx1665" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1669" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx1673" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1675"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-relative-path">f:get-relative-path</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1685"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?abs-path">abs-path</span><span class="z">"</span><span id="wx1693" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1695"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?parent-count">parent-count</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="1" pair-end="30" select="quick">count</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="7" pair-end="29" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="16" select="quick">$abs-path</span><span class="op" start="25">,</span><span class="op">'</span><span class="literal" start="26">/</span><span class="op">'</span><span class="parenthesis" start="29">)</span><span class="parenthesis" start="30">)</span><span class="whitespace" start="31"> </span><span class="op" start="32">-</span><span class="whitespace" start="33"> </span><span class="numeric" start="34">1</span><span class="z">"</span><span id="wx1729" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1731"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="23" select="quick">(</span><span class="variable" start="5" select="quick">$parent-count</span><span class="whitespace" start="18"> </span><span class="op" start="19">eq</span><span class="whitespace" start="21"> </span><span class="numeric" start="22">0</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">then</span><span class="whitespace" start="29"> 
                          </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable" start="31" select="quick">$css-name</span></a><span class="whitespace" start="40">
                          </span><span class="op" start="41">else</span><span class="whitespace" start="45">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="46" pair-end="155" select="quick">concat</span></a><span class="parenthesis">(</span><span class="whitespace" start="53">
                              </span><a href="http://www.w3.org/TR/xpath-functions/#func-string-join" class="solar"><span class="function" start="58" pair-end="137" select="quick">string-join</span></a><span class="parenthesis">(</span><span class="whitespace" start="70">
                                  </span><span class="higher" start="79">for</span><span class="whitespace" start="82"> </span><span id="rng-$n" class="variable" start="83" select="quick">$n</span><span class="whitespace" start="85"> </span><span class="op" start="86">in</span><span class="whitespace" start="88"> </span><span class="numeric" start="89">1</span><span class="whitespace" start="90"> </span><span class="op" start="91">to</span><span class="whitespace" start="93"> </span><span class="variable" start="94" select="quick">$parent-count</span><span class="whitespace" start="107"> </span><span class="op" start="108">return</span><span class="whitespace" start="114">
                                  </span><span class="op">'</span><span class="literal" start="123">..</span><span class="op">'</span><span class="whitespace" start="127">
                              </span><span class="op" start="132">,</span><span class="whitespace" start="133"> </span><span class="op">'</span><span class="literal" start="134">/</span><span class="op">'</span><span class="parenthesis" start="137">)</span><span class="whitespace" start="138">
                          </span><span class="op" start="139">,</span><span class="whitespace" start="140"> </span><span class="op">'</span><span class="literal" start="141">/</span><span class="op">'</span><span class="op" start="144">,</span><span class="whitespace" start="145"> </span><a href="highlight-file.xsl.html#v?css-name" class="solar"><span class="variable" start="146" select="quick">$css-name</span></a><span class="parenthesis" start="155">)</span><span class="z">"</span><span id="wx1794" class="sc">/&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx1798" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w1800"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?wrap-spans">wrap-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w1810"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1830" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1832"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?globals">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1852" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1854"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?xmlns">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx1874" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w1876"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx1890" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1892"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span">span</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$spans</span><span class="filter" start="7" pair-end="14" select="quick">[</span><span class="variable" start="8" select="quick">$index</span><span class="filter" start="14">]</span><span class="z">"</span><span id="wx1909" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1911"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">mod</span><span class="whitespace" start="11"> </span><span class="numeric" start="12">500</span><span class="whitespace" start="15"> </span><span class="op" start="16">eq</span><span class="whitespace" start="18"> </span><span class="numeric" start="19">0</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1929"><span class="es">&lt;</span><span class="enxsl">xsl:message</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w1933"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="op">'</span><span class="literal" start="1">token: </span><span class="op">'</span><span class="op" start="10">,</span><span class="whitespace" start="11"> </span><span class="variable" start="12" select="quick">$index</span><span class="z">"</span><span id="wx1946" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="clxsl">xsl:message</span><span id="wx1950" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx1954" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w1956"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w1960"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="type" start="1">empty</span><span class="parenthesis">(</span><span class="variable" start="7" select="quick">$span</span><span class="parenthesis" start="12">)</span><span class="z">"</span><span id="wx1971" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w1973"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="whitespace" start="13"> </span><span class="op" start="14">eq</span><span class="whitespace" start="16"> </span><span class="op">'</span><span class="literal" start="17">es</span><span class="op">'</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w1992"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?span-children">span-children</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">node()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2008"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w2018"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx2036" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2040" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2044" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2046"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">ww</span><span class="z">"</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">w</span><span class="op">{</span><span class="variable" start="1" select="quick">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2065"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span id="wx2073" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2075"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span-children</span><span class="z">"</span><span id="wx2083" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2087" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2089"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prev-index">prev-index</span><span class="z">"</span><span class="z">
                      </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="53" select="quick">xs:integer</span><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring" class="solar"><span class="function" start="12" pair-end="52" select="quick">substring</span></a><span class="parenthesis">(</span><span class="variable" start="22" select="quick">$span-children</span><span class="filter" start="36" pair-end="43" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="37" pair-end="42" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="42">)</span><span class="filter" start="43">]</span><span class="step" start="44">/</span><span class="axis" start="45">@</span><span class="qname" start="46" select="quick">id</span><span class="op" start="48">,</span><span class="whitespace" start="49"> </span><span class="numeric" start="50">3</span><span class="whitespace" start="51">
                              </span><span class="parenthesis" start="52">)</span><span class="parenthesis" start="53">)</span><span class="z">"</span><span id="wx2121" class="sc">/&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2123"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2133"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$prev-index</span><span class="whitespace" start="12"> </span><span class="op" start="13">+</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="z">"</span><span id="wx2151" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2155" class="ec">&gt;</span></span><span class="txt">
        
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2159" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2161"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">class</span><span class="whitespace" start="13"> </span><span class="op" start="14">=</span><span class="whitespace" start="15"> </span><span class="parenthesis" start="16" pair-end="27" select="quick">(</span><span class="op">'</span><span class="literal" start="17">sc</span><span class="op">'</span><span class="op" start="21">,</span><span class="whitespace" start="22"> </span><span class="op">'</span><span class="literal" start="23">ec</span><span class="op">'</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2187"><span class="es">&lt;</span><span class="en">span</span><span class="z"> </span><span class="atn">id</span><span class="atneq">=</span><span class="z">"</span><span class="av">wx</span><span class="op">{</span><span class="variable" start="1" select="quick">$index</span><span class="op">}</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2200"><span class="es">&lt;</span><span class="enxsl">xsl:copy-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="step" start="6">/</span><span class="axis" start="7">@</span><span class="qname" start="8" select="quick">*</span><span class="op" start="9">|</span><span class="variable" start="10" select="quick">$span</span><span class="step" start="15">/</span><span class="node" start="16" pair-end="21" select="quick">node</span><span class="parenthesis">(</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx2217" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">span</span><span id="wx2221" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2225" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2227"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        
        </span><span class="ww" id="w2231"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$span</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">markup</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2247"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">xmlns</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$xmlns</span><span class="z">"</span><span id="wx2267" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2269"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$globals</span><span class="z">"</span><span id="wx2289" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:apply-templates</span><span id="wx2293" class="ec">&gt;</span></span><span class="txt">
        
        </span><span class="ww" id="w2295"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?wrap-spans" class="solar"><span class="tcall">wrap-spans</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2305"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx2323" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2327" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2331" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2335" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2339" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w2341"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-common-root">get-common-root</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2357"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?all-files">all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z"> </span><span class="atn">tunnel</span><span class="atneq">=</span><span class="z">"</span><span class="av">yes</span><span class="z">"</span><span id="wx2377" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2379"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?index">index</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2393" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2395"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?common-path">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx2409" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2411"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?current-file">current-file</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="32" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$all-files</span><span class="filter" start="20" pair-end="27" select="quick">[</span><span class="variable" start="21" select="quick">$index</span><span class="filter" start="27">]</span><span class="op" start="28">,</span><span class="op">'</span><span class="literal" start="29">/</span><span class="op">'</span><span class="parenthesis" start="32">)</span><span class="z">"</span><span id="wx2435" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2437"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?min-file">min-file</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="16" select="quick">(</span><span class="variable" start="5" select="quick">$index</span><span class="whitespace" start="11"> </span><span class="op" start="12">eq</span><span class="whitespace" start="14"> </span><span class="numeric" start="15">1</span><span class="parenthesis" start="16">)</span><span class="whitespace" start="17"> </span><span class="op" start="18">then</span><span class="whitespace" start="22">
                              </span><span class="variable" start="27" select="quick">$current-file</span><span class="whitespace" start="40">
                          </span><span class="op" start="41">else</span><span class="whitespace" start="45"> </span><span class="parenthesis" start="46" pair-end="93" select="quick">(</span><a href="highlight-file.xsl.html#f?{internal}min-common-item" class="solar"><span class="function" start="47" pair-end="92" select="quick">f:min-common-item</span></a><span class="parenthesis">(</span><span class="variable" start="65" select="quick">$common-path</span><span class="op" start="77">,</span><span class="whitespace" start="78"> </span><span class="variable" start="79" select="quick">$current-file</span><span class="parenthesis" start="92">)</span><span class="parenthesis" start="93">)</span><span class="z">"</span><span id="wx2481" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2483"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2487"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">lt</span><span class="whitespace" start="10"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="11" pair-end="27" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$all-files</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2504"><span class="es">&lt;</span><span class="enxsl">xsl:call-template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#t?get-common-root" class="solar"><span class="tcall">get-common-root</span></a><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2514"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">index</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$index</span><span class="whitespace" start="7"> </span><span class="op" start="8">+</span><span class="whitespace" start="9"> </span><span class="numeric" start="10">1</span><span class="z">"</span><span id="wx2532" class="sc">/&gt;</span></span><span class="txt">
          </span><span class="ww" id="w2534"><span class="es">&lt;</span><span class="enxsl">xsl:with-param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="av">common-path</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$min-file</span><span class="z">"</span><span id="wx2548" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:call-template</span><span id="wx2552" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2556" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2558"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2562"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$min-file</span><span class="z">"</span><span id="wx2570" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2574" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2578" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx2582" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w2584"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}min-common-item">f:min-common-item</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2600"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?min">min</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx2614" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2616"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new">new</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx2630" class="sc">/&gt;</span></span><span class="txt">
    
    
    </span><span class="ww" id="w2632"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="numeric" start="1">1</span><span class="whitespace" start="2"> </span><span class="op" start="3">to</span><span class="whitespace" start="5"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-count" class="solar"><span class="function" start="6" pair-end="16" select="quick">count</span></a><span class="parenthesis">(</span><span class="variable" start="12" select="quick">$min</span><span class="parenthesis" start="16">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2649"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?x">x</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="function" start="1" pair-end="13" select="quick">xs:integer</span><span class="parenthesis">(</span><span class="context" start="12">.</span><span class="parenthesis" start="13">)</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx2672" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2674"><span class="es">&lt;</span><span class="enxsl">xsl:if</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$min</span><span class="filter" start="5" pair-end="8" select="quick">[</span><span class="variable" start="6" select="quick">$x</span><span class="filter" start="8">]</span><span class="whitespace" start="9"> </span><span class="op" start="10">eq</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$new</span><span class="filter" start="17" pair-end="20" select="quick">[</span><span class="variable" start="18" select="quick">$x</span><span class="filter" start="20">]</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2694"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$min</span><span class="filter" start="5" pair-end="8" select="quick">[</span><span class="variable" start="6" select="quick">$x</span><span class="filter" start="8">]</span><span class="z">"</span><span id="wx2705" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:if</span><span id="wx2709" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2713" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx2717" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w2719"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-all-files">f:get-all-files</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w2735"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-uri">new-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx2749" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w2751"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?uri-list">uri-list</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span id="wx2765" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2767"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?add-uri">add-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="higher" start="1">for</span><span class="whitespace" start="4"> </span><span id="rng-$file" class="variable" start="5" select="quick">$file</span><span class="whitespace" start="10"> </span><span class="op" start="11">in</span><span class="whitespace" start="13"> </span><span class="variable" start="14" select="quick">$new-uri</span><span class="whitespace" start="22"> </span><span class="op" start="23">return</span><span class="whitespace" start="29">
                          </span><span class="if" start="30">if</span><span class="whitespace" start="32"> </span><span class="parenthesis" start="33" pair-end="53" select="quick">(</span><span class="variable" start="34" select="quick">$file</span><span class="whitespace" start="39"> </span><span class="op" start="40">=</span><span class="whitespace" start="41"> </span><span class="parenthesis" start="42" pair-end="52" select="quick">(</span><span class="variable" start="43" select="quick">$uri-list</span><span class="parenthesis" start="52">)</span><span class="parenthesis" start="53">)</span><span class="whitespace" start="54"> </span><span class="op" start="55">then</span><span class="whitespace" start="59"> </span><span class="parenthesis" start="60" pair-end="61" select="quick">(</span><span class="parenthesis" start="61">)</span><span class="whitespace" start="62"> </span><span class="op" start="63">else</span><span class="whitespace" start="67"> </span><span class="variable" start="68" select="quick">$file</span><span class="z">"</span><span id="wx2816" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2818"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?new-externals">new-externals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2834"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$add-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2844"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doc">doc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function" start="1" pair-end="6" select="quick">doc</span></a><span class="parenthesis">(</span><span class="context" start="5">.</span><span class="parenthesis" start="6">)</span><span class="z">"</span><span id="wx2861" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w2863"><span class="es">&lt;</span><span class="enxsl">xsl:for-each</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$doc</span><span class="step" start="5">/</span><span class="qname" start="6" select="quick">*</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">xsl:import</span><span class="step" start="18">/</span><span class="axis" start="19">@</span><span class="qname" start="20" select="quick">href</span><span class="op" start="24">|</span><span class="variable" start="25" select="quick">$doc</span><span class="step" start="29">/</span><span class="qname" start="30" select="quick">*</span><span class="step" start="31">/</span><span class="qname" start="32" select="quick">xsl:include</span><span class="step" start="43">/</span><span class="axis" start="44">@</span><span class="qname" start="45" select="quick">href</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w2889"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-resolve-uri" class="solar"><span class="function" start="1" pair-end="30" select="quick">resolve-uri</span></a><span class="parenthesis">(</span><span class="context" start="13">.</span><span class="op" start="14">,</span><span class="whitespace" start="15"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-base-uri" class="solar"><span class="function" start="16" pair-end="29" select="quick">base-uri</span></a><span class="parenthesis">(</span><span class="variable" start="25" select="quick">$doc</span><span class="parenthesis" start="29">)</span><span class="parenthesis" start="30">)</span><span class="z">"</span><span id="wx2906" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2910" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:for-each</span><span id="wx2914" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:variable</span><span id="wx2918" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2920"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?concat-sequence">concat-sequence</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="parenthesis" start="1" pair-end="21" select="quick">(</span><span class="variable" start="2" select="quick">$uri-list</span><span class="op" start="11">,</span><span class="whitespace" start="12"> </span><span class="variable" start="13" select="quick">$add-uri</span><span class="parenthesis" start="21">)</span><span class="z">"</span><span id="wx2939" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w2941"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w2945"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-exists" class="solar"><span class="function" start="1" pair-end="22" select="quick">exists</span></a><span class="parenthesis">(</span><span class="variable" start="8" select="quick">$new-externals</span><span class="parenthesis" start="22">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2958"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}get-all-files" class="solar"><span class="function" start="1" pair-end="49" select="quick">f:get-all-files</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$new-externals</span><span class="op" start="31">,</span><span class="whitespace" start="32"> </span><span class="variable" start="33" select="quick">$concat-sequence</span><span class="parenthesis" start="49">)</span><span class="z">"</span><span id="wx2972" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx2976" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w2978"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w2982"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$concat-sequence</span><span class="z">"</span><span id="wx2990" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx2994" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx2998" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3002" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="z">&lt;!--</span><span class="cm">
  sample globals elements:
  &lt;doc-prefix&gt;xsl&lt;/doc-prefix&gt;
  &lt;function name="do-something" ns="internal"/&gt;
  &lt;function name="somethin-else" ns="internal"/&gt;
  &lt;template name="output-days" ns=""/&gt;
  &lt;variable name="my-global" ns=""/&gt;
  </span><span class="z">--&gt;</span><span class="txt">
  
  </span><span class="ww" id="w3008"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}get-globals">f:get-globals</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3024"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-uri">file-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx3038" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3040"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?doc">doc</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-doc" class="solar"><span class="function" start="1" pair-end="14" select="quick">doc</span></a><span class="parenthesis">(</span><span class="variable" start="5" select="quick">$file-uri</span><span class="parenthesis" start="14">)</span><span class="z">"</span><span id="wx3057" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3059"><span class="es">&lt;</span><span class="en">doc-prefix</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3063"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-prefix-from-QName" class="solar"><span class="function" start="1" pair-end="36" select="quick">prefix-from-QName</span></a><span class="parenthesis">(</span><a href="http://www.w3.org/TR/xpath-functions/#func-node-name" class="solar"><span class="function" start="19" pair-end="35" select="quick">node-name</span></a><span class="parenthesis">(</span><span class="variable" start="29" select="quick">$doc</span><span class="step" start="33">/</span><span class="qname" start="34" select="quick">*</span><span class="parenthesis" start="35">)</span><span class="parenthesis" start="36">)</span><span class="z">"</span><span id="wx3079" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">doc-prefix</span><span id="wx3083" class="ec">&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3085"><span class="es">&lt;</span><span class="en">templates</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3089"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$doc</span><span class="step" start="5">/</span><span class="qname" start="6" select="quick">*</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">xsl:template</span><span class="filter" start="20" pair-end="26" select="quick">[</span><span class="axis" start="21">@</span><span class="qname" start="22" select="quick">name</span><span class="filter" start="26">]</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx3111" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">templates</span><span id="wx3115" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3117"><span class="es">&lt;</span><span class="en">functions</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3121"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$doc</span><span class="step" start="5">/</span><span class="qname" start="6" select="quick">*</span><span class="step" start="7">/</span><span class="qname" start="8" select="quick">xsl:function</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx3139" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">functions</span><span id="wx3143" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3145"><span class="es">&lt;</span><span class="en">variables</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3149"><span class="es">&lt;</span><span class="enxsl">xsl:apply-templates</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$doc</span><span class="step" start="5">/</span><span class="qname" start="6" select="quick">*</span><span class="step" start="7">/</span><span class="parenthesis" start="8" pair-end="31" select="quick">(</span><span class="qname" start="9" select="quick">xsl:variable</span><span class="op" start="21">|</span><span class="qname" start="22" select="quick">xsl:param</span><span class="parenthesis" start="31">)</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span id="wx3171" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="cl">variables</span><span id="wx3175" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3179" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3181"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">match</span><span class="atneq">=</span><span class="z">"</span><span class="qname" start="1" select="quick">xsl:template</span><span class="op" start="13">|</span><span class="qname" start="14" select="quick">xsl:function</span><span class="op" start="26">|</span><span class="qname" start="27" select="quick">xsl:variable</span><span class="op" start="39">|</span><span class="qname" start="40" select="quick">xsl:param</span><span class="z">"</span><span class="z"> </span><span class="atn">mode</span><span class="atneq">=</span><span class="z">"</span><span class="av">globals</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3203"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?after-colon">after-colon</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-after" class="solar"><span class="function" start="1" pair-end="27" select="quick">substring-after</span></a><span class="parenthesis">(</span><span class="axis" start="17">@</span><span class="qname" start="18" select="quick">name</span><span class="op" start="22">,</span><span class="whitespace" start="23"> </span><span class="op">'</span><span class="literal" start="24">:</span><span class="op">'</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx3226" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3228"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?local">local</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="23" select="quick">(</span><span class="variable" start="5" select="quick">$after-colon</span><span class="whitespace" start="17"> </span><span class="op" start="18">eq</span><span class="whitespace" start="20"> </span><span class="op">'</span><span class="literal" start="21"></span><span class="op">'</span><span class="parenthesis" start="23">)</span><span class="whitespace" start="24"> </span><span class="op" start="25">then</span><span class="whitespace" start="29"> </span><span class="axis" start="30">@</span><span class="qname" start="31" select="quick">name</span><span class="whitespace" start="35"> </span><span class="op" start="36">else</span><span class="whitespace" start="40"> </span><span class="variable" start="41" select="quick">$after-colon</span><span class="z">"</span><span id="wx3261" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3263"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?prefix">prefix</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-substring-before" class="solar"><span class="function" start="1" pair-end="28" select="quick">substring-before</span></a><span class="parenthesis">(</span><span class="axis" start="18">@</span><span class="qname" start="19" select="quick">name</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="op">'</span><span class="literal" start="25">:</span><span class="op">'</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx3286" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="z">&lt;!--</span><span class="cm">
    &lt;item name="{$local}" ns="{namespace-uri-for-prefix($prefix, .)}"/&gt;
    </span><span class="z">--&gt;</span><span class="txt">
    </span><span class="ww" id="w3292"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?clark-name">clark-name</span><span class="z">"</span><span class="z">
                  </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="18" select="quick">(</span><span class="variable" start="5" select="quick">$prefix</span><span class="whitespace" start="12"> </span><span class="op" start="13">eq</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16"></span><span class="op">'</span><span class="parenthesis" start="18">)</span><span class="whitespace" start="19"> </span><span class="op" start="20">then</span><span class="whitespace" start="24">
                          </span><span class="variable" start="25" select="quick">$local</span><span class="whitespace" start="31">
                          </span><span class="op" start="32">else</span><span class="whitespace" start="36"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="37" pair-end="98" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="44">{</span><span class="op">'</span><span class="op" start="47">,</span><span class="whitespace" start="48">
                          </span><a href="http://www.w3.org/TR/xpath-functions/#func-namespace-uri-for-prefix" class="solar"><span class="function" start="49" pair-end="84" select="quick">namespace-uri-for-prefix</span></a><span class="parenthesis">(</span><span class="variable" start="74" select="quick">$prefix</span><span class="op" start="81">,</span><span class="whitespace" start="82"> </span><span class="context" start="83">.</span><span class="parenthesis" start="84">)</span><span class="op" start="85">,</span><span class="whitespace" start="86">
                          </span><span class="op">'</span><span class="literal" start="87">}</span><span class="op">'</span><span class="op" start="90">,</span><span class="whitespace" start="91"> </span><span class="variable" start="92" select="quick">$local</span><span class="parenthesis" start="98">)</span><span class="z">"</span><span id="wx3346" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3348"><span class="es">&lt;</span><span class="en">item</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w3352"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$clark-name</span><span class="z">"</span><span id="wx3360" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">item</span><span id="wx3364" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3368" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3370"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?output-html-doc">output-html-doc</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3380"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?result-spans">result-spans</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">element()*</span><span class="z">"</span><span id="wx3394" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3396"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?filename">filename</span><span class="z">"</span><span id="wx3404" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3406"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?css-link">css-link</span><span class="z">"</span><span id="wx3414" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3416"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function" start="1" pair-end="26" select="quick">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$filename</span><span class="parenthesis" start="26">)</span><span class="z">"</span><span id="wx3433" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3435"><span class="es">&lt;</span><span class="enxsl">xsl:result-document</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><a href="http://www.w3.org/TR/xpath-functions/#func-concat" class="solar"><span class="function" start="1" pair-end="37" select="quick">concat</span></a><span class="parenthesis">(</span><span class="op">'</span><span class="literal" start="8">output/</span><span class="op">'</span><span class="op" start="17">,</span><span class="whitespace" start="18"> </span><span class="variable" start="19" select="quick">$filename</span><span class="op" start="28">,</span><span class="whitespace" start="29"> </span><span class="op">'</span><span class="literal" start="30">.html</span><span class="op">'</span><span class="parenthesis" start="37">)</span><span class="op">}</span><span class="z">"</span><span class="z"> </span><span class="atn">method</span><span class="atneq">=</span><span class="z">"</span><span class="av">html</span><span class="z">"</span><span class="z"> </span><span class="atn">indent</span><span class="atneq">=</span><span class="z">"</span><span class="av">no</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3472"><span class="es">&lt;</span><span class="enxsl">xsl:text</span><span class="z"> </span><span class="atn">disable-output-escaping</span><span class="atneq">=</span><span class="z">'</span><span class="av">yes</span><span class="z">'</span><span class="scx">&gt;</span><span class="txt">&amp;lt;!DOCTYPE html&gt;</span><span class="ez">&lt;/</span><span class="clxsl">xsl:text</span><span id="wx3484" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3486"><span class="es">&lt;</span><span class="en">html</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="ww" id="w3490"><span class="es">&lt;</span><span class="en">head</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3494"><span class="es">&lt;</span><span class="en">title</span><span class="scx">&gt;</span><span class="txt"></span><span class="ww" id="w3498"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$file-only</span><span class="z">"</span><span id="wx3506" class="sc">/&gt;</span></span><span class="txt"></span><span class="ez">&lt;/</span><span class="cl">title</span><span id="wx3510" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ww" id="w3512"><span class="es">&lt;</span><span class="en">link</span><span class="z"> </span><span class="atn">rel</span><span class="atneq">=</span><span class="z">"</span><span class="av">stylesheet</span><span class="z">"</span><span class="z"> </span><span class="atn">type</span><span class="atneq">=</span><span class="z">"</span><span class="av">text/css</span><span class="z">"</span><span class="z"> </span><span class="atn">href</span><span class="atneq">=</span><span class="z">"</span><span class="op">{</span><span class="variable" start="1" select="quick">$css-link</span><span class="op">}</span><span class="z">"</span><span id="wx3534" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">head</span><span id="wx3538" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3540"><span class="es">&lt;</span><span class="en">body</span><span class="scx">&gt;</span><span class="txt">
          </span><span class="ww" id="w3544"><span class="es">&lt;</span><span class="en">div</span><span class="scx">&gt;</span><span class="txt">
            </span><span class="ww" id="w3548"><span class="es">&lt;</span><span class="en">p</span><span class="z"> </span><span class="atn">class</span><span class="atneq">=</span><span class="z">"</span><span class="av">spectrum</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
              </span><span class="z">&lt;!--</span><span class="cm"> Call to imported functions returns sequence of span elements
                   with class attribute values used to colorise with CSS
              </span><span class="z">--&gt;</span><span class="txt">
              </span><span class="ww" id="w3562"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$result-spans</span><span class="z">"</span><span id="wx3570" class="sc">/&gt;</span></span><span class="txt">
            </span><span class="ez">&lt;/</span><span class="cl">p</span><span id="wx3574" class="ec">&gt;</span></span><span class="txt">
          </span><span class="ez">&lt;/</span><span class="cl">div</span><span id="wx3578" class="ec">&gt;</span></span><span class="txt">
        </span><span class="ez">&lt;/</span><span class="cl">body</span><span id="wx3582" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="cl">html</span><span id="wx3586" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:result-document</span><span id="wx3590" class="ec">&gt;</span></span><span class="txt">
    
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3594" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3596"><span class="es">&lt;</span><span class="enxsl">xsl:function</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="fname" id="f?{internal}file-from-uri">f:file-from-uri</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3606"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?uri">uri</span><span class="z">"</span><span id="wx3614" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3616"><span class="es">&lt;</span><span class="enxsl">xsl:value-of</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-tokenize" class="solar"><span class="function" start="1" pair-end="22" select="quick">tokenize</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$uri</span><span class="op" start="14">,</span><span class="whitespace" start="15"> </span><span class="op">'</span><span class="literal" start="16">/|\\</span><span class="op">'</span><span class="parenthesis" start="22">)</span><span class="filter" start="23" pair-end="30" select="quick">[</span><a href="http://www.w3.org/TR/xpath-functions/#func-last" class="solar"><span class="function" start="24" pair-end="29" select="quick">last</span></a><span class="parenthesis">(</span><span class="parenthesis" start="29">)</span><span class="filter" start="30">]</span><span class="z">"</span><span id="wx3637" class="sc">/&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:function</span><span id="wx3641" class="ec">&gt;</span></span><span class="txt">
  
  </span><span class="ww" id="w3643"><span class="es">&lt;</span><span class="enxsl">xsl:template</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="tname" id="t?get-result-spans">get-result-spans</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
    </span><span class="ww" id="w3653"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?input-uri">input-uri</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span id="wx3667" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3669"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xml">is-xml</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3683" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3685"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?is-xsl">is-xsl</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:boolean</span><span class="z">"</span><span id="wx3699" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3701"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?indent-size">indent-size</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3715" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3717"><span class="es">&lt;</span><span class="enxsl">xsl:param</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?root-prefix">root-prefix</span><span class="z">"</span><span id="wx3725" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3727"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-content">file-content</span><span class="z">"</span><span class="z"> </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:string</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="http://www.w3.org/TR/xpath-functions/#func-unparsed-text" class="solar"><span class="function" start="1" pair-end="25" select="quick">unparsed-text</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$input-uri</span><span class="parenthesis" start="25">)</span><span class="z">"</span><span id="wx3750" class="sc">/&gt;</span></span><span class="txt">
    </span><span class="ww" id="w3752"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?file-only">file-only</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="highlight-file.xsl.html#f?{internal}file-from-uri" class="solar"><span class="function" start="1" pair-end="27" select="quick">f:file-from-uri</span></a><span class="parenthesis">(</span><span class="variable" start="17" select="quick">$input-uri</span><span class="parenthesis" start="27">)</span><span class="z">"</span><span id="wx3769" class="sc">/&gt;</span></span><span class="txt">
    
    </span><span class="ww" id="w3771"><span class="es">&lt;</span><span class="enxsl">xsl:choose</span><span class="scx">&gt;</span><span class="txt">
      </span><span class="ww" id="w3775"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xml</span><span class="whitespace" start="8"> </span><span class="op" start="9">and</span><span class="whitespace" start="12"> </span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable" start="13" select="quick">$indent-size</span></a><span class="whitespace" start="25"> </span><span class="op" start="26">lt</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">0</span><span class="whitespace" start="30"> </span><span class="op" start="31">and</span><span class="whitespace" start="34"> </span><a href="http://www.w3.org/TR/xpath-functions/#func-not" class="solar"><span class="function" start="35" pair-end="47" select="quick">not</span></a><span class="parenthesis">(</span><a href="highlight-file.xsl.html#v?do-trim" class="solar"><span class="variable" start="39" select="quick">$do-trim</span></a><span class="parenthesis" start="47">)</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is embedded in XML text </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w3804"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}render" class="solar"><span class="function" start="1" pair-end="46" select="quick">f:render</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$file-content</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$is-xsl</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$root-prefix</span><span class="parenthesis" start="46">)</span><span class="z">"</span><span id="wx3821" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3825" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3827"><span class="es">&lt;</span><span class="enxsl">xsl:when</span><span class="z"> </span><span class="atn">test</span><span class="atneq">=</span><span class="z">"</span><span class="variable" start="1" select="quick">$is-xml</span><span class="z">"</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is embedded in XML text and indentation required </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w3841"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?spans">spans</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}render" class="solar"><span class="function" start="1" pair-end="46" select="quick">f:render</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$file-content</span><span class="op" start="23">,</span><span class="whitespace" start="24"> </span><span class="variable" start="25" select="quick">$is-xsl</span><span class="op" start="32">,</span><span class="whitespace" start="33"> </span><span class="variable" start="34" select="quick">$root-prefix</span><span class="parenthesis" start="46">)</span><span class="z">"</span><span id="wx3864" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3866"><span class="es">&lt;</span><span class="enxsl">xsl:variable</span><span class="z"> </span><span class="atn">name</span><span class="atneq">=</span><span class="z">"</span><span class="vname" id="v?real-indent">real-indent</span><span class="z">"</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><span class="if" start="1">if</span><span class="whitespace" start="3"> </span><span class="parenthesis" start="4" pair-end="22" select="quick">(</span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable" start="5" select="quick">$indent-size</span></a><span class="whitespace" start="17"> </span><span class="op" start="18">lt</span><span class="whitespace" start="20"> </span><span class="numeric" start="21">0</span><span class="parenthesis" start="22">)</span><span class="whitespace" start="23"> </span><span class="op" start="24">then</span><span class="whitespace" start="28"> </span><span class="numeric" start="29">0</span><span class="whitespace" start="30"> </span><span class="op" start="31">else</span><span class="whitespace" start="35"> </span><a href="highlight-file.xsl.html#v?indent-size" class="solar"><span class="variable" start="36" select="quick">$indent-size</span></a><span class="z">"</span><span class="z">
                      </span><span class="atn">as</span><span class="atneq">=</span><span class="z">"</span><span class="av">xs:integer</span><span class="z">"</span><span id="wx3902" class="sc">/&gt;</span></span><span class="txt">
        </span><span class="ww" id="w3904"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{internal}indent" class="solar"><span class="function" start="1" pair-end="40" select="quick">f:indent</span></a><span class="parenthesis">(</span><span class="variable" start="10" select="quick">$spans</span><span class="op" start="16">,</span><span class="whitespace" start="17"> </span><span class="variable" start="18" select="quick">$real-indent</span><span class="op" start="30">,</span><span class="whitespace" start="31"> </span><a href="highlight-file.xsl.html#v?do-trim" class="solar"><span class="variable" start="32" select="quick">$do-trim</span></a><span class="parenthesis" start="40">)</span><span class="z">"</span><span id="wx3921" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:when</span><span id="wx3925" class="ec">&gt;</span></span><span class="txt">
      </span><span class="ww" id="w3927"><span class="es">&lt;</span><span class="enxsl">xsl:otherwise</span><span class="scx">&gt;</span><span class="txt">
        </span><span class="z">&lt;!--</span><span class="cm"> for case where XPath is standalone </span><span class="z">--&gt;</span><span class="txt">
        </span><span class="ww" id="w3935"><span class="es">&lt;</span><span class="enxsl">xsl:sequence</span><span class="z"> </span><span class="atn">select</span><span class="atneq">=</span><span class="z">"</span><a href="xmlspectrum.xsl.html#f?{com.qutoric.sketchpath.functions}showXPath" class="solar"><span class="function" start="1" pair-end="28" select="quick">loc:showXPath</span></a><span class="parenthesis">(</span><span class="variable" start="15" select="quick">$file-content</span><span class="parenthesis" start="28">)</span><span class="z">"</span><span id="wx3946" class="sc">/&gt;</span></span><span class="txt">
      </span><span class="ez">&lt;/</span><span class="clxsl">xsl:otherwise</span><span id="wx3950" class="ec">&gt;</span></span><span class="txt">
    </span><span class="ez">&lt;/</span><span class="clxsl">xsl:choose</span><span id="wx3954" class="ec">&gt;</span></span><span class="txt">
  </span><span class="ez">&lt;/</span><span class="clxsl">xsl:template</span><span id="wx3958" class="ec">&gt;</span></span><span class="txt">
  
</span><span class="ez">&lt;/</span><span class="clxsl">xsl:stylesheet</span><span id="wx3962" class="ec">&gt;</span></span><span class="txt">
</span></p></div></body></html>